From john.johansen@canonical.com  Tue Nov 17 11:13:49 2009
From: John Johansen <john.johansen@canonical.com>
Date: Fri, 10 Jul 2009 09:29:50 +0000 (-0700)
Subject: AppArmor: Correct mapping of file permissions.
Git-commit: 0fbb67a37fc861aa10d9072f315b0e6674be2456
Git-Repo: git://kernel.ubuntu.com/jj/apparmor-mainline.git AppArmor-2.4

AppArmor: Correct mapping of file permissions.

File permissions opened with an exec permission should be mapped to
the 'm' permission (mapped executable), not the 'x' permission (control
of execve transition).

Signed-off-by: John Johansen <john.johansen@canonical.com>
Signed-off-by: Andy Whitcroft <apw@canonical.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 security/apparmor/include/file.h |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/security/apparmor/include/file.h
+++ b/security/apparmor/include/file.h
@@ -200,7 +200,7 @@ static inline void aa_free_file_rules(st
 	aa_free_domain_entries(&rules->trans);
 }
 
-#define ACC_FMODE(x) (("\000\004\002\006"[(x)&O_ACCMODE]) | (((x) >> 5) & 0x1))
+#define ACC_FMODE(x) (("\000\004\002\006"[(x)&O_ACCMODE]) | (((x) << 1) & 0x40))
 
 /* from namei.c */
 #define ACC_MODE(x) ("\000\004\002\006"[(x)&O_ACCMODE])
