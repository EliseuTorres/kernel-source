From john.johansen@canonical.com  Tue Nov 17 11:13:49 2009
From: John Johansen <john.johansen@canonical.com>
Date: Wed, 26 Aug 2009 21:04:32 +0000 (-0700)
Subject: AppArmor: Fix mapping of pux to new internal permission format
Git-commit: 936afb68ec447026a201ff7210d6d15dace0c4b3
Git-Repo: git://kernel.ubuntu.com/jj/apparmor-mainline.git AppArmor-2.4

AppArmor: Fix mapping of pux to new internal permission format

BugLink: http://bugs.launchpad.net/bugs/419222

The mapping of pux (exec profile or unconfined) from old permission format
to the new internal format is missing so that pux does not work.

Signed-off-by: John Johansen <john.johansen@canonical.com>
Signed-off-by: Tim Gardner <tim.gardner@canonical.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 security/apparmor/include/file.h |    2 ++
 1 file changed, 2 insertions(+)

--- a/security/apparmor/include/file.h
+++ b/security/apparmor/include/file.h
@@ -110,6 +110,8 @@ static inline u16 dfa_map_xindex(u16 mas
 		index |= AA_X_UNSAFE;
 	if (mask & 0x200)
 		index |= AA_X_INHERIT;
+	if (mask & 0x80)
+		index |= AA_X_UNCONFINED;
 
 	if (old_index == 1) {
 		index |= AA_X_UNCONFINED;
