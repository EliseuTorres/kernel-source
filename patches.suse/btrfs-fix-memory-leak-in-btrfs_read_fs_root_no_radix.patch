From: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Date: Mon, 27 Dec 2010 06:53:10 +0000
Patch-mainline: yes
References: FATE#306586
Subject: [PATCH] btrfs: Fix memory leak in
 btrfs_read_fs_root_no_radix()

In btrfs_read_fs_root_no_radix(), 'root' is not freed if
btrfs_search_slot() returns error.

Signed-off-by: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Signed-off-by: Chris Mason <chris.mason@oracle.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/disk-io.c |    1 +
 1 file changed, 1 insertion(+)

--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -1155,6 +1155,7 @@ struct btrfs_root *btrfs_read_fs_root_no
 	}
 	btrfs_free_path(path);
 	if (ret) {
+		kfree(root);
 		if (ret > 0)
 			ret = -ENOENT;
 		return ERR_PTR(ret);
