From: "jeff.liu" <jeff.liu@oracle.com>
Date: Sat, 27 Oct 2012 12:06:39 +0000
Patch-mainline: 3.8
Git-commit: 0253f40ef9a709a1af39ce38b1d998af090f8127
References: FATE#312888
Subject: [PATCH] Btrfs: Remove the invalid shrink size check up from
 btrfs_shrink_dev()

Remove an invalid size check up from btrfs_shrink_dev().

The new size should not larger than the device->total_bytes as it was
already verified before coming to here(i.e. new_size < old_size).

Remove invalid check up for btrfs_shrink_dev().

Signed-off-by: Jie Liu <jeff.liu@oracle.com>
Signed-off-by: Chris Mason <chris.mason@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/ioctl.c   |    2 +-
 fs/btrfs/volumes.c |    3 ---
 2 files changed, 1 insertion(+), 4 deletions(-)

--- a/fs/btrfs/ioctl.c
+++ b/fs/btrfs/ioctl.c
@@ -1416,7 +1416,7 @@ static noinline int btrfs_ioctl_resize(s
 		btrfs_commit_transaction(trans, root);
 	} else if (new_size < old_size) {
 		ret = btrfs_shrink_device(device, new_size);
-	}
+	} /* equal, nothing need to do */
 
 out_free:
 	kfree(vol_args);
--- a/fs/btrfs/volumes.c
+++ b/fs/btrfs/volumes.c
@@ -3063,9 +3063,6 @@ int btrfs_shrink_device(struct btrfs_dev
 	u64 old_size = device->total_bytes;
 	u64 diff = device->total_bytes - new_size;
 
-	if (new_size >= device->total_bytes)
-		return -EINVAL;
-
 	path = btrfs_alloc_path();
 	if (!path)
 		return -ENOMEM;
