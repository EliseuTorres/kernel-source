From: Josef Bacik <jbacik@fusionio.com>
Date: Mon, 3 Jun 2013 16:51:23 -0400
Patch-mainline: 3.11
Git-commit: c69b26b0116dc2c064457991bec91b6d94e96d65
References: FATE#312888
Subject: [PATCH] Btrfs: add some missing iput()'s in
 btrfs_orphan_cleanup

There are some error cases that we don't do an iput() on our inode, fix this.
Thanks,

Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/inode.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

--- a/fs/btrfs/inode.c
+++ b/fs/btrfs/inode.c
@@ -3213,13 +3213,16 @@ int btrfs_orphan_cleanup(struct btrfs_ro
 			/* 1 for the orphan item deletion. */
 			trans = btrfs_start_transaction(root, 1);
 			if (IS_ERR(trans)) {
+				iput(inode);
 				ret = PTR_ERR(trans);
 				goto out;
 			}
 			ret = btrfs_orphan_add(trans, inode);
 			btrfs_end_transaction(trans, root);
-			if (ret)
+			if (ret) {
+				iput(inode);
 				goto out;
+			}
 
 			ret = btrfs_truncate(inode);
 			if (ret)
