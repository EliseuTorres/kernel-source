From: Mike Snitzer <snitzer@redhat.com>
Date: Mon, 24 May 2010 09:07:32 +0200
Subject: [PATCH] block: Adjust elv_iosched_show to return "none" for bio-based DM
X-Git: e36f724b4ae70e443a7d152929b60059cbfa1a26
References: FATE#311692
Patch-Mainline: 2.6.35

Bio-based DM doesn't use an elevator (queue is !blk_queue_stackable()).

Longer-term DM will not allocate an elevator for bio-based DM.  But even
then there will be small potential for an elevator to be allocated for
a request-based DM table only to have a bio-based table be loaded in the
end.

Displaying "none" for bio-based DM will help avoid user confusion.

Signed-off-by: Mike Snitzer <snitzer@redhat.com>
Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/elevator.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/block/elevator.c b/block/elevator.c
index 7f4cf2f..0081640 100644
--- a/block/elevator.c
+++ b/block/elevator.c
@@ -1107,7 +1107,7 @@ ssize_t elv_iosched_show(struct request_queue *q, char *name)
 	struct elevator_type *__e;
 	int len = 0;
 
-	if (!q->elevator)
+	if (!q->elevator || !blk_queue_stackable(q))
 		return sprintf(name, "none\n");
 
 	elv = e->elevator_type;
-- 
1.6.0.2

