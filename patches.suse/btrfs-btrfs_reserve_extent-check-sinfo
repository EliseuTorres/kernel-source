From: Jeff Mahoney <jeffm@suse.com>
Subject: btrfs: avoid NULL deref in btrfs_reserve_extent with DEBUG_ENOSPC
Patch-mainline: Eventually

 __find_space_info can return NULL but we don't check it before calling
 dump_space_info().

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 fs/btrfs/extent-tree.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/fs/btrfs/extent-tree.c
+++ b/fs/btrfs/extent-tree.c
@@ -5641,7 +5641,8 @@ again:
 		printk(KERN_ERR "btrfs allocation failed flags %llu, "
 		       "wanted %llu\n", (unsigned long long)data,
 		       (unsigned long long)num_bytes);
-		dump_space_info(sinfo, num_bytes, 1);
+		if (sinfo)
+			dump_space_info(sinfo, num_bytes, 1);
 	}
 
 	trace_btrfs_reserved_extent_alloc(root, ins->objectid, ins->offset);
