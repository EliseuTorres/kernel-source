From: Dan Carpenter <error27@gmail.com>
Subject: [PATCH 030/111] 9p: return on mutex_lock_interruptible()
Git-commit: 85a770a8889035625466a4cfb1393cd7d2ffd165
Patch-Mainline: 2.6.34
References: FATE#311639

    If "err" is -EINTR here the original code calls mutex_unlock() and then
    returns, but it should just return directly.

	upstream commit: 85a770a8889035625466a4cfb1393cd7d2ffd165

    Signed-off-by: Dan Carpenter <error27@gmail.com>
    Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 fs/9p/vfs_dir.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/fs/9p/vfs_dir.c b/fs/9p/vfs_dir.c
index d8a3afe..bbe00cf 100644
--- a/fs/9p/vfs_dir.c
+++ b/fs/9p/vfs_dir.c
@@ -130,6 +130,8 @@ static int v9fs_dir_readdir(struct file *filp, void *dirent, filldir_t filldir)
 	rdir = (struct p9_rdir *) fid->rdir;
 
 	err = mutex_lock_interruptible(&rdir->mutex);
+	if (err)
+		return err;
 	while (err == 0) {
 		if (rdir->tail == rdir->head) {
 			err = v9fs_file_readn(filp, rdir->buf, NULL,
-- 
1.7.1.1

