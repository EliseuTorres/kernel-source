From: Andrew Morton <akpm@linux-foundation.org>
Date: Mon, 23 Aug 2010 13:36:20 +0200
Subject: [PATCH] fs/bio-integrity.c: return -ENOMEM on kmalloc failure
X-Git: 220eb7fd984bfc7e6b4005fdf32efe9cd8af7cf2
References: FATE#311692
Patch-Mainline: 2.6.34

Cc: David Rientjes <rientjes@google.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 fs/bio-integrity.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/bio-integrity.c b/fs/bio-integrity.c
index a2660d6..8209786 100644
--- a/fs/bio-integrity.c
+++ b/fs/bio-integrity.c
@@ -415,7 +415,7 @@ int bio_integrity_prep(struct bio *bio)
 	buf = kmalloc(len, GFP_NOIO | q->bounce_gfp);
 	if (unlikely(buf == NULL)) {
 		printk(KERN_ERR "could not allocate integrity buffer\n");
-		return -EIO;
+		return -ENOMEM;
 	}
 
 	end = (((unsigned long) buf) + len + PAGE_SIZE - 1) >> PAGE_SHIFT;
-- 
1.6.0.2

