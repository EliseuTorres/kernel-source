From: Jeff Layton <jlayton@redhat.com>
Date: Mon, 26 Jul 2010 10:29:57 -0400
Subject: cifs: map NT_STATUS_ERROR_WRITE_PROTECTED to -EROFS
References: FATE#311695
Git-commit: 3572d2857f61f720082740cc17e2d99b45e7af7f
Patch-mainline: v2.6.36-rc1

Seems like a more sensible mapping than -EIO.

Signed-off-by: Jeff Layton <jlayton@redhat.com>
Signed-off-by: Steve French <sfrench@us.ibm.com>
Signed-off-by: Suresh Jayaraman <sjayaraman@suse.de>
---
 fs/cifs/netmisc.c |    1 +
 fs/cifs/smberr.h  |    1 +
 2 files changed, 2 insertions(+), 0 deletions(-)

Index: linux-2.6.32-SLE11-SP2/fs/cifs/netmisc.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/cifs/netmisc.c
+++ linux-2.6.32-SLE11-SP2/fs/cifs/netmisc.c
@@ -61,6 +61,7 @@ static const struct smb_to_posix_error m
 	{ERRremcd, -EACCES},
 	{ERRdiffdevice, -EXDEV},
 	{ERRnofiles, -ENOENT},
+	{ERRwriteprot, -EROFS},
 	{ERRbadshare, -ETXTBSY},
 	{ERRlock, -EACCES},
 	{ERRunsup, -EINVAL},
Index: linux-2.6.32-SLE11-SP2/fs/cifs/smberr.h
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/cifs/smberr.h
+++ linux-2.6.32-SLE11-SP2/fs/cifs/smberr.h
@@ -76,6 +76,7 @@
 #define ERRnofiles		18	/* A File Search command can find no
 					   more files matching the specified
 					   criteria. */
+#define ERRwriteprot		19	/* media is write protected */
 #define ERRgeneral		31
 #define ERRbadshare		32	/* The sharing mode specified for an
 					   Open conflicts with existing FIDs on
