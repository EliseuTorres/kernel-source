From: Josef Bacik <jbacik@fusionio.com>
Date: Fri, 5 Oct 2012 16:53:34 -0400
Patch-mainline: 3.7
Git-commit: f60b1b49f6f72abb8bedfd49b758773bbda043c8
References: FATE#312888
Subject: [PATCH] Btrfs: fix page leakage

Alloc_dummy_extent_buffer will not free the first page in the eb array if we
fail to allocate a page, fix this.  Thanks,

Reported-by: David Sterba <dave@jikos.cz>
Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/extent_io.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/fs/btrfs/extent_io.c
+++ b/fs/btrfs/extent_io.c
@@ -4106,7 +4106,7 @@ struct extent_buffer *alloc_dummy_extent
 
 	return eb;
 err:
-	for (i--; i > 0; i--)
+	for (i--; i >= 0; i--)
 		__free_page(eb->pages[i]);
 	__free_extent_buffer(eb);
 	return NULL;
