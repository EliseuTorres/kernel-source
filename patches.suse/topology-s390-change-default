Subject: [S390] topology: change default
From: Heiko Carstens <heiko.carstens@de.ibm.com>
Date: Mon Oct 25 16:10:43 2010 +0200
Git-commit: c9af3fa9e1e3e5154649991a14b74f3a2dee19ee
References: FATE#311860
Patch-mainline: v2.6.37-rc1

Switch default value of the kernel parameter 'topology' from off to on.
Various performance measurements have finally shown that there are no
(known) regressions anywhere.

Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: Mike Galbraith <mgalbraith@suse.de>

---
 Documentation/kernel-parameters.txt |    2 +-
 arch/s390/kernel/topology.c         |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

Index: linux-2.6.32-SLE11-SP2/Documentation/kernel-parameters.txt
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/Documentation/kernel-parameters.txt
+++ linux-2.6.32-SLE11-SP2/Documentation/kernel-parameters.txt
@@ -2564,7 +2564,7 @@ and is between 256 and 4096 characters.
 			topology informations if the hardware supports these.
 			The scheduler will make use of these informations and
 			e.g. base its process migration decisions on it.
-			Default is off.
+			Default is on.
 
 	tp720=		[HW,PS2]
 
Index: linux-2.6.32-SLE11-SP2/arch/s390/kernel/topology.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/arch/s390/kernel/topology.c
+++ linux-2.6.32-SLE11-SP2/arch/s390/kernel/topology.c
@@ -63,7 +63,7 @@ struct mask_info {
 	cpumask_t mask;
 };
 
-static int topology_enabled;
+static int topology_enabled = 1;
 static void topology_work_fn(struct work_struct *work);
 static struct tl_info *tl_info;
 static int machine_has_topology;
@@ -311,9 +311,9 @@ static void set_topology_timer(void)
 
 static int __init early_parse_topology(char *p)
 {
-	if (strncmp(p, "on", 2))
+	if (strncmp(p, "off", 3))
 		return 0;
-	topology_enabled = 1;
+	topology_enabled = 0;
 	return 0;
 }
 early_param("topology", early_parse_topology);

