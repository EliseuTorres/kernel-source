From: M. Mohan Kumar <mohan@in.ibm.com>
Subject: [PATCH 084/111]     9p: Use V9FS_MAGIC in statfs
Git-commit: 368c09d2a303c39e9f37193b23e945e6754cf0a7
Patch-Mainline: 2.6.37
References: FATE#311639

    Use V9FS_MAGIC as the file system type while filling kernel statfs
    strucutre instead of using host file system magic number. Also move
    the definition of V9FS_MAGIC from v9fs.h to standard magic.h file.

	upstream commit 368c09d2a303c39e9f37193b23e945e6754cf0a7

    Signed-off-by: M. Mohan Kumar <mohan@in.ibm.com>
    Signed-off-by: Venkateswararao Jujjuri <jvrao@linux.vnet.ibm.com>
    Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 fs/9p/v9fs.h          |    2 --
 fs/9p/vfs_super.c     |    3 ++-
 include/linux/magic.h |    1 +
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/fs/9p/v9fs.h b/fs/9p/v9fs.h
index 4c963c9..99b3faa 100644
--- a/fs/9p/v9fs.h
+++ b/fs/9p/v9fs.h
@@ -113,8 +113,6 @@ void v9fs_session_close(struct v9fs_session_info *v9ses);
 void v9fs_session_cancel(struct v9fs_session_info *v9ses);
 void v9fs_session_begin_cancel(struct v9fs_session_info *v9ses);
 
-#define V9FS_MAGIC 0x01021997
-
 /* other default globals */
 #define V9FS_PORT	564
 #define V9FS_DEFUSER	"nobody"
diff --git a/fs/9p/vfs_super.c b/fs/9p/vfs_super.c
index a9e1db5..2bf8339 100644
--- a/fs/9p/vfs_super.c
+++ b/fs/9p/vfs_super.c
@@ -38,6 +38,7 @@
 #include <linux/idr.h>
 #include <linux/sched.h>
 #include <linux/statfs.h>
+#include <linux/magic.h>
 #include <net/9p/9p.h>
 #include <net/9p/client.h>
 
@@ -246,7 +247,7 @@ static int v9fs_statfs(struct dentry *dentry, struct kstatfs *buf)
 	if (v9fs_proto_dotl(v9ses)) {
 		res = p9_client_statfs(fid, &rs);
 		if (res == 0) {
-			buf->f_type = rs.type;
+			buf->f_type = V9FS_MAGIC;
 			buf->f_bsize = rs.bsize;
 			buf->f_blocks = rs.blocks;
 			buf->f_bfree = rs.bfree;
diff --git a/include/linux/magic.h b/include/linux/magic.h
index 76285e0..6603a6a 100644
--- a/include/linux/magic.h
+++ b/include/linux/magic.h
@@ -58,5 +58,6 @@
 
 #define DEVPTS_SUPER_MAGIC	0x1cd1
 #define SOCKFS_MAGIC		0x534F434B
+#define V9FS_MAGIC		0x01021997
 
 #endif /* __LINUX_MAGIC_H__ */
-- 
1.7.1.1

