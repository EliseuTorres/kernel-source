From: Josef Bacik <jbacik@fusionio.com>
Date: Wed, 8 May 2013 13:30:11 -0400
Patch-mainline: 3.10
Git-commit: 69a85bd87cc81bcbd36730d4a1214c12fdb8a548
References: FATE#312888
Subject: [PATCH] Btrfs: don't null pointer deref on abort

I'm sorry, theres no excuse for this sort of work.  We need to use
root->leafsize since eb may be NULL.  Thanks,

Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/disk-io.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -3772,7 +3772,7 @@ static int btrfs_destroy_marked_extents(
 		while (start <= end) {
 			eb = btrfs_find_tree_block(root, start,
 						   root->leafsize);
-			start += eb->len;
+			start += root->leafsize;
 			if (!eb)
 				continue;
 			wait_on_extent_buffer_writeback(eb);
