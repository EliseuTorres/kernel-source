From: Filipe David Borba Manana <fdmanana@gmail.com>
Date: Wed, 31 Jul 2013 00:39:56 +0100
Patch-mainline: 3.12
Git-commit: 0f0fe8f710f29dbd4b2c915fc1c36962e4957b3b
References: FATE#312888
Subject: [PATCH] Btrfs: add missing error handling to read_tree_block

Signed-off-by: Filipe David Borba Manana <fdmanana@gmail.com>
Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: Chris Mason <chris.mason@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/disk-io.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -1132,6 +1132,10 @@ struct extent_buffer *read_tree_block(st
 		return NULL;
 
 	ret = btree_read_extent_buffer_pages(root, buf, 0, parent_transid);
+	if (ret) {
+		free_extent_buffer(buf);
+		return NULL;
+	}
 	return buf;
 
 }
