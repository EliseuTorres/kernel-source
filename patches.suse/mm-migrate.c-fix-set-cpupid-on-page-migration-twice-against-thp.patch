From: Wanpeng Li <liwanp@linux.vnet.ibm.com>
Date: Tue, 17 Dec 2013 10:45:52 +1100
Subject: [PATCH] mm/migrate.c: fix set cpupid on page migration twice against
 thp

References: Automatic NUMA Balancing (fate#315482)
Patch-mainline: No (expected v3.14)

7851a45cd3 (mm: numa: Copy cpupid on page migration) copies over the
cpupid at page migration time.  It is unnecessary to set it again in
migrate_misplaced_transhuge_page().

Signed-off-by: Wanpeng Li <liwanp@linux.vnet.ibm.com>
Acked-by: Mel Gorman <mgorman@suse.de>
Reviewed-by: Rik van Riel <riel@redhat.com>
Reviewed-by: Naoya Horiguchi <n-horiguchi@ah.jp.nec.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 mm/migrate.c | 2 --
 1 file changed, 2 deletions(-)

diff --git a/mm/migrate.c b/mm/migrate.c
index 48248de..85b628f 100644
--- a/mm/migrate.c
+++ b/mm/migrate.c
@@ -1758,8 +1758,6 @@ int migrate_misplaced_transhuge_page(struct mm_struct *mm,
 	if (!new_page)
 		goto out_fail;
 
-	page_cpupid_xchg_last(new_page, page_cpupid_last(page));
-
 	isolated = numamigrate_isolate_page(pgdat, page);
 	if (!isolated) {
 		put_page(new_page);
