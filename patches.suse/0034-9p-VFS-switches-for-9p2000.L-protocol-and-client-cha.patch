From: Sripathi Kodi <sripathik@in.ibm.com>
Subject: [PATCH 034/111]     9p: VFS switches for 9p2000.L: protocol and client changes
Git-commit: c56e4acf55c804cbeea0ddb696ef698c73d39826
Patch-Mainline: 2.6.35
References: FATE#311639

    Prepare p9pdu_read/write functions to handle multiple protocols.

	upstream commit c56e4acf55c804cbeea0ddb696ef698c73d39826

    Signed-off-by: Sripathi Kodi <sripathik@in.ibm.com>
    Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 net/9p/client.c   |    3 ++-
 net/9p/protocol.c |    6 ++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/net/9p/client.c b/net/9p/client.c
index 20a3319..b59a46a 100644
--- a/net/9p/client.c
+++ b/net/9p/client.c
@@ -1320,7 +1320,8 @@ static int p9_client_statsize(struct p9_wstat *wst, int proto_version)
 	if (wst->muid)
 		ret += strlen(wst->muid);
 
-	if (proto_version == p9_proto_2000u) {
+	if ((proto_version == p9_proto_2000u) ||
+		(proto_version == p9_proto_2000L)) {
 		ret += 2+4+4+4;	/* extension[s] n_uid[4] n_gid[4] n_muid[4] */
 		if (wst->extension)
 			ret += strlen(wst->extension);
diff --git a/net/9p/protocol.c b/net/9p/protocol.c
index 94f5a8f..d6bc02f 100644
--- a/net/9p/protocol.c
+++ b/net/9p/protocol.c
@@ -340,7 +340,8 @@ p9pdu_vreadf(struct p9_fcall *pdu, int proto_version, const char *fmt,
 			}
 			break;
 		case '?':
-			if (proto_version != p9_proto_2000u)
+			if ((proto_version != p9_proto_2000u) &&
+				(proto_version != p9_proto_2000L))
 				return 0;
 			break;
 		default:
@@ -487,7 +488,8 @@ p9pdu_vwritef(struct p9_fcall *pdu, int proto_version, const char *fmt,
 			}
 			break;
 		case '?':
-			if (proto_version != p9_proto_2000u)
+			if ((proto_version != p9_proto_2000u) &&
+				(proto_version != p9_proto_2000L))
 				return 0;
 			break;
 		default:
-- 
1.7.1.1

