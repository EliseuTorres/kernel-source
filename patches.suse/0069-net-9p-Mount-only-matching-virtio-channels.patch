From: Sven Eckelmann <sven.eckelmann@gmx.de>
Subject: [PATCH 069/111]     net/9p: Mount only matching virtio channels
Git-commit: 0b20406cda621c2495d10baab1e87127ceb43337
Patch-Mainline: 2.6.36
References: FATE#311639

    p9_virtio_create will only compare the the channel's tag characters
    against the device name till the end of the channel's tag but not till
    the end of the device name. This means that if a user defines channels
    with the tags foo and foobar then he would mount foo when he requested
    foonot and may mount foo when he requested foobar.

    Thus it is necessary to check both string lengths against each other in
    case of a successful partial string match.

	upstream commit 0b20406cda621c2495d10baab1e87127ceb43337
    Signed-off-by: Sven Eckelmann <sven.eckelmann@gmx.de>
    Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 net/9p/trans_virtio.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/net/9p/trans_virtio.c b/net/9p/trans_virtio.c
index afde1a8..c0027e1 100644
--- a/net/9p/trans_virtio.c
+++ b/net/9p/trans_virtio.c
@@ -328,7 +328,8 @@ p9_virtio_create(struct p9_client *client, const char *devname, char *args)
 
 	mutex_lock(&virtio_9p_lock);
 	list_for_each_entry(chan, &virtio_chan_list, chan_list) {
-		if (!strncmp(devname, chan->tag, chan->tag_len)) {
+		if (!strncmp(devname, chan->tag, chan->tag_len) &&
+		    strlen(devname) == chan->tag_len) {
 			if (!chan->inuse) {
 				chan->inuse = true;
 				found = 1;
-- 
1.7.1.1

