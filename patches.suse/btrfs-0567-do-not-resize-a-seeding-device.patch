From: Liu Bo <liubo2009@cn.fujitsu.com>
Date: Thu, 14 Jun 2012 02:23:19 -0600
Patch-mainline: 3.5
Git-commit: 4e42ae1bdcda77fc958a17d7ff4ba5a9c9c207da
References: FATE#312888
Subject: [PATCH] Btrfs: do not resize a seeding device

Seeding devices are not supposed to change any more.

Signed-off-by: Liu Bo <liubo2009@cn.fujitsu.com>
Signed-off-by: Chris Mason <chris.mason@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/ioctl.c |    7 +++++++
 1 file changed, 7 insertions(+)

--- a/fs/btrfs/ioctl.c
+++ b/fs/btrfs/ioctl.c
@@ -1313,6 +1313,13 @@ static noinline int btrfs_ioctl_resize(s
 		ret = -EINVAL;
 		goto out_free;
 	}
+	if (device->fs_devices && device->fs_devices->seeding) {
+		printk(KERN_INFO "btrfs: resizer unable to apply on "
+		       "seeding device %llu\n", devid);
+		ret = -EINVAL;
+		goto out_free;
+	}
+
 	if (!strcmp(sizestr, "max"))
 		new_size = device->bdev->bd_inode->i_size;
 	else {
