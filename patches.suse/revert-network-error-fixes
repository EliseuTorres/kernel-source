From: Lifeng Sun <lifongsun@gmail.com>
Date: Wed Apr 27 22:04:51 2011 +0000
Subject: inappropriate ioctl operation should return ENOTTY
Patch-mainline: reverse
References: bnc#717500

This patch reverses mainline commit 41c31f318a5209922d051e293c61e4724daad11c
The original rationale was:    

    ioctl() calls against a socket with an inappropriate ioctl operation
    are incorrectly returning EINVAL rather than ENOTTY:
    
      [ENOTTY]
          Inappropriate I/O control operation.
    
    BugLink: https://bugzilla.kernel.org/show_bug.cgi?id=33992
    
    Signed-off-by: Lifeng Sun <lifongsun@gmail.com>
    Signed-off-by: David S. Miller <davem@davemloft.net>

Since this is a service pack / maintenance kernel, it should not unnecessarily
change its behaviour, and remain backward compatible where appropriate; so
restore the old, wrong error codes.

Acked-by: Torsten Duwe <duwe@suse.de>

---
 net/core/dev.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)
diff --git a/net/core/dev.c b/net/core/dev.c
index c2ac599..856b6ee 100644
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -4773,7 +4773,7 @@ static int dev_ifsioc_locked(struct net *net, struct ifreq *ifr, unsigned int cm
 		 * is never reached
 		 */
 		WARN_ON(1);
-		err = -ENOTTY;
+		err = -EINVAL;
 		break;
 
 	}
@@ -5041,7 +5041,7 @@ int dev_ioctl(struct net *net, unsigned int cmd, void __user *arg)
 		/* Set the per device memory buffer space.
 		 * Not applicable in our case */
 	case SIOCSIFLINK:
-		return -ENOTTY;
+		return -EINVAL;
 
 	/*
 	 *	Unknown or private ioctl.
@@ -5062,7 +5062,7 @@ int dev_ioctl(struct net *net, unsigned int cmd, void __user *arg)
 		/* Take care of Wireless Extensions */
 		if (cmd >= SIOCIWFIRST && cmd <= SIOCIWLAST)
 			return wext_handle_ioctl(net, &ifr, cmd, arg);
-		return -ENOTTY;
+		return -EINVAL;
 	}
 }
 
