From: David Rientjes <rientjes@google.com>
Date: Mon, 23 Aug 2010 13:35:09 +0200
Subject: [PATCH] bio-integrity.c: remove dependency on __GFP_NOFAIL
Git-commit: 72f465033702ebfe20db8f50edaad59f0f38b0f5
References: FATE#311692
Patch-Mainline: 2.6.36

The kmalloc() in bio_integrity_prep() is failable, so remove __GFP_NOFAIL
from its mask.

Signed-off-by: David Rientjes <rientjes@google.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 fs/bio-integrity.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/bio-integrity.c b/fs/bio-integrity.c
index a16f29e..a2660d6 100644
--- a/fs/bio-integrity.c
+++ b/fs/bio-integrity.c
@@ -412,7 +412,7 @@ int bio_integrity_prep(struct bio *bio)
 
 	/* Allocate kernel buffer for protection data */
 	len = sectors * blk_integrity_tuple_size(bi);
-	buf = kmalloc(len, GFP_NOIO | __GFP_NOFAIL | q->bounce_gfp);
+	buf = kmalloc(len, GFP_NOIO | q->bounce_gfp);
 	if (unlikely(buf == NULL)) {
 		printk(KERN_ERR "could not allocate integrity buffer\n");
 		return -EIO;
-- 
1.6.0.2

