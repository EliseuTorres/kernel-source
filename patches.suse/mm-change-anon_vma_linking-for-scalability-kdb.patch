From: Mel Gorman <mgorman@suse.de>
Date: Fri, 13 May 2011 09:49:09 +0100
Subject: [PATCH] mm: change anon_vma linking to fix multi-process server scalability issue kdb
References: anon_vma scalability (fate#311931)
Patch-mainline: no

anon_vma information printing for kdb.

Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 kdb/modules/kdbm_vm.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/kdb/modules/kdbm_vm.c b/kdb/modules/kdbm_vm.c
index c34ac4f..6e03471 100644
--- a/kdb/modules/kdbm_vm.c
+++ b/kdb/modules/kdbm_vm.c
@@ -15,6 +15,7 @@
 #include <linux/mm.h>
 #include <linux/swap.h>
 #include <linux/swapops.h>
+#include <linux/rmap.h>
 
 #include <scsi/scsi.h>
 #include <scsi/scsi_cmnd.h>
@@ -90,8 +91,8 @@ kdbm_print_vm(struct vm_area_struct *vp, unsigned long addr, int verbose_flg)
 	kdb_printf("shared.vm_set.list.prev = 0x%p\n", (void *) vp->shared.vm_set.list.prev);
 	kdb_printf("shared.vm_set.parent = 0x%p\n", (void *) vp->shared.vm_set.parent);
 	kdb_printf("shared.vm_set.head = 0x%p\n", (void *) vp->shared.vm_set.head);
-	kdb_printf("anon_vma_node.next = 0x%p\n", (void *) vp->anon_vma_node.next);
-	kdb_printf("anon_vma_node.prev = 0x%p\n", (void *) vp->anon_vma_node.prev);
+	kdb_printf("anon_vma root = 0x%p\n", (void *) vp->anon_vma->root);
+	kdb_printf("anon_vma = 0x%p\n", (void *) vp->anon_vma);
 	kdb_printf("vm_ops = 0x%p\n", (void *) vp->vm_ops);
 	if (vp->vm_ops != NULL) {
 		kdb_printf("vm_ops->open = 0x%p\n", vp->vm_ops->open);
