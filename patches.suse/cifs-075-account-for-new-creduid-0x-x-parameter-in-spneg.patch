From: Jeff Layton <jlayton@redhat.com>
Date: Tue, 3 Aug 2010 10:19:50 -0400
Subject: cifs: account for new creduid=0x%x parameter in spnego upcall string
References: FATE#311695
Git-commit: ba5dadbf4e7b531bd7ccecffb4d3935c80a3372e
Patch-mainline: v2.6.36-rc1

The commit that added the creduid=0x%x parameter failed to increase the
buffer allocation to account for it.

Reported-by: J. Bruce Fields <bfields@fieldses.org>
Signed-off-by: Jeff Layton <jlayton@redhat.com>
Signed-off-by: Steve French <sfrench@us.ibm.com>
Signed-off-by: Suresh Jayaraman <sjayaraman@suse.de>
---
 fs/cifs/cifs_spnego.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

Index: linux-2.6.32-SLE11-SP2/fs/cifs/cifs_spnego.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/cifs/cifs_spnego.c
+++ linux-2.6.32-SLE11-SP2/fs/cifs/cifs_spnego.c
@@ -83,6 +83,9 @@ struct key_type cifs_spnego_key_type = {
 /* strlen of ";uid=0x" */
 #define UID_KEY_LEN		7
 
+/* strlen of ";creduid=0x" */
+#define CREDUID_KEY_LEN		11
+
 /* strlen of ";user=" */
 #define USER_KEY_LEN		6
 
@@ -106,6 +109,7 @@ cifs_get_spnego_key(struct cifsSesInfo *
 		   IP_KEY_LEN + INET6_ADDRSTRLEN +
 		   MAX_MECH_STR_LEN +
 		   UID_KEY_LEN + (sizeof(uid_t) * 2) +
+		   CREDUID_KEY_LEN + (sizeof(uid_t) * 2) +
 		   USER_KEY_LEN + strlen(sesInfo->userName) +
 		   PID_KEY_LEN + (sizeof(pid_t) * 2) + 1;
 
