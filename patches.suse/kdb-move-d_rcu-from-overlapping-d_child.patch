From: Miklos Szeredi <mszeredi@suse.cz>
Subject: kdb: move d_rcu from overlapping d_child to overlapping d_alias
Patch-mainline: no
References: bnc#903640 CVE-2014-8559

Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
---
 kdb/modules/kdbm_pg.c |    4 ++--
 kdb/modules/kdbm_vm.c |    4 ++--
 2 files changed, 4 insertions(+), 4 deletions(-)

--- a/kdb/modules/kdbm_pg.c
+++ b/kdb/modules/kdbm_pg.c
@@ -488,8 +488,8 @@ kdbm_inode(int argc, const char **argv)
 		list_entry(inode->i_sb_list.prev, struct inode, i_sb_list));
 
 	lkdb_printf(" i_dentry.nxt = 0x%p i_dentry.prv = 0x%p\n",
-		list_entry(inode->i_dentry.next, struct dentry, d_alias),
-		list_entry(inode->i_dentry.prev, struct dentry, d_alias));
+		list_entry(inode->i_dentry.next, struct dentry, d_u.d_alias),
+		list_entry(inode->i_dentry.prev, struct dentry, d_u.d_alias));
 
 	lkdb_printf(" i_sb = 0x%p i_op = 0x%p i_data = 0x%lx nrpages = %lu\n",
 					inode->i_sb, inode->i_op,
--- a/kdb/modules/kdbm_vm.c
+++ b/kdb/modules/kdbm_vm.c
@@ -700,13 +700,13 @@ kdbm_print_dentry(unsigned long daddr)
 					d.d_lru.next, d.d_lru.prev);
 
 	lkdb_printf(" d_child.nxt = 0x%p d_child.prv = 0x%p\n",
-					d.d_u.d_child.next, d.d_u.d_child.prev);
+					d.d_child.next, d.d_child.prev);
 
 	lkdb_printf(" d_subdirs.nxt = 0x%p d_subdirs.prv = 0x%p\n",
 					d.d_subdirs.next, d.d_subdirs.prev);
 
 	lkdb_printf(" d_alias.nxt = 0x%p d_alias.prv = 0x%p\n",
-					d.d_alias.next, d.d_alias.prev);
+					d.d_u.d_alias.next, d.d_u.d_alias.prev);
 
 	lkdb_printf(" d_op = 0x%p d_sb = 0x%p d_fsdata = 0x%p\n",
 					d.d_op, d.d_sb, d.d_fsdata);
