From: Thomas Renninger <trenn@suse.de>
Subject: Do not allow access to /dev/cpu/microcode in secure boot mode
References: bnc#813166
Patch-Mainline: no

Index: linux-3.0-SLE11-SP3/arch/x86/kernel/microcode_core.c
===================================================================
--- linux-3.0-SLE11-SP3.orig/arch/x86/kernel/microcode_core.c
+++ linux-3.0-SLE11-SP3/arch/x86/kernel/microcode_core.c
@@ -204,7 +204,8 @@ static int do_microcode_update(const voi
 
 static int microcode_open(struct inode *inode, struct file *file)
 {
-	return capable(CAP_SYS_RAWIO) ? nonseekable_open(inode, file) : -EPERM;
+	return (capable(CAP_SYS_RAWIO) && capable(CAP_COMPROMISE_KERNEL))
+		? nonseekable_open(inode, file) : -EPERM;
 }
 
 static ssize_t microcode_write(struct file *file, const char __user *buf,
