From: Ilya Dryomov <idryomov@gmail.com>
Date: Fri, 22 Jun 2012 12:13:01 -0600
Patch-mainline: yes
References: FATE#306586
Git-commit: fed425c742cb1262ce90a41f2d3d211bac099533
Subject: [PATCH] Btrfs: do not return EINVAL instead of ENOMEM from
 open_ctree()

When bailing from open_ctree() err is returned, not ret.

Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/disk-io.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/fs/btrfs/disk-io.c b/fs/btrfs/disk-io.c
index 2936ca4..fd216d9 100644
--- a/fs/btrfs/disk-io.c
+++ b/fs/btrfs/disk-io.c
@@ -2244,7 +2244,7 @@ int open_ctree(struct super_block *sb,
 	ret |= btrfs_start_workers(&fs_info->caching_workers);
 	ret |= btrfs_start_workers(&fs_info->readahead_workers);
 	if (ret) {
-		ret = -ENOMEM;
+		err = -ENOMEM;
 		goto fail_sb_buffer;
 	}
 
-- 
1.7.6.233.gd79bc

