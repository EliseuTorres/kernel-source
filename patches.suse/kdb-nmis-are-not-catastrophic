From: Mike Travis <travis@sgi.com>
Subject: KDB: NMIs are not catastrophic
References: bnc#744655
Patch-mainline: N/A

NMI interrupts are NOT catastrophic on UV. Disable the ugly
message about continuing after an NMI is received.
Signed-off-by: Jack Steiner <steiner@sgi.com>

Modified to not consider OOPS entries as non-catastrophic.

Signed-off-by: Mike Travis <travis@sgi.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 kdb/kdbmain.c |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

--- linux.orig/kdb/kdbmain.c
+++ linux/kdb/kdbmain.c
@@ -44,6 +44,9 @@
 #ifdef CONFIG_KDB_KDUMP
 #include <linux/kexec.h>
 #endif
+#ifdef CONFIG_X86_UV
+#include <asm/uv/uv.h>
+#endif
 
 #include <acpi/acpi_bus.h>
 
@@ -1922,8 +1925,11 @@ kdb(lkdb_reason_t reason, int error, str
 
 	switch(reason) {
 	case LKDB_REASON_OOPS:
+		LKDB_FLAG_SET(CATASTROPHIC); /* kernel state is dubious now */
+		break;
 	case LKDB_REASON_NMI:
-		LKDB_FLAG_SET(CATASTROPHIC);	/* kernel state is dubious now */
+		if (!is_uv_system())	/* NMI is NOT catastrophic on UV */
+			LKDB_FLAG_SET(CATASTROPHIC);
 		break;
 	default:
 		break;

