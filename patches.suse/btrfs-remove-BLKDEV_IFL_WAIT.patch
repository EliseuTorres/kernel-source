From: Christoph Hellwig <hch@lst.de>
Date: Thu, 16 Sep 2010 20:51:46 +0200
Subject: [PATCH] block: remove BLKDEV_IFL_WAIT
Git-commit: dd3932eddf428571762596e17b65f5dc92ca361b
References: FATE#311488
Patch-Mainline: 2.6.36

All the blkdev_issue_* helpers can only sanely be used for synchronous
caller.  To issue cache flushes or barriers asynchronously the caller needs
to set up a bio by itself with a completion callback to move the asynchronous
state machine ahead.  So drop the BLKDEV_IFL_WAIT flag that is always
specified when calling blkdev_issue_* and also remove the now unused flags
argument to blkdev_issue_flush and blkdev_issue_zeroout.  For
blkdev_issue_discard we need to keep it for the secure discard flag, which
gains a more descriptive name and loses the bitops vs flag confusion.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 fs/btrfs/extent-tree.c       |    3 +--

diff --git a/fs/btrfs/extent-tree.c b/fs/btrfs/extent-tree.c
index 0f794ce..a7d1596 100644
--- a/fs/btrfs/extent-tree.c
+++ b/fs/btrfs/extent-tree.c
@@ -1759,8 +1759,7 @@ static int remove_extent_backref(struct btrfs_trans_handle *trans,
 static int btrfs_issue_discard(struct block_device *bdev,
 				u64 start, u64 len)
 {
-	return blkdev_issue_discard(bdev, start >> 9, len >> 9, GFP_NOFS,
-			BLKDEV_IFL_WAIT);
+	return blkdev_issue_discard(bdev, start >> 9, len >> 9, GFP_NOFS, 0);
 }
 
 static int btrfs_discard_extent(struct btrfs_root *root, u64 bytenr,

