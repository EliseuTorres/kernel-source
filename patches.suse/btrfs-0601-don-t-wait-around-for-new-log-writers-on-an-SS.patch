From: Chris Mason <chris.mason@fusionio.com>
Date: Mon, 23 Jul 2012 15:23:45 -0400
Patch-mainline: 3.6
Git-commit: e39e64ac0cdeca3798a6bf186f873be20e2f57b4
References: FATE#312888
Subject: [PATCH] Btrfs: don't wait around for new log writers on an
 SSD

Waiting on spindles improves performance, but ssds want all the
IO as quickly as we can push it down.

Signed-off-by: Chris Mason <chris.mason@fusionio.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/transaction.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/fs/btrfs/transaction.c
+++ b/fs/btrfs/transaction.c
@@ -1329,7 +1329,8 @@ int btrfs_commit_transaction(struct btrf
 		spin_unlock(&root->fs_info->trans_lock);
 	}
 
-	if (now < cur_trans->start_time || now - cur_trans->start_time < 1)
+	if (!btrfs_test_opt(root, SSD) &&
+	    (now < cur_trans->start_time || now - cur_trans->start_time < 1))
 		should_grow = 1;
 
 	do {
