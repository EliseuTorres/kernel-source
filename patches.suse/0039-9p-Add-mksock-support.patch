From: Venkateswararao Jujjuri <jvrao@linux.vnet.ibm.com>
Subject: [PATCH 039/111]     9p: Add mksock support
Git-commit: 75cc5c9b82a31936d2a8cb75f34752000e244015
Patch-Mainline: 2.6.35
References: FATE#311639

    Without this patch, an attempt to mksock will get an EINVAL.

    Before this patch:
    [root@localhost 1dir]# mksock mysock
    mksock: error making mysock: Invalid argument

    With this patch:
    [root@localhost 1dir]# mksock mysock
    [root@localhost 1dir]# ls    -l mysock
    s--------- 1 root root 0 2010-03-31 17:44 mysock

	upstream commit: 75cc5c9b82a31936d2a8cb75f34752000e244015

    Signed-off-by: Venkateswararao Jujjuri <jvrao@linux.vnet.ibm.com>
    Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 fs/9p/vfs_inode.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/fs/9p/vfs_inode.c b/fs/9p/vfs_inode.c
index 2532d58..893e144 100644
--- a/fs/9p/vfs_inode.c
+++ b/fs/9p/vfs_inode.c
@@ -1226,6 +1226,8 @@ v9fs_vfs_mknod(struct inode *dir, struct dentry *dentry, int mode, dev_t rdev)
 		sprintf(name, "c %u %u", MAJOR(rdev), MINOR(rdev));
 	else if (S_ISFIFO(mode))
 		*name = 0;
+	else if (S_ISSOCK(mode))
+		*name = 0;
 	else {
 		__putname(name);
 		return -EINVAL;
-- 
1.7.1.1

