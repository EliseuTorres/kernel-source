From: Eric Van Hensbergen <ericvh@gmail.com>
Subject: [PATCH 004/111] net/9p: fail when user specifies a transport which we can't find
Git-commit: 349d3bb878d71978650a0634b5445af3c1cc1cd8
Patch-Mainline: 2.6.33
References: FATE#311639

    If the user specifies a transport and we can't find it, we failed back
    to the default trainsport silently.  This patch will make the code
    complain more loudly and return an error code.
	upstream commit: 349d3bb878d71978650a0634b5445af3c1cc1cd8

    Signed-off-by: Eric Van Hensbergen <ericvh@gmail.com>
Signed-off-by: Harsh Prateek Bora <harsh@linux.vnet.ibm.com>
Acked-by: Bruce Rogers <brogers@suse.com>
---
 net/9p/client.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/net/9p/client.c b/net/9p/client.c
index 8af95b2..90a2eb9 100644
--- a/net/9p/client.c
+++ b/net/9p/client.c
@@ -108,6 +108,13 @@ static int parse_opts(char *opts, struct p9_client *clnt)
 			break;
 		case Opt_trans:
 			clnt->trans_mod = v9fs_get_trans_by_name(&args[0]);
+			if(clnt->trans_mod == NULL) {
+				P9_DPRINTK(P9_DEBUG_ERROR,
+				   "Could not find request transport: %s\n",
+				   (char *) &args[0]);
+				ret = -EINVAL;
+				goto free_and_return;
+			}
 			break;
 		case Opt_legacy:
 			clnt->dotu = 0;
@@ -117,6 +124,7 @@ static int parse_opts(char *opts, struct p9_client *clnt)
 		}
 	}
 
+free_and_return:
 	kfree(options);
 	return ret;
 }
-- 
1.7.1.1

