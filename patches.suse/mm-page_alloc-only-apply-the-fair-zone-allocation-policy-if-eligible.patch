From 08072572397a8360b6b1359c1dffa390edd97e20 Mon Sep 17 00:00:00 2001
From: Mel Gorman <mgorman@suse.de>
Date: Thu, 3 Jul 2014 08:47:06 +0100
Subject: [PATCH] mm: page_alloc: Only apply the fair zone allocation policy if
 it's eligible

References: VM Performance
Patch-mainline: Submitted, 2014-06-25

The fair zone allocation policy breaks zone-list ordering by skipping
over remote nodes that should be used to find the lower zone. This patch
restores the expected behaviour.

Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 mm/page_alloc.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mm/page_alloc.c b/mm/page_alloc.c
index 6cd7f06..2638b19 100644
--- a/mm/page_alloc.c
+++ b/mm/page_alloc.c
@@ -1953,7 +1953,7 @@ zonelist_scan:
 		 */
 		if (alloc_flags & ALLOC_FAIR) {
 			if (!zone_local(preferred_zone, zone))
-				continue;
+				break;
 			if (zone_page_state(zone, NR_ALLOC_BATCH) <= 0)
 				continue;
 		}
