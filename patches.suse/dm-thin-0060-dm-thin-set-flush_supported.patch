Git-commit: 16ad3d103dbec4fe6c5950d5a6c383ba9a5296ef
From: Joe Thornber <ejt@redhat.com>
Date: Fri, 27 Jul 2012 15:08:07 +0100
Subject: [PATCH] dm thin: set flush_supported
Patch-mainline: v3.6-rc1
Reference: FATE#313903

The thin provisioning target commits internal metadata on flush.  So it
should receive flushes regardless of whether the underlying devices
support them.

Signed-off-by: Joe Thornber <ejt@redhat.com>
Signed-off-by: Mike Snitzer <snitzer@redhat.com>
Signed-off-by: Alasdair G Kergon <agk@redhat.com>
Acked-by: NeilBrown <nfbrown@suse.com>

---
 drivers/md/dm-thin.c |    1 +
 1 file changed, 1 insertion(+)

--- linux-3.0-SLE11-SP3.orig/drivers/md/dm-thin.c
+++ linux-3.0-SLE11-SP3/drivers/md/dm-thin.c
@@ -2652,6 +2652,7 @@ static int thin_ctr(struct dm_target *ti
 		goto bad_thin_open;
 
 	ti->num_flush_requests = 1;
+	ti->flush_supported = true;
 
 	/* In case the pool supports discards, pass them on. */
 	if (tc->pool->pf.discard_enabled) {
