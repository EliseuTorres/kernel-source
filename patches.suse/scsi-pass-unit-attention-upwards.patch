From: Hannes Reinecke <hare@suse.de>
Subject: Pass unit attention code upwards to the SCSI layer
Reference: FATE#311692
Patch-Mainline: n/a

This is a split-off-patch from 'block-remove-REQ_HARDBARRIER.patch'.
It just updates the error path to the version found in the above patch.

Signed-off-by: Hannes Reinecke <hare@suse.de>

diff --git a/drivers/scsi/scsi_error.c b/drivers/scsi/scsi_error.c
index f4ea422..8c8d3b4 100644
--- a/drivers/scsi/scsi_error.c
+++ b/drivers/scsi/scsi_error.c
@@ -391,7 +391,12 @@ static int scsi_check_sense(struct scsi_cmnd *scmd)
 		    (sshdr.asc == 0x04) && (sshdr.ascq == 0x02))
 			return FAILED;
 
-		return NEEDS_RETRY;
+		/*
+		 * Pass the UA upwards for a determination in the completion
+		 * functions.
+		 */
+		return SUCCESS;
+
 		/* these three are not supported */
 	case COPY_ABORTED:
 	case VOLUME_OVERFLOW:
