From: Dmitry Monakhov <dmonakhov@openvz.org>
Date: Wed Apr 28 17:55:06 2010 +0400
Subject: blkdev: generalize flags for blkdev_issue_fn functions
Git-commit: fbd9b09a177a481eda256447c881f014f29034fe
References: FATE#311692
Patch-Mainline: 2.6.35

The patch just convert all blkdev_issue_xxx function to common
set of flags. Wait/allocation semantics preserved.

Split off from the original patch to apply cleanly.

Signed-off-by: Dmitry Monakhov <dmonakhov@openvz.org>
Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>

diff --git a/fs/btrfs/extent-tree.c b/fs/btrfs/extent-tree.c
index 631babe..176e794 100644
--- a/fs/btrfs/extent-tree.c
+++ b/fs/btrfs/extent-tree.c
@@ -1695,7 +1695,7 @@ static void btrfs_issue_discard(struct block_device *bdev,
 				u64 start, u64 len)
 {
 	return blkdev_issue_discard(bdev, start >> 9, len >> 9, GFP_NOFS,
-			     DISCARD_FL_BARRIER);
+			BLKDEV_IFL_WAIT | BLKDEV_IFL_BARRIER);
 }
 
 static int btrfs_discard_extent(struct btrfs_root *root, u64 bytenr,

