Subject: hv: return correct data for HDIO_GET_IDENTITY ioctl
From: <ohering@suse.de>
References: bnc#709332
Patch-mainline: never

---
 drivers/staging/hv/blkvsc_drv.c |   23 +----------------------
 1 file changed, 1 insertion(+), 22 deletions(-)

--- a/drivers/staging/hv/blkvsc_drv.c
+++ b/drivers/staging/hv/blkvsc_drv.c
@@ -97,8 +97,6 @@ struct block_device_context {
 	enum blkvsc_device_type	device_type;
 	struct list_head pending_list;
 
-	unsigned char device_id[64];
-	unsigned int device_id_len;
 	int num_outstanding_reqs;
 	int shutting_down;
 	unsigned int sector_size;
@@ -256,21 +254,7 @@ static void blkvsc_init_rw(struct blkvsc
 static int blkvsc_ioctl(struct block_device *bd, fmode_t mode,
 			unsigned cmd, unsigned long arg)
 {
-	struct block_device_context *blkdev = bd->bd_disk->private_data;
-	int ret = 0;
-
-	switch (cmd) {
-	case HDIO_GET_IDENTITY:
-		if (copy_to_user((void __user *)arg, blkdev->device_id,
-				 blkdev->device_id_len))
-			ret = -EFAULT;
-		break;
-	default:
-		ret = -EINVAL;
-		break;
-	}
-
-	return ret;
+	return cmd == HDIO_GET_IDENTITY ? -ENOTTY : -EINVAL;
 }
 
 static void blkvsc_cmd_completion(struct hv_storvsc_request *request)
@@ -387,11 +371,6 @@ static int blkvsc_do_operation(struct bl
 		 else
 			blkdev->device_type = UNKNOWN_DEV_TYPE;
 
-		blkdev->device_id_len = buf[7];
-		if (blkdev->device_id_len > 64)
-			blkdev->device_id_len = 64;
-
-		memcpy(blkdev->device_id, &buf[8], blkdev->device_id_len);
 		break;
 
 	case DO_CAPACITY:
