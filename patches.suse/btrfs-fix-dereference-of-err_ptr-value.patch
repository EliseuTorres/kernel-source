From: David Sterba <dsterba@suse.cz>
Date: Mon, 13 Jun 2011 17:54:22 +0000
Patch-mainline: yes
References: FATE#306586
Subject: [PATCH] btrfs: fix dereference of ERR_PTR value

smatch reports:

btrfs_recover_log_trees error: 'wc.replay_dest' dereferencing
possible ERR_PTR()

Signed-off-by: David Sterba <dsterba@suse.cz>
Signed-off-by: Chris Mason <chris.mason@oracle.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/tree-log.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: linux-2.6.32-SLE11-SP2/fs/btrfs/tree-log.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/btrfs/tree-log.c
+++ linux-2.6.32-SLE11-SP2/fs/btrfs/tree-log.c
@@ -3176,7 +3176,7 @@ again:
 		tmp_key.offset = (u64)-1;
 
 		wc.replay_dest = btrfs_read_fs_root_no_name(fs_info, &tmp_key);
-		BUG_ON(!wc.replay_dest);
+		BUG_ON(IS_ERR_OR_NULL(wc.replay_dest));
 
 		wc.replay_dest->log_root = log;
 		btrfs_record_root_in_trans(trans, wc.replay_dest);
