From: Michal Marek <mmarek@suse.cz>
Subject: pciehp: Automatically load on VMware
References: bnc#736669
Patch-mainline: No

Add a DMI table to the pciehp module to make it load automatically
when running under VMware.

Signed-off-by: Michal Marek <mmarek@suse.cz>
Signed-off-by: Rafael J. Wysocki <rjw@suse.de>
---
 drivers/pci/hotplug/pciehp_core.c |   12 ++++++++++++
 1 file changed, 12 insertions(+)

Index: linux-3.0-SLE11-SP2/drivers/pci/hotplug/pciehp_core.c
===================================================================
--- linux-3.0-SLE11-SP2.orig/drivers/pci/hotplug/pciehp_core.c
+++ linux-3.0-SLE11-SP2/drivers/pci/hotplug/pciehp_core.c
@@ -337,6 +337,18 @@ static struct pcie_port_service_driver h
 #endif	/* PM */
 };
 
+/* Automatically load pciehp in VMware */
+static struct dmi_system_id __initdata pcieph_dmi_table[] = {
+	{
+		.ident = "VMware",
+		.matches = {
+			DMI_MATCH(DMI_SYS_VENDOR, "VMware"),
+		},
+	},
+	{ },
+};
+MODULE_DEVICE_TABLE(dmi, pcieph_dmi_table);
+
 static int __init pcied_init(void)
 {
 	int retval = 0;
