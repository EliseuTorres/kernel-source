From: Martin K. Petersen <martin.petersen@oracle.com>
Date: Fri, 15 Oct 2010 15:49:18 +0200
Subject: [PATCH] block: Fix double free in blk_integrity_unregister
Git-commit: e817bf3f68f55e7307c3e9abe5f32d0c05c83988
References: FATE#311755
Patch-Mainline: 2.6.38

Commit 3839e4b introduced a kobject_put but failed to remove the
kmem_cache_free beneath it, leading to a double free.

Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-integrity.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/block/blk-integrity.c b/block/blk-integrity.c
index 5139864..9aa0cca 100644
--- a/block/blk-integrity.c
+++ b/block/blk-integrity.c
@@ -431,7 +431,6 @@ void blk_integrity_unregister(struct gendisk *disk)
 	kobject_uevent(&bi->kobj, KOBJ_REMOVE);
 	kobject_del(&bi->kobj);
 	kobject_put(&bi->kobj);
-	kmem_cache_free(integrity_cachep, bi);
 	disk->integrity = NULL;
 }
 EXPORT_SYMBOL(blk_integrity_unregister);
-- 
1.6.0.2

