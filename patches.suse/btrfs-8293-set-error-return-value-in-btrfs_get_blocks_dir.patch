From: Filipe Manana <fdmanana@suse.com>
Date: Mon, 7 Jul 2014 12:35:21 +0100
Patch-mainline: 3.18
Git-commit: 555e12864063762964433139dee651c5b859a047
Subject: [PATCH] Btrfs: set error return value in
 btrfs_get_blocks_direct

We were returning with 0 (success) because we weren't extracting the
error code from em (PTR_ERR(em)). Fix it.

Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: Satoru Takeuchi <takeuchi_satoru@jp.fujitsu.com>
Signed-off-by: Chris Mason <clm@fb.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/inode.c |    1 +
 1 file changed, 1 insertion(+)

--- a/fs/btrfs/inode.c
+++ b/fs/btrfs/inode.c
@@ -6775,6 +6775,7 @@ static int btrfs_get_blocks_direct(struc
 						       ram_bytes, type);
 				if (IS_ERR(em)) {
 					btrfs_end_transaction(trans, root);
+					ret = PTR_ERR(em);
 					goto unlock_err;
 				}
 			}
