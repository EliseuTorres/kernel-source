From: Jeff Mahoney <jeffm@suse.com>
Subject: btrfs: compat, use printk_get_level and printk_skip_level add _printf fix fallout
Patch-mainline: never, compat

Commit 533574c6 (use printk_get_level and printk_skip_level add _printf
fix fallout) requires printk_get_level and printk_skip_level, which
our kernel doesn't include. We can add compat versions instead.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 fs/btrfs/compat.h |   24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)

--- a/fs/btrfs/compat.h	2012-01-25 13:13:35.000000000 -0500
+++ b/fs/btrfs/compat.h	2013-11-23 14:31:11.609460113 -0500
@@ -4,4 +4,28 @@
 #define btrfs_drop_nlink(inode) drop_nlink(inode)
 #define btrfs_inc_nlink(inode)	inc_nlink(inode)
 
+static inline int printk_get_level(const char *buffer)
+{
+	if (buffer[0] == '<' && buffer[2] == '>') {
+		switch (buffer[1]) {
+		case '0' ... '7':
+		case 'd':
+			return buffer[1];
+		}
+	}
+	return 0;
+}
+
+static inline const char *printk_skip_level(const char *buffer)
+{
+	if (printk_get_level(buffer)) {
+		switch (buffer[1]) {
+		case '0' ... '7':
+		case 'd':       /* KERN_DEFAULT */
+			return buffer + 3;
+		}
+	}
+	return buffer;
+}
+
 #endif /* _COMPAT_H_ */
