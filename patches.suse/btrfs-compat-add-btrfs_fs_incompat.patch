From: Josef Bacik <jbacik@fusionio.com>
Date: Thu, 7 Mar 2013 14:22:04 -0500
Subject: [PATCH] btrfs: compat, add btrfs_fs_incompat
Patch-mainline: v3.10-rc2
Git-commit: 3173a18f70554fe7880bb2d85c7da566e364eb3c (partial)

[ This version only accepts the btrfs_fs_incompat implementation]

Signed-off-by: Josef Bacik <jbacik@fusionio.com>
Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 fs/btrfs/ctree.h |   10 ++++++++++
 1 file changed, 10 insertions(+)

--- a/fs/btrfs/ctree.h
+++ b/fs/btrfs/ctree.h
@@ -3665,6 +3665,16 @@ static inline void __btrfs_set_fs_incomp
 	}
 }
 
+#define btrfs_fs_incompat(fs_info, opt) \
+	__btrfs_fs_incompat((fs_info), BTRFS_FEATURE_INCOMPAT_##opt)
+
+static inline int __btrfs_fs_incompat(struct btrfs_fs_info *fs_info, u64 flag)
+{
+	struct btrfs_super_block *disk_super;
+	disk_super = fs_info->super_copy;
+	return !!(btrfs_super_incompat_flags(disk_super) & flag);
+}
+
 /*
  * Call btrfs_abort_transaction as early as possible when an error condition is
  * detected, that way the exact line number is reported.
