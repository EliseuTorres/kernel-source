From: Tony Luck <tony.luck@intel.com>
Date: Tue, 1 Nov 2011 09:50:08 -0700
Subject: [PATCH] ia64: Wire up cross memory attach syscalls

References: Cross Memory Attach (fate#314115,bnc#793689)
Patch-mainline: v3.2
Git-commit: 5569459cd3a828a998dc305ae4141c1e41f25ecb

Add sys_process_vm_readv and sys_process_vm_writev to ia64
syscall table. Passes tests at http://ozlabs.org/~cyeoh/cma/cma-test-20110718.tgz

Signed-off-by: Tony Luck <tony.luck@intel.com>
Signed-off-by: Mel Gorman <mgorman@suse.de>
---
 arch/ia64/include/asm/unistd.h |    4 +++-
 arch/ia64/kernel/entry.S       |    4 ++--
 2 files changed, 5 insertions(+), 3 deletions(-)

diff --git a/arch/ia64/include/asm/unistd.h b/arch/ia64/include/asm/unistd.h
index d8de182..b402bb9 100644
--- a/arch/ia64/include/asm/unistd.h
+++ b/arch/ia64/include/asm/unistd.h
@@ -321,12 +321,14 @@
 #define __NR_syncfs			1329
 #define __NR_setns			1330
 #define __NR_sendmmsg			1331
+#define __NR_process_vm_readv		1332
+#define __NR_process_vm_writev		1333
 #define __NR_accept4			1334
 
 #ifdef __KERNEL__
 
 
-#define NR_syscalls			311 /* length of syscall table */
+#define NR_syscalls			313 /* length of syscall table */
 
 /*
  * The following defines stop scripts/checksyscalls.sh from complaining about
diff --git a/arch/ia64/kernel/entry.S b/arch/ia64/kernel/entry.S
index df477f8..8509af3 100644
--- a/arch/ia64/kernel/entry.S
+++ b/arch/ia64/kernel/entry.S
@@ -1777,8 +1777,8 @@ sys_call_table:
 	data8 sys_syncfs
 	data8 sys_setns				// 1330
 	data8 sys_sendmmsg
-	data8 sys_ni_syscall	/* process_vm_readv */
-	data8 sys_ni_syscall	/* process_vm_writev */
+	data8 sys_process_vm_readv
+	data8 sys_process_vm_writev
 	data8 sys_accept4
 
 	.org sys_call_table + 8*NR_syscalls	// guard against failures to increase NR_syscalls
