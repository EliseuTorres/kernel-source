From: Dmitry Monakhov <dmonakhov@openvz.org>
Date: Wed, 28 Apr 2010 17:55:06 +0400
Subject: [PATCH] ocfs2: generalize flags for blkdev_issue_fn functions
X-Git: fbd9b09a177a481eda256447c881f014f29034fe
References: FATE#311692
Patch-Mainline: 2.6.35

The patch just convert all blkdev_issue_xxx function to common
set of flags. Wait/allocation semantics preserved.

Split off from the original patch to apply cleanly.

Signed-off-by: Dmitry Monakhov <dmonakhov@openvz.org>
Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 fs/ocfs2/file.c              |    3 ++-
 14 files changed, 52 insertions(+), 34 deletions(-)

diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.c
index 2a7e831..24a86e8 100644
--- a/fs/ocfs2/file.c
+++ b/fs/ocfs2/file.c
@@ -185,7 +185,8 @@ static int ocfs2_sync_file(struct file *file,
 		 * platter
 		 */
 		if (osb->s_mount_opt & OCFS2_MOUNT_BARRIER)
-			blkdev_issue_flush(inode->i_sb->s_bdev, NULL);
+			blkdev_issue_flush(inode->i_sb->s_bdev, GFP_KERNEL,
+					   NULL, BLKDEV_IFL_WAIT);
 		goto bail;
 	}
 
-- 
1.6.0.2

