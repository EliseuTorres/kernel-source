From: Benny Halevy <bhalevy@panasas.com>
Date: Mon, 13 Sep 2010 21:32:19 +0200
Subject: [PATCH] block: fix blk_rq_map_kern bio direction flag
X-Git: a45dc2d2b8d1afa57c91dcfac224e50ffcd3f805
References: FATE#311692
Patch-Mainline: 2.6.36

This bug was introduced in 7b6d91daee5cac6402186ff224c3af39d79f4a0e
"block: unify flags for struct bio and struct request"

Cc: Boaz Harrosh <bharrosh@panasas.com>
Signed-off-by: Benny Halevy <bhalevy@panasas.com>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-map.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/block/blk-map.c b/block/blk-map.c
index ec683f5..073eaf6 100644
--- a/block/blk-map.c
+++ b/block/blk-map.c
@@ -310,7 +310,7 @@ int blk_rq_map_kern(struct request_queue *q, struct request *rq, void *kbuf,
 		return PTR_ERR(bio);
 
 	if (rq_data_dir(rq) == WRITE)
-		bio->bi_rw |= (1 << REQ_WRITE);
+		bio->bi_rw |= REQ_WRITE;
 
 	if (do_copy)
 		rq->cmd_flags |= REQ_COPY_USER;
-- 
1.6.0.2

