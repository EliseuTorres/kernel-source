From 85ce506c83e950ff4720c6b283cf040164bdaaf0 Mon Sep 17 00:00:00 2001
From: Michal Kubecek <mkubecek@suse.cz>
Date: Tue, 25 Sep 2012 13:19:52 +0200
Subject: fix TAINT_NO_SUPPORT handling on module load
Patch-mainline: Never, SUSE specific code

When loading a module, test module taint flags to contain
TAINT_NO_SUPPORT rather than to be equal to it so that kernel is
flagged as unsupported even if module has other taint flags set.

Signed-off-by: Michal Kubecek <mkubecek@suse.cz>
Acked-by: Jiri Kosina <jkosina@suse.cz>
---
 kernel/module.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kernel/module.c b/kernel/module.c
index 8070f36..7e3c47d 100644
--- a/kernel/module.c
+++ b/kernel/module.c
@@ -1593,7 +1593,7 @@ static int mod_sysfs_setup(struct module *mod,
 	/* We don't use add_taint() here because it also disables lockdep. */
 	if (mod->taints & (1 << TAINT_EXTERNAL_SUPPORT))
 		add_nonfatal_taint(TAINT_EXTERNAL_SUPPORT);
-	else if (mod->taints == (1 << TAINT_NO_SUPPORT)) {
+	else if (mod->taints & (1 << TAINT_NO_SUPPORT)) {
 		if (unsupported == 0) {
 			printk(KERN_WARNING "%s: module not supported by "
 			       "SUSE, refusing to load. To override, echo "
-- 
1.7.10.4

