From: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Date: Wed, 19 May 2010 08:27:30 +0200
Subject: [PATCH] block: remove all rcu head initializations
X-Git: f1ac2502e19c59e996242d406fcc60e4c563e8ce
References: FATE#311692
Patch-Mainline: 2.6.34

Remove all rcu head inits. We don't care about the RCU head state before passing
it to call_rcu() anyway. Only leave the "on_stack" variants so debugobjects can
keep track of objects on stack.

Signed-off-by: Mathieu Desnoyers <mathieu.desnoyers@efficios.com>
Signed-off-by: Paul E. McKenney <paulmck@linux.vnet.ibm.com>
Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 block/cfq-iosched.c |    1 -
 block/genhd.c       |    1 -
 2 files changed, 0 insertions(+), 2 deletions(-)

diff --git a/block/cfq-iosched.c b/block/cfq-iosched.c
index 84a7a8e..f8ff606 100644
--- a/block/cfq-iosched.c
+++ b/block/cfq-iosched.c
@@ -3738,7 +3738,6 @@ static void *cfq_init_queue(struct request_queue *q)
 	 * second, in order to have larger depth for async operations.
 	 */
 	cfqd->last_delayed_sync = jiffies - HZ;
-	INIT_RCU_HEAD(&cfqd->rcu);
 	return cfqd;
 }
 
diff --git a/block/genhd.c b/block/genhd.c
index 2f2d6bf..159b0f6 100644
--- a/block/genhd.c
+++ b/block/genhd.c
@@ -1031,7 +1031,6 @@ int disk_expand_part_tbl(struct gendisk *disk, int partno)
 	if (!new_ptbl)
 		return -ENOMEM;
 
-	INIT_RCU_HEAD(&new_ptbl->rcu_head);
 	new_ptbl->len = target;
 
 	for (i = 0; i < len; i++)
-- 
1.6.0.2

