From: Omar Sandoval <osandov@osandov.com>
Date: Mon, 18 May 2015 02:16:31 -0700
Patch-mainline: 4.2
Git-commit: c8d3fe028f64054d75c72566efb9ecf3c75ee161
References: bsc#934962
Subject: [PATCH] Btrfs: show subvol= and subvolid= in /proc/mounts

Now that we're guaranteed to have a meaningful root dentry, we can just
export seq_dentry() and use it in btrfs_show_options(). The subvolume ID
is easy to get and can also be useful, so put that in there, too.

Reviewed-by: David Sterba <dsterba@suse.cz>
Signed-off-by: Omar Sandoval <osandov@osandov.com>
Signed-off-by: Chris Mason <clm@fb.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/super.c |    4 ++++
 fs/seq_file.c    |    1 +
 2 files changed, 5 insertions(+)

--- a/fs/btrfs/super.c
+++ b/fs/btrfs/super.c
@@ -1199,6 +1199,10 @@ static int btrfs_show_options(struct seq
 		seq_puts(seq, ",fatal_errors=panic");
 	if (info->commit_interval != BTRFS_DEFAULT_COMMIT_INTERVAL)
 		seq_printf(seq, ",commit=%d", info->commit_interval);
+	seq_printf(seq, ",subvolid=%llu",
+		  BTRFS_I(dentry->d_inode)->root->root_key.objectid);
+	seq_puts(seq, ",subvol=");
+	seq_dentry(seq, dentry, " \t\n\\");
 	return 0;
 }
 
--- a/fs/seq_file.c
+++ b/fs/seq_file.c
@@ -547,6 +547,7 @@ int seq_dentry(struct seq_file *m, struc
 
 	return res;
 }
+EXPORT_SYMBOL(seq_dentry);
 
 int seq_bitmap(struct seq_file *m, const unsigned long *bits,
 				   unsigned int nr_bits)
