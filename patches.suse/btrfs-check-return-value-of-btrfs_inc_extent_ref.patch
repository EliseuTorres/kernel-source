From: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Date: Thu, 28 Apr 2011 09:18:21 +0000
Patch-mainline: yes
References: FATE#306586
Subject: [PATCH] Btrfs: check return value of btrfs_inc_extent_ref()

If return value of btrfs_inc_extent_ref() is not 0, BUG() is called.

Signed-off-by: Tsutomu Itoh <t-itoh@jp.fujitsu.com>
Signed-off-by: Chris Mason <chris.mason@oracle.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/tree-log.c |    1 +
 1 file changed, 1 insertion(+)

Index: linux-2.6.32-SLE11-SP2/fs/btrfs/tree-log.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/btrfs/tree-log.c
+++ linux-2.6.32-SLE11-SP2/fs/btrfs/tree-log.c
@@ -588,6 +588,7 @@ static noinline int replay_one_extent(st
 						ins.objectid, ins.offset,
 						0, root->root_key.objectid,
 						key->objectid, offset);
+				BUG_ON(ret);
 			} else {
 				/*
 				 * insert the extent pointer in the extent
