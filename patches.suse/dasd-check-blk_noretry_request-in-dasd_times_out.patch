From: Hannes Reinecke <hare@suse.de>
Date: Fri, 11 Jan 2013 08:38:49 +0100
Subject: dasd: check blk_noretry_request in dasd_times_out()
Patch-Mainline: n/a
References: FATE#311379

The 'failfast' cqr attribute might be overridden by
the sysfs attribute setting, so we need to check for
blk_noretry_request if we want to check for a
failfast request in dasd_times_out().

Compability for SLES11; not applicable upstream.

Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 drivers/s390/block/dasd.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/s390/block/dasd.c b/drivers/s390/block/dasd.c
index a6f4ebc..e38ae25 100644
--- a/drivers/s390/block/dasd.c
+++ b/drivers/s390/block/dasd.c
@@ -2289,7 +2289,7 @@ enum blk_eh_timer_return dasd_times_out(struct request *req)
 	if (!cqr)
 		return BLK_EH_NOT_HANDLED;
 
-	if (!test_bit(DASD_CQR_FLAGS_FAILFAST, &cqr->flags))
+	if (!blk_noretry_request(req))
 		return BLK_EH_RESET_TIMER;
 
 	device = cqr->startdev ? cqr->startdev : block->base;
-- 
1.7.4.2

