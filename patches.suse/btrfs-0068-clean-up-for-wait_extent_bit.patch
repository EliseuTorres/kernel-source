From: Xiao Guangrong <xiaoguangrong@cn.fujitsu.com>
Date: Thu, 14 Jul 2011 03:19:27 +0000
Patch-mainline: yes
References: FATE#306586
Git-commit: ded91f0814a349e36b3ca0eff497f816ad518fba
Subject: [PATCH] Btrfs: clean up for wait_extent_bit()

We can just use cond_resched_lock().

Signed-off-by: Xiao Guangrong <xiaoguangrong@cn.fujitsu.com>
Signed-off-by: Li Zefan <lizf@cn.fujitsu.com>
Signed-off-by: Chris Mason <chris.mason@oracle.com>
Signed-off-by: David Sterba <dsterba@suse.cz>
---
 fs/btrfs/extent_io.c |    6 +-----
 1 files changed, 1 insertions(+), 5 deletions(-)

diff --git a/fs/btrfs/extent_io.c b/fs/btrfs/extent_io.c
index 0d69425..a0811e6 100644
--- a/fs/btrfs/extent_io.c
+++ b/fs/btrfs/extent_io.c
@@ -648,11 +648,7 @@ again:
 		if (start > end)
 			break;
 
-		if (need_resched()) {
-			spin_unlock(&tree->lock);
-			cond_resched();
-			spin_lock(&tree->lock);
-		}
+		cond_resched_lock(&tree->lock);
 	}
 out:
 	spin_unlock(&tree->lock);
-- 
1.7.6.233.gd79bc

