# This file is included by all the kernel-*.spec files

# Build with bash instead of sh as the shell: this turns on bash
# extensions like <(...).
%define _buildshell /bin/bash

%define using_buildservice	0%{?opensuse_bs}

# source_rel is the package release string, without the rebuild counter
# generated by the build service. In non-official builds, the upstream
# EXTRAVERSION component is also part of the release string,
# e.g. next.20110101.9.6 (hyphens are replaced by periods). Builds in the
# official distribution projects replace the release string though.
%define source_rel %release
%if %using_buildservice
%define source_rel %(release=%release; echo ${release%.*})
%endif

# release_num is the numeric source revision part of the release number,
# i.e. source_rel without the upstream tags like -rcX. A hyphen is added
# automatically for convenient use.
# examples: rc3 -> "", rc3.1 -> -1, next.20110101.9 -> -9
#
# patchversion is inserted into the spec files by the mkspec script, it is the
# upstream release string unchanged, e.g. 2.6.38-rc3
%define release_num %(upstream=%patchversion; upstream=${upstream#%version}; upstream=${upstream#-}; upstream=${upstream//-/.}; rel="%source_rel" ; res="${rel#$upstream}"; res=${res#.}; echo ${res:+-}${res})

# how the kernel release string (uname -r) should look like
%define kernelrelease %patchversion%release_num

%define my_builddir %_builddir/%{name}-%{version}

# macro to add the source timestamp to package descriptions
%define source_timestamp %(sed '1s/^/Source Timestamp: /' %_sourcedir/source-timestamp || :)

# vim: ft=spec
