%package -n %{-n*}-ueficert
Summary: UEFI Secure Boot Certificate For Package %{-n}-kmp
Group: System/Kernel
%description -n %{-n*}-ueficert
This package contains the UEFI Secure Boot certificate used to sign
modules in the %{-n}-kmp packages.

%post -n %{-n*}-ueficert
# Make the -cert subpackage scriptlets non-fatal and verbose in the
# Beta phase
set -x +e
if ! command -v mokutil >/dev/null; then
	exit 0
fi
# XXX: Only call mokutil if UEFI and shim are used
mokutil --import "@CERT@" --root-pw
exit 0

%preun -n %{-n*}-ueficert
set -x +e
if ! command -v mokutil >/dev/null; then
	exit 0
fi
ln "@CERT@" "@CERT@.delete"
exit 0

%postun -n %{-n*}-ueficert
set -x +e
if ! command -v mokutil >/dev/null; then
	exit 0
fi
if ! test -e "@CERT@"; then
	mokutil --delete "@CERT@.delete" --root-pw
fi
rm "@CERT@.delete"
exit 0

%files -n %{-n*}-ueficert
%defattr(-, root, root)
%dir /etc/uefi
/etc/uefi/certs
