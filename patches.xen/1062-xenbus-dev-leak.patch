From: http://xenbits.xensource.com/linux-2.6.18-xen.hg?rev/5c0b28125957
# HG changeset patch
# User Keir Fraser <keir@xen.org>
# Date 1292837095 0
# Node ID 5c0b28125957507fbf69d23da50b9f655a04c630
# Parent  072d5b122c53852b4b09c33fdd63b6ca4b1c58e7
Subject: xenbus: Fix memory leak on release
Patch-mainline: n/a

Pending responses were leaked on close.

Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov>
Signed-off-by: Jan Beulich <jbeulich@novell.com>

--- sle11sp1-2011-01-04.orig/drivers/xen/xenbus/xenbus_dev.c	2011-01-04 14:21:45.000000000 +0100
+++ sle11sp1-2011-01-04/drivers/xen/xenbus/xenbus_dev.c	2011-01-04 14:23:03.000000000 +0100
@@ -356,6 +356,7 @@ static int xenbus_dev_release(struct ino
 	struct xenbus_dev_data *u = filp->private_data;
 	struct xenbus_dev_transaction *trans, *tmp;
 	struct watch_adapter *watch, *tmp_watch;
+	struct read_buffer *rb, *tmp_rb;
 
 	list_for_each_entry_safe(trans, tmp, &u->transactions, list) {
 		xenbus_transaction_end(trans->handle, 1);
@@ -369,6 +370,10 @@ static int xenbus_dev_release(struct ino
 		free_watch_adapter(watch);
 	}
 
+	list_for_each_entry_safe(rb, tmp_rb, &u->read_buffers, list) {
+		list_del(&rb->list);
+		kfree(rb);
+	}
 	kfree(u);
 
 	return 0;
