From http://xenbits.xen.org/hg/linux-2.6.18-xen.hg/rev/0a5bb80edc45
From: xen-devel@lists.xen.org
Patch-mainline: n/a
Subject: scsiback: correct grant page unmapping

In function scsiback_fast_flush_area() the unmap array is set up with sparse
entries in case of some grant pages could not be mapped originally. This can
lead to never unmapped grant pages.

The unmap array is to be indexed with the so far found number of valid grants,
not with the loop variable.

Signed-off-by: Juergen Gross <jgross@suse.com>
Committed-by: Jan Beulich <jbeulich@suse.com>

--- sle11sp3.orig/drivers/xen/scsiback/scsiback.c	2013-06-11 12:13:31.000000000 +0200
+++ sle11sp3/drivers/xen/scsiback/scsiback.c	2014-07-24 12:19:38.000000000 +0200
@@ -92,7 +92,7 @@ void scsiback_fast_flush_area(pending_re
 			handle = pending_handle(req, i);
 			if (handle == SCSIBACK_INVALID_HANDLE)
 				continue;
-			gnttab_set_unmap_op(&unmap[i], vaddr(req, i),
+			gnttab_set_unmap_op(&unmap[invcount], vaddr(req, i),
 						GNTMAP_host_map, handle);
 			pending_handle(req, i) = SCSIBACK_INVALID_HANDLE;
 			invcount++;
