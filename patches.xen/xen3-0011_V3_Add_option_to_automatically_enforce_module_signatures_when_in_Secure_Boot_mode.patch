From: Matthew Garrett <matthew.garrett@nebula.com>
Subject: [PATCH V3 11/11] Add option to automatically enforce module signatures when in Secure Boot mode
Date: Tue,  3 Sep 2013 19:50:18 -0400

Patch-mainline: Not yet, fedora 20
References: fate#314486, bnc#884333
Target: SLE-11 SP3

UEFI Secure Boot provides a mechanism for ensuring that the firmware will
only load signed bootloaders and kernels. Certain use cases may also
require that all kernel modules also be signed. Add a configuration option
that enforces this automatically when enabled.

Signed-off-by: Matthew Garrett <matthew.garrett@nebula.com>
Acked-by: Lee, Chun-Yi <jlee@suse.com>

Automatically created from "patches.suse/0011_V3_Add_option_to_automatically_enforce_module_signatures_when_in_Secure_Boot_mode.patch" by xen-port-patches.py

--- a/arch/x86/kernel/setup-xen.c
+++ b/arch/x86/kernel/setup-xen.c
@@ -1190,6 +1190,15 @@ void __init setup_arch(char **cmdline_p)
 
 	io_delay_init();
 
+#ifndef CONFIG_XEN
+	if (boot_params.secure_boot) {
+#else
+	if (0) {
+#endif
+		pr_info("Secure boot enabled\n");
+		enforce_signed_modules();
+	}
+
 #ifdef CONFIG_ACPI
 	if (!is_initial_xendomain()) {
 		printk(KERN_INFO "ACPI in unprivileged domain disabled\n");
