From 926172d46038d7610b6b8d84e40db727cefb482d Mon Sep 17 00:00:00 2001
From: Dave Young <dyoung@redhat.com>
Date: Fri, 20 Dec 2013 18:02:18 +0800
Subject: efi: Export EFI runtime memory mapping to sysfs
Patch-mainline: Never, SUSE-Xen specific
References: fate#315019

kexec kernel will need exactly same mapping for EFI runtime memory
ranges. Thus here export the runtime ranges mapping to sysfs,
kexec-tools will assemble them and pass to 2nd kernel via setup_data.

Introducing a new directory /sys/firmware/efi/runtime-map just like
/sys/firmware/memmap. Containing below attribute in each file of that
directory:

attribute  num_pages  phys_addr  type  virt_addr

Signed-off-by: Dave Young <dyoung@redhat.com>
Tested-by: Toshi Kani <toshi.kani@hp.com>
Signed-off-by: Matt Fleming <matt.fleming@intel.com>
Acked-by: Borislav Petkov <bp@suse.de>
Automatically created from "patches.arch/0017-efi-Export-EFI-runtime-memory-mapping-to-sysfs.patch" by xen-port-patches.py

--- sle12.orig/drivers/firmware/efi/Kconfig	2014-02-25 08:40:57.000000000 +0100
+++ sle12/drivers/firmware/efi/Kconfig	2014-02-25 08:39:54.000000000 +0100
@@ -41,7 +41,7 @@ config EFI_VARS_PSTORE_DEFAULT_DISABLE
 
 config EFI_RUNTIME_MAP
 	bool "Export efi runtime maps to sysfs"
-	depends on X86 && EFI && KEXEC
+	depends on X86 && EFI && KEXEC && !XEN
 	default y
 	help
 	  Export efi runtime memory maps to /sys/firmware/efi/runtime-map.
