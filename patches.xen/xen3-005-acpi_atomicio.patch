From: Myron Stowe <mstowe@redhat.com>
Subject: ACPI, APEI: Add RAM mapping support to ACPI
References: fate#313747
Patch-Mainline: v3.3-rc2

Signed-off-by: Thomas Renninger <trenn@suse.de>

This patch adds support for RAM to ACPI's mapping capabilities in order
to support APEI error injection (EINJ) actions.

This patch re-factors similar functionality introduced in commit
76da3fb3575, bringing it into osl.c in preparation for removing
./drivers/acpi/atomicio.[ch].

Signed-off-by: Myron Stowe <myron.stowe@redhat.com>
Signed-off-by: Len Brown <len.brown@intel.com>
Automatically created from "patches.arch/005-acpi_atomicio.patch" by xen-port-patches.py

--- sle11sp3.orig/drivers/acpi/osl.c	2012-12-04 11:57:22.000000000 +0100
+++ sle11sp3/drivers/acpi/osl.c	2012-12-04 13:53:45.000000000 +0100
@@ -335,8 +335,12 @@ acpi_map_lookup_virt(void __iomem *virt,
 }
 
 #ifndef CONFIG_IA64
+#ifndef CONFIG_XEN
 #define should_use_kmap(pfn)   page_is_ram(pfn)
 #else
+#define should_use_kmap(mfn)   pfn_valid(pfn = mfn_to_local_pfn(mfn))
+#endif
+#else
 /* ioremap will take care of cache attributes */
 #define should_use_kmap(pfn)   0
 #endif
