From: Jiri Kosina <jkosina@suse.cz>
Subject: xen: x86, tls: Interpret an all-zero struct user_desc as "no segment"
References: bsc#920250
Patch-mainline: no

Have LDT_zero() defined for Xen as well, as it's needed by
patches.arch/02-x86-tls-interpret-an-all-zero-struct-user_desc-as-no-segment.patch

Signed-off-by: Jiri Kosina <jkosina@suse.cz>

---
Index: linux-3.0-SLE11-SP3-fasttrack-bnc920250/arch/x86/include/mach-xen/asm/desc.h
===================================================================
--- linux-3.0-SLE11-SP3-fasttrack-bnc920250.orig/arch/x86/include/mach-xen/asm/desc.h	2015-03-05 21:49:40.761104401 +0100
+++ linux-3.0-SLE11-SP3-fasttrack-bnc920250/arch/x86/include/mach-xen/asm/desc.h	2015-03-05 21:49:41.077119820 +0100
@@ -282,6 +282,19 @@
 	 (info)->seg_not_present	== 1	&&	\
 	 (info)->useable		== 0)
 
+/* Lots of programs expect an all-zero user_desc to mean "no segment at all". */
+static inline bool LDT_zero(const struct user_desc *info)
+{
+	return (info->base_addr		== 0 &&
+		info->limit		== 0 &&
+		info->contents		== 0 &&
+		info->read_exec_only	== 0 &&
+		info->seg_32bit		== 0 &&
+		info->limit_in_pages	== 0 &&
+		info->seg_not_present	== 0 &&
+		info->useable		== 0);
+}
+
 #ifdef CONFIG_X86_64
 #define LDT_empty(info) (_LDT_empty(info) && ((info)->lm == 0))
 #else
