From: Jiri Slaby <jslaby@suse.cz>
Subject: Linux 3.12.20
Patch-mainline: 3.12.20

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
Automatically created from "patches.kernel.org/patch-3.12.19-20" by xen-port-patches.py

--- sle12.orig/arch/x86/kernel/ldt-xen.c	2012-04-11 13:26:23.000000000 +0200
+++ sle12/arch/x86/kernel/ldt-xen.c	2014-05-26 14:26:52.000000000 +0200
@@ -234,6 +234,17 @@ static int write_ldt(void __user *ptr, u
 		}
 	}
 
+	/*
+	 * On x86-64 we do not support 16-bit segments due to
+	 * IRET leaking the high bits of the kernel stack address.
+	 */
+#ifdef CONFIG_X86_64
+	if (!ldt_info.seg_32bit) {
+		error = -EINVAL;
+		goto out_unlock;
+	}
+#endif
+
 	fill_ldt(&ldt, &ldt_info);
 	if (oldmode)
 		ldt.avl = 0;
