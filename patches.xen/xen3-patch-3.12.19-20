From: Jiri Slaby <jslaby@suse.cz>
Subject: Linux 3.12.20
Patch-mainline: 3.12.20
References: bnc#821619 bnc#827670 bnc#871252 bnc#871729 bnc#873901 bnc#875242 bnc#875690 CVE-2014-0196 FATE#315518
Git-commit: 2f1e800799bf478494cec3573cd63eb34ca89c9d
Git-commit: 27a38856a948c3e8de30dc71647ff9e1778c99fc
Git-commit: 46a2986ebbe18757c2d8c352f8fb6e0f4f0754e3
Git-commit: 4025ce24f326830135341814307c072f6c2a7738
Git-commit: e39435ce68bb4685288f78b1a7e24311f7ef939f
Git-commit: 679b033df48422191c4cac52b610d9980e019f9b
Git-commit: fa8a53c39f3fdde98c9eace6a9b412143f0f6ed6
Git-commit: 5fc68a6cad658e45dca3e0a6607df3a8e5df4ef9
Git-commit: fe76cd88e654124d1431bb662a0fc6e99ca811a5
Git-commit: 5a32083d03fb543f63489b2946c4948398579ba0
Git-commit: a9d45396f5956d0b615c7ae3b936afd888351a47
Git-commit: d132cc6d9e92424bb9d4fd35f5bd0e55d583f4be
Git-commit: 10b6ee4a87811a110cb01eaca01eb04da6801baf
Git-commit: b4c233057771581698a13694ab6f33b48ce837dc
Git-commit: c69dbbf3335a21aae74376d7e5db50a486d52439
Git-commit: 90445ff6241e2a13445310803e2efa606c61f276
Git-commit: 6b0df6827bb6fcacb158dff29ad0a62d6418b534
Git-commit: a585f87c863e4e1d496459d382b802bf5ebe3717
Git-commit: 328e203fc35f0b4f6df1c4943f74cf553bcc04f8
Git-commit: 2610decdd0b3808ba20471a999835cfee5275f98
Git-commit: a53268be0cb9763f11da4f6fe3fb924cbe3a7d4a
Git-commit: 6b6392715856d563719991e9ce95e773491a8983
Git-commit: bfc1010c418a22cbebd8b1bd1e75dad6a527a609
Git-commit: 4991a628a789dc5954e98e79476d9808812292ec
Git-commit: 3b3e0efb5c72c4fc940af50b33626b8a78a907dc
Git-commit: 764152ff66f4a8be1f9d7981e542ffdaa5bd7aff
Git-commit: 115b943a6ea12656088fa1ff6634c0d30815e55b
Git-commit: 1a1cb744de160ee70086a77afff605bbc275d291
Git-commit: 112c44b2df0984121a52fbda89425843b8e1a457
Git-commit: d2722f8b87fb172ff2f31d3a2816b31d58678d40
Git-commit: 82e5a649453a3cf23516277abb84273768a1592b
Git-commit: d121f7d0cbb875abce249dbf7eb191f9bafe80b7
Git-commit: 2cf532f5e67c0cfe38c8c100e49280cdadacd2be
Git-commit: 8a4aeec8d2d6a3edeffbdfae451cdf05cbf0fefd
Git-commit: 9ae794ac5e407d3bc3fec785db481d5a2c0fa275
Git-commit: cc6ca3023f2c2bbcd062e9d4cf6afc2ba2821ada
Git-commit: 12cd43c6ed6da7bf7c5afbd74da6959cda6d056b
Git-commit: 43751a1b8ee2e70ce392bf31ef3133da324e68b3
Git-commit: c29dd8696dc5dbd50b3ac441b8a26751277ba520
Git-commit: a772d4736641ec1b421ad965e13457c17379fc86
Git-commit: 00a9d699bc85052d2d3ed56251cd928024ce06a3
Git-commit: 8aa9e85adac609588eeec356e5a85059b3b819ba
Git-commit: d345ea2892ae7a2b70f84cf881c20731e43e4993
Git-commit: 2697e4fb9209dfe1d1b24c92d254158f63d4bc8e
Git-commit: 6e0de817594c61f3b392a9245deeb09609ec707d
Git-commit: 06cd7a874ec6e09d151aeb1fa8600e14f1ff89f6
Git-commit: e6b8fd028b584ffca7a7255b8971f254932c9fce
Git-commit: 422b9b9684db3c511e65c91842275c43f5910ae9
Git-commit: af61e27c3f77c7623b5335590ae24b6a5c323e22
Git-commit: 0c8482ac92db5ac15792caf23b7f7df9e4f48ae1
Git-commit: c14af233fbe279d0e561ecf84f1208b1bae087ef
Git-commit: 15505679362270d02c449626385cb74af8905514
Git-commit: 5d4e08c45a6cf8f1ab3c7fa375007635ac569165
Git-commit: 91021a6c8ffdc55804dab5acdfc7de4f278b9ac3
Git-commit: 2145e15e0557a01b9195d1c7199a1b92cb9be81f
Git-commit: ef87dbe7614341c2e7bfe8d32fcb7028cc97442c
Git-commit: 4291086b1f081b869c6d79e5b7441633dc3ace00
Git-commit: 62a0d8d7c2b29f92850e4ee3c38e5dfd936e92b2
Git-commit: b790f210fe8423eff881b2a8a93ba5dbc45534d0
Git-commit: 501fed45b7e8836ee9373f4d31e2d85e3db6103a
Git-commit: a2f8d6b303213a98436455aece7e14cdd1240629
Git-commit: b16c02fbfb963fa2941b7517ebf1f8a21946775e
Git-commit: 1f81b6d22a5980955b01e08cf27fb745dc9b686f
Git-commit: 6e6358fc3c3c862bfe9a5bc029d3f8ce43dc9765
Git-commit: 622cad1325e404598fe3b148c3fa640dbaabc235
Git-commit: ec4cb1aa2b7bae18dd8164f2e9c7c51abcf61280
Git-commit: 9503c67c93ed0b95ba62d12d1fd09da6245dbdd6
Git-commit: 4adb6ab3e0fa71363a5ef229544b2d17de6600d7
Git-commit: 238e14055da87d0d012257788e39fe0df3a82226
Git-commit: f81c20158f8d5f7938d5eb86ecc42ecc09273ce6
Git-commit: f7cf4f5bfe073ad792ab49c04f247626b3e38db6
Git-commit: ded2cf71419b9353060e633b59e446c42a6a2a09
Git-commit: 34aa8dac482f1358d59110d5e3a12f4351f6acaa
Git-commit: ea1a8217b06b41b31a2b60b0b83f75c77ef9c873
Git-commit: 55f67141a8927b2be3e51840da37b8a2320143ed
Git-commit: 57e68e9cd65b4b8eb4045a1e0d0746458502554c
Git-commit: 3a025760fc158b3726eac89ee95d7f29599e9dfa
Git-commit: a0c32761e73c9999cbf592b702f284221fea8040
Git-commit: 368c89d7ac70f937c93cd6f3b65bcfdfb3ba794f
Git-commit: 1044b1bb9278f2e656a1a7b63dc24a59506540aa
Git-commit: 6aec044cc2f5670cf3b143c151c8be846499bd15
Git-commit: ead5178bf442dbae4008ee54bf4f66a1f6a317c9
Git-commit: f76a1cbed18c86e2d192455f0daebb48458965f3
Git-commit: eee3f15d5f1f4f0c283dd4db67dc1b874a2852d1
Git-commit: 610183051d8f9421f138c4203ca894387f9f8839
Git-commit: 06f9b6e59661cee510b04513b13ea7927727d758
Git-commit: 61f0319193c44adbbada920162d880b1fdb3aeb3
Git-commit: 8b57b9669aa884ac75b8d09c251d6b1755533c15
Git-commit: 30d652823de5fd7907d40e969a2d8e23938d8d03
Git-commit: 3ec40dcfb413214b2874aec858870502b61c2202
Git-commit: 3c8023a782964c72574ad8268ba0ea4e2d9772fc
Git-commit: 8272d0a0c0d374a01721e579df6e8add5577132b
Git-commit: bc826d6e39fe5f09cbadf8723e9183e6331b586f
Git-commit: c4885ada88e4331f8ac56d14296d0058359db2d7
Git-commit: 7d3477d801808a5037a511cf5a5aae5718e7ecce
Git-commit: aee786acfc0a12bcd37a1c60f3198fb25cf7181a
Git-commit: b1e43f232698274871e1358c276d7b0242a7d607
Git-commit: 01bb59ebffdec314da8da66266edf29529372f9b
Git-commit: c09ec25d3684cad74d851c0f028a495999591279
Git-commit: bcffae7708eb8352f44dc510b326541fe43a02a4
Git-commit: 9c1b70361e0b38e4acb8e62b54da66538cb77ff2
Git-commit: d8eb6c653ef6b323d630de3c5685478469e248bc
Git-commit: aba37fd975f0dd58e025c99c2a79b61b20190831
Git-commit: 01d8885785a60ae8f4c37b0ed75bdc96d0fc6a44
Git-commit: 7e8213c1f3acc064aef37813a39f13cbfe7c3ce7
Git-commit: 2c42be2dd4f6586728dba5c4e197afd5cfaded78
Git-commit: a1e1774c6dfa3a524dd8df51ca95185fe5ef3247
Git-commit: d444edc679e7713412f243b792b1f964e5cff1e1
Git-commit: e2c70425f05219b142b3a8a9489a622c736db39d
Git-commit: b2a72ec32d0f499aaadf41264232517a12326df0
Git-commit: b076808051f2c80d38e03fb2f1294f525c7a446d
Git-commit: 37a967651caf99dd267017023737bd442f5acb3d
Git-commit: f8b6c47a44c063062317646683a73371c24c69ee
Git-commit: 5bdb0f02add5994b0bc17494f4726925ca5d6ba1
Git-commit: 08e74c4b00c30c232d535ff368554959403d0432
Git-commit: 9d194d1025f463392feafa26ff8c2d8247f71be1
Git-commit: a2cb0eb8a64adb29a99fd864013de957028f36ae
Git-commit: 3758cf7e14b753838fe754ede3862af10b35fdac
Git-commit: 2b9056359889c78ea5decb5b654a512c2e8a945c
Git-commit: 480efaee085235bb848f1063f959bf144103c342
Git-commit: 3064639423c48d6e0eb9ecc27c512a58e38c6c57
Git-commit: 9f67f189939eccaa54f3d2c9cf10788abaf2d584
Git-commit: 04819bf6449094e62cebaf5199d85d68d711e667
Git-commit: a11fcce1544df08c723d950ff0edef3adac40405
Git-commit: de3997a7eeb9ea286b15879fdf8a95aae065b4f7
Git-commit: 4c69d5855a16f7378648c5733632628fa10431db
Git-commit: e911b8158ee1def8153849b1641b736026b036e0
Git-commit: 2076a20fc1a06f7b0333c62a2bb4eeeac7ed1bcb
Git-commit: a2ff864b53eac9a0e9b05bfe9d1781ccd6c2af71
Git-commit: 4f4bde1df33bde076f53325bdf2c6430cf85e1bb
Git-commit: a35ff2861690eaf9dbb38fa744a8a9e6f4ebfd61
Git-commit: b3b42ac2cbae1f3cecbb6229964a4d48af31d382
Git-commit: 12729f14d8357fb845d75155228b21e76360272d
Git-commit: 9452bf560273e4de2395ffdd79024debfb0c1290
Git-commit: 2704f807f9498054b8153002bafa3e818079e9a5
Git-commit: f764cd68d9036498f08fe8834deb6a367b5c2542
Git-commit: abe5d64d1a74195a44cd14624f8178b9f48b7cc7
Git-commit: 6b355b33a64fd6d8ead2b838ec16fb9b551f71e8
Git-commit: 204747c970c0d568721c76ab8a57dde0e5dcf0d5
Git-commit: 483e2dfdbc94751430e41db9973985f5b054d322
Git-commit: 97dc4ed3fa377ec91bb60ba98b70d645c2099384
Git-commit: ed26f87b9f71693a1d1ee85f5e6209601505080f
Git-commit: 96cf3dedc491d2f1f66cc26217f2b06b0c7b6797
Git-commit: ad09dd6a1f5d6244bd89314015af506ba7f9810a
Git-commit: b9e183a1d495cd65412abe0f9df19b151716bfe7
Git-commit: 141050cf3d84fc303df58796d68dc1376b0e8f67
Git-commit: a7ab1c8b261305af583ce26bb4a14f555fdaa73e
Git-commit: 159ce52a6b777fc82fa0b51c7440e25f9e4c6feb
Git-commit: 65aba1e04916d72b30c028730a1e31860c225412
Git-commit: 34ec43661fe8f1977dd0f05353302ae2ed10aabb
Git-commit: 5e6533a6f52f1a8283b2f818f5828be99a417dd6
Git-commit: cc99ecfdac01215594c73907726b12f251c21e20
Git-commit: 2955c83f72801245afd0fe5c560cc75b82bea9aa
Git-commit: 2253e8d79237c69086ded391e6767afe16972527
Git-commit: 12f6dd860cf8bf036c0bec38c00a53da71bcd43a
Git-commit: 61db45ca21630f5ab7f678d54c5d969c21647854
Git-commit: 8dc9abb93dde94e7f2bc719032fe16f5713df05c
Git-commit: 7c66593286bcd153e4868383e675673a27071bd5
Git-commit: 415d555e6b398b00fc1733f0113065a54df9106a
Git-commit: 4f8e940095536bc002a81666a4107a581c84e9b9
Git-commit: a4b7f21d7b42b33609df3f86992a8deff80abfaf
Git-commit: a6e03dd451c724f785277d8ecca5d1a0b886d892
Git-commit: 56b700fd6f1e49149880fb1b6ffee0dca5be45fb
Git-commit: 80bb3ef109ff40a7593d9481c17de9bbc4d7c0e2
Git-commit: 95c52fe063351192e0f4ffb70ef9bac1aa26f5a4
Git-commit: 12567bbdee7ea553237085a2bbc0ffa5240f5248
Git-commit: b6ccb9803e90c16b212cf4ed62913a7591e79a39
Git-commit: bfeda827278f09f4db35877e5f1ca9c149ca2890
Git-commit: 8abcdd680d543fb582371e146e62ba9f2af8a816
Git-commit: c6c56697ae4bf1226263c19e8353343d7083f40e
Git-commit: 07484ca33ef83900f5cfbde075c1a19e5a237aa1
Git-commit: 698b48532539484b012fb7c4176b959d32a17d00
Git-commit: 1555b652970e541fa1cb80c61ffc696bbfb92bb7
Git-commit: d31a33dd7792c7d6c11fda226a3b9e4fb7f86f95
Git-commit: 7272e051157ccd5871b5d939548d0ba5a94a2965
Git-commit: de2db7432917a82b62d55bb59635586eeca6d1bd
Git-commit: 71fdb6bf61bf0692f004f9daf5650392c0cfe300
Git-commit: 03367ef5ea811475187a0732aada068919e14d61
Git-commit: e28bab4828354583bb66ac09021ca69b341a7db4
Git-commit: 03e7848a64ed535a30f5d7fc6dede2d5a6a2534b
Git-commit: f46d6a8a01d6bbd83a97140f30a72a89b038807b
Git-commit: 493a52a9b6645f61954580c7d4bd52fa62110934
Git-commit: a97f4a66d8ee4faf0f31cc4ad3f4aa0baef23fc7

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
Automatically created from "patches.kernel.org/patch-3.12.19-20" by xen-port-patches.py

--- sle12.orig/arch/x86/kernel/ldt-xen.c	2012-04-11 13:26:23.000000000 +0200
+++ sle12/arch/x86/kernel/ldt-xen.c	2014-05-26 14:26:52.000000000 +0200
@@ -234,6 +234,17 @@ static int write_ldt(void __user *ptr, u
 		}
 	}
 
+	/*
+	 * On x86-64 we do not support 16-bit segments due to
+	 * IRET leaking the high bits of the kernel stack address.
+	 */
+#ifdef CONFIG_X86_64
+	if (!ldt_info.seg_32bit) {
+		error = -EINVAL;
+		goto out_unlock;
+	}
+#endif
+
 	fill_ldt(&ldt, &ldt_info);
 	if (oldmode)
 		ldt.avl = 0;
