From: trenn@suse.de
Subject: acpi processor hotplug: Delay most initialization to cpu online
References: fate#311831,bnc#703100
Patch-Mainline: no

When the CPU hotplug notification comes in via ACPI notify()
cpu_data of the core is not yet initialized.
This leads to errors in throttling and (if acpi_idle is used
as cpuidle driver) to not set up cpu idle subsystem.
-> Only bring up ACPI sysfs at that time
-> Initialize the rest (throttling, cpuidle,...) when a hotplugged
core is onlined the first time

Signed-off-by: Thomas Renninger <trenn@suse.de>
Automatically created from "patches.arch/acpi_processor_delay_cpuidle_init_on_hotplug.patch" by xen-port-patches.py

--- sle11sp2-2011-08-08.orig/drivers/acpi/processor_core.c	2011-08-08 17:59:23.000000000 +0200
+++ sle11sp2-2011-08-08/drivers/acpi/processor_core.c	2011-08-08 18:02:13.000000000 +0200
@@ -778,7 +778,11 @@ static void acpi_processor_notify(struct
 
 static int __cpuinit acpi_processor_start(struct acpi_processor *pr)
 {
+#ifndef CONFIG_XEN
 	struct acpi_device *device = per_cpu(processor_device_array, pr->id);
+#else
+	struct acpi_device *device = processor_device_array[pr->acpi_id];
+#endif
 	int result = 0;
 
 	/* _PDC call should be done before doing anything else (if reqd.). */
