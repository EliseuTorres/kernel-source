From: Yinghai Lu <yinghai@kernel.org>
Subject: [PATCH] x86: allow NVS can be accessed by driver
References: bnc#725592
Patch-Mainline: Submitted

Signed-off-by: Thomas Renninger <trenn@suse.de>

APEI needs to be able to access NVS marked (by e820.c) ram.

Signed-off-by: Yinghai Lu <yinghai@kernel.org>

Automatically created from "patches.arch/x86_do_not_set_nvs_ram_busy.patch" by xen-port-patches.py

--- sle11sp2-2011-11-04.orig/arch/x86/kernel/e820-xen.c	2011-10-04 15:57:28.000000000 +0200
+++ sle11sp2-2011-11-04/arch/x86/kernel/e820-xen.c	2011-11-04 15:02:20.000000000 +0100
@@ -1083,7 +1083,8 @@ void __init e820_reserve_resources(void)
 		 * pcibios_resource_survey()
 		 */
 		if (e820.map[i].type != E820_RESERVED || res->start < (1ULL<<20)) {
-			res->flags |= IORESOURCE_BUSY;
+			if (e820.map[i].type != E820_NVS)
+				res->flags |= IORESOURCE_BUSY;
 			insert_resource(&iomem_resource, res);
 		}
 		res++;
