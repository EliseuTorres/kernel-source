From: Christoph Hellwig <hch@infradead.org>
Date: Wed, 18 Aug 2010 05:29:21 -0400
Subject: [PATCH] block: remove the WRITE_BARRIER flag
References: FATE#311692
Patch-Mainline: 2.6.34

It's unused now.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Tejun Heo <tj@kernel.org>
Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>

Automatically created from "patches.suse/block-remove-the-WRITE_BARRIER-flag.patch" by xen-port-patches.py

--- sle11sp2-2011-06-15.orig/drivers/xen/blkback/blkback.c	2010-09-22 16:22:32.000000000 +0200
+++ sle11sp2-2011-06-15/drivers/xen/blkback/blkback.c	2011-06-15 11:58:00.000000000 +0200
@@ -409,7 +409,7 @@ static void dispatch_rw_block_io(blkif_t
 		operation = WRITE;
 		break;
 	case BLKIF_OP_WRITE_BARRIER:
-		operation = WRITE_BARRIER;
+		operation = WRITE_FLUSH_FUA;
 		break;
 	default:
 		operation = 0; /* make gcc happy */
@@ -418,7 +418,7 @@ static void dispatch_rw_block_io(blkif_t
 
 	/* Check that number of segments is sane. */
 	nseg = req->nr_segments;
-	if (unlikely(nseg == 0 && operation != WRITE_BARRIER) || 
+	if (unlikely(nseg == 0 && !(operation & (REQ_FLUSH|REQ_FUA))) ||
 	    unlikely(nseg > BLKIF_MAX_SEGMENTS_PER_REQUEST)) {
 		DPRINTK("Bad number of segments in request (%d)\n", nseg);
 		goto fail_response;
@@ -526,7 +526,7 @@ static void dispatch_rw_block_io(blkif_t
 	}
 
 	if (!bio) {
-		BUG_ON(operation != WRITE_BARRIER);
+		BUG_ON(!(operation & (REQ_FLUSH|REQ_FUA)));
 		bio = bio_alloc(GFP_KERNEL, 0);
 		if (unlikely(bio == NULL))
 			goto fail_put_bio;
@@ -541,7 +541,7 @@ static void dispatch_rw_block_io(blkif_t
 
 	if (operation == READ)
 		blkif->st_rd_sect += preq.nr_sects;
-	else if (operation == WRITE || operation == WRITE_BARRIER)
+	else
 		blkif->st_wr_sect += preq.nr_sects;
 
 	return;
