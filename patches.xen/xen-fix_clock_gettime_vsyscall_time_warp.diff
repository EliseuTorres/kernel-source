From: Kurt Garloff <garloff@suse.de>
Subject: Adapt Xen to fix_clock_gettime_vsyscall_time_warp.diff
Patch-mainline: Not applicable

patches.fixes/fix_clock_gettime_vsyscall_time_warp.diff
fixed a regression with using TSC and NTP.
This is the corresponding Xen change, so xen kernels compile again.

Signed-off-by: Kurt Garloff <garloff@suse.de>

Index: linux-2.6.32-SLE11-SP1/arch/x86/kernel/vsyscall_64-xen.c
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/arch/x86/kernel/vsyscall_64-xen.c
+++ linux-2.6.32-SLE11-SP1/arch/x86/kernel/vsyscall_64-xen.c
@@ -72,18 +72,19 @@ void update_vsyscall_tz(void)
 	vsyscall_gtod_data.sys_tz = sys_tz;
 	write_sequnlock_irqrestore(&vsyscall_gtod_data.lock, flags);
 }
 
-void update_vsyscall(struct timespec *wall_time, struct clocksource *clock)
+void update_vsyscall(struct timespec *wall_time, struct clocksource *clock,
+		     u32 mult)
 {
 	unsigned long flags;
 
 	write_seqlock_irqsave(&vsyscall_gtod_data.lock, flags);
 	/* copy vsyscall data */
 	vsyscall_gtod_data.clock.vread = clock->vread;
 	vsyscall_gtod_data.clock.cycle_last = clock->cycle_last;
 	vsyscall_gtod_data.clock.mask = clock->mask;
-	vsyscall_gtod_data.clock.mult = clock->mult;
+	vsyscall_gtod_data.clock.mult = mult;
 	vsyscall_gtod_data.clock.shift = clock->shift;
 	vsyscall_gtod_data.wall_time_sec = wall_time->tv_sec;
 	vsyscall_gtod_data.wall_time_nsec = wall_time->tv_nsec;
 	vsyscall_gtod_data.wall_to_monotonic = wall_to_monotonic;
