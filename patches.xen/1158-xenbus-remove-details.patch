From http://xenbits.xen.org/hg/linux-2.6.18-xen.hg/rev/504cb8e11466
From: xen-devel@lists.xen.org
Patch-mainline: n/a
Subject: xenbus: don't free other end details too early

The individual drivers' remove functions could legitimately attempt to
access this information (for logging messages if nothing else). Note
that I did not in fact observe a problem anywhere, but I came across
this while looking into the reasons for what turned out to need the
fix at https://lkml.org/lkml/2012/3/5/336 to vsprintf().

Signed-off-by: Jan Beulich <jbeulich@suse.com>

--- sle11sp2.orig/drivers/xen/xenbus/xenbus_probe.c	2011-10-06 11:34:39.000000000 +0200
+++ sle11sp2/drivers/xen/xenbus/xenbus_probe.c	2012-03-19 11:27:54.000000000 +0100
@@ -334,11 +334,12 @@ int xenbus_dev_remove(struct device *_de
 	DPRINTK("%s", dev->nodename);
 
 	free_otherend_watch(dev);
-	free_otherend_details(dev);
 
 	if (drv->remove)
 		drv->remove(dev);
 
+	free_otherend_details(dev);
+
 	xenbus_switch_state(dev, XenbusStateClosed);
 	return 0;
 }
