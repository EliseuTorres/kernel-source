From http://xenbits.xen.org/hg/linux-2.6.18-xen.hg/rev/821a5b2a10c8
From: xen-devel@lists.xen.org
Patch-mainline: n/a
Subject: xenbus: Reject replies with payload > XENSTORE_PAYLOAD_MAX

This also avoids a potential integer overflow pointed out by Haogang
Chen.

Also use this in struct xenbus_dev_data even though it happens to be
== PAGE_SIZE.

The code which takes requests from userspace already validates against
the size of this buffer so no further checks are required to ensure
that userspace requests comply with the protocol in this respect.

Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
Cc: Haogang Chen <haogangchen@gmail.com>

(drivers/xen/xenbus/xenbus_xs.c change no longer needed as of 3.0.18)
Acked-by: jbeulich@suse.com

--- sle11sp2.orig/drivers/xen/xenbus/xenbus_dev.c	2012-02-28 10:20:39.000000000 +0100
+++ sle11sp2/drivers/xen/xenbus/xenbus_dev.c	2012-01-11 12:01:47.000000000 +0100
@@ -78,7 +78,7 @@ struct xenbus_dev_data {
 	unsigned int len;
 	union {
 		struct xsd_sockmsg msg;
-		char buffer[PAGE_SIZE];
+		char buffer[XENSTORE_PAYLOAD_MAX];
 	} u;
 
 	/* Response queue. */
