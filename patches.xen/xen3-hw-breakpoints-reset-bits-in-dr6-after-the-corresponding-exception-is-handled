From: K.Prasad <prasad@linux.vnet.ibm.com>
Date: Mon, 1 Jun 2009 23:47:06 +0530
Subject: hw-breakpoints: reset bits in dr6 after the corresponding exception
 is handled
Patch-mainline: v2.6.33-rc1

This patch resets the bit in dr6 after the corresponding exception is
handled in code, so that we keep a clean track of the current virtual debug
status register.

[ Impact: keep track of breakpoints triggering completion ]

Signed-off-by: K.Prasad <prasad@linux.vnet.ibm.com>
Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
Automatically created from "patches.suse/hw-breakpoints-reset-bits-in-dr6-after-the-corresponding-exception-is-handled" by xen-port-patches.py

--- sle11sp2-2011-07-15.orig/arch/x86/kernel/traps-xen.c	2011-07-15 14:06:22.000000000 +0200
+++ sle11sp2-2011-07-15/arch/x86/kernel/traps-xen.c	2011-07-15 14:08:55.000000000 +0200
@@ -542,8 +542,8 @@ dotraplinkage void __kprobes do_debug(st
 	/* Store the virtualized DR6 value */
 	tsk->thread.debugreg6 = dr6;
 
-	if (notify_die(DIE_DEBUG, "debug", regs, dr6, error_code,
-						SIGTRAP) == NOTIFY_STOP)
+	if (notify_die(DIE_DEBUG, "debug", regs, PTR_ERR(&dr6), error_code,
+							SIGTRAP) == NOTIFY_STOP)
 		return;
 
 	/* It's safe to allow irq's after DR6 has been saved */
