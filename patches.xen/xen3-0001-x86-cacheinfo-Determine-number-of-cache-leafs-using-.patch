From 636b5c6f404d9141a652f23e4547b0dfbb803fd9 Mon Sep 17 00:00:00 2001
From: Boris Ostrovsky <boris.ostrovsky@amd.com>
Date: Fri, 14 Dec 2012 06:54:32 -0500
Subject: [PATCH 1/3] x86, cacheinfo: Determine number of cache leafs using
 CPUID 0x8000001d on AMD
References: fate#314145 bnc#794648
Patch-Mainline: yes

CPUID 0x8000001d works quite similar to Intels' CPUID function 4.
Use it to determine number of cache leafs.

Signed-off-by: Boris Ostrovsky <boris.ostrovsky@amd.com>
Signed-off-by: Borislav Petkov <bpetkov@suse.de>
Automatically created from "patches.arch/0001-x86-cacheinfo-Determine-number-of-cache-leafs-using-.patch" by xen-port-patches.py

--- sle11sp3.orig/arch/x86/include/mach-xen/asm/processor.h	2011-11-17 16:53:30.000000000 +0100
+++ sle11sp3/arch/x86/include/mach-xen/asm/processor.h	2013-01-10 10:21:44.000000000 +0100
@@ -177,7 +177,7 @@ extern void identify_secondary_cpu(struc
 extern void print_cpu_info(struct cpuinfo_x86 *);
 extern void init_scattered_cpuid_features(struct cpuinfo_x86 *c);
 extern unsigned int init_intel_cacheinfo(struct cpuinfo_x86 *c);
-extern unsigned short num_cache_leaves;
+extern void init_amd_cacheinfo(struct cpuinfo_x86 *c);
 
 extern void detect_extended_topology(struct cpuinfo_x86 *c);
 extern void detect_ht(struct cpuinfo_x86 *c);
