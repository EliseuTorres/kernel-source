From: Tejun Heo <tj@kernel.org>
Date: Thu, 29 Oct 2009 22:34:13 +0900
Subject: [PATCH 01/50] percpu: make percpu symbols in oprofile unique
Patch-mainline: v2.6.34-rc1
Git-commit: b3e9f672b6cd0f4c2982c1bcc0b3c3fb39d3b0fe
References: FATE#309728, FATE#309730, BNC#686840
Signed-off-by: Tony Jones <tonyj@suse.de>

This patch updates percpu related symbols in oprofile such that percpu
symbols are unique and don't clash with local symbols.  This serves
two purposes of decreasing the possibility of global percpu symbol
collision and allowing dropping per_cpu__ prefix from percpu symbols.

* drivers/oprofile/cpu_buffer.c: s/cpu_buffer/op_cpu_buffer/

Partly based on Rusty Russell's "alloc_percpu: rename percpu vars
which cause name clashes" patch.

Signed-off-by: Tejun Heo <tj@kernel.org>
Acked-by: Robert Richter <robert.richter@amd.com>
Cc: Rusty Russell <rusty@rustcorp.com.au>
Signed-off-by: Robert Richter <robert.richter@amd.com>
Automatically created from "patches.suse/oprofile-001-percpu-make-percpu-symbols-in-unique.patch" by xen-port-patches.py

--- sle11sp2-2011-05-31.orig/drivers/oprofile/cpu_buffer.c	2011-05-31 10:50:14.000000000 +0200
+++ sle11sp2-2011-05-31/drivers/oprofile/cpu_buffer.c	2011-05-31 11:19:40.000000000 +0200
@@ -432,7 +432,7 @@ void oprofile_add_pc(unsigned long pc, i
  */
 void oprofile_add_mode(int cpu_mode)
 {
-	struct oprofile_cpu_buffer *cpu_buf = &__get_cpu_var(cpu_buffer);
+	struct oprofile_cpu_buffer *cpu_buf = &__get_cpu_var(op_cpu_buffer);
 
 	if (op_add_code(cpu_buf, 1, cpu_mode, current))
 		cpu_buf->sample_lost_overflow++;
