From: Jiri Slaby <jslaby@suse.cz>
Subject: Linux 3.12.37
Patch-mainline: 3.12.37
References: CVE-2014-8559 CVE-2014-9585 bnc#897736 bnc#903640 bnc#905329 bnc#908904 bsc#908825 bsc#912705
Git-commit: ca5358ef75fc69fee5322a38a340f5739d997c10
Git-commit: 946e51f2bf37f1656916eb75bd0742ba33983c28
Git-commit: e87c3f80ad0490d26ffe04754b7d094463b40f30
Git-commit: fc625960edecfb57e62c2975d1f155155e28e6ba
Git-commit: 108cef3aa41669610e1836fe638812dd067d72de
Git-commit: 45f87de57f8fad59302fd263dd81ffa4843b5b24
Git-commit: 3e14dcf7cb80b34a1f38b55bc96f02d23fdaaaaf
Git-commit: 4943ba16bbc2db05115707b3ff7b4874e9e3c560
Git-commit: 5d26a105b5a73e5635eae0629b42fa0a90e07b7b
Git-commit: 3b9d35d744bb5139f9fed57f38c019bb8c7d351c
Git-commit: 3b05ac3824ed9648c0d9c02d51d9b54e4e7e874f
Git-commit: a3a8784454692dd72e5d5d34dcdab17b4420e74c
Git-commit: 4aaa71873ddb9faf4b0c4826579e2f6d18ff9ab4
Git-commit: 7ddc6a2199f1da405a2fb68c40db8899b1a8cd87
Git-commit: 38a1dfda8e77d7ba74c94d06d8bc41ba98a4bc8c
Git-commit: 3669ef9fa7d35f573ec9c0e0341b29251c2734a7
Git-commit: e30ab185c490e9a9381385529e0fd32f0a399495
Git-commit: f285f4a21c3253887caceed493089ece17579d59
Git-commit: 520452172e6b318f3a8bd9d4fe1e25066393de25
Git-commit: 32c6590d126836a062b3140ed52d898507987017
Git-commit: 8c38d28ba8da98f7102c31d35359b4dbe9d1f329
Git-commit: 9b1087aa5e86448fe6ad40a58964e35f3ba423d5
Git-commit: 38bdf45f4aa5cb6186d50a29e6cbbd9d486a1519
Git-commit: 7ecd0bde5bfea524a843ad8fa8cb66ccbce68779
Git-commit: 5e5aeb4367b450a28f447f6d5ab57d8f2ab16a5f
Git-commit: 6ada1fc0e1c4775de0e043e1bd3ae9d065491aa5
Git-commit: a59db67656021fa212e9b95a583f13c34eb67cd9
Git-commit: 9b1cc9f251affdd27f29fe46d0989ba76c33faf6
Git-commit: 6cdb08172bc89f0a39e1643c5e7eab362692fd1b
Git-commit: 5615f890bc6babdc2998dec62f3552326d06eb7b
Git-commit: 226e5ae9e5f9108beb0bde4ac69f68fe6210fed9
Git-commit: 1caf6aaaa47471831d77c75f094d4e00ad1ec808
Git-commit: 6455931186bff407493135e74c5f32efd30860e2
Git-commit: ce7514526742c0898b837d4395f515b79dfb5a12
Git-commit: db93facfb0ef542aa5d8079e47580b3e669a4d82
Git-commit: 0915e6feb38de8d3601819992a5bd050201a56fa
Git-commit: 121b6a79955a3a3fd7bbb9b8cb88d5b9dad6283d
Git-commit: 7d444909a25ed4a9dbc546bf9528c8d2e3bf3752
Git-commit: bcf090e0040e30f8409e6a535a01e6473afb096f
Git-commit: b02efbfc9a051b41e71fe8f94ddf967260e024a6
Git-commit: ca6c1d82d12d8013fb75ce015900d62b9754623c
Git-commit: 19e2090fb246ca21b3e569ead51a6a7a1748eadd
Git-commit: 2371e5da8cfe91443339b54444dec6254fdd6dfc
Git-commit: 128e9cc84566a84146baea2335b3824288eed817
Git-commit: 954f23722b5753305be490330cf2680b7a25f4a3
Git-commit: 46243860806bdc2756f3ce8ac86b4d7c616bcd6c
Git-commit: 06bed7d18c2c07b3e3eeadf4bd357f6e806618cc
Git-commit: b485342bd79af363c77ef1a421c4a0aef2de9812
Git-commit: f911d731054ab3d82ee72a16b889e17ca3a2332a
Git-commit: b5c8afe5be51078a979d86ae5ae78c4ac948063d
Git-commit: b0ddb319db3d7a1943445f0de0a45c07a7f3457a
Git-commit: 572b24e6d85d98cdc552f07e9fb9870d9460d81b
Git-commit: 81ef447950bf0955aca46f4a7617d8ce435cf0ce
Git-commit: d2a10a1727b3948019128e83162f22c65859f1fd
Git-commit: 7a87e9cbc3a2f0ff0955815335e08c9862359130
Git-commit: 9333caeaeae4f831054e0e127a6ed3948b604d3e
Git-commit: 148e9a711e034e06310a8c36b64957934ebe30f2
Git-commit: 5e7e6e0c9b47a45576c38b4a72d67927a5e049f7
Git-commit: 889b77f7fd2bcc922493d73a4c51d8a851505815
Git-commit: b442723fcec445fb0ae1104888dd22cd285e0a91
Git-commit: 68693b8ea4e284c46bff919ac62bd9ccdfdbb6ba
Git-commit: 6d89252a998a695ecb0348fc2d717dc33d90cae9
Git-commit: 32a4bf2e81ec378e5925d4e069e0677a6c86a6ad
Git-commit: d269d4434c72ed0da3a9b1230c30da82c4918c63
Git-commit: b5122236bba8d7ef62153da5b55cc65d0944c61e
Git-commit: 1ae78a4870989a354028cb17dabf819b595e70e3
Git-commit: 90441b4dbe90ba0c38111ea89fa093a8c9627801
Git-commit: 39e60635a01520e8c8ed3946a28c2b98e6a46f79
Git-commit: ec512fb8e5611fed1df2895f90317ce6797d6b32
Git-commit: 56abcab833fafcfaeb2f5b25e0364c1dec45f53e
Git-commit: 5539b3c938d64a60cb1fc442ac3ce9263d52de0c
Git-commit: 7b8792bbdffdff3abda704f89c6a45ea97afdc62
Git-commit: 1fc0703af3143914a389bfa081c7acb09502ed5d
Git-commit: 237d28db036e411f22c03cfd5b0f6dc2aa9bf3bc
Git-commit: 25906052d953d3fbdb7e19480b9de5e6bb949f3f
Git-commit: 7c2e211f3c95b91912a92a8c6736343690042e2e
Git-commit: 2228d80dd05a4fc5a410fde847677b8fb3eb23d7
Git-commit: 678fa12fb8e75c6dc1e781a02e3ddbbba7e1a904
Git-commit: 5d1f00a20d2d56ed480e64e938a2391353ee565b
Git-commit: f85698cd296f08218a7750f321e94607da128600
Git-commit: 2279948735609d0d17d7384e776b674619f792ef
Git-commit: bc47150ab93988714d1fab7bc82fe5f505a107ad
Git-commit: 92b004d1aa9f367c372511ca0330f58216b25703
Git-commit: 7ce67a38f799d1fb332f672b117efbadedaa5352
Git-commit: e86fb5e8ab95f10ec5f2e9430119d5d35020c951
Git-commit: 358b7dfa1c32dfb77ff3261d244991a7c7c6d2cb
Git-commit: 11e424e88bd493b5d55d73d96c82bd889002ef30
Git-commit: b25adce1606427fd88da08f5203714cada7f6a98
Git-commit: 198a956a11b15b564ac06d1411881e215b587408
Git-commit: 2311ce4d9c91ed63a46e18f0378f3e406e7e888e
Git-commit: 81a89c2d891b78695aa7e4cc0d5a7427785ae078
Git-commit: 6bf6ca7515c1df06f5c03737537f5e0eb191e29e
Git-commit: c291ee622165cb2c8d4e7af63fffd499354a23be
Git-commit: a5fd9733a30d18d7ac23f17080e7e07bb3205b69
Git-commit: 6583659e0f92e38079a8dd081e0a1181a0f37747
Git-commit: 34f05f543f02350e920bddb7660ffdd4697aaf60
Git-commit: add284a3a2481e759d6bec35f6444c32c8ddc383
Git-commit: 148b83d0815a3778c8949e6a97cb798cbaa0efb3
Git-commit: 0b6d24c01932db99fc95304235e751e7f7625c41
Git-commit: 410cce2a6b82299b46ff316c6384e789ce275ecb
Git-commit: 5e5c21cac1001089007260c48b0c89ebaace0e71
Git-commit: 4bb62c95a7e781a238b2ab374f34b1bf91e01ddc
Git-commit: 129acb7c0b682512e89c4f65c33593d50f2f49a9
Git-commit: 881fdaa5e4cb0d68e52acab0ad4e1820e2bfffa4
Git-commit: 89669e7a7f96be3ee8d9a22a071d7c0d3b4428fc
Git-commit: 3617dc9675f0184b7bb210cfa34f3cac928d8055
Git-commit: 74b51ee152b6d99e61ba329799a039453fb9438f
Git-commit: 2196937e12b1b4ba139806d132647e1651d655df
Git-commit: 2c26d34bbcc0b3f30385d5587aa232289e2eed8e
Git-commit: 17e96834fd35997ca7cdfbf15413bcd5a36ad448
Git-commit: b0d11b42785b70e19bc6a3122eead3f7969a7589
Git-commit: 7a05dc64e2e4c611d89007b125b20c0d2a4d31a5
Git-commit: 843925f33fcc293d80acf2c5c8a78adf3344d49b
Git-commit: b8fb4e0648a2ab3734140342002f68fb0c7d1602
Git-commit: 796f2da81bead71ffc91ef70912cd8d1827bf756
Git-commit: 05b0aa579397b734f127af58e401a30784a1e315
Git-commit: 6d08acd2d32e3e877579315dc3202d7a5f336d98
Git-commit: a18e6a186f53af06937a2c268c72443336f4ab56
Git-commit: 4682a0358639b29cf69437ed909c6221f8c89847
Git-commit: 690eac53daff34169a4d74fc7bfbd388c4896abb
Git-commit: fee7e49d45149fba60156f5b59014f764d3e3728
Git-commit: 9e5e3661727eaf960d3480213f8e87c8d67b6956
Git-commit: 2836766a9d0bd02c66073f8dd44796e6cc23848d
Git-commit: 4302a59629f7a0bd70fd1605d2b558597517372a
Git-commit: f61ff6c06dc8f32c7036013ad802c899ec590607
Git-commit: 9fc81d87420d0d3fd62d5e5529972c0ad9eab9cc
Git-commit: af91568e762d04931dcbdd6bef4655433d8b9418
Git-commit: e55355453600a33bb5ca4f71f2d7214875f3b061
Git-commit: 4bf9636c39ac70da091d5a2e28d3448eaa7f115c
Git-commit: 9008d83fe9dc2e0f19b8ba17a423b3759d8e0fd7
Git-commit: 7b990789a4c3420fa57596b368733158e432d444
Git-commit: 705304a863cc41585508c0f476f6d3ec28cf7e00
Git-commit: 68f29815034e9dc9ed53cad85946c32b07adc8cc
Git-commit: 021b77bee210843bed1ea91b5cad58235ff9c8e5
Git-commit: 5a64e56976f1ba98743e1678c0029a98e9034c81
Git-commit: ef17af2a817db97d42dd2ec0a425231748e23dbc
Git-commit: 04a258c162a85c0f4ae56be67634dc43c9a4fa9b
Git-commit: 8bfbe2de769afda051c56aba5450391670e769fc
Git-commit: 1ff383a4c3eda8893ec61b02831826e1b1f46b41
Git-commit: 9c6ac78eb3521c5937b2dd8a7d1b300f41092f45
Git-commit: d908f8478a8d18e66c80a12adb27764920c1f1ca
Git-commit: 5fabcb4c33fe11c7e3afdf805fde26c1a54d0953
Git-commit: 007487f1fd43d84f26cda926081ca219a24ecbc4
Git-commit: 403dff4e2c94f275e24fd85f40b2732ffec268a1
Git-commit: c507de88f6a336bd7296c9ec0073b2d4af8b4f5e
Git-commit: 69eba10e606a80665f8573221fec589430d9d1cb
Git-commit: d70a1b9893f820fdbcdffac408c909c50f2e6b43
Git-commit: bb34cb6bbd287b57e955bc5cfd42fcde6aaca279
Git-commit: 1ddf0b1b11aa8a90cef6706e935fc31c75c406ba
Git-commit: 394f56fe480140877304d342dec46d50dc823d46
Git-commit: a629df7eadffb03e6ce4a8616e62ea29fdf69b6b
Git-commit: 2bacedada682d5485424f5227f27a3d5d6eb551c
Git-commit: da940db41dcf8c04166f711646df2f35376010aa
Git-commit: 606185b20caf4c57d7e41e5a5ea4aff460aef2ab
Git-commit: d1c7e29e8d276c669e8790bb8be9f505ddc48888
Git-commit: 6296f4a8eb86f9abcc370fb7a1a116b8441c17fd
Git-commit: cc4f14aa170d895c9a43bdb56f62070c8a6da908
Git-commit: aa5ad3b6eb8feb2399a5d26c8fb0060561bb9534
Git-commit: f38aed975c0c3645bbdfc5ebe35726e64caaf588
Git-commit: 027bc8b08242c59e19356b4b2c189f2d849ab660
Git-commit: 7ae9cb81933515dc7db1aa3c47ef7653717e3090
Git-commit: 36e8164882ca6d3c41cb91e6f09a3ed236841f80
Git-commit: 8117ac6a6c2fa0f847ff6a21a1f32c8d2c8501d0
Git-commit: cd32e2dcc9de6c27ecbbfc0e2079fb64b42bad5f
Git-commit: 3475c3d034d7f276a474c8bd53f44b48c8bf669d
Git-commit: 48826ee590da03e9882922edf96d8d27bdfe9552
Git-commit: 50c0f21b42dd4cd02b51f82274f66912d9a7fa32
Git-commit: 9e4982f6a51a2442f1bb588fee42521b44b4531c
Git-commit: dc50ddcd4c58a5a0226038307d6ef884bec9f8c2
Git-commit: af35d0f1cce7a990286e2b94c260a2c2d2a0e4b0
Git-commit: 78063d81d353e10cbdd279c490593113b8fdae1c
Git-commit: ad8fdccf9c197a89e2d2fa78c453283dcc2c343f
Git-commit: 136f49b9171074872f2a14ad0ab10486d1ba13ca
Git-commit: 0e95325525c4383565cea4f402f15a3113162d05
Git-commit: 6424babfd68dd8a83d9c60a5242d27038856599f

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
Automatically created from "patches.kernel.org/patch-3.12.36-37" by xen-port-patches.py

diff --git a/arch/x86/include/mach-xen/asm/desc.h b/arch/x86/include/mach-xen/asm/desc.h
index b90e5dfeee46..f6aaf7d16571 100644
--- a/arch/x86/include/mach-xen/asm/desc.h
+++ b/arch/x86/include/mach-xen/asm/desc.h
@@ -251,7 +251,8 @@ static inline void native_load_tls(struct thread_struct *t, unsigned int cpu)
 }
 #endif
 
-#define _LDT_empty(info)				\
+/* This intentionally ignores lm, since 32-bit apps don't have that field. */
+#define LDT_empty(info)					\
 	((info)->base_addr		== 0	&&	\
 	 (info)->limit			== 0	&&	\
 	 (info)->contents		== 0	&&	\
@@ -261,11 +262,18 @@ static inline void native_load_tls(struct thread_struct *t, unsigned int cpu)
 	 (info)->seg_not_present	== 1	&&	\
 	 (info)->useable		== 0)
 
-#ifdef CONFIG_X86_64
-#define LDT_empty(info) (_LDT_empty(info) && ((info)->lm == 0))
-#else
-#define LDT_empty(info) (_LDT_empty(info))
-#endif
+/* Lots of programs expect an all-zero user_desc to mean "no segment at all". */
+static inline bool LDT_zero(const struct user_desc *info)
+{
+	return (info->base_addr		== 0 &&
+		info->limit		== 0 &&
+		info->contents		== 0 &&
+		info->read_exec_only	== 0 &&
+		info->seg_32bit		== 0 &&
+		info->limit_in_pages	== 0 &&
+		info->seg_not_present	== 0 &&
+		info->useable		== 0);
+}
 
 static inline void clear_LDT(void)
 {
diff --git a/arch/x86/kernel/traps-xen.c b/arch/x86/kernel/traps-xen.c
index 5739ab5359a3..88f3d3b86802 100644
--- a/arch/x86/kernel/traps-xen.c
+++ b/arch/x86/kernel/traps-xen.c
@@ -369,7 +369,7 @@ exit:
  * for scheduling or signal handling. The actual stack switch is done in
  * entry.S
  */
-asmlinkage __kprobes struct pt_regs *sync_regs(struct pt_regs *eregs)
+asmlinkage notrace __kprobes struct pt_regs *sync_regs(struct pt_regs *eregs)
 {
 	struct pt_regs *regs = eregs;
 	/* Did already sync */
@@ -394,7 +394,7 @@ struct bad_iret_stack {
 	struct pt_regs regs;
 };
 
-asmlinkage __visible
+asmlinkage __visible notrace __kprobes
 struct bad_iret_stack *fixup_bad_iret(struct bad_iret_stack *s)
 {
 	/*
