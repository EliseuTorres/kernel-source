From: Jeff Mahoney <jeffm@suse.com>
Subject: xen: disable lockref on Xen
Patch-mainline: depends on Xen

Lockref needs to be able to map the lock counter portion of the spinlock
plus a 4 byte counter into an 8 byte value.

Since Xen spinlocks (with alignment padding) don't map into the 8 byte value,
lockref must be disabled on Xen.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 lib/Kconfig |    1 +
 1 file changed, 1 insertion(+)

--- a/lib/Kconfig
+++ b/lib/Kconfig
@@ -28,6 +28,7 @@ config CMPXCHG_LOCKREF
 	depends on !GENERIC_LOCKBREAK
 	depends on !DEBUG_SPINLOCK
 	depends on !DEBUG_LOCK_ALLOC
+	depends on !XEN
 
 config CRC_CCITT
 	tristate "CRC-CCITT functions"
