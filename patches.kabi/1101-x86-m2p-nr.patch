From: jbeulich@novell.com
Subject: re-introduce machine_to_phys_order for kABI consistency
Patch-mainline: n/a

On 64-bit we can safely expose the symbol, but on 32-bit exposing it
leaves the problem addressed by the original change un-fixed for any
consumer.

--- sle11sp1-2011-08-11.orig/arch/x86/kernel/head-xen.c	2011-08-16 11:13:19.000000000 +0200
+++ sle11sp1-2011-08-11/arch/x86/kernel/head-xen.c	2011-08-16 11:13:51.000000000 +0200
@@ -78,6 +78,8 @@ unsigned long *__read_mostly machine_to_
 EXPORT_SYMBOL(machine_to_phys_mapping);
 unsigned long __read_mostly machine_to_phys_nr;
 EXPORT_SYMBOL(machine_to_phys_nr);
+static unsigned int machine_to_phys_order;
+EXPORT_SYMBOL(machine_to_phys_order);
 
 void __init xen_start_kernel(void)
 {
@@ -102,6 +104,7 @@ void __init xen_start_kernel(void)
 		machine_to_phys_nr = (unsigned long *)NULL
 				     - machine_to_phys_mapping;
 #endif
+	machine_to_phys_order = __fls(machine_to_phys_nr - 1);
 
 	if (!xen_feature(XENFEAT_auto_translated_physmap))
 		phys_to_machine_mapping =
