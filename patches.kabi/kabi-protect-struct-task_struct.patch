From: Jiri Slaby <jslaby@suse.cz>
Subject: kABI: protect thread_struct
References: VM performance
Patch-mainline: never, kABI

In 3.0.39, commit 627c5c60b4ac673 (cpuset: mm: reduce large amounts of
memory barrier related damage v3), upstream commit cc9a6c8776615,
changed mems_allowed_change_disable (int) to mems_allowed_seq
(seqcount_t) in thread_struct. It didn't change the layout, but the
names.

There was a different approach done by Mel, but it was too ugly. Let's
just ignore the change, since it has no effect as he stated
(seqcount_t fits into int).

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/sched.h |    4 ++++
 1 file changed, 4 insertions(+)

--- a/include/linux/sched.h
+++ b/include/linux/sched.h
@@ -1486,7 +1486,11 @@ struct task_struct {
 #endif
 #ifdef CONFIG_CPUSETS
 	nodemask_t mems_allowed;	/* Protected by alloc_lock */
+#ifdef __GENKSYMS__
+	int mems_allowed_change_disable;
+#else
 	seqcount_t mems_allowed_seq;	/* Seqence no to catch updates */
+#endif
 	int cpuset_mem_spread_rotor;
 	int cpuset_slab_spread_rotor;
 #endif
