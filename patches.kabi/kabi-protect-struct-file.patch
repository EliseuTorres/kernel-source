From: Jiri Slaby <jslaby@suse.cz>
Subject: kABI: protect struct file
Patch-mainline: never

In 3.0.23, commit 547740231f76185 (epoll: limit paths), upstream
commit 28d82dc1c4edbc3, added f_tfile_llink to struct file. It is a
list head and it changed layout of that structure.

Let's fix it by moving the list to the end of the structure and
protecting it by __GENKSYMS__ macro. We can do that because struct
file has to be allocatated by alloc_file.

Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/fs.h |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

--- a/include/linux/fs.h
+++ b/include/linux/fs.h
@@ -988,12 +988,14 @@ struct file {
 #ifdef CONFIG_EPOLL
 	/* Used by fs/eventpoll.c to link all the hooks to this file */
 	struct list_head	f_ep_links;
-	struct list_head	f_tfile_llink;
 #endif /* #ifdef CONFIG_EPOLL */
 	struct address_space	*f_mapping;
 #ifdef CONFIG_DEBUG_WRITECOUNT
 	unsigned long f_mnt_write_state;
 #endif
+#if defined(CONFIG_EPOLL) && !defined(__GENKSYMS__)
+	struct list_head	f_tfile_llink;
+#endif /* #ifdef CONFIG_EPOLL */
 };
 
 struct file_handle {
