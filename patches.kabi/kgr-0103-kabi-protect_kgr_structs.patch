From: Jiri Slaby <jslaby@suse.cz>
Date: Tue, 29 Apr 2014 14:35:12 +0200
Subject: kabi: kgr, protect kgr structs
Patch-mainline: never, kabi
References: fate#313296

Here, we use the reserved fields of kgr structures to preserve kabi.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/kgraft.h |    9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

--- a/include/linux/kgraft.h
+++ b/include/linux/kgraft.h
@@ -93,13 +93,20 @@ struct kgr_patch {
 	struct completion finish;
 	bool __percpu *irq_use_new;
 	unsigned int refs;
+#ifdef __GENKSYMS__
 	unsigned long suse_kabi_padding[8];
+#else
+	union {
+		bool immediate;
+		unsigned long krtek; /* just for alignment and sizing */
+	};
+	unsigned long suse_kabi_padding[7];
+#endif
 
 	/* a patch shall set these */
 	const char *name;
 	struct module *owner;
 	bool replace_all;
-	bool immediate;
 	struct kgr_patch_fun patches[];
 };
 
