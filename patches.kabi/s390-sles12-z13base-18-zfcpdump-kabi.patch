From: Martin Schwidefsky <schwidefsky@de.ibm.com>
Subject: s390: z13 base performance
Patch-mainline: no
References: bnc#929879, LTC#KRN1514

Summary:     s390: z13 base performance
Description: Provide the backport of a minimum set of upstream patches
             to optimize the base performance of the IBM z13 machine.

Upstream-Description:

             zfcpdump: preserve SLES 12 kabi

             This patch re-introduces the zfcpdump_save_areas symbol to
             keep the SLES 12 kabi checker happy. This symbol is not used
             by any 3rd party modules, and it should be removed with
             SLES 12 SP1 before a new kabi is defined.

Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/kernel/smp.c |    8 ++++++++
 1 file changed, 8 insertions(+)

--- a/arch/s390/kernel/smp.c
+++ b/arch/s390/kernel/smp.c
@@ -534,6 +534,14 @@ EXPORT_SYMBOL(smp_ctl_clear_bit);
 
 #if defined(CONFIG_ZFCPDUMP) || defined(CONFIG_CRASH_DUMP)
 
+/*
+ * This is a temporary workaround to keep the SLES 12 kabi checker happy,
+ * the zfcpdump_save_areas symbol is not used by 3rd party modules.
+ * This has to be removed for SLES 12 SP1, before a new kabi is defined.
+ */
+struct save_area *zfcpdump_save_areas[NR_CPUS + 1];
+EXPORT_SYMBOL_GPL(zfcpdump_save_areas);
+
 static void __init smp_get_save_area(int cpu, u16 address)
 {
 	void *lc = pcpu_devices[0].lowcore;
