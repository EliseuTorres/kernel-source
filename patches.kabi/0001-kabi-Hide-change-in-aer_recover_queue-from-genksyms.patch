From e67796123c32897fd67c814508caa87497265e60 Mon Sep 17 00:00:00 2001
From: Michal Marek <mmarek@suse.cz>
Date: Tue, 29 Oct 2013 11:58:33 +0100
Subject: [PATCH] kabi: Hide change in aer_recover_queue() from genksyms
Patch-mainline: never (kabi)
References: bnc#847721

The aer_recover_queue() symbol is only going to be used by ghes.ko, but
it is part of the drivers_pci_pcie_aer_aerdriver symset, which some KMPs
depend on.

Signed-off-by: Michal Marek <mmarek@suse.cz>
---
 drivers/pci/pcie/aer/aerdrv_core.c | 6 +++++-
 include/linux/aer.h                | 7 +++++--
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/drivers/pci/pcie/aer/aerdrv_core.c b/drivers/pci/pcie/aer/aerdrv_core.c
index 5a3cadd..c56694c 100644
--- a/drivers/pci/pcie/aer/aerdrv_core.c
+++ b/drivers/pci/pcie/aer/aerdrv_core.c
@@ -602,7 +602,11 @@ static DEFINE_SPINLOCK(aer_recover_ring_lock);
 static DECLARE_WORK(aer_recover_work, aer_recover_work_func);
 
 void aer_recover_queue(int domain, unsigned int bus, unsigned int devfn,
-		       int severity, struct aer_capability_regs *aer_regs)
+		       int severity
+#ifndef __GENKSYMS__
+		       , struct aer_capability_regs *aer_regs
+#endif
+		       )
 {
 	unsigned long flags;
 	struct aer_recover_entry entry = {
diff --git a/include/linux/aer.h b/include/linux/aer.h
index 3c3718e..52202d9 100644
--- a/include/linux/aer.h
+++ b/include/linux/aer.h
@@ -57,7 +57,10 @@ extern void cper_print_aer(struct pci_dev *dev,
 			   int cper_severity, struct aer_capability_regs *aer);
 extern int cper_severity_to_aer(int cper_severity);
 extern void aer_recover_queue(int domain, unsigned int bus, unsigned int devfn,
-			      int severity,
-			      struct aer_capability_regs *aer_regs);
+			      int severity
+#ifndef __GENKSYMS__
+			      , struct aer_capability_regs *aer_regs
+#endif
+			      );
 #endif //_AER_H_
 
-- 
1.8.1.4

