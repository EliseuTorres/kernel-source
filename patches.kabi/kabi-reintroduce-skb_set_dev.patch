From: Jiri Slaby <jslaby@suse.cz>
Subject: kABI: reintroduce skb_set_dev
Patch-mainline: never

In 3.0.34, commit 83bba7979059b83df4edc16f747784c6990fc3bb (Revert
"net: maintain namespace isolation between vlan and real device"),
upstream commit 59b9997baba5242997ddc7bd96b1391f5275a5a4, removed
skb_set_dev function from the kernel. But it was exported and we
provided it already.

Fix it by reverting a part of the revert, i.e. reintroduce the
function back.

Signed-off-by: Jiri Slaby <jslaby@suse.cz>
---
 include/linux/netdevice.h |    9 +++++++++
 net/core/dev.c            |    8 ++++++++
 2 files changed, 17 insertions(+)

--- a/include/linux/netdevice.h
+++ b/include/linux/netdevice.h
@@ -1457,6 +1457,15 @@ static inline bool netdev_uses_dsa_tags(
 	return 0;
 }
 
+#ifndef CONFIG_NET_NS
+static inline void skb_set_dev(struct sk_buff *skb, struct net_device *dev)
+{
+	skb->dev = dev;
+}
+#else /* CONFIG_NET_NS */
+void skb_set_dev(struct sk_buff *skb, struct net_device *dev);
+#endif
+
 static inline bool netdev_uses_trailer_tags(struct net_device *dev)
 {
 #ifdef CONFIG_NET_DSA_TAG_TRAILER
--- a/net/core/dev.c
+++ b/net/core/dev.c
@@ -1800,6 +1800,14 @@ void netif_device_attach(struct net_devi
 }
 EXPORT_SYMBOL(netif_device_attach);
 
+#ifdef CONFIG_NET_NS
+void skb_set_dev(struct sk_buff *skb, struct net_device *dev)
+{
+	skb->dev = dev;
+}
+EXPORT_SYMBOL(skb_set_dev);
+#endif /* CONFIG_NET_NS */
+
 /*
  * Invalidate hardware checksum when packet is to be mangled, and
  * complete checksum manually on outgoing path.
