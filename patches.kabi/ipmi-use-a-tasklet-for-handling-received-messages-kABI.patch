From: Jean Delvare <jdelvare@suse.de>
Subject: Fix ipmi-use-a-tasklet-for-handling-received-messages.patch kABI breakage
Patch-mainline: never

Work around kABI breakage caused by new members in struct ipmi_smi.
This structure is only passed by address outside of ipmi_msghandler.

Signed-off-by: Jean Delvare <jdelvare@suse.de>
---
 drivers/char/ipmi/ipmi_msghandler.c |    9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

--- a/drivers/char/ipmi/ipmi_msghandler.c
+++ b/drivers/char/ipmi/ipmi_msghandler.c
@@ -46,7 +46,9 @@
 #include <linux/init.h>
 #include <linux/proc_fs.h>
 #include <linux/rcupdate.h>
+#ifndef __GENKSYMS__
 #include <linux/interrupt.h>
+#endif
 
 #define PFX "IPMI message handler: "
 
@@ -365,8 +367,6 @@ struct ipmi_smi {
 	 */
 	spinlock_t       waiting_msgs_lock;
 	struct list_head waiting_msgs;
-	atomic_t	 watchdog_pretimeouts_to_deliver;
-	struct tasklet_struct recv_tasklet;
 
 	/*
 	 * The list of command receivers that are registered for commands
@@ -429,6 +429,11 @@ struct ipmi_smi {
 	 * parameters passed by "low" level IPMI code.
 	 */
 	int run_to_completion;
+
+#ifndef __GENKSYMS__
+	atomic_t	 watchdog_pretimeouts_to_deliver;
+	struct tasklet_struct recv_tasklet;
+#endif
 };
 #define to_si_intf_from_dev(device) container_of(device, struct ipmi_smi, dev)
 
