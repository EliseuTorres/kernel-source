From 64a4926cd46885d1bb124aa083965e98bdeb1c78 Mon Sep 17 00:00:00 2001
From: Sage Weil <sage@inktank.com>
Date: Fri, 20 Jul 2012 17:19:43 -0700
Subject: [PATCH 569/938] libceph: drop unnecessary CLOSED check in socket
 state change callback
References: fate#312983
Git-commit: d7353dd5aaf22ed611fbcd0d4a4a12fb30659290
Patch-mainline: v3.6-rc1

If we are CLOSED, the socket is closed and we won't get these.

Signed-off-by: Sage Weil <sage@inktank.com>
Acked-by: Danny Al-Gaaf <dalgaaf@suse.de>

---
 net/ceph/messenger.c | 3 ---
 1 file changed, 3 deletions(-)

diff --git a/net/ceph/messenger.c b/net/ceph/messenger.c
index 72f40c8..6c47e0d 100644
--- a/net/ceph/messenger.c
+++ b/net/ceph/messenger.c
@@ -295,9 +295,6 @@ static void ceph_sock_state_change(struct sock *sk)
 	dout("%s %p state = %lu sk_state = %u\n", __func__,
 	     con, con->state, sk->sk_state);
 
-	if (test_bit(CLOSED, &con->state))
-		return;
-
 	switch (sk->sk_state) {
 	case TCP_CLOSE:
 		dout("%s TCP_CLOSE\n", __func__);
-- 
1.8.3

