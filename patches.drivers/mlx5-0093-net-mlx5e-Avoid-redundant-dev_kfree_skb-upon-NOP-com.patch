From: Achiad Shochat <achiad@mellanox.com>
Date: Tue, 23 Jun 2015 17:14:17 +0300
Subject: [PATCH 093/117] net/mlx5e: Avoid redundant dev_kfree_skb() upon NOP
 completion
Patch-mainline: v4.2-rc1
Git-commit: 9fc5930625bcf7c519db84023ec720e7f2f7f61c
References: bsc#923036 FATE#318772

NOP completion SKBs are always NULL.

Signed-off-by: Achiad Shochat <achiad@mellanox.com>
Signed-off-by: Saeed Mahameed <saeedm@mellanox.com>
Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Hadar Hen Zion <hadarh@mellanox.com>
Acked-by: Cho, Yu-Chen <acho@suse.com>
---
 drivers/net/ethernet/mellanox/mlx5/core/en_tx.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_tx.c
@@ -293,7 +293,7 @@ bool mlx5e_poll_tx_cq(struct mlx5e_cq *c
 		if (unlikely(!skb)) { /* nop */
 			sq->stats.nop++;
 			sqcc++;
-			goto free_skb;
+			continue;
 		}
 
 		for (j = 0; j < MLX5E_TX_SKB_CB(skb)->num_dma; j++) {
@@ -308,8 +308,6 @@ bool mlx5e_poll_tx_cq(struct mlx5e_cq *c
 		npkts++;
 		nbytes += MLX5E_TX_SKB_CB(skb)->num_bytes;
 		sqcc += MLX5E_TX_SKB_CB(skb)->num_wqebbs;
-
-free_skb:
 		dev_kfree_skb(skb);
 	}
 
