From: Matthew Wilcox <matthew.r.wilcox@intel.com>
Date: Thu, 20 Jan 2011 13:42:34 -0500
Subject: NVMe: Fix admin IRQ claim on real hardware
Git-commit: 53c9577e9ca68a633c6e9df2b54eaecacfa77f62
References: FATE#313627
Patch-Mainline: v3.7-rc1

The admin IRQ is supposed to use the pin-based (or single message MSI)
interrupt.  Accomplish this by filling in entry[0]'s vector with the
INTx irq number.

Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/block/nvme.c b/drivers/block/nvme.c
index 3d917a8..44a9d5e 100644
--- a/drivers/block/nvme.c
+++ b/drivers/block/nvme.c
@@ -979,6 +979,7 @@ static int __devinit nvme_probe(struct pci_dev *pdev,
 	pci_set_drvdata(pdev, dev);
 	dma_set_mask(&dev->pci_dev->dev, DMA_BIT_MASK(64));
 	nvme_set_instance(dev);
+	dev->entry[0].vector = pdev->irq;
 
 	dev->bar = ioremap(pci_resource_start(pdev, 0), 8192);
 	if (!dev->bar) {
-- 
1.7.4.2

