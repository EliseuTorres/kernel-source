From jpirko@redhat.com  Thu Jun 23 22:49:03 2011
From: Jiri Pirko <jpirko@redhat.com>
Date: Tue, 23 Feb 2010 09:19:49 +0000
Subject: [PATCH 010/187] net: convert multiple drivers to use
 netdev_for_each_mc_addr, part5 V2
Git-commit: f9dcbcc9e338d08c0f7de7eba4eaafbbb7f81249
Patch-mainline: v2.6.34-rc1
References: bnc#698272, FATE#311468

removed some needless checks and also corrected bug in lp486e (dmi was passed
instead of dmi->dmi_addr)

Signed-off-by: Jiri Pirko <jpirko@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/net/qlcnic/qlcnic_compat.h |    5 +++++
 drivers/net/qlcnic/qlcnic_hw.c     |    3 +--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/drivers/net/qlcnic/qlcnic_compat.h b/drivers/net/qlcnic/qlcnic_compat.h
index 4d3b802..bfec7f5 100644
--- a/drivers/net/qlcnic/qlcnic_compat.h
+++ b/drivers/net/qlcnic/qlcnic_compat.h
@@ -9,4 +9,9 @@
 #define netdev_mc_empty(dev) (netdev_mc_count(dev) == 0)
 #endif
 
+#ifndef netdev_for_each_mc_addr
+#define netdev_for_each_mc_addr(mclist, dev) \
+	for (mclist = dev->mc_list; mclist; mclist = mclist->next)
+#endif
+
 #endif
diff --git a/drivers/net/qlcnic/qlcnic_hw.c b/drivers/net/qlcnic/qlcnic_hw.c
index 8ea7f86..99a4d13 100644
--- a/drivers/net/qlcnic/qlcnic_hw.c
+++ b/drivers/net/qlcnic/qlcnic_hw.c
@@ -453,8 +453,7 @@ void qlcnic_set_multi(struct net_device *netdev)
 	}
 
 	if (!netdev_mc_empty(netdev)) {
-		for (mc_ptr = netdev->mc_list; mc_ptr;
-				     mc_ptr = mc_ptr->next) {
+		netdev_for_each_mc_addr(mc_ptr, netdev) {
 			qlcnic_nic_add_mac(adapter, mc_ptr->dmi_addr,
 							&del_list);
 		}
-- 
1.6.3.3

