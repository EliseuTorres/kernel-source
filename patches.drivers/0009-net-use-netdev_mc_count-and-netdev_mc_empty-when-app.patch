From: Jiri Pirko <jpirko@redhat.com>
Date: Mon, 8 Feb 2010 04:30:35 +0000
Subject: [PATCH 009/187] net: use netdev_mc_count and netdev_mc_empty when
 appropriate
Git-commit: 4cd24eaf0c6ee7f0242e34ee77ec899f255e66b5
Patch-mainline: v2.6.34-rc1

This patch replaces dev->mc_count in all drivers (hopefully I didn't miss
anything). Used spatch and did small tweaks and conding style changes when
it was suitable.

Jirka

Signed-off-by: Jiri Pirko <jpirko@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/net/qlcnic/qlcnic.h        |    1 +
 drivers/net/qlcnic/qlcnic_compat.h |   12 ++++++++++++
 drivers/net/qlcnic/qlcnic_hw.c     |    4 ++--
 3 files changed, 15 insertions(+), 2 deletions(-)
 create mode 100644 drivers/net/qlcnic/qlcnic_compat.h

diff --git a/drivers/net/qlcnic/qlcnic.h b/drivers/net/qlcnic/qlcnic.h
index b40a851..252e068 100644
--- a/drivers/net/qlcnic/qlcnic.h
+++ b/drivers/net/qlcnic/qlcnic.h
@@ -48,6 +48,7 @@
 #include <asm/byteorder.h>
 
 #include "qlcnic_hdr.h"
+#include "qlcnic_compat.h"
 
 #define _QLCNIC_LINUX_MAJOR 5
 #define _QLCNIC_LINUX_MINOR 0
diff --git a/drivers/net/qlcnic/qlcnic_compat.h b/drivers/net/qlcnic/qlcnic_compat.h
new file mode 100644
index 0000000..4d3b802
--- /dev/null
+++ b/drivers/net/qlcnic/qlcnic_compat.h
@@ -0,0 +1,12 @@
+#ifndef _QLCNIC_COMPAT_H
+#define _QLCNIC_COMPAT_H
+
+#ifndef netdev_mc_count
+#define netdev_mc_count(dev) ((dev)->mc_count)
+#endif
+
+#ifndef netdev_mc_empty
+#define netdev_mc_empty(dev) (netdev_mc_count(dev) == 0)
+#endif
+
+#endif
diff --git a/drivers/net/qlcnic/qlcnic_hw.c b/drivers/net/qlcnic/qlcnic_hw.c
index dc6cd69..8ea7f86 100644
--- a/drivers/net/qlcnic/qlcnic_hw.c
+++ b/drivers/net/qlcnic/qlcnic_hw.c
@@ -447,12 +447,12 @@ void qlcnic_set_multi(struct net_device *netdev)
 	}
 
 	if ((netdev->flags & IFF_ALLMULTI) ||
-			(netdev->mc_count > adapter->max_mc_count)) {
+	    (netdev_mc_count(netdev) > adapter->max_mc_count)) {
 		mode = VPORT_MISS_MODE_ACCEPT_MULTI;
 		goto send_fw_cmd;
 	}
 
-	if (netdev->mc_count > 0) {
+	if (!netdev_mc_empty(netdev)) {
 		for (mc_ptr = netdev->mc_list; mc_ptr;
 				     mc_ptr = mc_ptr->next) {
 			qlcnic_nic_add_mac(adapter, mc_ptr->dmi_addr,
-- 
1.6.3.3

