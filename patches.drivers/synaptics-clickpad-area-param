From: Takashi Iwai <tiwai@suse.de>
Subject: input: synaptics - add clickpad_area parameter
Patch-mainline: Unlikely
References: bnc#567703

Add clickpad_area parameter to psmouse synaptics driver to make the
button area configurable.  Also, use the larger area than before as
default for new HP laptops, what are main user of Clickpad.

The sensing in the right-side v-scroll area is exceptionally allowed
even in the button area.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/input/mouse/synaptics.c |   11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

--- a/drivers/input/mouse/synaptics.c
+++ b/drivers/input/mouse/synaptics.c
@@ -333,6 +333,11 @@
 	((XMAX_NOMINAL - XMIN_NOMINAL) * 2 / 5 + XMIN_NOMINAL)
 #define CLICKPAD_RIGHT_BTN_X \
 	((XMAX_NOMINAL - XMIN_NOMINAL) * 3 / 5 + XMIN_NOMINAL)
+#define X_VSCROLL (XMAX_NOMINAL - (XMAX_NOMINAL - XMIN_NOMINAL) / 15)
+
+/* additional clickpad area in percent */
+static int clickpad_area = 20;
+module_param(clickpad_area, int, 0644);
 
 /* handle clickpad events */
 static void clickpad_process_packet(struct synaptics_data *priv,
@@ -341,9 +346,11 @@
 	/* clickpad mode reports Y range from 0 to YMAX_NOMINAL,
 	 * where the area Y < YMIN_NOMINAL is used as click buttons
 	 */
-	if (hw->y < YMIN_NOMINAL) {
+	if (hw->y < YMIN_NOMINAL + (YMAX_NOMINAL - YMIN_NOMINAL) * clickpad_area / 100) {
 		/* button area */
-		hw->z = 0; /* don't move pointer */
+		/* allow position change for the v-scroll area exceptionally */
+		if (hw->x < X_VSCROLL || hw->middle)
+			hw->z = 0; /* don't move pointer */
 		/* clickpad reports only the middle button, and we need
 		 * to fake left/right buttons depending on the touch position
 		 */
