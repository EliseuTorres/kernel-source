From: Hariprasad Shenai <hariprasad@chelsio.com>
Date: Mon, 12 Jan 2015 22:06:16 +0530
Subject: [PATCH 165/230] cxgb4vf: Initialize mdio_addr before using it
Patch-mainline: v3.19-rc5
Git-commit: fd48e639dfd3e86dd85bdeb40512a44b74b02e6f
References: bsc#924379 FATE#318566 bsc#921338

In commit 5ad24def21b205a8 ("cxgb4vf: Fix ethtool get_settings for VF driver")
mdio_addr of port_info structure was used unininitialzed. Fixing it.

Signed-off-by: Hariprasad Shenai <hariprasad@chelsio.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: David Chang <dchang@suse.com>
---
 drivers/net/ethernet/chelsio/cxgb4vf/t4vf_hw.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/net/ethernet/chelsio/cxgb4vf/t4vf_hw.c
+++ b/drivers/net/ethernet/chelsio/cxgb4vf/t4vf_hw.c
@@ -324,6 +324,8 @@ int t4vf_port_init(struct adapter *adapt
 		return v;
 
 	v = be32_to_cpu(port_rpl.u.info.lstatus_to_modtype);
+	pi->mdio_addr = (v & FW_PORT_CMD_MDIOCAP_F) ?
+			FW_PORT_CMD_MDIOADDR_G(v) : -1;
 	pi->port_type = FW_PORT_CMD_PTYPE_G(v);
 	pi->mod_type = FW_PORT_MOD_TYPE_NA;
 
