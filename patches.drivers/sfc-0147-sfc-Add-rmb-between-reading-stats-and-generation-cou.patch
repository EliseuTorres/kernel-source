From: Jon Cooper <jcooper@solarflare.com>
Date: Fri, 27 Sep 2013 18:26:30 +0100
Subject: [PATCH v2 147/244] sfc: Add rmb() between reading stats and
 generation count to ensure consistency
Patch-mainline: v3.12-rc7
Git-commit: d546a89362dcc35bc1aacf0e8e3b0da5a7d2dc89
References: bsc#909618 FATE#317521

Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
Acked-by: David Chang <dchang@suse.com>
---
 drivers/net/ethernet/sfc/ef10.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/ethernet/sfc/ef10.c
+++ b/drivers/net/ethernet/sfc/ef10.c
@@ -855,6 +855,7 @@ static int efx_ef10_try_update_nic_stats
 	rmb();
 	efx_nic_update_stats(efx_ef10_stat_desc, EF10_STAT_COUNT, stats_mask,
 			     stats, efx->stats_buffer.addr, false);
+	rmb();
 	generation_start = dma_stats[MC_CMD_MAC_GENERATION_START];
 	if (generation_end != generation_start)
 		return -EAGAIN;
