From: Dan Williams <dan.j.williams@intel.com>
Date: Fri, 29 Apr 2011 13:20:30 -0700
Subject: [PATCH 131/273] isci: kill scic_remote_device_get_connection_rate
Git-commit: 8f304c36ee415600c6bbc5de300e6fa3dbe59d6d
References: FATE#311808,bnc#709528
Patch-Mainline: 3.0

A function call to dereference a pointer is a tad much.

Signed-off-by: Dan Williams <dan.j.williams@intel.com>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/isci/core/scic_sds_request.c     |    3 +--
 drivers/scsi/isci/core/scic_sds_smp_request.c |    3 +--
 drivers/scsi/isci/core/scic_sds_stp_request.c |    3 +--
 drivers/scsi/isci/remote_device.c             |   13 -------------
 drivers/scsi/isci/remote_device.h             |   13 -------------
 5 files changed, 3 insertions(+), 32 deletions(-)

diff --git a/drivers/scsi/isci/core/scic_sds_request.c b/drivers/scsi/isci/core/scic_sds_request.c
index fba6428..ffc1607 100644
--- a/drivers/scsi/isci/core/scic_sds_request.c
+++ b/drivers/scsi/isci/core/scic_sds_request.c
@@ -443,8 +443,7 @@ static void scu_ssp_reqeust_construct_task_context(
 	task_context->abort = 0;
 	task_context->priority = 0;
 	task_context->initiator_request = 1;
-	task_context->connection_rate =
-		scic_remote_device_get_connection_rate(target_device);
+	task_context->connection_rate = target_device->connection_rate;
 	task_context->protocol_engine_index =
 		scic_sds_controller_get_protocol_engine_group(controller);
 	task_context->logical_port_index =
diff --git a/drivers/scsi/isci/core/scic_sds_smp_request.c b/drivers/scsi/isci/core/scic_sds_smp_request.c
index fff8668..2815da2 100644
--- a/drivers/scsi/isci/core/scic_sds_smp_request.c
+++ b/drivers/scsi/isci/core/scic_sds_smp_request.c
@@ -193,8 +193,7 @@ static void scu_smp_request_construct_task_context(
 	 */
 	task_context->priority = 0;
 	task_context->initiator_request = 1;
-	task_context->connection_rate =
-		scic_remote_device_get_connection_rate(sci_dev);
+	task_context->connection_rate = sci_dev->connection_rate;
 	task_context->protocol_engine_index =
 		scic_sds_controller_get_protocol_engine_group(controller);
 	task_context->logical_port_index =
diff --git a/drivers/scsi/isci/core/scic_sds_stp_request.c b/drivers/scsi/isci/core/scic_sds_stp_request.c
index ec21546..8c98023 100644
--- a/drivers/scsi/isci/core/scic_sds_stp_request.c
+++ b/drivers/scsi/isci/core/scic_sds_stp_request.c
@@ -181,8 +181,7 @@ static void scu_sata_reqeust_construct_task_context(
 	task_context->abort = 0;
 	task_context->priority = SCU_TASK_PRIORITY_NORMAL;
 	task_context->initiator_request = 1;
-	task_context->connection_rate =
-		scic_remote_device_get_connection_rate(target_device);
+	task_context->connection_rate = target_device->connection_rate;
 	task_context->protocol_engine_index =
 		scic_sds_controller_get_protocol_engine_group(controller);
 	task_context->logical_port_index =
diff --git a/drivers/scsi/isci/remote_device.c b/drivers/scsi/isci/remote_device.c
index f6da85e..834a3fe 100644
--- a/drivers/scsi/isci/remote_device.c
+++ b/drivers/scsi/isci/remote_device.c
@@ -152,22 +152,9 @@ enum sci_status scic_remote_device_reset_complete(
 	return sci_dev->state_handlers->reset_complete_handler(sci_dev);
 }
 
-
-enum sas_linkrate scic_remote_device_get_connection_rate(
-	struct scic_sds_remote_device *sci_dev)
-{
-	return sci_dev->connection_rate;
-}
-
-/**
- *
- *
- * Remote device timer requirements
- */
 #define SCIC_SDS_REMOTE_DEVICE_MINIMUM_TIMER_COUNT (0)
 #define SCIC_SDS_REMOTE_DEVICE_MAXIMUM_TIMER_COUNT (SCI_MAX_REMOTE_DEVICES)
 
-
 /**
  *
  * @sci_dev: The remote device for which the suspend is being requested.
diff --git a/drivers/scsi/isci/remote_device.h b/drivers/scsi/isci/remote_device.h
index dda217a..fd24df3 100644
--- a/drivers/scsi/isci/remote_device.h
+++ b/drivers/scsi/isci/remote_device.h
@@ -208,19 +208,6 @@ enum sci_status scic_remote_device_reset(
 enum sci_status scic_remote_device_reset_complete(
 	struct scic_sds_remote_device *remote_device);
 
-
-
-/**
- * scic_remote_device_get_connection_rate() - This method simply returns the
- *    link rate at which communications to the remote device occur.
- * @remote_device: This parameter specifies the device for which to get the
- *    connection rate.
- *
- * Return the link rate at which we transfer for the supplied remote device.
- */
-enum sas_linkrate scic_remote_device_get_connection_rate(
-	struct scic_sds_remote_device *remote_device);
-
 #define scic_remote_device_is_atapi(device_handle) false
 
 /**
-- 
1.6.0.2

