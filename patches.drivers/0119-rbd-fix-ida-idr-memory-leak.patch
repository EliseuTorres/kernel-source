From a414af35ac194de28e705698329d8e66585a9eee Mon Sep 17 00:00:00 2001
From: Ilya Dryomov <ilya.dryomov@inktank.com>
Date: Tue, 20 May 2014 15:46:04 +0400
Subject: [PATCH 119/213] rbd: fix ida/idr memory leak
References: fate#318918
Git-commit: ffe312cf31c7d8616096616d469eb5f6bb8905c0
Patch-mainline: v3.16-rc1

ida_destroy() needs to be called on module exit to release ida caches.

Signed-off-by: Ilya Dryomov <ilya.dryomov@inktank.com>
Reviewed-by: Alex Elder <elder@linaro.org>
Acked-by: David Disseldorp <ddiss@suse.de>

---
 drivers/block/rbd.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/block/rbd.c b/drivers/block/rbd.c
index 04ae041..68cf6c1 100644
--- a/drivers/block/rbd.c
+++ b/drivers/block/rbd.c
@@ -5531,6 +5531,7 @@ err_out_slab:
 
 static void __exit rbd_exit(void)
 {
+	ida_destroy(&rbd_dev_id_ida);
 	rbd_sysfs_cleanup();
 	if (single_major)
 		unregister_blkdev(rbd_major, RBD_DRV_NAME);
-- 
2.1.4

