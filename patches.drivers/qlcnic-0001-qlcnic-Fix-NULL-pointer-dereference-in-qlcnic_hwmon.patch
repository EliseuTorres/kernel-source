From: Shahed Shaikh <shahed.shaikh@qlogic.com>
Date: Thu, 25 Jun 2015 21:15:22 +0530
Subject: [PATCH] qlcnic: Fix NULL pointer dereference in qlcnic_hwmon_show_temp()
Patch-mainline: Never, only for SP4 kernel
References: bsc#936095

Driver was using wrong method to access adapter structure which
caused NULL pointer dereference.

Signed-off-by: Shahed Shaikh <shahed.shaikh@qlogic.com>
Acked-by: Gary Ching-Pang Lin <glin@suse.com>
---
 drivers/net/ethernet/qlogic/qlcnic/qlcnic_sysfs.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

--- a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_sysfs.c
+++ b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_sysfs.c
@@ -1269,9 +1269,7 @@ static ssize_t qlcnic_hwmon_show_temp(st
 				      struct device_attribute *dev_attr,
 				      char *buf)
 {
-	struct pci_dev *pdev = to_pci_dev(dev);
-	struct net_device *netdev = pci_get_drvdata(pdev);
-	struct qlcnic_adapter *adapter = netdev_priv(netdev);
+	struct qlcnic_adapter *adapter = dev_get_drvdata(dev);
 	unsigned int temperature = 0, value = 0;
 
 	if (qlcnic_83xx_check(adapter))
