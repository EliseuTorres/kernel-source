From: Jiri Pirko <jpirko@redhat.com>
Date: Tue, 23 Feb 2010 23:17:07 +0000
Subject: [PATCH 6/22] net: convert multiple drivers to use netdev_for_each_mc_addr, part6
References: bnc#674189, fate#311981
Patch-mainline: v2.6.34-rc1
Git-commit: 567ec874d15b478c8eda7e9a5d2dcb05f13f1fb5

Signed-off-by: Jiri Pirko <jpirko@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Chen, Chien-Chia <machen@suse.com>
---
 drivers/net/vmxnet3/vmxnet3_drv.c |   11 ++++-------
 
 drivers/net/vmxnet3/vmxnet3_drv.c |   11 ++++-------
 1 file changed, 4 insertions(+), 7 deletions(-)

--- a/drivers/net/vmxnet3/vmxnet3_drv.c
+++ b/drivers/net/vmxnet3/vmxnet3_drv.c
@@ -1684,15 +1684,12 @@ vmxnet3_copy_mc(struct net_device *netde
 		/* We may be called with BH disabled */
 		buf = kmalloc(sz, GFP_ATOMIC);
 		if (buf) {
-			int i;
-			struct dev_mc_list *mc = netdev->mc_list;
+			struct dev_mc_list *mc;
+			int i = 0;
 
-			for (i = 0; i < netdev_mc_count(netdev); i++) {
-				BUG_ON(!mc);
-				memcpy(buf + i * ETH_ALEN, mc->dmi_addr,
+			netdev_for_each_mc_addr(mc, netdev)
+				memcpy(buf + i++ * ETH_ALEN, mc->dmi_addr,
 				       ETH_ALEN);
-				mc = mc->next;
-			}
 		}
 	}
 	return buf;
