From 3ad75f8a02ef39c7c24714f23ef3551ad099785a Mon Sep 17 00:00:00 2001
From: SF Markus Elfring <elfring@users.sourceforge.net>
Date: Sun, 2 Nov 2014 15:20:59 +0100
Subject: [PATCH 182/213] rbd: delete unnecessary checks before two function
 calls
References: fate#318918
Git-commit: e96a650a8174e20112b400e72e0b2429aa66de20
Patch-mainline: v3.19-rc1

The functions ceph_put_snap_context() and iput() test whether their
argument is NULL and then return immediately. Thus the test around the
call is not needed.

This issue was detected by using the Coccinelle software.

Signed-off-by: Markus Elfring <elfring@users.sourceforge.net>
[idryomov@redhat.com: squashed rbd.c hunk, changelog]
Signed-off-by: Ilya Dryomov <idryomov@redhat.com>

[ddiss@suse.de: only pull in rbd changes, ignore CephFS]
Acked-by: David Disseldorp <ddiss@suse.de>

---
 drivers/block/rbd.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/block/rbd.c b/drivers/block/rbd.c
index 54d4716..1d3585c 100644
--- a/drivers/block/rbd.c
+++ b/drivers/block/rbd.c
@@ -3447,8 +3447,7 @@ err_rq:
 	if (result)
 		rbd_warn(rbd_dev, "%s %llx at %llx result %d",
 			 obj_op_name(op_type), length, offset, result);
-	if (snapc)
-		ceph_put_snap_context(snapc);
+	ceph_put_snap_context(snapc);
 	blk_end_request_all(rq, result);
 }
 
-- 
2.1.4

