From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Wed, 3 Jul 2013 12:37:46 +0300
Subject: net/mlx4: fix small memory leak on error
Patch-mainline: v3.11-rc1
Git-commit: 9caf83c32be1dabf000ab7dc8430fba4f7d89e65
References: bug#919382 FATE#317529

"work" needs to be freed before returning on this error path.

Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/mellanox/mlx4/cmd.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/ethernet/mellanox/mlx4/cmd.c
+++ b/drivers/net/ethernet/mellanox/mlx4/cmd.c
@@ -1547,6 +1547,7 @@ int mlx4_master_immediate_activate_vlan_
 					   vp_admin->default_vlan,
 					   &admin_vlan_ix);
 		if (err) {
+			kfree(work);
 			mlx4_warn((&priv->dev),
 				  "No vlan resources slave %d, port %d\n",
 				  slave, port);
