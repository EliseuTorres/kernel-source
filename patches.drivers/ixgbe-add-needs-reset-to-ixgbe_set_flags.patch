From 9a713e7c7cca2f31c89367bb7b48310ab8a3e630 Mon Sep 17 00:00:00 2001
From: Brandon Philips <bphilips@suse.de>
Date: Wed, 10 Feb 2010 16:07:54 +0000
Subject: [PATCH] ixgbe: add needs_reset to ixgbe_set_flags
Git-commit: 9a713e7c7cca2f31c89367bb7b48310ab8a3e630
Patch-mainline: Never, backport based on v2.6.34-rc1~233^2~382
References: bnc#686325

Take needs_reset logic from upstream to help with backport

Signed-off-by: Brandon Philips <bphilips@suse.de>

---
 drivers/net/ixgbe/ixgbe_ethtool.c |    7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

--- a/drivers/net/ixgbe/ixgbe_ethtool.c
+++ b/drivers/net/ixgbe/ixgbe_ethtool.c
@@ -2140,6 +2140,7 @@ static int ixgbe_set_coalesce(struct net
 static int ixgbe_set_flags(struct net_device *netdev, u32 data)
 {
 	struct ixgbe_adapter *adapter = netdev_priv(netdev);
+	bool need_reset = false;
 
 	ethtool_op_set_flags(netdev, data);
 
@@ -2150,13 +2151,17 @@ static int ixgbe_set_flags(struct net_de
 	if ((!!(data & ETH_FLAG_LRO)) != 
 	    (!!(adapter->flags2 & IXGBE_FLAG2_RSC_ENABLED))) {
 		adapter->flags2 ^= IXGBE_FLAG2_RSC_ENABLED;
+		need_reset = true;
+	}
+
+	if (need_reset) {
 		if (netif_running(netdev))
 			ixgbe_reinit_locked(adapter);
 		else
 			ixgbe_reset(adapter);
 	}
-	return 0;
 
+	return 0;
 }
 
 static const struct ethtool_ops ixgbe_ethtool_ops = {
