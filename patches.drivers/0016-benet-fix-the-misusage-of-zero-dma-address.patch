From fujita.tomonori@lab.ntt.co.jp  Thu Jun 23 15:40:24 2011
From: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp>
Date: Sun, 4 Apr 2010 21:40:18 +0000
Subject: [PATCH] benet: fix the misusage of zero dma address
Git-commit: b681ee77f8ad248b0fdcec2e5e8c4df6e757eba3
Patch-mainline: v2.6.35-rc1
References: FATE#311448, bnc#697255

benet driver wrongly assumes that zero is an invalid dma address
(calls dma_unmap_page for only non zero dma addresses). Zero is a
valid dma address on some architectures. The dma length can be used
here.

Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp>
Acked-by: Sathya Perla <sathyap@serverengines.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/net/benet/be_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
--- a/drivers/net/benet/be_main.c
+++ b/drivers/net/benet/be_main.c
@@ -405,7 +405,7 @@ static void unmap_tx_frag(struct pci_dev
 	be_dws_le_to_cpu(wrb, sizeof(*wrb));
 
 	dma = (u64)wrb->frag_pa_hi << 32 | (u64)wrb->frag_pa_lo;
-	if (dma != 0) {
+	if (wrb->frag_len) {
 		if (unmap_single)
 			pci_unmap_single(pdev, dma, wrb->frag_len,
 				PCI_DMA_TODEVICE);
