From: Eugenia Emantayev <eugenia@mellanox.com>
Date: Tue, 8 Jul 2014 11:25:22 +0300
Subject: net/mlx4_en: Do not disable vlan filter during promiscuous mode
Patch-mainline: v3.17-rc1
Git-commit: 49a1e4f6b7e78fed9ab36ebbb9d88656885255a4
References: bug#919382 FATE#317529

Promiscous mode is only for MACs.
Should not disable/enable VLAN filter when entering/leaving promisuous mode.

Signed-off-by: Aviad Yehezkel <aviadye@mellanox.co.il>
Signed-off-by: Eugenia Emantayev <eugenia@mellanox.com>
Signed-off-by: Amir Vadai <amirv@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/mellanox/mlx4/en_netdev.c |   10 ----------
 1 file changed, 10 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlx4/en_netdev.c
+++ b/drivers/net/ethernet/mellanox/mlx4/en_netdev.c
@@ -868,11 +868,6 @@ static void mlx4_en_do_set_multicast(str
 						  0, MLX4_MCAST_DISABLE);
 			if (err)
 				en_err(priv, "Failed disabling multicast filter\n");
-
-			/* Disable port VLAN filter */
-			err = mlx4_SET_VLAN_FLTR(mdev->dev, priv);
-			if (err)
-				en_err(priv, "Failed disabling VLAN filter\n");
 		}
 		goto out;
 	}
@@ -922,11 +917,6 @@ static void mlx4_en_do_set_multicast(str
 				en_err(priv, "Failed disabling promiscuous mode\n");
 			break;
 		}
-
-		/* Enable port VLAN filter */
-		err = mlx4_SET_VLAN_FLTR(mdev->dev, priv);
-		if (err)
-			en_err(priv, "Failed enabling VLAN filter\n");
 	}
 
 	/* Enable/disable the multicast filter according to IFF_ALLMULTI */
