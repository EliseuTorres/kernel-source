From: Ajit Khaparde <ajitk@serverengines.com>
Date: Thu, 11 Mar 2010 01:35:59 +0000
Subject: [PATCH] be2net: fix mccq create for big endian architectures
References: bnc#591513
Patch-mainline: Submitted and merged to net-next-2.6
Git-commit: d4a2ac3e802d9f598453a7854d0fdf67371ac2dd

The request to create an mccq was being dispatched without
doing a byte swap of num_pages. This byte swap is necessary
for Big Endian systems like PPC. Not having this fix leads
mccq create to fail on BE ASICs running newer version of
firmware, thereby causing driver initialization failure.

Signed-off-by: Ajit Khaparde <ajitk@serverengines.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Brandon Philips <bphilips@suse.de>

---
 drivers/net/benet/be_cmds.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: linux-2.6.32-SLE11-SP1/drivers/net/benet/be_cmds.c
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/drivers/net/benet/be_cmds.c
+++ linux-2.6.32-SLE11-SP1/drivers/net/benet/be_cmds.c
@@ -676,7 +676,7 @@ int be_cmd_mccq_create(struct be_adapter
 	be_cmd_hdr_prepare(&req->hdr, CMD_SUBSYSTEM_COMMON,
 			OPCODE_COMMON_MCC_CREATE, sizeof(*req));
 
-	req->num_pages = PAGES_4K_SPANNED(q_mem->va, q_mem->size);
+	req->num_pages = cpu_to_le16(PAGES_4K_SPANNED(q_mem->va, q_mem->size));
 
 	AMAP_SET_BITS(struct amap_mcc_context, fid, ctxt, be_pci_func(adapter));
 	AMAP_SET_BITS(struct amap_mcc_context, valid, ctxt, 1);
