From 8ae3124b8f0f3f97f928be22ccc816118d4b0ecb Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Tue, 15 Jan 2013 17:43:09 +0100
Subject: [PATCH 25/29] ALSA: hda/ca0132 - Fix possible invalid DMA channel deallocation
Git-commit: 8ae3124b8f0f3f97f928be22ccc816118d4b0ecb
Patch-mainline: 3.9-rc1
References: bnc#814440,FATE#314291

... in the error path in dspxfr_image().

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/pci/hda/patch_ca0132.c |    6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

--- a/sound/pci/hda/patch_ca0132.c
+++ b/sound/pci/hda/patch_ca0132.c
@@ -2167,7 +2167,7 @@ static const struct dsp_image_seg *get_n
 /*
  * CA0132 chip DSP transfer stuffs.  For DSP download.
  */
-#define INVALID_DMA_CHANNEL (~0UL)
+#define INVALID_DMA_CHANNEL (~0U)
 
 /*
  * Program a list of address/data pairs via the ChipIO widget.
@@ -2431,7 +2431,7 @@ static int dspxfr_image(struct hda_codec
 	dma_engine->buf_size = (ovly ? DSP_DMA_WRITE_BUFLEN_OVLY :
 			DSP_DMA_WRITE_BUFLEN_INIT) * 2;
 
-	dma_chan = 0;
+	dma_chan = ovly ? INVALID_DMA_CHANNEL : 0;
 
 	status = codec_set_converter_format(codec, WIDGET_CHIP_CTRL,
 					hda_format, &response);
@@ -2453,7 +2453,7 @@ static int dspxfr_image(struct hda_codec
 		status = dspio_alloc_dma_chan(codec, &dma_chan);
 		if (status < 0) {
 			snd_printdd(KERN_ERR "alloc dmachan fail");
-			dma_chan = (unsigned int)INVALID_DMA_CHANNEL;
+			dma_chan = INVALID_DMA_CHANNEL;
 			goto exit;
 		}
 	}
