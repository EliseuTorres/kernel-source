From: Andrew Vasquez <andrew.vasquez@qlogic.com>
Subject: SLES11 SP1 GMC kernel not identifying qla2xxx LUNs
References: bnc#606977
Patch-Mainline: Not yet

The .06 patchset introduced an issue where it would incorrectly
mark a port presenting both initiator and target capabilities.
This would cause the driver to not initiate a scan on these ports.

Signed-off-by: Andrew Vasquez <andrew.vasquez@qlogic.com>
Acked-by: Hannes Reinecke <hare@suse.de>

diff --git a/drivers/scsi/qla2xxx/qla_isr.c b/drivers/scsi/qla2xxx/qla_isr.c
index e1e4402..8b298c8 100644
--- a/drivers/scsi/qla2xxx/qla_isr.c
+++ b/drivers/scsi/qla2xxx/qla_isr.c
@@ -1115,8 +1115,7 @@ qla24xx_logio_entry(scsi_qla_host_t *vha, struct req_que *req,
 			fcport->port_type = FCT_TARGET;
 			if (iop[0] & BIT_8)
 				fcport->flags |= FCF_FCP2_DEVICE;
-		}
-		if (iop[0] & BIT_5)
+		} else if (iop[0] & BIT_5)
 			fcport->port_type = FCT_INITIATOR;
 		if (logio->io_parameter[7] || logio->io_parameter[8])
 			fcport->supported_classes |= FC_COS_CLASS2;
