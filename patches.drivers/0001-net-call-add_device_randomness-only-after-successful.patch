From f652151640344f8faee21fcf702b4fd46b8fe70b Mon Sep 17 00:00:00 2001
From: Jiri Pirko <jiri@resnulli.us>
Date: Tue, 1 Jan 2013 03:30:14 +0000
Subject: [PATCH v2 001/021] net: call add_device_randomness() only after successful mac
 change

Git-commit: f652151640344f8faee21fcf702b4fd46b8fe70b
Patch-mainline: v3.9-rc1
Reference: fate#317398
Target: sle11-sp4

Signed-off-by: Jiri Pirko <jiri@resnulli.us>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Lee, Chun-Yi <jlee@suse.com>

---
 net/core/dev.c |    7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

Index: linux-3.0-SLE11-SP4/net/core/dev.c
===================================================================
--- linux-3.0-SLE11-SP4.orig/net/core/dev.c
+++ linux-3.0-SLE11-SP4/net/core/dev.c
@@ -5004,10 +5004,11 @@ int dev_set_mac_address(struct net_devic
 	if (!netif_device_present(dev))
 		return -ENODEV;
 	err = ops->ndo_set_mac_address(dev, sa);
-	if (!err)
-		call_netdevice_notifiers(NETDEV_CHANGEADDR, dev);
+	if (err)
+		return err;
+	call_netdevice_notifiers(NETDEV_CHANGEADDR, dev);
 	add_device_randomness(dev->dev_addr, dev->addr_len);
-	return err;
+	return 0;
 }
 EXPORT_SYMBOL(dev_set_mac_address);
 
