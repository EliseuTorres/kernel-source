From: Alexander Duyck <alexander.h.duyck@redhat.com>
Date: Fri, 1 May 2015 10:34:50 -0700
Subject: [PATCH 50/50] ixgbevf: Use dev_kfree_skb_any in xmit path, not
 dev_kfree_skb
Patch-mainline: v4.1-rc4
Git-commit: e7fcd5439ffd76e499b7ba4a2f8e99645addff3e
References: bsc#922835 FATE#318522

With netpoll making use of the transmit function it is possible for the
ndo_start_xmit function to be called with irqs disabled.  As such we need
to use dev_kfree_skb_any in the Tx cleanup path for frames that are
dropped.

Signed-off-by: Alexander Duyck <alexander.h.duyck@redhat.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Cho, Yu-Chen <acho@suse.com>
---
 drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c
+++ b/drivers/net/ethernet/intel/ixgbevf/ixgbevf_main.c
@@ -3617,7 +3617,7 @@ static int ixgbevf_xmit_frame(struct sk_
 	u8 *dst_mac = skb_header_pointer(skb, 0, 0, NULL);
 
 	if (!dst_mac || is_link_local_ether_addr(dst_mac)) {
-		dev_kfree_skb(skb);
+		dev_kfree_skb_any(skb);
 		return NETDEV_TX_OK;
 	}
 
