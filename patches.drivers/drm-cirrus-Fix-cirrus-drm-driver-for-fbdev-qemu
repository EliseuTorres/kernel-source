From 99d4a8ae93ead27b5a88cdbd09dc556fe96ac3a8 Mon Sep 17 00:00:00 2001
From: Martin Koegler <martin.koegler@chello.at>
Date: Thu, 9 Jan 2014 10:05:07 +0100
Subject: [PATCH] drm/cirrus: Fix cirrus drm driver for fbdev + qemu
Git-commit: 99d4a8ae93ead27b5a88cdbd09dc556fe96ac3a8
Patch-mainline: 3.14-rc1
References: bnc#856760

Xorg fbdev driver requires smem_start/smem_len, otherwise
it tries to map 0 bytes as video memory.

Bugzilla: https://bugzilla.novell.com/show_bug.cgi?id=856760
Signed-off-by: Martin Koegler <martin.koegler@chello.at>
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Dave Airlie <airlied@redhat.com>

---
 drivers/gpu/drm/cirrus/cirrus_fbdev.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/drivers/gpu/drm/cirrus/cirrus_fbdev.c
+++ b/drivers/gpu/drm/cirrus/cirrus_fbdev.c
@@ -233,6 +233,9 @@ static int cirrusfb_create(struct drm_fb
 	info->apertures->ranges[0].base = cdev->dev->mode_config.fb_base;
 	info->apertures->ranges[0].size = cdev->mc.vram_size;
 
+	info->fix.smem_start = cdev->dev->mode_config.fb_base;
+	info->fix.smem_len = cdev->mc.vram_size;
+
 	info->screen_base = sysram;
 	info->screen_size = size;
 
