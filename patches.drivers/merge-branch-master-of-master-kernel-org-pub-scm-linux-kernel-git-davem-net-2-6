From davem@davemloft.net  Tue Jul  5 17:41:12 2011
From: David S. Miller <davem@davemloft.net>
Date: Tue, 6 Apr 2010 23:53:30 -0700
Subject: Merge branch 'master' of
	master.kernel.org:/pub/scm/linux/kernel/git/davem/net-2.6
Patch-mainline: v2.6.35-rc1
Git-commit: 4a35ecf8bf1c4b039503fa554100fe85c761de76
References: FATE#311470, bnc#694966

Conflicts:
	drivers/net/bonding/bond_main.c
	drivers/net/via-velocity.c
	drivers/net/wireless/iwlwifi/iwl-agn.c

Acked-by: Jeff Mahoney <jeffm@suse.com>
---

 drivers/net/cxgb4/cxgb4_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --cc drivers/net/cxgb4/cxgb4_main.c
index 0000000,a7e30a2..5f582db
mode 000000,100644..100644
--- a/drivers/net/cxgb4/cxgb4_main.c
+++ b/drivers/net/cxgb4/cxgb4_main.c
@@ -240,9 +240,9 @@
 	u16 filt_idx[7];
 	const u8 *addr[7];
 	int ret, naddr = 0;
-	const struct dev_addr_list *d;
 	const struct netdev_hw_addr *ha;
 	int uc_cnt = netdev_uc_count(dev);
+	int mc_cnt = netdev_mc_count(dev);
 	const struct port_info *pi = netdev_priv(dev);
 
 	/* first do the secondary unicast addresses */
@@ -260,9 +260,9 @@
 	}
 
 	/* next set up the multicast addresses */
-	netdev_for_each_mc_addr(d, dev) {
-		addr[naddr++] = d->dmi_addr;
-		if (naddr >= ARRAY_SIZE(addr) || d->next == NULL) {
+	netdev_for_each_mc_addr(ha, dev) {
+		addr[naddr++] = ha->addr;
+		if (--mc_cnt == 0 || naddr >= ARRAY_SIZE(addr)) {
 			ret = t4_alloc_mac_filt(pi->adapter, 0, pi->viid, free,
 					naddr, addr, filt_idx, &mhash, sleep);
 			if (ret < 0)

