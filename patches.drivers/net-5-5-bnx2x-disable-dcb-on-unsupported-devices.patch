From 39115b91c145ae43c3c724d7935ac6efb198abb4 Mon Sep 17 00:00:00 2001
From: Dmitry Kravkov <dmitry@broadcom.com>
Date: Thu, 11 Aug 2011 17:48:23 +0300
Subject: [PATCH] bnx2x: disable DCB on unsupported devices
Patch-mainline: No (code is different upstream)
References: fate#311461. bnc#698050

Signed-off-by: Dmitry Kravkov <dmitry@broadcom.com>
Acked-by: mmarek@suse.cz

---
 drivers/net/bnx2x/bnx2x_dcb.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/net/bnx2x/bnx2x_dcb.c b/drivers/net/bnx2x/bnx2x_dcb.c
index eb470c7..b1fca38 100644
--- a/drivers/net/bnx2x/bnx2x_dcb.c
+++ b/drivers/net/bnx2x/bnx2x_dcb.c
@@ -894,7 +894,7 @@ void bnx2x_dcbx_init(struct bnx2x *bp)
 {
 	u32 dcbx_lldp_params_offset = SHMEM_LLDP_DCBX_PARAMS_NONE;
 	/* validate:
-	 * chip of good for dcbx version,
+	 * chip rev is  good for dcbx,
 	 * dcb is wanted
 	 * the function is pmf
 	 * shmem2 contains DCBX support fields
@@ -902,7 +902,8 @@ void bnx2x_dcbx_init(struct bnx2x *bp)
 	DP(NETIF_MSG_LINK, "dcb_enable %d bp->port.pmf %d\n",
 	   bp->dcbx_config_params.dcb_enable, bp->port.pmf);
 
-	if (bp->dcbx_config_params.dcb_enable &&
+	if (!CHIP_IS_E1x(bp) && !CHIP_IS_E3(bp) &&
+	    bp->dcbx_config_params.dcb_enable &&
 	    bp->port.pmf &&
 	    SHMEM2_HAS(bp, dcbx_lldp_params_offset)) {
 		dcbx_lldp_params_offset = SHMEM2_RD(bp,
-- 
1.7.2.2

