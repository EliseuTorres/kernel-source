From: Matthew Wilcox <matthew.r.wilcox@intel.com>
Date: Thu, 28 Apr 2011 23:17:36 -0700
Subject: NVMe: Rename cancel_cmdid_data to cancel_cmdid
Git-commit: 21075bdee0a6f56058920d889df4ae561bfed754
References: FATE#313627
Patch-Mainline: v3.7-rc1

The trailing '_data' on the end was annoying and inconsistent.  Also, make
it actually return the data since this is needed for timing out commands.

Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme.c |    7 +++++--
 1 files changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/block/nvme.c b/drivers/block/nvme.c
index 205405e..9ca9db9 100644
--- a/drivers/block/nvme.c
+++ b/drivers/block/nvme.c
@@ -213,10 +213,13 @@ static unsigned long free_cmdid(struct nvme_queue *nvmeq, int cmdid)
 	return data;
 }
 
-static void cancel_cmdid_data(struct nvme_queue *nvmeq, int cmdid)
+static unsigned long cancel_cmdid(struct nvme_queue *nvmeq, int cmdid)
 {
+	unsigned long data;
 	struct nvme_cmd_info *info = nvme_cmd_info(nvmeq);
+	data = info[cmdid].ctx;
 	info[cmdid].ctx = CMD_CTX_CANCELLED;
+	return data;
 }
 
 static struct nvme_queue *get_nvmeq(struct nvme_ns *ns)
@@ -667,7 +670,7 @@ static irqreturn_t nvme_irq_check(int irq, void *data)
 static void nvme_abort_command(struct nvme_queue *nvmeq, int cmdid)
 {
 	spin_lock_irq(&nvmeq->q_lock);
-	cancel_cmdid_data(nvmeq, cmdid);
+	cancel_cmdid(nvmeq, cmdid);
 	spin_unlock_irq(&nvmeq->q_lock);
 }
 
-- 
1.7.4.2

