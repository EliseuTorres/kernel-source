From 019a35f1142b1cd153c8a38338515e633ec0cf77 Mon Sep 17 00:00:00 2001
From: Andiry Xu <andiry.xu@amd.com>
Date: Thu, 6 Jan 2011 15:43:17 +0800
Subject: xHCI: Remove redundant variable in xhci_resume()
Patch-mainline: v2.6.39
Git-commit: 019a35f1142b1cd153c8a38338515e633ec0cf77

Set hcd->state = HC_STATE_SUSPENDED if there is a power loss during system
resume or the system is hibernated, otherwise leave it be. The variable
old_state is redundant and made an unreachable code path, so remove it.

Signed-off-by: Andiry Xu <andiry.xu@amd.com>
Signed-off-by: Sarah Sharp <sarah.a.sharp@linux.intel.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

---
 drivers/usb/host/xhci.c |    7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)

--- a/drivers/usb/host/xhci.c
+++ b/drivers/usb/host/xhci.c
@@ -695,9 +695,8 @@ int xhci_resume(struct xhci_hcd *xhci, b
 {
 	u32			command, temp = 0;
 	struct usb_hcd		*hcd = xhci_to_hcd(xhci);
-	int	old_state, retval;
+	int			retval;
 
-	old_state = hcd->state;
 	if (time_before(jiffies, xhci->next_statechange))
 		msleep(100);
 
@@ -781,10 +780,6 @@ int xhci_resume(struct xhci_hcd *xhci, b
 	 */
 
 	set_bit(HCD_FLAG_HW_ACCESSIBLE, &hcd->flags);
-	if (!hibernated)
-		hcd->state = old_state;
-	else
-		hcd->state = HC_STATE_SUSPENDED;
 
 	spin_unlock_irq(&xhci->lock);
 	return 0;
