From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Mon, 12 Jan 2015 11:56:58 +0300
Subject: [PATCH 111/117] IB/mlx5: Fix error code in get_port_caps()
Patch-mainline: v4.0-rc1
Git-commit: f614fc15ae39ceb531586e3969f2b99fd23182a0
References: bsc#923036 FATE#318772

The current code returns success when kmalloc() fails.  It should
return an error code, -ENOMEM.

Fixes: e126ba97dba9 ("mlx5: Add driver for Mellanox Connect-IB adapters")
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Roland Dreier <roland@purestorage.com>
Signed-off-by: Hadar Hen Zion <hadarh@mellanox.com>
Acked-by: Cho, Yu-Chen <acho@suse.com>
---
 drivers/infiniband/hw/mlx5/main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/infiniband/hw/mlx5/main.c
+++ b/drivers/infiniband/hw/mlx5/main.c
@@ -891,7 +891,7 @@ static int get_port_caps(struct mlx5_ib_
 {
 	struct ib_device_attr *dprops = NULL;
 	struct ib_port_attr *pprops = NULL;
-	int err = 0;
+	int err = -ENOMEM;
 	int port;
 
 	pprops = kmalloc(sizeof(*pprops), GFP_KERNEL);
