From: Tony Luck <tony.luck@intel.com>
Subject: pstore: fix build warning for unused return value from sysfs_create_file
References: fate#311705
Patch-Mainline: v2.6.39-rc1
Git-commit: 168f2e14319aba3125946649604e858cbae85be6


Signed-off-by: Thomas Renninger <trenn@suse.de>

fs/pstore/inode.c: In function 'init_pstore_fs':
fs/pstore/inode.c:266: warning: ignoring return value of 'sysfs_create_file', declared with attribute warn_unused_result

Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
Signed-off-by: Tony Luck <tony.luck@intel.com>

---
 fs/pstore/inode.c |   29 +++++++++++++++++------------
 1 file changed, 17 insertions(+), 12 deletions(-)

Index: linux-2.6.32-SLE11-SP2/fs/pstore/inode.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/fs/pstore/inode.c
+++ linux-2.6.32-SLE11-SP2/fs/pstore/inode.c
@@ -257,23 +257,28 @@ static struct file_system_type pstore_fs
 
 static int __init init_pstore_fs(void)
 {
-	int ret = 0;
+	int rc = 0;
 	struct kobject *pstorefs_kobj;
 
 	pstorefs_kobj = kobject_create_and_add("pstore", fs_kobj);
-	if (!pstorefs_kobj)
-		return -ENOMEM;
-
-	sysfs_create_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
-
-	ret = register_filesystem(&pstore_fs_type);
-
-	if (ret) {
-		sysfs_remove_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
-		kobject_put(pstorefs_kobj);
+	if (!pstorefs_kobj) {
+		rc = -ENOMEM;
+		goto done;
 	}
 
-	return ret;
+	rc = sysfs_create_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
+	if (rc)
+		goto done1;
+
+	rc = register_filesystem(&pstore_fs_type);
+	if (rc == 0)
+		goto done;
+
+	sysfs_remove_file(pstorefs_kobj, &pstore_kmsg_bytes_attr.attr);
+done1:
+	kobject_put(pstorefs_kobj);
+done:
+	return rc;
 }
 module_init(init_pstore_fs)
 
