From: Randy Dunlap <randy.dunlap@oracle.com>
Subject: PCI: pci-label: Fix build failure when CONFIG_NLS is set to 'm' by allmodconfig
Git-commit: 8a226e00eeed8db843d4a580013a49ae3559bcd7
References: bnc#697944, fate#311158 
Patch-mainline: v2.6.39-rc5

Create a kconfig option symbol for PCI_LABEL and enable it
when DMI || ACPI are enabled.
    
Signed-off-by: Randy Dunlap <randy.dunlap@oracle.com>
Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
Signed-off-by: Rafael J. Wysocki <rjw@suse.de>
---
 drivers/pci/Kconfig  |    4 +++-
 drivers/pci/Makefile |    4 ++--
 2 files changed, 5 insertions(+), 3 deletions(-)

Index: linux-2.6.32-SLE11-SP2/drivers/pci/Kconfig
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/drivers/pci/Kconfig
+++ linux-2.6.32-SLE11-SP2/drivers/pci/Kconfig
@@ -91,4 +91,6 @@ config PCI_IOV
 
 	  If unsure, say N.
 
-select NLS if (DMI || ACPI)
+config PCI_LABEL
+	def_bool y if (DMI || ACPI)
+	select NLS
Index: linux-2.6.32-SLE11-SP2/drivers/pci/Makefile
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/drivers/pci/Makefile
+++ linux-2.6.32-SLE11-SP2/drivers/pci/Makefile
@@ -57,10 +57,10 @@ obj-$(CONFIG_MN10300) += setup-bus.o
 # ACPI Related PCI FW Functions
 # ACPI _DSM provided firmware instance and string name
 #
-obj-$(CONFIG_ACPI)    += pci-acpi.o pci-label.o
+obj-$(CONFIG_ACPI)    += pci-acpi.o
 
 # SMBIOS provided firmware instance and labels
-obj-$(CONFIG_DMI)    += pci-label.o
+obj-$(CONFIG_PCI_LABEL) += pci-label.o
 
 # Cardbus & CompactPCI use setup-bus
 obj-$(CONFIG_HOTPLUG) += setup-bus.o

