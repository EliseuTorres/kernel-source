From: Egbert Eich <eich@suse.de>
Subject: Don't delete DPLL Multiplier during DAC init.
Patch-mainline: To be mainlined
References: bnc #728840

The DPLL multipiler is set up in intel_display.c i9xx_crtc_mode_set().
There the multiplier is adjusted so that the SDVO gets a sufficient
bus clock. When cloning a CRTC between an SDVO driven encoder and the
standard DAC the DAC setup code reset the multiplier value to 1.
This is broken and leads to the wrong results, also there is no
need to touch the multiplier in the DAC setup code: the correct value
(i.e. 1 in case no SDVO encoder is used should be set by 
i9xx_crtc_mode_set() already.


---
 drivers/gpu/drm/i915/intel_crt.c |   12 +-----------
 1 file changed, 1 insertion(+), 11 deletions(-)

--- a.orig/drivers/gpu/drm/i915/intel_crt.c
+++ b/drivers/gpu/drm/i915/intel_crt.c
@@ -126,7 +126,7 @@ static void intel_crt_mode_set(struct dr
 	struct intel_crtc *intel_crtc = to_intel_crtc(crtc);
 	struct drm_i915_private *dev_priv = dev->dev_private;
 	int dpll_md_reg;
-	u32 adpa, dpll_md;
+	u32 adpa;
 	u32 adpa_reg;
 
 	dpll_md_reg = DPLL_MD(intel_crtc->pipe);
@@ -136,16 +136,6 @@ static void intel_crt_mode_set(struct dr
 	else
 		adpa_reg = ADPA;
 
-	/*
-	 * Disable separate mode multiplier used when cloning SDVO to CRT
-	 * XXX this needs to be adjusted when we really are cloning
-	 */
-	if (INTEL_INFO(dev)->gen >= 4 && !HAS_PCH_SPLIT(dev)) {
-		dpll_md = I915_READ(dpll_md_reg);
-		I915_WRITE(dpll_md_reg,
-			   dpll_md & ~DPLL_MD_UDI_MULTIPLIER_MASK);
-	}
-
 	adpa = ADPA_HOTPLUG_BITS;
 	if (adjusted_mode->flags & DRM_MODE_FLAG_PHSYNC)
 		adpa |= ADPA_HSYNC_ACTIVE_HIGH;
