From f6e4d19069c0fe8ece52ed056b804dad674fd7bb Mon Sep 17 00:00:00 2001
From: dann frazier <dannf@hp.com>
Date: Wed, 2 Jun 2010 16:23:39 -0600
Subject: [PATCH] watchdog: hpwdt (1/3): Introduce SECS_TO_TICKS() macro
References: bnc#612407
Patch-mainline: linux-next (will be in 2.6.36)

Define a macro to convert from seconds to timer ticks.

Signed-off-by: dann frazier <dannf@hp.com>
Acked-by: Thomas Mingarelli <Thomas.Mingarelli@hp.com>
Signed-off-by: Wim Van Sebroeck <wim@iguana.be>
Acked-by: Jean Delvare <jdelvare@suse.de>
---
 drivers/watchdog/hpwdt.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/drivers/watchdog/hpwdt.c
+++ b/drivers/watchdog/hpwdt.c
@@ -50,6 +50,8 @@
 #define ROM_SIZE			0x10000
 #define HPWDT_VERSION			"1.1.1"
 
+#define SECS_TO_TICKS(secs) ((secs) * 1000 / 128)
+
 struct bios32_service_dir {
 	u32 signature;
 	u32 entry_point;
@@ -421,7 +423,7 @@ static int __devinit detect_cru_service(
  */
 static void hpwdt_start(void)
 {
-	reload = (soft_margin * 1000) / 128;
+	reload = SECS_TO_TICKS(soft_margin);
 	iowrite16(reload, hpwdt_timer_reg);
 	iowrite16(0x85, hpwdt_timer_con);
 }
@@ -454,7 +456,7 @@ static int hpwdt_change_timer(int new_ma
 	printk(KERN_DEBUG
 		"hpwdt: New timer passed in is %d seconds.\n",
 		new_margin);
-	reload = (soft_margin * 1000) / 128;
+	reload = SECS_TO_TICKS(soft_margin);
 
 	return 0;
 }
