From 278b3953ce00cad99010aef90bb65eff08229792 Mon Sep 17 00:00:00 2001
From: Borislav Petkov <bp@suse.de>
Date: Thu, 13 Nov 2014 19:05:24 +0100
Subject: [PATCH] HID: picolcd: sanity check report size in raw_event()
 callback (bsc#896392, CVE-2014-3186).
References: bnc#905522
Git-Commit: f2e323ec96077642d397bb1c355def536d489d16
Patch-Mainline: v3.18-rc1

suse-commit: 177b5b9336a2c5efa4cb25d2bcd19826afd4f93a
Signed-off-by: Oliver Neukum <oneukum@suse.de>
---
 drivers/hid/hid-picolcd.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/hid/hid-picolcd.c b/drivers/hid/hid-picolcd.c
index 7ef4147..bfb079b 100644
--- a/drivers/hid/hid-picolcd.c
+++ b/drivers/hid/hid-picolcd.c
@@ -2389,6 +2389,12 @@ static int picolcd_raw_event(struct hid_device *hdev,
 	if (!data)
 		return 1;
 
+	if (size > 64) {
+		hid_warn(hdev, "invalid size value (%d) for picolcd raw event\n",
+				size);
+		return 0;
+	}
+
 	if (report->id == REPORT_KEY_STATE) {
 		if (data->input_keys)
 			ret = picolcd_raw_keypad(data, report, raw_data+1, size-1);
-- 
1.8.4.5

