From: Rasesh Mody <rmody@brocade.com>
Date: Thu, 18 Apr 2013 15:29:39 -0700
Subject: bfa: fix for Brocade FC Direct Attach LUN discovery failure
References: bnc#816037
Patch-Mainline: not yet

This patch fixes fcs rport state machine to address ocassional Brocade FC
Direct Attach LUN discovery failure.

Signed-off-by: Anil Gurumurthy <agurumur@brocade.com>
Signed-off-by: Rasesh Mody <rmody@brocade.com>
Acked-by: Hannes Reinecke <hare@suse.de>

diff --git a/drivers/scsi/bfa/bfa_fcs_rport.c b/drivers/scsi/bfa/bfa_fcs_rport.c
index 58ac643..610ca95 100644
--- a/drivers/scsi/bfa/bfa_fcs_rport.c
+++ b/drivers/scsi/bfa/bfa_fcs_rport.c
@@ -189,8 +189,8 @@ bfa_fcs_rport_sm_uninit(struct bfa_fcs_rport_s *rport, enum rport_event event)
 		break;
 
 	case RPSM_EVENT_PLOGI_RCVD:
-		bfa_sm_set_state(rport, bfa_fcs_rport_sm_fc4_fcs_online);
-		bfa_fcs_rport_fcs_online_action(rport);
+		bfa_sm_set_state(rport, bfa_fcs_rport_sm_plogiacc_sending);
+		bfa_fcs_rport_send_plogiacc(rport, NULL);
 		break;
 
 	case RPSM_EVENT_PLOGI_COMP:
