Net: Add netdev_alloc_skb_ip_align() helper
Subject: net: Add netdev_alloc_skb_ip_align() helper
References: BNC#562046
Patch-mainline: 2.6.33-rc1
Git-commit: 89d71a66c40d629e3b1285def543ab1425558cd5

From: Eric Dumazet <eric.dumazet@gmail.com>

Instead of hardcoding NET_IP_ALIGN stuff in various network drivers,
we can add a helper around netdev_alloc_skb()

Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: John Jolly <jjolly@suse.de>

---

 include/linux/skbuff.h |   10 ++++++++++
 1 files changed, 10 insertions(+), 0 deletions(-)


Index: linux-2.6.32-master/include/linux/skbuff.h
===================================================================
--- linux-2.6.32-master.orig/include/linux/skbuff.h
+++ linux-2.6.32-master/include/linux/skbuff.h
@@ -1508,6 +1508,16 @@ static inline struct sk_buff *netdev_all
 	return __netdev_alloc_skb(dev, length, GFP_ATOMIC);
 }
 
+static inline struct sk_buff *netdev_alloc_skb_ip_align(struct net_device *dev,
+		unsigned int length)
+{
+	struct sk_buff *skb = netdev_alloc_skb(dev, length + NET_IP_ALIGN);
+
+	if (NET_IP_ALIGN && skb)
+		skb_reserve(skb, NET_IP_ALIGN);
+	return skb;
+}
+
 extern struct page *__netdev_alloc_page(struct net_device *dev, gfp_t gfp_mask);
 extern void __netdev_free_page(struct net_device *dev, struct page *page);
 
