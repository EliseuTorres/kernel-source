From: Bhanu Prakash Gollapudi <bprakash@broadcom.com>
Date: Wed, 16 Jan 2013 08:42:54 -0800
Subject: bnx2fc: v2: Support software fcoe target
Git-commit: Pending
Patch-mainline: Submitted 11 Jan 2013 linux-scsi@vger.kernel.org
References: FATE#313818,bnc#798931

V2: Incorrectly used bitwise 'or' instead of bitwise 'and' operation. Fixed it
in this V2 patch.

Signed-off-by: Bhanu Prakash Gollapudi <bprakash@broadcom.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/bnx2fc/bnx2fc_tgt.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/scsi/bnx2fc/bnx2fc_tgt.c b/drivers/scsi/bnx2fc/bnx2fc_tgt.c
index 1d4c56e..c57a3bb 100644
--- a/drivers/scsi/bnx2fc/bnx2fc_tgt.c
+++ b/drivers/scsi/bnx2fc/bnx2fc_tgt.c
@@ -388,8 +388,8 @@ static int bnx2fc_init_tgt(struct bnx2fc_rport *tgt,
 	atomic_set(&tgt->num_active_ios, 0);
 
 	if (rdata->flags & FC_RP_FLAGS_RETRY &&
-	    rdata->ids.roles | FC_RPORT_ROLE_FCP_TARGET &&
-	    !(rdata->ids.roles | FC_RPORT_ROLE_FCP_INITIATOR)) {
+	    rdata->ids.roles & FC_RPORT_ROLE_FCP_TARGET &&
+	    !(rdata->ids.roles & FC_RPORT_ROLE_FCP_INITIATOR)) {
 		tgt->dev_type = TYPE_TAPE;
 		tgt->io_timeout = 0; /* use default ULP timeout */
 	} else {
-- 
1.7.10.130.g36e6c

