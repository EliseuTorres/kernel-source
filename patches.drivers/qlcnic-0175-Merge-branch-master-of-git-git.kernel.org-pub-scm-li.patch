From 627ab8d3bbc3909fb779ef752888d5f0d56d3a6e Mon Sep 17 00:00:00 2001
From: David S. Miller <davem@davemloft.net>
Date: Mon, 6 Jan 2014 17:37:45 -0500
Subject: [PATCH] Merge branch 'master' of git://git.kernel.org/pub/scm/linux/kernel/git/davem/net
Patch-mainline: v3.14-rc1
Git-commit: 56a4342dfe3145cd66f766adccb28fd9b571606d (partial)
References: bsc#909350 FATE#317546


Conflicts:
	drivers/net/ethernet/qlogic/qlcnic/qlcnic_sriov_pf.c
	net/ipv6/ip6_tunnel.c
	net/ipv6/ip6_vti.c

ipv6 tunnel statistic bug fixes conflicting with consolidation into
generic sw per-cpu net stats.

qlogic conflict between queue counting bug fix and the addition
of multiple MAC address support.

Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Shahed Shaikh <shahed.shaikh@qlogic.com>
Acked-by: Gary Ching-Pang Lin <glin@suse.com>
---
 drivers/net/ethernet/qlogic/qlcnic/qlcnic_sriov_pf.c |    7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

--- a/drivers/net/ethernet/qlogic/qlcnic/qlcnic_sriov_pf.c
+++ b/drivers/net/ethernet/qlogic/qlcnic/qlcnic_sriov_pf.c
@@ -80,9 +80,12 @@ static int qlcnic_sriov_pf_cal_res_limit
 	if (qlcnic_83xx_pf_check(adapter))
 		num_macs = 1;
 
+	info->max_rx_mcast_mac_filters = res->num_rx_mcast_mac_filters;
+
 	if (adapter->ahw->pci_func == func) {
 		info->min_tx_bw = 0;
 		info->max_tx_bw = MAX_BW;
+
 		temp = res->num_rx_ucast_mac_filters - num_macs * num_vfs;
 		info->max_rx_ucast_mac_filters = temp;
 		temp = res->num_tx_mac_filters - num_macs * num_vfs;
@@ -90,8 +93,8 @@ static int qlcnic_sriov_pf_cal_res_limit
 		temp = num_macs * num_vfs * QLCNIC_SRIOV_VF_MAX_MAC;
 		temp = res->num_rx_mcast_mac_filters - temp;
 		info->max_rx_mcast_mac_filters = temp;
-		info->max_tx_ques = res->num_tx_queues - sriov->num_vfs;
 
+		info->max_tx_ques = res->num_tx_queues - sriov->num_vfs;
 	} else {
 		id = qlcnic_sriov_func_to_index(adapter, func);
 		if (id < 0)
@@ -99,10 +102,12 @@ static int qlcnic_sriov_pf_cal_res_limit
 		vp = sriov->vf_info[id].vp;
 		info->min_tx_bw = vp->min_tx_bw;
 		info->max_tx_bw = vp->max_tx_bw;
+
 		info->max_rx_ucast_mac_filters = num_macs;
 		info->max_tx_mac_filters = num_macs;
 		temp = num_macs * QLCNIC_SRIOV_VF_MAX_MAC;
 		info->max_rx_mcast_mac_filters = temp;
+
 		info->max_tx_ques = QLCNIC_SINGLE_RING;
 	}
 
