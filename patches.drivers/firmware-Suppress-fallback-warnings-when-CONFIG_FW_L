From 68aeeaaaf86b61c78dca09879ce262778a9080e4 Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Mon, 2 Dec 2013 15:38:19 +0100
Subject: [PATCH] firmware: Suppress fallback warnings when CONFIG_FW_LOADER_USER_HELPER=n
Git-commit: 68aeeaaaf86b61c78dca09879ce262778a9080e4
Patch-mainline: 3.14-rc1
References: bnc#889297

The commit [3e358ac2bb5b: firmware: Be a bit more verbose about direct
firmware loading failure] introduced a new warning message about
falling back to user helper, but this isn't true when
CONFIG_FW_LOADER_USER_HELPER isn't set.

In this patch, clear the FW_OPT_FALLBACK flag in the case without
userhelper, so that the corresponding code will be disabled.

Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

---
 drivers/base/firmware_class.c |    4 ++++
 1 file changed, 4 insertions(+)

--- a/drivers/base/firmware_class.c
+++ b/drivers/base/firmware_class.c
@@ -99,7 +99,11 @@ static inline long firmware_loading_time
 /* firmware behavior options */
 #define FW_OPT_UEVENT	(1U << 0)
 #define FW_OPT_NOWAIT	(1U << 1)
+#ifdef CONFIG_FW_LOADER_USER_HELPER
 #define FW_OPT_FALLBACK	(1U << 2)
+#else
+#define FW_OPT_FALLBACK	0
+#endif
 
 struct firmware_cache {
 	/* firmware_buf instance will be added into the below list */
