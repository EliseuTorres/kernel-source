From: David Woodhouse <David.Woodhouse@intel.com>
Date: Sun, 9 Mar 2014 13:52:37 -0700
Subject: iommu/vt-d: Simplify iommu check in domain_remove_one_dev_info()
Git-commit: 8bbc4410129c0919e5943012489427c5e050a63e
Patch-mainline: v3.15-rc2
References: bnc#870687 bnc#879482 fate#317112

Now we store the iommu in the device_domain_info, we don't need to do a
lookup.

Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
Acked-by: Joerg Roedel <jroedel@suse.de>
---
 drivers/iommu/intel-iommu.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/iommu/intel-iommu.c b/drivers/iommu/intel-iommu.c
index 8303f25..dc322d0 100644
--- a/drivers/iommu/intel-iommu.c
+++ b/drivers/iommu/intel-iommu.c
@@ -4056,8 +4056,7 @@ static void domain_remove_one_dev_info(struct dmar_domain *domain,
 		 * owned by this domain, clear this iommu in iommu_bmp
 		 * update iommu count and coherency
 		 */
-		if (iommu == device_to_iommu(info->segment, info->bus,
-					    info->devfn))
+		if (info->iommu == iommu)
 			found = 1;
 	}
 

