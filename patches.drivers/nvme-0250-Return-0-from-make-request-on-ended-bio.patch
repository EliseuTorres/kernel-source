From: Keith Busch <keith.busch@intel.com>
Date: Wed, 8 Apr 2015 16:29:53 -0600
Subject: [PATCH] NVMe: Return 0 from make request on ended bio
Patch-Mainline: n/a
References: bsc#926480

This fixes repeatedly completing the same bio multiple times.

Signed-off-by: Keith Busch <keith.busch@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme-core.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/block/nvme-core.c b/drivers/block/nvme-core.c
index 6fd29b3..8ccc676 100644
--- a/drivers/block/nvme-core.c
+++ b/drivers/block/nvme-core.c
@@ -939,7 +939,7 @@ static int nvme_make_request(struct request_queue *q, struct bio *bio)
 
 	if (!nvmeq) {
 		bio_endio(bio, -EIO);
-		return result;
+		return 0;
 	}
 
 	spin_lock_irq(&nvmeq->q_lock);
-- 
1.8.4.5

