From: Stephen Boyd <sboyd@codeaurora.org>
Subject: hwrng: Pass entropy to add_hwgenerator_randomness() in bits, not bytes
Git-commit: e02b876597777ab26288dd2611a97b597d14d661
Patch-mainline: Queued in subsystem maintainer repository
Git-repo: git.kernel.org/cgit/linux/kernel/git/tytso/random.git
References: fate#316346

 hwrng: Pass entropy to add_hwgenerator_randomness() in bits, not bytes

rng_get_data() returns the number of bytes read from the hardware.
The entropy argument to add_hwgenerator_randomness() is passed
directly to credit_entropy_bits() so we should be passing the
number of bits, not bytes here.

Fixes: be4000bc464 "hwrng: create filler thread"
Acked-by: Torsten Duwe <duwe@suse.de>
Signed-off-by: Stephen Boyd <sboyd@codeaurora.org>
Signed-off-by: Theodore Ts'o <tytso@mit.edu>

Index: linux-3.12-SLE12/drivers/char/hw_random/core.c
===================================================================
--- linux-3.12-SLE12.orig/drivers/char/hw_random/core.c
+++ linux-3.12-SLE12/drivers/char/hw_random/core.c
@@ -342,7 +342,7 @@ static int hwrng_fillfn(void *unused)
 			continue;
 		}
 		add_hwgenerator_randomness((void *)rng_fillbuf, rc,
-					   (rc*current_quality)>>10);
+					   rc * current_quality * 8 >> 10);
 	}
 	hwrng_fill = 0;
 	return 0;
