From: Saurav Kashyap <saurav.kashyap@qlogic.com>
Date: Wed, 22 Aug 2012 14:21:29 -0400
Subject: [PATCH] [SCSI] qla2xxx: Restrict nic core reset to one function for mctp.
Git-commit: 409ee0fe14b113cbb7ec6ef4a6e0982e2e5c1e8f
References: FATE#313901
Patch-Mainline: v3.7

Signed-off-by: Saurav Kashyap <saurav.kashyap@qlogic.com>
Signed-off-by: Chad Dupuis <chad.dupuis@qlogic.com>
Signed-off-by: James Bottomley <JBottomley@Parallels.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/qla2xxx/qla_init.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/scsi/qla2xxx/qla_init.c b/drivers/scsi/qla2xxx/qla_init.c
index ef4aeb7..62081cf 100644
--- a/drivers/scsi/qla2xxx/qla_init.c
+++ b/drivers/scsi/qla2xxx/qla_init.c
@@ -4153,7 +4153,7 @@ qla2xxx_mctp_dump(scsi_qla_host_t *vha)
 		ha->mctp_dumped = 1;
 	}
 
-	if (!ha->flags.nic_core_reset_hdlr_active) {
+	if (!ha->flags.nic_core_reset_hdlr_active && !ha->portnum) {
 		ha->flags.nic_core_reset_hdlr_active = 1;
 		rval = qla83xx_restart_nic_firmware(vha);
 		if (rval)
-- 
1.7.4.2

