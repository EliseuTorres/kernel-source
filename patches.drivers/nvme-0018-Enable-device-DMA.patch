From: Matthew Wilcox <matthew.r.wilcox@intel.com>
Date: Tue, 1 Feb 2011 09:01:59 -0500
Subject: NVMe: Enable device DMA
Git-commit: f64d3365a3e5cb46e69db7e2c82a7cb9a5bed1b8
References: FATE#313627
Patch-Mainline: v3.7-rc1

Need to call pci_set_master() to enable device DMA

Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/block/nvme.c b/drivers/block/nvme.c
index 1dda4b5..128fd70 100644
--- a/drivers/block/nvme.c
+++ b/drivers/block/nvme.c
@@ -1105,6 +1105,7 @@ static int __devinit nvme_probe(struct pci_dev *pdev,
 
 	if (pci_enable_device_mem(pdev))
 		goto free;
+	pci_set_master(pdev);
 
 	INIT_LIST_HEAD(&dev->namespaces);
 	dev->pci_dev = pdev;
-- 
1.7.4.2

