From somnath.kotur@emulex.com  Thu Jun 23 15:40:25 2011
From: Somnath Kotur <somnath.kotur@emulex.com>
Date: Mon, 25 Oct 2010 01:11:10 +0000
Subject: [PATCH] be2net: Call netif_carier_off() after register_netdev()
Git-commit: 63a76944b674bb758232e4213da0da95ae055012
Patch-mainline: v2.6.37-rc1
References: FATE#311448, bnc#697255

Calling netif_carrier_off before register_netdev was causing the network interface
to miss a linkwatch pending event leading to  an inconsistent state if the link
is not up when interface is initialized.This is now invoked after register_netdev.

Signed-off-by: Somnath Kotur <somnath.kotur@emulex.com>
Signed-off-by: David S. Miller <davem@davemloft.net>

Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/net/benet/be_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
--- a/drivers/net/benet/be_main.c
+++ b/drivers/net/benet/be_main.c
@@ -2462,7 +2462,6 @@ static void be_netdev_init(struct net_de
 	netif_napi_add(netdev, &adapter->tx_eq.napi, be_poll_tx_mcc,
 		BE_NAPI_WEIGHT);
 
-	netif_carrier_off(netdev);
 	netif_stop_queue(netdev);
 }
 
@@ -2770,6 +2769,7 @@ static int __devinit be_probe(struct pci
 	status = register_netdev(netdev);
 	if (status != 0)
 		goto unsetup;
+	netif_carrier_off(netdev);
 
 	dev_info(&pdev->dev, "%s port %d\n", nic_name(pdev), adapter->port_num);
 	return 0;
