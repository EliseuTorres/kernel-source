From: Amir Vadai <amirv@mellanox.com>
Date: Mon, 25 Aug 2014 16:06:53 +0300
Subject: net/mlx4: Use is_kdump_kernel() to detect kdump kernel
Patch-mainline: v3.18-rc1
Git-commit: 48ea526a6877d605c961aa37fae33f3227b29424
References: bug#919382 FATE#317529

Use is_kdump_kernel() to detect kdump kernel, instead of reset_devices.

Signed-off-by: Amir Vadai <amirv@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 include/linux/mlx4/device.h |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/include/linux/mlx4/device.h
+++ b/include/linux/mlx4/device.h
@@ -37,6 +37,7 @@
 #include <linux/pci.h>
 #include <linux/completion.h>
 #include <linux/radix-tree.h>
+#include <linux/crash_dump.h>
 struct cpu_rmap;
 
 #include <linux/atomic.h>
@@ -1192,7 +1193,7 @@ int mlx4_config_vxlan_port(struct mlx4_d
 /* Returns true if running in low memory profile (kdump kernel) */
 static inline bool mlx4_low_memory_profile(void)
 {
-	return reset_devices;
+	return is_kdump_kernel();
 }
 
 #endif /* MLX4_DEVICE_H */
