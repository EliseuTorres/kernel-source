From: Kees Cook <kees.cook@canonical.com>
Date: Wed, 13 Oct 2010 12:12:06 -0700
Subject: [PATCH] v4l: disable dangerous buggy compat function
Patch-mainline: Never, Linus is trying to fix this mess up
References: bnc#646045, CVE-2010-2963

Fix CVE-2010-2963 by disabling the entire bad compat function.

See 3e645d6b485446c54c6745c5e2cf5c528fe4deec for Linus trying to fix it.
But, we don't care as there are no callers in our tree.

Signed-off-by: Jiri Slaby <jslaby@suse.cz> [move the check (3e645 is in stable)]
Signed-off-by: Kees Cook <kees.cook@canonical.com>
Signed-off-by: Brandon Philips <bphilips@suse.de>
---
 drivers/media/video/v4l2-compat-ioctl32.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/media/video/v4l2-compat-ioctl32.c
+++ b/drivers/media/video/v4l2-compat-ioctl32.c
@@ -832,6 +832,7 @@ static long do_video_ioctl(struct file *
 			return -EFAULT;
 		/* Convert the 32-bit version to a 64-bit version in user space */
 		up = get_microcode32(&karg.vc);
+		err = -EFAULT;
 		break;
 
 	case VIDIOCSFREQ:
