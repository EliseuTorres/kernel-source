From: Mark Rustad <mark.d.rustad@intel.com>
Date: Tue, 22 Jul 2014 06:50:36 +0000
Subject: ixgbe: Convert some udelays to usleep_range
Patch-mainline: v3.17-rc1
Git-commit: d819fc52117e18e9e331edc8fe7bd623279825d0
References: bug#908398 FATE#317382

Convert some udelay calls to the preferred usleep_range.

Signed-off-by: Mark Rustad <mark.d.rustad@intel.com>
Tested-by: Phil Schmitt <phillip.j.schmitt@intel.com>
Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/intel/ixgbe/ixgbe_common.c |    6 +++---
 drivers/net/ethernet/intel/ixgbe/ixgbe_x540.c   |    4 ++--
 2 files changed, 5 insertions(+), 5 deletions(-)

--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_common.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_common.c
@@ -1386,7 +1386,7 @@ static s32 ixgbe_get_eeprom_semaphore(st
 			status = 0;
 			break;
 		}
-		udelay(50);
+		usleep_range(50, 100);
 	}
 
 	if (i == timeout) {
@@ -1399,7 +1399,7 @@ static s32 ixgbe_get_eeprom_semaphore(st
 		 */
 		ixgbe_release_eeprom_semaphore(hw);
 
-		udelay(50);
+		usleep_range(50, 100);
 		/*
 		 * one last try
 		 * If the SMBI bit is 0 when we read it, then the bit will be
@@ -1427,7 +1427,7 @@ static s32 ixgbe_get_eeprom_semaphore(st
 			if (swsm & IXGBE_SWSM_SWESMBI)
 				break;
 
-			udelay(50);
+			usleep_range(50, 100);
 		}
 
 		/*
--- a/drivers/net/ethernet/intel/ixgbe/ixgbe_x540.c
+++ b/drivers/net/ethernet/intel/ixgbe/ixgbe_x540.c
@@ -699,7 +699,7 @@ static s32 ixgbe_get_swfw_sync_semaphore
 			status = 0;
 			break;
 		}
-		udelay(50);
+		usleep_range(50, 100);
 	}
 
 	/* Now get the semaphore between SW/FW through the REGSMP bit */
@@ -709,7 +709,7 @@ static s32 ixgbe_get_swfw_sync_semaphore
 			if (!(swsm & IXGBE_SWFW_REGSMP))
 				break;
 
-			udelay(50);
+			usleep_range(50, 100);
 		}
 	} else {
 		hw_dbg(hw, "Software semaphore SMBI between device drivers not granted.\n");
