From: Divy Le Ray <divy@chelsio.com>
Date: Sat, 24 Sep 2011 06:11:31 +0000
Subject: [PATCH 03/28] cxgb4: Fix EEH on IBM P7IOC
Git-commit: 6482aa7c120447858da1869197b48eff66435a31
Patch-mainline: v3.1-rc9
References: bnc#784800 FATE#314296

Fix EEH recovery on new P Series platform by
requesting fundamental reset.

Signed-off-by: Divy Le Ray <divy@chelsio.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
+++ b/drivers/net/ethernet/chelsio/cxgb4/cxgb4_main.c
@@ -3711,6 +3711,9 @@ static int __devinit init_one(struct pci
 		setup_debugfs(adapter);
 	}
 
+	/* PCIe EEH recovery on powerpc platforms needs fundamental reset */
+	pdev->needs_freset = 1;
+
 	if (is_offload(adapter))
 		attach_ulds(adapter);
 
