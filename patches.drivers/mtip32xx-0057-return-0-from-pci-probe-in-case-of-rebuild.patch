From: Asai Thambi S P <asamymuthupa@micron.com>
Date: Wed, 3 Apr 2013 19:54:35 +0530
Subject: mtip32xx: return 0 from pci probe in case of rebuild
References: bnc#818635
Patch-Mainline: v3.9-rc7
Git-commit: 6b06d35f3f63dbfde71c792b8584225f3d1fc7f2

Fix to return 0 from pci probe in case of rebuild. If not, pci consider
probe has failed, and crash during rmmod.

Signed-off-by: Asai Thambi S P <asamymuthupa@micron.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/mtip32xx/mtip32xx.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/drivers/block/mtip32xx/mtip32xx.c b/drivers/block/mtip32xx/mtip32xx.c
index 292a80e..899a192 100644
--- a/drivers/block/mtip32xx/mtip32xx.c
+++ b/drivers/block/mtip32xx/mtip32xx.c
@@ -4305,6 +4305,8 @@ static int mtip_pci_probe(struct pci_dev *pdev,
 	instance++;
 	if (rv != MTIP_FTL_REBUILD_MAGIC)
 		set_bit(MTIP_DDF_INIT_DONE_BIT, &dd->dd_flag);
+	else
+		rv = 0; /* device in rebuild state, return 0 from probe */
 	goto done;
 
 block_initialize_err:
-- 
1.7.12.4

