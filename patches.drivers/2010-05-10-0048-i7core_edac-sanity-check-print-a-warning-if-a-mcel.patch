From: Mauro Carvalho Chehab <mchehab@redhat.com>
Subject: i7core_edac: sanity check: print a warning if a mcelog is ignored
References: fate#311968
Patch-Mainline: yes
Git-commit: 6c6aa3afdba2460cb668d4cb65c74dfa8eb43449


Signed-off-by: Thomas Renninger <trenn@suse.de>

In thesis, the other mc controller should handle it.

Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

---
 drivers/edac/i7core_edac.c |    7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: linux-2.6.32-SLE11-SP1/drivers/edac/i7core_edac.c
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/drivers/edac/i7core_edac.c
+++ linux-2.6.32-SLE11-SP1/drivers/edac/i7core_edac.c
@@ -1682,8 +1682,13 @@ static int i7core_mce_check_error(void *
 		return 0;
 
 	/* Only handle if it is the right mc controller */
-	if (cpu_data(mce->cpu).phys_proc_id != pvt->i7core_dev->socket)
+	if (cpu_data(mce->cpu).phys_proc_id != pvt->i7core_dev->socket) {
+		debugf0("mc%d: ignoring mce log for socket %d. "
+			"Another mc should get it.\n",
+			pvt->i7core_dev->socket,
+			cpu_data(mce->cpu).phys_proc_id);
 		return 0;
+	}
 
 	spin_lock_irqsave(&pvt->mce_lock, flags);
 	if (pvt->mce_count < MCE_LOG_LEN) {
