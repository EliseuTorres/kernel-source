From: dann frazier <dannf@hp.com>
Date: Wed, 2 Jun 2010 16:23:40 -0600
Subject: [PATCH] watchdog: hpwdt (2/3): allow full range of timer values supported by hardware
References: bnc#612407
Patch-mainline: 2.6.36
Git-commit: 6f681c2eabbd8df062963c52abaa0c7c3b2c5a7d

The hpwdt timer is a 16 bit value with 128ms resolution.
Let applications use this entire range.

Signed-off-by: dann frazier <dannf@hp.com>
Acked-by: Thomas Mingarelli <Thomas.Mingarelli@hp.com>
Signed-off-by: Wim Van Sebroeck <wim@iguana.be>
Acked-by: Jean Delvare <jdelvare@suse.de>
---
 drivers/watchdog/hpwdt.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

--- a/drivers/watchdog/hpwdt.c
+++ b/drivers/watchdog/hpwdt.c
@@ -51,6 +51,8 @@
 #define HPWDT_VERSION			"1.1.1"
 
 #define SECS_TO_TICKS(secs) ((secs) * 1000 / 128)
+#define TICKS_TO_SECS(ticks) ((ticks) * 128 / 1000)
+#define HPWDT_MAX_TIMER	TICKS_TO_SECS(65535)
 
 struct bios32_service_dir {
 	u32 signature;
@@ -444,8 +446,7 @@ static void hpwdt_ping(void)
 
 static int hpwdt_change_timer(int new_margin)
 {
-	/* Arbitrary, can't find the card's limits */
-	if (new_margin < 5 || new_margin > 600) {
+	if (new_margin < 1 || new_margin > HPWDT_MAX_TIMER) {
 		printk(KERN_WARNING
 			"hpwdt: New value passed in is invalid: %d seconds.\n",
 			new_margin);
