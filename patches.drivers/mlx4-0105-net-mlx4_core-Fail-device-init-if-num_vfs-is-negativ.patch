From: Jack Morgenstein <jackm@dev.mellanox.com>
Date: Tue, 25 Jun 2013 12:09:38 +0300
Subject: net/mlx4_core: Fail device init if num_vfs is negative
Patch-mainline: v3.11-rc1
Git-commit: 30e514a71753ac3fd0ddea1411d5602ccbe14acf
References: bug#919382 FATE#317529

Should not allow negative num_vfs

Signed-off-by: Jack Morgenstein <jackm@dev.mellanox.com>
Signed-off-by: Vladimir Sokolovsky <vlad@mellanox.com>
Signed-off-by: Amir Vadai <amirv@mellanox.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/mellanox/mlx4/main.c |    5 +++++
 1 file changed, 5 insertions(+)

--- a/drivers/net/ethernet/mellanox/mlx4/main.c
+++ b/drivers/net/ethernet/mellanox/mlx4/main.c
@@ -2135,6 +2135,11 @@ static int __mlx4_init_one(struct pci_de
 		       num_vfs, MLX4_MAX_NUM_VF);
 		return -EINVAL;
 	}
+
+	if (num_vfs < 0) {
+		pr_err("num_vfs module parameter cannot be negative\n");
+		return -EINVAL;
+	}
 	/*
 	 * Check for BARs.
 	 */
