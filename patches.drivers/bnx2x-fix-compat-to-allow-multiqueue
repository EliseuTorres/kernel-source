From 4f55f74f1559d95e7ae997a14678fb0b93328fcc Mon Sep 17 00:00:00 2001
From: Dmitry Kravkov <dmitry@broadcom.com>
Date: Sun, 17 Jul 2011 16:27:49 +0300
Subject: [PATCH 1/4] bnx2x - fix compat to allow multiqueue
Patch-mainline: Never, backport only
References: bnc#698050


Signed-off-by: Dmitry Kravkov <dmitry@broadcom.com>
Signed-off-by: Eilon Greenstein <eilong@broadcom.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/net/bnx2x/bnx2x.h        |    7 +------
 drivers/net/bnx2x/bnx2x_compat.h |    6 ++++++
 2 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/drivers/net/bnx2x/bnx2x.h b/drivers/net/bnx2x/bnx2x.h
index deb303e..758d897 100644
--- a/drivers/net/bnx2x/bnx2x.h
+++ b/drivers/net/bnx2x/bnx2x.h
@@ -26,11 +26,6 @@
 #define DRV_MODULE_RELDATE      "2011/06/13"
 #define BNX2X_BC_VER            0x040200
 
-#if defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE)
-#define BCM_VLAN			1
-#endif
-
-
 #if defined(CONFIG_CNIC) || defined(CONFIG_CNIC_MODULE)
 #define BCM_CNIC 1
 #include "../cnic_if.h"
@@ -1160,7 +1155,7 @@ struct bnx2x {
 #define NO_ISCSI_OOO_FLAG		(1 << 14)
 #define NO_ISCSI_FLAG			(1 << 15)
 #define NO_FCOE_FLAG			(1 << 16)
- 
+
 #define NO_ISCSI(bp)		((bp)->flags & NO_ISCSI_FLAG)
 #define NO_ISCSI_OOO(bp)	((bp)->flags & NO_ISCSI_OOO_FLAG)
 #define NO_FCOE(bp)		((bp)->flags & NO_FCOE_FLAG)
diff --git a/drivers/net/bnx2x/bnx2x_compat.h b/drivers/net/bnx2x/bnx2x_compat.h
index e8320ae..923c8c7 100644
--- a/drivers/net/bnx2x/bnx2x_compat.h
+++ b/drivers/net/bnx2x/bnx2x_compat.h
@@ -11,6 +11,12 @@
 
 #include <linux/if_vlan.h>
 
+#define OLD_VLAN			1
+#if defined(OLD_VLAN) && (defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE))
+#define BCM_VLAN			1
+#endif
+#define BNX2X_MULTI_QUEUE
+#define BNX2X_NEW_NAPI
 #if (LINUX_VERSION_CODE < 0x02061e)
 #define skb_record_rx_queue(skb, index)
 #define skb_tx_hash(dev, skb)	0
-- 
1.7.2.2


