From 447ee6a7cbbfb5ae7ab8f9b8b058b4a04fe398bf Mon Sep 17 00:00:00 2001
From: Takashi Iwai <tiwai@suse.de>
Date: Wed, 4 May 2011 18:28:50 +0200
Subject: [PATCH] ALSA: hda - Use position_fix=3 as default for AMD chipsets
Git-commit: 447ee6a7cbbfb5ae7ab8f9b8b058b4a04fe398bf
Git-repo: git://git.kernel.org/pub/scm/linux/kernel/git/tiwai/sound-2.6.git
Patch-mainline: Submitted
References: bnc#691269,bnc#687760

AMD chipsets often behave pretty badly regarding the DMA position
reporting.  It results in the bad quality audio recording.
Using position_fix=3 works well in general for them, so let's enable
it as default for AMD.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 sound/pci/hda/hda_intel.c |    5 +++++
 1 file changed, 5 insertions(+)

--- a/sound/pci/hda/hda_intel.c
+++ b/sound/pci/hda/hda_intel.c
@@ -2341,6 +2341,11 @@
 	case AZX_DRIVER_ATI:
 		/* Use link position directly, avoid any transfer problem. */
 		return POS_FIX_VIACOMBO;
+	case AZX_DRIVER_GENERIC:
+		/* AMD chipsets behave often badly, too */
+		if (chip->pci->vendor == PCI_VENDOR_ID_AMD)
+			return POS_FIX_VIACOMBO;
+		break;
 	}
 
 	return POS_FIX_AUTO;
