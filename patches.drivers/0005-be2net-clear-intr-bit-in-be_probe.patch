From: Sathya Perla <sathya.perla@emulex.com>
Date: Wed, 29 Jun 2011 23:33:37 +0000
Subject: [PATCH] be2net: clear intr bit in be_probe()
References: bnc#722092
Patch-mainline: v3.0-rc4
Git-commit: b9ab82c774d8abcca8b6c1d5f30f5912a4448980

It may be set in the card while the driver is probed by kdump kernel after a
crash.

Signed-off-by: Sathya Perla <sathya.perla@emulex.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: David Chang <dchang@suse.com>
---
 drivers/net/benet/be_main.c |    6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/net/benet/be_main.c
+++ b/drivers/net/benet/be_main.c
@@ -3419,6 +3419,12 @@ static int __devinit be_probe(struct pci
 	if (status)
 		goto stats_clean;
 
+	/* The INTR bit may be set in the card when probed by a kdump kernel
+	 * after a crash.
+	 */
+	if (!lancer_chip(adapter))
+		be_intr_set(adapter, false);
+
 	be_msix_enable(adapter);
 
 	INIT_DELAYED_WORK(&adapter->work, be_worker);
