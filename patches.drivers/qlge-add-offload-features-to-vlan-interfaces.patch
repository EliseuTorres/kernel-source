From: brenohl@br.ibm.com <brenohl@br.ibm.com>
Date:   Fri Jul 27 08:54:52 2012 +0000
Subject: Add offload features to vlan interfaces
Patch-mainline: Yes, v3.6-rc1
Git-commit: 1a0150a93c496986297fc08304ac564213c08942
References: bnc#776081,LTC#84322

This patch fills the net_device vlan_features with the proper hardware features,
thus, improving the vlan interface performance.

With the patch applied, I can see around 148% improvement on a TCP_STREAM test,
from 3.5 Gb/s to 8.7 Gb/s. On TCP_RR, I see a 11% improvement, from 18k
to 20. The CPU utilization is almost the same on both cases, from the comparison
above.

Signed-off-by: Breno Leitao <brenohl@br.ibm.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: John L. Jolly <jjolly@suse.de>
---
 drivers/net/qlge/qlge_main.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/qlge/qlge_main.c
+++ b/drivers/net/qlge/qlge_main.c
@@ -4636,6 +4636,7 @@ static int __devinit qlge_probe(struct p
 		NETIF_F_HW_VLAN_TX | NETIF_F_RXCSUM;
 	ndev->features = ndev->hw_features |
 		NETIF_F_HW_VLAN_RX | NETIF_F_HW_VLAN_FILTER;
+	ndev->vlan_features = ndev->hw_features;
 
 	if (test_bit(QL_DMA64, &qdev->flags))
 		ndev->features |= NETIF_F_HIGHDMA;
