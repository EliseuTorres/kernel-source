From: Atul Deshmukh <atul.deshmukh@qlogic.com>
Date: Wed, 30 Oct 2013 03:38:20 -0400
Subject: [SCSI] qla2xxx: Clear RISC INT reg only for an event and not always
References: bnc#909372,FATE#317544
Patch-Mainline: v3.15
Git-commit: 02a9ae6e31975e97777a4e3db6e33e059f256c05
 while polling.

Signed-off-by: Atul Deshmukh <atul.deshmukh@qlogic.com>
Signed-off-by: Saurav Kashyap <saurav.kashyap@qlogic.com>
Signed-off-by: James Bottomley <JBottomley@Parallels.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/qla2xxx/qla_nx.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/scsi/qla2xxx/qla_nx.c b/drivers/scsi/qla2xxx/qla_nx.c
index c7854b3..c9b3f0c 100644
--- a/drivers/scsi/qla2xxx/qla_nx.c
+++ b/drivers/scsi/qla2xxx/qla_nx.c
@@ -2237,8 +2237,8 @@ qla82xx_poll(int irq, void *dev_id)
 			    stat * 0xff);
 			break;
 		}
+		WRT_REG_DWORD(&reg->host_int, 0);
 	}
-	WRT_REG_DWORD(&reg->host_int, 0);
 out:
 	spin_unlock_irqrestore(&ha->hardware_lock, flags);
 }
-- 
1.8.5.2

