From: Keith Busch <keith.busch@intel.com>
Date: Tue, 24 Jul 2012 15:01:04 -0600
Subject: NVMe: Set request queue logical block size
Git-commit: e9ef46369f5107e634a93b7fc4e62a1f53343197
References: FATE#313627
Patch-Mainline: v3.7-rc1

Sets the request queue logical block size with the block size of the
namespace.

Signed-off-by: Keith Busch <keith.busch@intel.com>
Signed-off-by: Matthew Wilcox <matthew.r.wilcox@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/block/nvme.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/drivers/block/nvme.c b/drivers/block/nvme.c
index e063248..b6014e7 100644
--- a/drivers/block/nvme.c
+++ b/drivers/block/nvme.c
@@ -1343,6 +1343,7 @@ static struct nvme_ns *nvme_alloc_ns(struct nvme_dev *dev, int nsid,
 	ns->disk = disk;
 	lbaf = id->flbas & 0xf;
 	ns->lba_shift = id->lbaf[lbaf].ds;
+	blk_queue_logical_block_size(ns->queue, 1 << ns->lba_shift);
 
 	disk->major = nvme_major;
 	disk->minors = NVME_MINORS;
-- 
1.7.4.2

