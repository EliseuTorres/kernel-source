From: Christoph Hellwig <hch@lst.de>
Date: Mon, 2 Jun 2014 09:52:52 +0200
Subject: [PATCH 82/97] Revert "be2iscsi: Fix processing cqe for cxn whose
	endpoint is freed"
Git-commit: 4f96827dd55981ec4bfcbc7584eb155bcd8d1849
Patch-mainline: v3.16-rc1
References: FATE#317534 bsc#908901

This reverts commit 11206081ad895d83e717bfe23603168dc307d904.

Based on comments from Mike Christie and Sony John-N.

Acked-by: Lee Duncan <lduncan@suse.com>
---
 drivers/scsi/be2iscsi/be_main.c | 11 -----------
 1 file changed, 11 deletions(-)

 drivers/scsi/be2iscsi/be_main.c |   11 -----------
 1 file changed, 11 deletions(-)

diff --git a/drivers/scsi/be2iscsi/be_main.c b/drivers/scsi/be2iscsi/be_main.c
index ac54cf55998f..554349029628 100644
--- a/drivers/scsi/be2iscsi/be_main.c
+++ b/drivers/scsi/be2iscsi/be_main.c
@@ -2110,16 +2110,6 @@ static unsigned int beiscsi_process_cq(struct be_eq_obj *pbe_eq)
 
 		cri_index = BE_GET_CRI_FROM_CID(cid);
 		ep = phba->ep_array[cri_index];
-		if (unlikely(ep == NULL)) {
-			/* connection has already been freed
-			 * just move on to next one
-			 */
-			beiscsi_log(phba, KERN_WARNING,
-				    BEISCSI_LOG_INIT,
-				    "BM_%d : proc cqe of disconn ep: cid %d\n",
-				    cid);
-			goto proc_next_cqe;
-		}
 		beiscsi_ep = ep->dd_data;
 		beiscsi_conn = beiscsi_ep->conn;
 
@@ -2229,7 +2219,6 @@ static unsigned int beiscsi_process_cq(struct be_eq_obj *pbe_eq)
 			break;
 		}
 
-proc_next_cqe:
 		AMAP_SET_BITS(struct amap_sol_cqe, valid, sol, 0);
 		queue_tail_inc(cq);
 		sol = queue_tail_node(cq);
-- 
1.7.12.4


