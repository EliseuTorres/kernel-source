From: Himanshu Madhani <himanshu.madhani@qlogic.com>
Date: Thu, 9 Apr 2015 15:00:01 -0400
Subject: qla2xxx: Add udev notification to save fw dump for ISP27XX
References: bnc#921081
Patch-Mainline: v4.1-rc1
Git-commit: 0137e59e6271fc91f9e6c854d7833ad8ff8cb50b

Signed-off-by: Giridhar Malavali <giridhar.malavali@qlogic.com>
Signed-off-by: Himanshu Madhani <himanshu.madhani@qlogic.com>
Reviewed-by: Hannes Reinecke <hare@suse.de>
Signed-off-by: James Bottomley <JBottomley@Odin.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/qla2xxx/qla_tmpl.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/scsi/qla2xxx/qla_tmpl.c b/drivers/scsi/qla2xxx/qla_tmpl.c
index 280f163..8de8e25 100644
--- a/drivers/scsi/qla2xxx/qla_tmpl.c
+++ b/drivers/scsi/qla2xxx/qla_tmpl.c
@@ -787,11 +787,12 @@ qla27xx_walk_template(struct scsi_qla_host *vha,
 	ql_dbg(ql_dbg_misc, vha, 0xd01b,
 	    "%s: len=%lx\n", __func__, *len);
 
-	if (buf)
+	if (buf) {
 		ql_log(ql_log_warn, vha, 0xd015,
 		    "Firmware dump saved to temp buffer (%ld/%p)\n",
 		    vha->host_no, vha->hw->fw_dump);
-
+		qla2x00_post_uevent_work(vha, QLA_UEVENT_CODE_FW_DUMP);
+	}
 }
 
 static void
-- 
1.8.5.2

