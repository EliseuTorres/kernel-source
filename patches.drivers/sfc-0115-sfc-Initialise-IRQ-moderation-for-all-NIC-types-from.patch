From: Ben Hutchings <bhutchings@solarflare.com>
Date: Wed, 1 May 2013 16:30:17 +0100
Subject: [PATCH v2 115/244] sfc: Initialise IRQ moderation for all NIC types
 from efx_init_eventq()
Patch-mainline: v3.12-rc1
Git-commit: 15acb1cea5d9298eac511b80380183be624fa31c
References: bsc#909618 FATE#317521

Signed-off-by: Ben Hutchings <bhutchings@solarflare.com>
Acked-by: David Chang <dchang@suse.com>
---
 drivers/net/ethernet/sfc/efx.c   |    4 +++-
 drivers/net/ethernet/sfc/farch.c |    2 --
 2 files changed, 3 insertions(+), 3 deletions(-)

--- a/drivers/net/ethernet/sfc/efx.c
+++ b/drivers/net/ethernet/sfc/efx.c
@@ -331,15 +331,17 @@ static int efx_probe_eventq(struct efx_c
 /* Prepare channel's event queue */
 static int efx_init_eventq(struct efx_channel *channel)
 {
+	struct efx_nic *efx = channel->efx;
 	int rc;
 
 	EFX_WARN_ON_PARANOID(channel->eventq_init);
 
-	netif_dbg(channel->efx, drv, channel->efx->net_dev,
+	netif_dbg(efx, drv, efx->net_dev,
 		  "chan %d init event queue\n", channel->channel);
 
 	rc = efx_nic_init_eventq(channel);
 	if (rc == 0) {
+		efx->type->push_irq_moderation(channel);
 		channel->eventq_read_ptr = 0;
 		channel->eventq_init = true;
 	}
--- a/drivers/net/ethernet/sfc/farch.c
+++ b/drivers/net/ethernet/sfc/farch.c
@@ -1366,8 +1366,6 @@ int efx_farch_ev_init(struct efx_channel
 	efx_writeo_table(efx, &reg, efx->type->evq_ptr_tbl_base,
 			 channel->channel);
 
-	efx->type->push_irq_moderation(channel);
-
 	return 0;
 }
 
