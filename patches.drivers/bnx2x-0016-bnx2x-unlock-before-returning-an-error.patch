From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Tue, 24 Jan 2012 21:59:31 +0000
Subject: [PATCH 016/111] bnx2x: unlock before returning an error
Patch-mainline: v3.4-rc1
Git-commit: a44acd551467d78a26bfa76ea348225575830efc
References: bnc#790597 FATE#313915

We introduced a new return here but forgot to drop the lock.

Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Acked-by: Dmitry Kravkov <dmitry@broadcom.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Acked-by: Benjamin Poirier <bpoirier@suse.de>
---
 drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.c
+++ b/drivers/net/ethernet/broadcom/bnx2x/bnx2x_sp.c
@@ -1836,6 +1836,7 @@ static int bnx2x_vlan_mac_del_all(struct
 			rc = exeq->remove(bp, exeq->owner, exeq_pos);
 			if (rc) {
 				BNX2X_ERR("Failed to remove command\n");
+				spin_unlock_bh(&exeq->lock);
 				return rc;
 			}
 			list_del(&exeq_pos->link);
