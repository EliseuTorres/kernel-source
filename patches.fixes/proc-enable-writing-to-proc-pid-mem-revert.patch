From 198214a7ee50375fa71a65e518341980cfd4b2f0 Mon Sep 17 00:00:00 2001
From: Stephen Wilson <wilsons@start.ca>
Date: Sun, 13 Mar 2011 15:49:24 -0400
Subject: [PATCH] proc: enable writing to /proc/pid/mem
Patch-mainline: no fixed by other commit
References: bnc#742279 CVE-2012-0056

mhocko:
The issue is fixed by e268337 [proc: clean up and fix /proc/<pid>/mem handling]
but the easier way to fix is just to disable writing as we do not have
to support it anyway. Sle11sp1 didn't enable it and nobody requested this
as a feature.

With recent changes there is no longer a security hazard with writing to
/proc/pid/mem.  Remove the #ifdef.

Signed-off-by: Stephen Wilson <wilsons@start.ca>
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Acked-by: Michal Hocko <mhocko@suse.cz>
---
 fs/proc/base.c |    5 +++++
 1 file changed, 5 insertions(+)

--- a/fs/proc/base.c
+++ b/fs/proc/base.c
@@ -909,6 +909,10 @@ static ssize_t mem_read(struct file * fi
 	return ret;
 }
 
+#define mem_write NULL
+
+#ifndef mem_write
+/* This is a security hazard */
 static ssize_t mem_write(struct file * file, const char __user *buf,
 			 size_t count, loff_t *ppos)
 {
@@ -949,6 +953,7 @@ static ssize_t mem_write(struct file * f
 	free_page((unsigned long) page);
 	return copied;
 }
+#endif
 
 loff_t mem_lseek(struct file *file, loff_t offset, int orig)
 {
