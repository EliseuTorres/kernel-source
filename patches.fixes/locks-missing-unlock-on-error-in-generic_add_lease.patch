From: Dan Carpenter <dan.carpenter@oracle.com>
Date: Wed, 13 Nov 2013 10:56:27 +0300
Subject: [PATCH] locks: missing unlock on error in generic_add_lease()
Git-commit: 4fdb793ffe262cfc0b796d3b2cd05ca3b687deb9
Patch-mainline: v3.13
References: internal review

We should unlock here before returning.

Fixes: df4e8d2c1d2b ('locks: implement delegations')
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Acked-by: NeilBrown <neilb@suse.de>

---
 fs/locks.c |    1 +
 1 file changed, 1 insertion(+)

--- linux-3.12-SLE12.orig/fs/locks.c
+++ linux-3.12-SLE12/fs/locks.c
@@ -1493,6 +1493,7 @@ static int generic_add_lease(struct file
 
 	if (is_deleg && arg == F_WRLCK) {
 		/* Write delegations are not currently supported: */
+		mutex_unlock(&inode->i_mutex);
 		WARN_ON_ONCE(1);
 		return -EINVAL;
 	}
