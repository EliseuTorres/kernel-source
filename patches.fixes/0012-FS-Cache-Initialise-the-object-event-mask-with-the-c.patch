From: David Howells <dhowells@redhat.com>
Date: Wed, 5 Dec 2012 13:34:46 +0000
Subject: [PATCH] FS-Cache: Initialise the object event mask with the
 calculated mask
Git-commit: 03acc4be5e479eebc95338cd1d72a9954c128e2b
Patch-mainline: v3.8
References: bnc#880344

Initialise the object event mask with the calculated mask rather than unmasking
undefined events also.

Signed-off-by: David Howells <dhowells@redhat.com>
Acked-by: NeilBrown <neilb@suse.de>

---
 fs/fscache/object.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- linux-3.0-SLE11-SP3.orig/fs/fscache/object.c
+++ linux-3.0-SLE11-SP3/fs/fscache/object.c
@@ -114,7 +114,8 @@ static void fscache_object_state_machine
 		/* wait for the parent object to become ready */
 	case FSCACHE_OBJECT_INIT:
 		object->event_mask =
-			ULONG_MAX & ~(1 << FSCACHE_OBJECT_EV_CLEARED);
+			FSCACHE_OBJECT_EVENTS_MASK &
+			~(1 << FSCACHE_OBJECT_EV_CLEARED);
 		fscache_initialise_object(object);
 		goto done;
 
