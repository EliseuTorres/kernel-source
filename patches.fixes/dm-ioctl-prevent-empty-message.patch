From: Alasdair G Kergon <agk@redhat.com>
Date: Tue, 2 Aug 2011 12:32:03 +0100
Subject: dm ioctl: prevent empty message
Git-commit: 2ca4c92f58f9386e080b26f9ccd78c9ca5825a42
References: FATE#314163
Patch-Mainline: v3.1

Detect invalid empty messages in core dm instead of requiring every target to
check this.

Signed-off-by: Alasdair G Kergon <agk@redhat.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/md/dm-ioctl.c |    5 +++++
 1 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/drivers/md/dm-ioctl.c b/drivers/md/dm-ioctl.c
index 0af6aba..de78ee1 100644
--- a/drivers/md/dm-ioctl.c
+++ b/drivers/md/dm-ioctl.c
@@ -1425,6 +1425,11 @@ static int target_message(struct dm_ioctl *param, size_t param_size)
 		goto out;
 	}
 
+	if (!argc) {
+		DMWARN("Empty message received.");
+		goto out;
+	}
+
 	table = dm_get_live_table(md);
 	if (!table)
 		goto out_argv;
-- 
1.7.4.2

