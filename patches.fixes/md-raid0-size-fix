From: NeilBrown <neilb@suse.de>
Subject: md: Don't truncate size at 4TB for RAID0 and Linear
Patch-mainline: 3.6
References: email to Linux <linux@lists.novell.com> (Big md broken after update)

A recent change to 0.90 metadata handling truncated size to 4TB as that is
all that 0.90 can record.
However for RAID0 and Linear, 0.90 doesn't need to record the size, so 
this truncation is not needed and causes working arrays to become too small.

So avoid the truncation for RAID0 and Linear

Signed-off-by: Neil Brown <neilb@suse.de>

---
 drivers/md/md.c |    7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

--- linux-3.0-SLE11-SP2.orig/drivers/md/md.c
+++ linux-3.0-SLE11-SP2/drivers/md/md.c
@@ -1115,8 +1115,11 @@ static int super_90_load(mdk_rdev_t *rde
 			ret = 0;
 	}
 	rdev->sectors = rdev->sb_start;
-	/* Limit to 4TB as metadata cannot record more than that */
-	if (rdev->sectors >= (2ULL << 32))
+	/* Limit to 4TB as metadata cannot record more than that.
+	 * (not needed for Linear and RAID0 as  metadata doesn't
+	 * record this size
+	 */
+	if (rdev->sectors >= (2ULL << 32) && sb->level >= 1)
 		rdev->sectors = (2ULL << 32) - 2;
 
 	if (rdev->sectors < ((sector_t)sb->size) * 2 && sb->level >= 1)
