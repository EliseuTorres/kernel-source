From: John Jolly <jjolly@suse.de>
Date: Fri, 10 Apr 2015 08:00:00 -0700
Subject: mlx4_core: Disable 64b CQE EQE by default
Patch-mainline: Never, SLE11-SP4 specific
Git-commit: -
References: bnc#924482 bnc#924653

For the SLES11 SP4 release, the decision was made to keep the KABI as 
unchanged as possible. The 64b CQE EQE fix changes the 
MLX4_IB_UVERBS_ABI_VERSION value from 3 to 4. This affects the libmlx4 
userspace library on RoCE-based ConnectX hardware. The following error 
is generated:

    # ibv_devinfo
    mlx4: Fatal: ABI version 4 of /sys/class/infiniband_verbs/uverbs0 is not supported (min supported 2, max supported 3)
    libibverbs: Warning: no userspace device-specific driver found for /sys/class/infiniband_verbs/uverbs0
    No IB devices found

In order to avoid the need to upgrade the libmlx4 userspace library, 
the default value of the enable_64b_cqe_eqe setting for the mlx4_core 
module should be set to false.

Signed-off-by: John Jolly <jjolly@suse.de>
---
 drivers/net/ethernet/mellanox/mlx4/main.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlx4/main.c	2015-04-10 08:44:40.607641501 -0600
+++ b/drivers/net/ethernet/mellanox/mlx4/main.c	2015-04-10 09:02:27.197641501 -0600
@@ -96,10 +96,10 @@ MODULE_PARM_DESC(log_num_mgm_entry_size,
 					 " To activate device managed"
 					 " flow steering when available, set to -1");
 
-static bool enable_64b_cqe_eqe = true;
+static bool enable_64b_cqe_eqe = false;
 module_param(enable_64b_cqe_eqe, bool, 0444);
 MODULE_PARM_DESC(enable_64b_cqe_eqe,
-		 "Enable 64 byte CQEs/EQEs when the FW supports this (default: True)");
+		 "Enable 64 byte CQEs/EQEs when the FW supports this (default: False)");
 
 #define HCA_GLOBAL_CAP_MASK            0
 
