From: "Moger, Babu" <Babu.Moger@netapp.com>
Subject: [PATCH 2/4] scsi_dh_hp_sw: Adding the match function for hp_sw device handler
Patch-mainline: v3.3-rc1~124^2~65
Git-commit: a315969e8d699682adf449813de84b7f2358f64d
References: bnc#726504

This patch introduces the match function for hp_sw device handler.
The match function was introduced by this patch
http://www.spinics.net/lists/linux-scsi/msg54284.html

Signed-off-by: Babu Moger <babu.moger@netapp.com>
Acked-by: Hannes Reinecke <hare@suse.de>
Acked-by: Ankit Jain <jankit@suse.de>
---
 drivers/scsi/device_handler/scsi_dh_hp_sw.c |   19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

Index: b/drivers/scsi/device_handler/scsi_dh_hp_sw.c
===================================================================
--- a/drivers/scsi/device_handler/scsi_dh_hp_sw.c
+++ b/drivers/scsi/device_handler/scsi_dh_hp_sw.c
@@ -319,6 +319,24 @@ static const struct scsi_dh_devlist hp_s
 	{NULL, NULL},
 };
 
+static bool hp_sw_match(struct scsi_device *sdev)
+{
+	int i;
+
+	if (scsi_device_tpgs(sdev))
+		return false;
+
+	for (i = 0; hp_sw_dh_data_list[i].vendor; i++) {
+		if (!strncmp(sdev->vendor, hp_sw_dh_data_list[i].vendor,
+			strlen(hp_sw_dh_data_list[i].vendor)) &&
+		    !strncmp(sdev->model, hp_sw_dh_data_list[i].model,
+			strlen(hp_sw_dh_data_list[i].model))) {
+			return true;
+		}
+	}
+	return false;
+}
+
 static int hp_sw_bus_attach(struct scsi_device *sdev);
 static void hp_sw_bus_detach(struct scsi_device *sdev);
 
@@ -330,6 +348,7 @@ static struct scsi_device_handler hp_sw_
 	.detach		= hp_sw_bus_detach,
 	.activate	= hp_sw_activate,
 	.prep_fn	= hp_sw_prep_fn,
+	.match		= hp_sw_match,
 };
 
 static int hp_sw_bus_attach(struct scsi_device *sdev)
