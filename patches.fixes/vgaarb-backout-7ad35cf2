From: Takashi Iwai <tiwai@suse.de>
Date: Wed, 28 Sep 2011 15:12:14 +0200
Subject: [PATCH] Revert "x86/uv/x2apic: update for change in pci bridge handling."
Patch-mainline: to be mainlined
References: bnc#711684

This reverts commit 7ad35cf288fd63a19bf50e490440a992de808b2b.

It must be done together with patches.fixes/vgaarb-backout-3448a19d.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 arch/x86/kernel/apic/x2apic_uv_x.c |    8 ++++----
 drivers/pci/pci.c                  |    4 ++--
 2 files changed, 6 insertions(+), 6 deletions(-)

--- a/arch/x86/kernel/apic/x2apic_uv_x.c
+++ b/arch/x86/kernel/apic/x2apic_uv_x.c
@@ -631,14 +631,14 @@
 
 /* Direct Legacy VGA I/O traffic to designated IOH */
 int uv_set_vga_state(struct pci_dev *pdev, bool decode,
-		      unsigned int command_bits, u32 flags)
+		      unsigned int command_bits, bool change_bridge)
 {
 	int domain, bus, rc;
 
-	PR_DEVEL("devfn %x decode %d cmd %x flags %d\n",
-			pdev->devfn, decode, command_bits, flags);
+	PR_DEVEL("devfn %x decode %d cmd %x chg_brdg %d\n",
+			pdev->devfn, decode, command_bits, change_bridge);
 
-	if (!(flags & PCI_VGA_STATE_CHANGE_BRIDGE))
+	if (!change_bridge)
 		return 0;
 
 	if ((command_bits & PCI_COMMAND_IO) == 0)
--- a/drivers/pci/pci.c
+++ b/drivers/pci/pci.c
@@ -3344,11 +3344,11 @@
 }
 
 static int pci_set_vga_state_arch(struct pci_dev *dev, bool decode,
-		      unsigned int command_bits, u32 flags)
+		      unsigned int command_bits, bool change_bridge)
 {
 	if (arch_set_vga_state)
 		return arch_set_vga_state(dev, decode, command_bits,
-						flags);
+						change_bridge);
 	return 0;
 }
 
