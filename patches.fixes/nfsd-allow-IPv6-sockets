From 205ba42308729f4f41f21d314a4435e7de5c9a2e Mon Sep 17 00:00:00 2001
From: Aime Le Rouzic <aime.le-rouzic@bull.net>
Date: Tue, 26 Jan 2010 14:03:56 -0500
Subject: [PATCH] NFSD: Support AF_INET6 in svc_addsock() function
Patch-mainline: 2.6.34
References: fate#307240

Relax the address family check at the top of svc_addsock() to allow AF_INET6
listener sockets to be specified via /proc/fs/nfsd/portlist.

Signed-off-by: Aime Le Rouzic <aime.le-rouzic@bull.net>
Signed-off-by: Chuck Lever <chuck.lever@oracle.com>
Signed-off-by: J. Bruce Fields <bfields@citi.umich.edu>
Acked-by: NeilBrown <neilb@suse.de>

---
 net/sunrpc/svcsock.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- linux-2.6.32-SLE11-SP1.orig/net/sunrpc/svcsock.c
+++ linux-2.6.32-SLE11-SP1/net/sunrpc/svcsock.c
@@ -1358,7 +1358,7 @@ int svc_addsock(struct svc_serv *serv, c
 
 	if (!so)
 		return err;
-	if (so->sk->sk_family != AF_INET)
+	if ((so->sk->sk_family != PF_INET) && (so->sk->sk_family != PF_INET6))
 		err =  -EAFNOSUPPORT;
 	else if (so->sk->sk_protocol != IPPROTO_TCP &&
 	    so->sk->sk_protocol != IPPROTO_UDP)
