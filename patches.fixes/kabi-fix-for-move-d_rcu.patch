From: Miklos Szeredi <mszeredi@suse.cz>
Subject: kabi: fix for move of d_rcu
Patch-mainline: no
References: bnc#903640 CVE-2014-8559 boo#927018

d_rcu shouldn't be used outside core VFS.  The size and offset of the other
fields doesn't change.   So it's OK to ignore this move.

[rebased for openSUSE-13.2 kernel by tiwai]

Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 include/linux/dcache.h |    7 +++++++
 1 file changed, 7 insertions(+)

--- a/include/linux/dcache.h
+++ b/include/linux/dcache.h
@@ -126,8 +126,14 @@ struct dentry {
 	struct list_head d_lru;		/* LRU list */
 	union {
 		struct list_head d_child;	/* child of parent list */
+#ifdef __GENKSYMS__
+	 	struct rcu_head d_rcu;
+#endif
 	} d_u;
 	struct list_head d_subdirs;	/* our children */
+#ifdef __GENKSYMS__
+	struct hlist_node d_alias;
+#else
 	/*
 	 * d_alias and d_rcu can share memory
 	 */
@@ -135,6 +141,7 @@ struct dentry {
 		struct hlist_node d_alias;	/* inode alias list */
 	 	struct rcu_head d_rcu;
 	};
+#endif
 };
 
 /*
