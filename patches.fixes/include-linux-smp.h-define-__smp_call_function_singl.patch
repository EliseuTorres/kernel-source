From 94048cdb5f8370987a08ea07289854a4eb41d57b Mon Sep 17 00:00:00 2001
From: Michal Hocko <mhocko@suse.cz>
Date: Thu, 1 Aug 2013 09:50:28 +0200
Subject: [PATCH] include/linux/smp.h: define __smp_call_function_single for
 !CONFIG_SMP
Patch-mainline: not yet
References: bnc#829357

This function was not needed until (watchdog: update watchdog_tresh
properly) which cannot use on_each_cpu unfortunately as
watchdog_nmi_enable relies on perf_event_alloc which is might sleep.

Export it as an alias to on_each_cpu for !CONFIG_SMP.

Reported-by: Fengguang Wu <fengguang.wu@intel.com>
Signed-off-by: Michal Hocko <mhocko@suse.cz>

---
 include/linux/smp.h |    7 +++++++
 1 file changed, 7 insertions(+)

--- a/include/linux/smp.h
+++ b/include/linux/smp.h
@@ -148,6 +148,13 @@ static inline int up_smp_call_function(s
 		local_irq_enable();		\
 		0;				\
 	})
+
+static inline void __smp_call_function_single(int cpuid,
+		struct call_single_data *data, int wait)
+{
+	on_each_cpu(data->func, data->info, wait);
+}
+
 /*
  * Note we still need to test the mask even for UP
  * because we actually can get an empty mask from
