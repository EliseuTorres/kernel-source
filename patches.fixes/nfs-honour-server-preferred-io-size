From: NeilBrown <neilb@suse.de>
Subject: NFS: Honour server-preferred io sizes
Patch-mainline: not yet
References: bnc#550648

When interpreting the preferred IO size sent by the server, linux/nfs
assumes that a non-zero setting means a user-specified setting so
it ignores the server specified setting.

This patch initialises rsize and wsize to zero so the server-preferred
values get using (if no value is specified in a mount option).

Signed-off-by: Neil Brown <neilb@suse.de>

---
 fs/nfs/super.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- linux-2.6.31-master.orig/fs/nfs/super.c
+++ linux-2.6.31-master/fs/nfs/super.c
@@ -734,8 +734,8 @@ static struct nfs_parsed_mount_data *nfs
 
 	data = kzalloc(sizeof(*data), GFP_KERNEL);
 	if (data) {
-		data->rsize		= NFS_MAX_FILE_IO_SIZE;
-		data->wsize		= NFS_MAX_FILE_IO_SIZE;
+		data->rsize		= 0;
+		data->wsize		= 0;
 		data->acregmin		= NFS_DEF_ACREGMIN;
 		data->acregmax		= NFS_DEF_ACREGMAX;
 		data->acdirmin		= NFS_DEF_ACDIRMIN;
