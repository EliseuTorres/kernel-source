From tao.ma@oracle.com  Fri Sep 24 14:30:43 2010
From: Tao Ma <tao.ma@oracle.com>
Date: Mon, 19 Jul 2010 13:55:11 -0700
Subject: [PATCH 137/314] ocfs2: Reset status if we want to restart file
 extension.
Oracle-commit: 45b96fe86ea16c229ce68808c5d8cc25b6fa01d3
Git-commit: 79681842e160c3211eeeb47ea31b061038d1e41e
Patch-mainline: 2.6.34-rc7

Mainline commit 79681842e160c3211eeeb47ea31b061038d1e41e

In __ocfs2_extend_allocation, we will restart our file extension
if ((!status) && restart_func). But there is a bug that the
status is still left as -EGAIN. This is really an old bug,
but it is masked by the return value of ocfs2_journal_dirty.
So it show up when we make ocfs2_journal_dirty void.

Signed-off-by: Tao Ma <tao.ma@oracle.com>
Signed-off-by: Joel Becker <joel.becker@oracle.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
Signed-off-by: Mark Fasheh <mfasheh@suse.com>
---
 fs/ocfs2/file.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/fs/ocfs2/file.c b/fs/ocfs2/file.c
index d76ef5c..987253c 100644
--- a/fs/ocfs2/file.c
+++ b/fs/ocfs2/file.c
@@ -685,6 +685,7 @@ restarted_transaction:
 		if (why == RESTART_META) {
 			mlog(0, "restarting function.\n");
 			restart_func = 1;
+			status = 0;
 		} else {
 			BUG_ON(why != RESTART_TRANS);
 
-- 
1.7.1

