From: Shaohua Li <shaohua.li@intel.com>
Date: Wed, 16 Nov 2011 09:21:50 +0100
Subject: block: add missed trace_block_plug
Git-commit: 019ceb7d5d252ce71001a157cf29f4ac28501b72
References: bnc#778477
Patch-Mainline: v3.2

After flush plug list, the list has no request, so we need to add a
trace_block_plug().

Signed-off-by: Shaohua Li <shaohua.li@intel.com>
Reviewed-by: Namhyung Kim <namhyung@gmail.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 block/blk-core.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/block/blk-core.c b/block/blk-core.c
index 8824398..b26cd49 100644
--- a/block/blk-core.c
+++ b/block/blk-core.c
@@ -1381,8 +1381,10 @@ get_rq:
 				if (__rq->q != q)
 					plug->should_sort = 1;
 			}
-			if (request_count >= BLK_MAX_REQUEST_COUNT)
+			if (request_count >= BLK_MAX_REQUEST_COUNT) {
 				blk_flush_plug_list(plug, false);
+				trace_block_plug(q);
+			}
 		}
 		list_add_tail(&req->queuelist, &plug->list);
 		drive_stat_acct(req, 1);
-- 
1.7.10.4

