From: Dmitry Kasatkin <dmitry.kasatkin@intel.com>
Date: Thu, 26 Jan 2012 19:13:17 +0200
Subject: [PATCH] lib/mpi: added missing NULL check
Git-commit: c70c471c585a3fc1a10c792d5121b3803c83dde0
Patch-mainline: v3.3
References: fate#314508
Target: SLE-11 SP3

Added missing NULL check after mpi_alloc().

Signed-off-by: Dmitry Kasatkin <dmitry.kasatkin@intel.com>
Reviewed-by: Tetsuo Handa <penguin-kernel@I-love.SAKURA.ne.jp>
Signed-off-by: James Morris <jmorris@namei.org>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 lib/mpi/mpicoder.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/lib/mpi/mpicoder.c
+++ b/lib/mpi/mpicoder.c
@@ -79,7 +79,8 @@ MPI do_encode_md(const void *sha_buffer,
 	}
 
 	a = mpi_alloc((nframe + BYTES_PER_MPI_LIMB - 1) / BYTES_PER_MPI_LIMB);
-	mpi_set_buffer(a, frame, nframe, 0);
+	if (a)
+		mpi_set_buffer(a, frame, nframe, 0);
 	kfree(frame);
 
 	return a;
