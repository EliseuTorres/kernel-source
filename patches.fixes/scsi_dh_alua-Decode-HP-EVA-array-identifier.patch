From: Hannes Reinecke <hare@suse.de>
Date: Thu, 27 Sep 2012 09:49:44 +0200
Subject: scsi_dh_alua: Decode HP EVA array identifier
References: bnc#708296
Patch-Mainline: submitted to linux scsi

HP EVA stores the NAA identifier in the extended inquiry data.

Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/device_handler/scsi_dh_alua.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/drivers/scsi/device_handler/scsi_dh_alua.c b/drivers/scsi/device_handler/scsi_dh_alua.c
index f2e0395..1f911a5 100644
--- a/drivers/scsi/device_handler/scsi_dh_alua.c
+++ b/drivers/scsi/device_handler/scsi_dh_alua.c
@@ -505,6 +505,15 @@ static int alua_vpd_inquiry(struct scsi_device *sdev, struct alua_dh_data *h)
 			strcpy(target_id_str, "emc.");
 			memcpy(target_id_str + 4, target_id, target_id_size);
 		}
+		/* Check for HP EVA extended inquiry */
+		if (!strncmp(sdev->vendor, "HP      ", 8) &&
+		    !strncmp(sdev->model, "HSV", 3) &&
+		    sdev->inquiry_len > 170) {
+			target_id_size = 16;
+			target_id = sdev->inquiry + 154;
+			strcpy(target_id_str, "naa.");
+			memcpy(target_id_str + 4, target_id, target_id_size);
+		}
 	}
 
 	spin_lock(&port_group_lock);
-- 
1.7.12.4

