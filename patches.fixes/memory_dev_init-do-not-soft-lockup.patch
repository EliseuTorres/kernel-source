From: Michal Hocko <mhocko@suse.cz>
Subject: mm: memory_dev_init make sure nmi watchdog doesn't trigger while registering memory sections
Patch-mainline: no
References: bnc#804609, bnc#820434

Even after 321bf4ed which reduced considerable overhead from a pointless
find_memory_block we still might fall into softlockup.

Workaround it by touching watchdog after every memory section is registered.

Signed-off-by: Michal Hocko <mhocko@suse.cz> 

---
 drivers/base/memory.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/base/memory.c
+++ b/drivers/base/memory.c
@@ -23,6 +23,7 @@
 #include <linux/mutex.h>
 #include <linux/stat.h>
 #include <linux/slab.h>
+#include <linux/nmi.h>
 
 #include <asm/atomic.h>
 #include <asm/uaccess.h>
@@ -698,6 +699,7 @@ int __init memory_dev_init(void)
 				 (sections_per_block == 1) ? NULL : &mem,
 					 MEM_ONLINE,
 					 BOOT);
+		touch_nmi_watchdog();
 		if (!ret)
 			ret = err;
 	}
