From: David Howells <dhowells@redhat.com>
Date: Wed, 5 Dec 2012 13:34:48 +0000
Subject: [PATCH] FS-Cache: Limit the number of I/O error reports for a cache
Git-commit: 75bc411388f4aeb9fb0381bd56eb5d67193ed9a1
Patch-mainline: v3.8
References: bnc#880344

Limit the number of I/O error reports for a cache to 1 to prevent massive
amounts of noise.  After the first I/O error the cache is taken off line
automatically, so must be restarted to resume caching.

Signed-off-by: David Howells <dhowells@redhat.com>
Acked-by: NeilBrown <neilb@suse.de>

---
 fs/fscache/cache.c |    8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

--- linux-3.0-SLE11-SP3.orig/fs/fscache/cache.c
+++ linux-3.0-SLE11-SP3/fs/fscache/cache.c
@@ -314,10 +314,10 @@ EXPORT_SYMBOL(fscache_add_cache);
  */
 void fscache_io_error(struct fscache_cache *cache)
 {
-	set_bit(FSCACHE_IOERROR, &cache->flags);
-
-	printk(KERN_ERR "FS-Cache: Cache %s stopped due to I/O error\n",
-	       cache->ops->name);
+	if (!test_and_set_bit(FSCACHE_IOERROR, &cache->flags))
+		printk(KERN_ERR "FS-Cache:"
+		       " Cache '%s' stopped due to I/O error\n",
+		       cache->ops->name);
 }
 EXPORT_SYMBOL(fscache_io_error);
 
