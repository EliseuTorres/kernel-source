From: Mimi Zohar <zohar@linux.vnet.ibm.com>
Date: Mon, 24 Oct 2011 08:17:42 -0400
Subject: [PATCH] encrypted-keys: fix error return code
Git-commit: f4a0d5abef14562c37dee5a1d49180f494106230
Patch-mainline: v3.2
References: fate#314508
Target: SLE-11 SP3

Fix request_master_key() error return code.

Signed-off-by: Mimi Zohar <zohar@us.ibm.com>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 security/keys/encrypted-keys/encrypted.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/security/keys/encrypted-keys/encrypted.c b/security/keys/encrypted-keys/encrypted.c
index dcc843c..41144f7 100644
--- a/security/keys/encrypted-keys/encrypted.c
+++ b/security/keys/encrypted-keys/encrypted.c
@@ -444,7 +444,7 @@ static struct key *request_master_key(struct encrypted_key_payload *epayload,
 		goto out;
 
 	if (IS_ERR(mkey)) {
-		int ret = PTR_ERR(epayload);
+		int ret = PTR_ERR(mkey);
 
 		if (ret == -ENOTSUPP)
 			pr_info("encrypted_key: key %s not supported",
-- 
1.6.4.2

