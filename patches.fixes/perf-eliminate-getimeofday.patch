From: Russ Anderson <rja@sgi.com>
Date: Tue May 18 17:52:40 2010 -0500
Git-commit: ef365cefbc53d8674a18520a1d4c2e5590127299
Subject: perf record: remove unneeded gettimeofday() call
Patch-mainline: v2.6.35-rc1
References: bnc#607339
Signed-off-by: Tony Jones <tonyj@suse.de>

    perf record: remove unneeded gettimeofday() call
    
    Perf record repeatedly calls gettimeofday() which adds noise to the performance
    measurements.  Since gettimeofday() is only used for the error printf, delete
    it.
    
    Cc: Ingo Molnar <mingo@elte.hu>
    Cc: Peter Zijlstra <peterz@infradead.org>
    Cc: Stephane Eranian <eranian@google.com>
    LKML-Reference: <20100518225240.GC25589@sgi.com>
    Signed-off-by: Russ Anderson <rja@sgi.com>
    Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>

---
 tools/perf/builtin-record.c |   16 +---------------
 1 file changed, 1 insertion(+), 15 deletions(-)

--- a/tools/perf/builtin-record.c
+++ b/tools/perf/builtin-record.c
@@ -55,8 +55,6 @@ static int			multiplex			=      0;
 static int			multiplex_fd			=     -1;
 
 static long			samples				=      0;
-static struct timeval		last_read;
-static struct timeval		this_read;
 
 static u64			bytes_written			=      0;
 
@@ -132,8 +130,6 @@ static void mmap_read(struct mmap_data *
 	void *buf;
 	int diff;
 
-	gettimeofday(&this_read, NULL);
-
 	/*
 	 * If we're further behind than half the buffer, there's a chance
 	 * the writer will bite our tail and mess up the samples under us.
@@ -144,23 +140,13 @@ static void mmap_read(struct mmap_data *
 	 */
 	diff = head - old;
 	if (diff < 0) {
-		struct timeval iv;
-		unsigned long msecs;
-
-		timersub(&this_read, &last_read, &iv);
-		msecs = iv.tv_sec*1000 + iv.tv_usec/1000;
-
-		fprintf(stderr, "WARNING: failed to keep up with mmap data."
-				"  Last read %lu msecs ago.\n", msecs);
-
+		fprintf(stderr, "WARNING: failed to keep up with mmap data\n");
 		/*
 		 * head points to a known good entry, start there.
 		 */
 		old = head;
 	}
 
-	last_read = this_read;
-
 	if (old != head)
 		samples++;
 
