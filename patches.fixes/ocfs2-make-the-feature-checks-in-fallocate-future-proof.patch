From: Christoph Hellwig <hch@lst.de>
Date: Fri, 14 Jan 2011 13:07:30 +0100
Subject: [PATCH] make the feature checks in ->fallocate future proof
Git-commit: 64c23e86873ee410554d6d1c76b60da47025e96f
Patch-mainline: yes

[picked ocfs2 bits]

Instead of various home grown checks that might need updates for new
flags just check for any bit outside the mask of the features supported
by the filesystem.  This makes the check future proof for any newly
added flag.

Signed-off-by: Christoph Hellwig <hch@lst.de>
Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Acked-by: David Sterba <dsterba@suse.cz>
---
 fs/ocfs2/file.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/fs/ocfs2/file.c
+++ b/fs/ocfs2/file.c
@@ -1990,6 +1990,8 @@ static long ocfs2_fallocate(struct inode
 	struct ocfs2_space_resv sr;
 	int change_size = 1;
 
+	if (mode & ~FALLOC_FL_KEEP_SIZE)
+		return -EOPNOTSUPP;
 	if (!ocfs2_writes_unwritten_extents(osb))
 		return -EOPNOTSUPP;
 
