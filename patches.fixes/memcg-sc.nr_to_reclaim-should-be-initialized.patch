From b8f5c5664d51776d74c84228c4b7165abfa92a18 Mon Sep 17 00:00:00 2001
From: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
Date: Tue, 10 Aug 2010 18:03:02 -0700
Subject: [PATCH] memcg: sc.nr_to_reclaim should be initialized
Patch-mainline: b8f5c5664d51776d74c84228c4b7165abfa92a18
References: bnc#704592

Currently, mem_cgroup_shrink_node_zone() initialize sc.nr_to_reclaim as 0.
 It mean shrink_zone() only scan 32 pages and immediately return even if
it doesn't reclaim any pages.

This patch fixes it.

Signed-off-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
Acked-by: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com>
Acked-by: Mel Gorman <mel@csn.ul.ie>
Cc: Balbir Singh <balbir@in.ibm.com>
Cc: Nishimura Daisuke <d-nishimura@mtf.biglobe.ne.jp>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Acked-by: Michal Hocko <mhocko@suse.cz>

---
 mm/vmscan.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

Index: linux-2.6.32-memcg-backports/mm/vmscan.c
===================================================================
--- linux-2.6.32-memcg-backports.orig/mm/vmscan.c
+++ linux-2.6.32-memcg-backports/mm/vmscan.c
@@ -2100,6 +2100,7 @@ unsigned long mem_cgroup_shrink_node_zon
 						struct zone *zone, int nid)
 {
 	struct scan_control sc = {
+		.nr_to_reclaim = SWAP_CLUSTER_MAX,
 		.may_writepage = !laptop_mode,
 		.may_unmap = 1,
 		.may_swap = !noswap,
