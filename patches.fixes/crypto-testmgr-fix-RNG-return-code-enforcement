From: Stephan Mueller <smueller@chronox.de>
Subject: crypto: testmgr - fix RNG return code enforcement
Git-commit: 19e60e1392d110be03d794e2286dd6cfd779cbe3
Patch-mainline: Queued in subsystem maintainer repository
Git-repo: git.kernel.org/cgit/linux/kernel/git/herbert/cryptodev-2.6.git
References: bsc#920805

 crypto: testmgr - fix RNG return code enforcement

Due to the change to RNGs to always return zero in success case, the
invocation of the RNGs in the test manager must be updated as otherwise
the RNG self tests are not properly executed any more.

Signed-off-by: Stephan Mueller <smueller@chronox.de>
Signed-off-by: Alexander Bergmann <abergmann@suse.com>
Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
Acked-by: Torsten Duwe <duwe@suse.de>

--- a/crypto/testmgr.c
+++ b/crypto/testmgr.c
@@ -1473,11 +1473,11 @@ static int test_cprng(struct crypto_rng
 		for (j = 0; j < template[i].loops; j++) {
 			err = crypto_rng_get_bytes(tfm, result,
 						   template[i].rlen);
-			if (err != template[i].rlen) {
+			if (err < 0) {
 				printk(KERN_ERR "alg: cprng: Failed to obtain "
 				       "the correct amount of random data for "
-				       "%s (requested %d, got %d)\n", algo,
-				       template[i].rlen, err);
+				       "%s (requested %d)\n", algo,
+				       template[i].rlen);
 				goto out;
 			}
 		}
@@ -1760,7 +1760,7 @@ static int drbg_cavs_test(struct drbg_te
 		ret = crypto_drbg_get_bytes_addtl(drng,
 			buf, test->expectedlen, &addtl);
 	}
-	if (ret <= 0) {
+	if (ret < 0) {
 		printk(KERN_ERR "alg: drbg: could not obtain random data for"
 		       "driver %s\n", driver);
 		goto outbuf;
@@ -1775,7 +1775,7 @@ static int drbg_cavs_test(struct drbg_te
 		ret = crypto_drbg_get_bytes_addtl(drng,
 			buf, test->expectedlen, &addtl);
 	}
-	if (ret <= 0) {
+	if (ret < 0) {
 		printk(KERN_ERR "alg: drbg: could not obtain random data for"
 		       "driver %s\n", driver);
 		goto outbuf;
