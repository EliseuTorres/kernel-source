From: David J. Wilder <wilder@wilder.ibm.com>
Subject: [rnfs]: Correct rqstp->rq_respages calculation
References: bnc#577355,LTC#60382
Patch-mainline: Yes

In rdma_read_complete() rqstp->rq_respages is incorrectly calculated 
and can be set point past the end of the rqstp->rq_pages page list.
This results in a NULL reference in svc_process() when passing rq_respages[0]
to page_address().  This patch corrects this calculation.

Signed-of-by: David Wilder <dwilder@us.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 net/sunrpc/xprtrdma/svc_rdma_recvfrom.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c b/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c
index f92e37e..eb12b5b 100644
--- a/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c
+++ b/net/sunrpc/xprtrdma/svc_rdma_recvfrom.c
@@ -542,7 +542,7 @@ static int rdma_read_complete(struct svc_rqst *rqstp,
 	rqstp->rq_arg.page_base = head->arg.page_base;
 
 	/* rq_respages starts after the last arg page */
-	rqstp->rq_respages = &rqstp->rq_arg.pages[page_no];
+	rqstp->rq_respages = &rqstp->rq_pages[head->count];
 	rqstp->rq_resused = 0;
 
 	/* Rebuild rq_arg head and tail. */
