From: Namhyung Kim <namhyung@gmail.com>
Date: Mon, 31 Oct 2011 20:18:56 +0000
Subject: dm: remove superfluous smp_mb
Git-commit: fbdc86f3bd597e108fa03d998132d04fcfe1d669
References: FATE#314163
Patch-Mainline: v3.2

Since set_current_state() contains a memory barrier in it,
an additional barrier isn't needed.

Signed-off-by: Namhyung Kim <namhyung@gmail.com>
Signed-off-by: Alasdair G Kergon <agk@redhat.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/md/dm.c |    1 -
 1 files changed, 0 insertions(+), 1 deletions(-)

diff --git a/drivers/md/dm.c b/drivers/md/dm.c
index 4079adb..089e099 100644
--- a/drivers/md/dm.c
+++ b/drivers/md/dm.c
@@ -2334,7 +2334,6 @@ static int dm_wait_for_completion(struct mapped_device *md, int interruptible)
 	while (1) {
 		set_current_state(interruptible);
 
-		smp_mb();
 		if (!md_in_flight(md))
 			break;
 
-- 
1.7.4.2

