From: NeilBrown <neilb@suse.de>
Subject: VFS: avoid prepend_path warning about d_obtain_alias aliases.
Patch-mainline: 3.6
References: bnc#773006

If you lazy-unmount an NFS filesystem while some process holds a file open
in the filesystem then "lsof" that process, the kernel will complain
  Root dentry has weird name <>
This is because nfs uses d_obtain_alias to create a dentry for the
filesystem root.

So change d_obtain_alias to create a similar alias to d_alloc_root()

Signed-off-by: Neil Brown <neilb@suse.de>

---
 fs/dcache.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

--- linux-3.0-SLE11-SP2.orig/fs/dcache.c
+++ linux-3.0-SLE11-SP2/fs/dcache.c
@@ -1580,10 +1580,13 @@ static struct dentry * d_find_any_alias(
  * To make it easier to use in export operations a %NULL or IS_ERR inode may
  * be passed in and will be the error will be propagate to the return value,
  * with a %NULL @inode replaced by ERR_PTR(-ESTALE).
+ *
+ * This alias can sometimes be seen by prepend_path, so make it look
+ * the same as a d_alloc_root alias.
  */
 struct dentry *d_obtain_alias(struct inode *inode)
 {
-	static const struct qstr anonstring = { .name = "" };
+	static const struct qstr anonstring = { .name = "/", .len = 1 };
 	struct dentry *tmp;
 	struct dentry *res;
 
