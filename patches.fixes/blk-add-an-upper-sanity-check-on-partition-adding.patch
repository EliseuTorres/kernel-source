From: Alan Cox <alan@linux.intel.com>
Date: Mon, 17 Sep 2012 11:47:13 +0100
Subject: blk: add an upper sanity check on partition adding
Git-commit: 2bd6efad25d7c1950008e2ab4e2d6796001919fc
References: bnc#778477
Patch-Mainline: v3.6

65536 should be ludicrous anyway but without it we overflow the
memory computation doing the allocation and badness occurs.

Signed-off-by: Alan Cox <alan@linux.intel.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 block/ioctl.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/block/ioctl.c b/block/ioctl.c
index 5c74efc..2efe10f 100644
--- a/block/ioctl.c
+++ b/block/ioctl.c
@@ -40,7 +40,7 @@ static int blkpg_ioctl(struct block_device *bdev, struct blkpg_ioctl_arg __user
 			    sizeof(long long) > sizeof(long)) {
 				long pstart = start, plength = length;
 				if (pstart != start || plength != length
-				    || pstart < 0 || plength < 0)
+				    || pstart < 0 || plength < 0 || partno > 65535)
 					return -EINVAL;
 			}
 
-- 
1.7.10.4

