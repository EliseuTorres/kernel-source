From: Yi Zou <yi.zou@intel.com>
Date: Fri, 29 Oct 2010 13:37:03 +0200
Subject: libfc: do not return error from fc_fcp_send_abort with null seq_ptr
References: bnc#650113
Patch-Mainline: 2.6.35

If the sequence pointer for the corresponding fsp is NULL, the associated
exchange is already done, do not return error in fc_fcp_send_abort(), which
would end up returning error from fc_eh_abort() to scsi-ml, causing
unnecessary lun reset.

Signed-off-by: Yi Zou <yi.zou@intel.com>
Signed-off-by: Eric Multanen <eric.w.multanen@intel.com>
Acked-by: Hannes Reinecke <hare@suse.de>
---
 drivers/scsi/libfc/fc_fcp.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/scsi/libfc/fc_fcp.c b/drivers/scsi/libfc/fc_fcp.c
index f8d56cb..0616c73 100644
--- a/drivers/scsi/libfc/fc_fcp.c
+++ b/drivers/scsi/libfc/fc_fcp.c
@@ -262,7 +262,7 @@ static void fc_fcp_timer_set(struct fc_fcp_pkt *fsp, unsigned long delay)
 static int fc_fcp_send_abort(struct fc_fcp_pkt *fsp)
 {
 	if (!fsp->seq_ptr)
-		return -EINVAL;
+		return 0;
 
 	fsp->state |= FC_SRB_ABORT_PENDING;
 	return fsp->lp->tt.seq_exch_abort(fsp->seq_ptr, 0);
-- 
1.6.0.2

