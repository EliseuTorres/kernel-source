From: Michal Hocko <mhocko@suse.cz>
Subject: Fix page in/out accounting
Patch-mainline: No
References: bnc#697913

patches.suse/mm-memcg-modify-accounting-for-THP.patch accounts page in/out
events with the given nr_pages. This is not correct for two reasons
	- there is only one faut event even for compound pages
	- we really do not want to decrement MEM_CGROUP_STAT_PGPGOUT_COUNT
	  counter because it contains the total number of events so we would
	  underflow.

Signed-off-by: Michal Hocko <mhocko@suse.cz>

Index: linux-2.6.32-memcgthp/mm/memcontrol.c
===================================================================
--- linux-2.6.32-memcgthp.orig/mm/memcontrol.c
+++ linux-2.6.32-memcgthp/mm/memcontrol.c
@@ -515,10 +515,10 @@ static void mem_cgroup_charge_statistics
 
 	if (nr_pages > 0)
 		__mem_cgroup_stat_add_safe(cpustat,
-				MEM_CGROUP_STAT_PGPGIN_COUNT, nr_pages);
+				MEM_CGROUP_STAT_PGPGIN_COUNT, 1);
 	else
 		__mem_cgroup_stat_add_safe(cpustat,
-				MEM_CGROUP_STAT_PGPGOUT_COUNT, nr_pages);
+				MEM_CGROUP_STAT_PGPGOUT_COUNT, 1);
 	__mem_cgroup_stat_add_safe(cpustat, MEM_CGROUP_STAT_EVENTS, nr_pages);
 	put_cpu();
 }
