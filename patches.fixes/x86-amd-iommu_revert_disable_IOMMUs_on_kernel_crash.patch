From: Chris Wright <chrisw@sous-sol.org>
Subject: Revert "x86: disable IOMMUs on kernel crash"
References: bnc#589650
Patch-Mainline: yes
Git-commit: 8f9f55e83e939724490d7cde3833c4883c6d1310


Signed-off-by: Thomas Renninger <trenn@suse.de>

This effectively reverts commit 61d047be99757fd9b0af900d7abce9a13a337488.

Disabling the IOMMU can potetially allow DMA transactions to
complete without being translated.  Leave it enabled, and allow
crash kernel to do the IOMMU reinitialization properly.

Cc: stable@kernel.org
Cc: Joerg Roedel <joerg.roedel@amd.com>
Cc: Eric Biederman <ebiederm@xmission.com>
Cc: Neil Horman <nhorman@tuxdriver.com>
Cc: Vivek Goyal <vgoyal@redhat.com>
Signed-off-by: Chris Wright <chrisw@sous-sol.org>
Signed-off-by: Joerg Roedel <joerg.roedel@amd.com>

---
 arch/x86/kernel/crash.c |    6 ------
 1 file changed, 6 deletions(-)

Index: linux-2.6.32-SLE11-SP1/arch/x86/kernel/crash.c
===================================================================
--- linux-2.6.32-SLE11-SP1.orig/arch/x86/kernel/crash.c
+++ linux-2.6.32-SLE11-SP1/arch/x86/kernel/crash.c
@@ -27,7 +27,6 @@
 #include <asm/cpu.h>
 #include <asm/reboot.h>
 #include <asm/virtext.h>
-#include <asm/iommu.h>
 
 
 #if defined(CONFIG_SMP) && defined(CONFIG_X86_LOCAL_APIC)
@@ -104,10 +103,5 @@ void native_machine_crash_shutdown(struc
 #ifdef CONFIG_HPET_TIMER
 	hpet_disable();
 #endif
-
-#ifdef CONFIG_X86_64
-	pci_iommu_shutdown();
-#endif
-
 	crash_save_cpu(regs, safe_smp_processor_id());
 }
