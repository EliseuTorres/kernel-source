From: Jeff Mahoney <jeffm@suse.com>
Subject: serial: fix reading uninitialized stack memory issues
References: CVE-2010-4075 CVE-2010-4076 CVE-2010-4077 bnc#642309
Patch-mainline: No, fixed differently

 Several serial drivers leak kernel stack memory in the TIOCGICOUNT ioctl
 call. This patch fixes them.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---
 drivers/char/amiserial.c     |    2 ++
 drivers/char/nozomi.c        |    2 ++
 drivers/serial/serial_core.c |    2 ++
 3 files changed, 6 insertions(+)

--- a/drivers/char/amiserial.c
+++ b/drivers/char/amiserial.c
@@ -1341,6 +1341,8 @@ static int rs_ioctl(struct tty_struct *t
 			local_irq_save(flags);
 			cnow = info->state->icount;
 			local_irq_restore(flags);
+
+			memset(&icount, 0, sizeof(icount));
 			icount.cts = cnow.cts;
 			icount.dsr = cnow.dsr;
 			icount.rng = cnow.rng;
--- a/drivers/char/nozomi.c
+++ b/drivers/char/nozomi.c
@@ -1788,6 +1788,8 @@ static int ntty_ioctl_tiocgicount(struct
 	const struct async_icount cnow = port->tty_icount;
 	struct serial_icounter_struct icount;
 
+	memset(&icount, 0, sizeof(icount));
+
 	icount.cts = cnow.cts;
 	icount.dsr = cnow.dsr;
 	icount.rng = cnow.rng;
--- a/drivers/serial/serial_core.c
+++ b/drivers/serial/serial_core.c
@@ -1074,6 +1074,8 @@ static int uart_get_count(struct uart_st
 	struct uart_icount cnow;
 	struct uart_port *uport = state->uart_port;
 
+	memset(&icount, 0, sizeof(icount));
+
 	spin_lock_irq(&uport->lock);
 	memcpy(&cnow, &uport->icount, sizeof(struct uart_icount));
 	spin_unlock_irq(&uport->lock);
