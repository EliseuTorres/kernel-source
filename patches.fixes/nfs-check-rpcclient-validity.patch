From: Malahal Naineni <malahal@us.ibm.com>
Date: Wed, 21 Sep 2011 00:27:14 +0000 (-0700)
Subject: Check validity of cl_rpcclient in nfs_server_list_show
Git-commit: 940aab490215424a269f93d2eba2794fc8b3e269
Patch-mainline: v3.2-rc1
References: bnc#717884

Check validity of cl_rpcclient in nfs_server_list_show

As soon as the nfs_client gets created, its cl_rpcclient is set to
ERR_PTR(-EINVAL). The rpc client structure is allocated later. Check
if the client is ready before using the cl_rpcclient pointer.

Signed-off-by: Malahal Naineni <malahal@us.ibm.com>
Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
Acked-by: NeilBrown <neilb@suse.de>

---

---
 fs/nfs/client.c |    4 ++++
 1 file changed, 4 insertions(+)

--- linux-3.0-SLE11-SP2-3.0-neilb.orig/fs/nfs/client.c
+++ linux-3.0-SLE11-SP2-3.0-neilb/fs/nfs/client.c
@@ -1865,6 +1865,10 @@ static int nfs_server_list_show(struct s
 	/* display one transport per line on subsequent lines */
 	clp = list_entry(v, struct nfs_client, cl_share_link);
 
+	/* Check if the client is initialized */
+	if (clp->cl_cons_state != NFS_CS_READY)
+		return 0;
+
 	seq_printf(m, "v%u %s %s %3d %s\n",
 		   clp->rpc_ops->version,
 		   rpc_peeraddr2str(clp->cl_rpcclient, RPC_DISPLAY_HEX_ADDR),

