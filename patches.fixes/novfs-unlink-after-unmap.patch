From: Michal Kubecek <mkubecek@suse.cz>
Subject: novfs: unlink directory after unmap
References: bnc#649625
Patch-mainline: no

Unlink the directory after unmap.

Reported-by: Jeremy Meldrum <jmeldrum@novell.com>
Signed-off-by: Tukaram Laxmeshwar <tlaxmeshwar@novell.com>
Acked-by: Jan Kara <jack@suse.cz>
---
 fs/novfs/daemon.c |    1 +
 1 files changed, 1 insertions(+), 0 deletions(-)

diff --git a/fs/novfs/daemon.c b/fs/novfs/daemon.c
index 702179b..d7553b6 100644
--- a/fs/novfs/daemon.c
+++ b/fs/novfs/daemon.c
@@ -1839,6 +1839,7 @@ static int unmap_drive(struct novfs_xplat *pdata, struct novfs_schandle Session)
 	if (dm) {
 		__DbgPrint("%s: Remove dm=0x%p %s\n"
 			   "   hash:    0x%x\n" "   namelen: %d\n", __func__, dm, dm->name, dm->hash, dm->namelen);
+		local_unlink(dm->name);
 		list_del(&dm->list);
 		kfree(dm);
 	}
-- 
1.7.3.4

