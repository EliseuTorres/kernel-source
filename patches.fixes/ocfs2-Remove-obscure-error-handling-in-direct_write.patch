From: Tao Ma <tao.ma@oracle.com>
Date: Wed, 9 Jun 2010 16:48:59 +0800
Subject: ocfs2: Remove obscure error handling in direct_write.
Patch-mainline: v2.6.37

In ocfs2, actually we don't allow any direct write pass i_size,
see the function ocfs2_prepare_inode_for_write. So we don't
need the bogus simple_setsize.

Signed-off-by: Tao Ma <tao.ma@oracle.com>
Signed-off-by: Joel Becker <joel.becker@oracle.com>
Signed-off-by: Mark Fasheh <mfasheh@suse.com>
---
 fs/ocfs2/file.c |   11 -----------
 1 files changed, 0 insertions(+), 11 deletions(-)

Index: linux-2.6.32-ocfs2-update-2.6.37-fixes/fs/ocfs2/file.c
===================================================================
--- linux-2.6.32-ocfs2-update-2.6.37-fixes.orig/fs/ocfs2/file.c
+++ linux-2.6.32-ocfs2-update-2.6.37-fixes/fs/ocfs2/file.c
@@ -2310,13 +2310,6 @@ relock:
 		written = generic_file_direct_write(iocb, iov, &nr_segs, *ppos,
 						    ppos, count, ocount);
 		if (written < 0) {
-			/*
-			 * direct write may have instantiated a few
-			 * blocks outside i_size. Trim these off again.
-			 * Don't need i_size_read because we hold i_mutex.
-			 */
-			if (*ppos + count > inode->i_size)
-				vmtruncate(inode, inode->i_size);
 			ret = written;
 			goto out_dio;
 		}
