From: Dan Carpenter <error27@gmail.com>
Date: Sat, 29 May 2010 09:48:35 +0000
Subject: [PATCH] Btrfs: handle ERR_PTR from posix_acl_from_xattr()
Git-commit: 834e74759a473f8101a273e843d1edec2778801d
Patch-mainline: v2.6.35-rc3

posix_acl_from_xattr() returns both ERR_PTRs and null, but it's OK to
pass null values to set_cached_acl()

Signed-off-by: Dan Carpenter <error27@gmail.com>
Signed-off-by: Chris Mason <chris.mason@oracle.com>
Acked-by: Jeff Mahoney <jeffm@suse.com>
---

 fs/btrfs/acl.c |    2 ++
 1 file changed, 2 insertions(+)

diff --git a/fs/btrfs/acl.c b/fs/btrfs/acl.c
index a372985..1606dc1 100644
--- a/fs/btrfs/acl.c
+++ b/fs/btrfs/acl.c
@@ -60,6 +60,8 @@ static struct posix_acl *btrfs_get_acl(struct inode *inode, int type)
 		size = __btrfs_getxattr(inode, name, value, size);
 		if (size > 0) {
 			acl = posix_acl_from_xattr(value, size);
+			if (IS_ERR(acl))
+				return acl;
 			set_cached_acl(inode, type, acl);
 		}
 		kfree(value);
