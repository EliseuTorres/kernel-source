From: Michal Kubecek <mkubecek@suse.cz>
Date: Thu, 12 Sep 2013 14:15:37 +0200
Subject: bonding: check bond->vlgrp in bond_vlan_rx_kill_vid()
Patch-mainline: Never, code removed in v3.1
References: bnc#834905

If a bond has NETIF_F_HW_VLAN_FILTER set but not
NETIF_F_HW_VLAN_RX, bond->vlgrp is null but
bond_vlan_rx_kill_vid() tries to use it. Add the check to
prevent null pointer dereference.

Signed-off-by: Michal Kubecek <mkubecek@suse.cz>
---
 drivers/net/bonding/bond_main.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/bonding/bond_main.c b/drivers/net/bonding/bond_main.c
index 29c0f03..23d10e6 100644
--- a/drivers/net/bonding/bond_main.c
+++ b/drivers/net/bonding/bond_main.c
@@ -504,7 +504,7 @@ static void bond_vlan_rx_kill_vid(struct net_device *bond_dev, uint16_t vid)
 		const struct net_device_ops *slave_ops = slave_dev->netdev_ops;
 
 		if ((slave_dev->features & NETIF_F_HW_VLAN_FILTER) &&
-		    slave_ops->ndo_vlan_rx_kill_vid) {
+		    slave_ops->ndo_vlan_rx_kill_vid && bond->vlgrp) {
 			/* Save and then restore vlan_dev in the grp array,
 			 * since the slave's driver might clear it.
 			 */
-- 
1.8.1.4

