From: Mark Tinguely <tinguely@sgi.com>
Subject: xfs: zero allocation_args on the kernel stack
Patch-mainline: 3.8
Git-commit: a00416844b8f4b0106344bdfd90fe45a854b1d05
References: bnc#815356

Zero the kernel stack space that makes up the xfs_alloc_arg structures.

Signed-off-by: Mark Tinguely <tinguely@sgi.com>
Reviewed-by: Ben Myers <bpm@sgi.com>
Signed-off-by: Ben Myers <bpm@sgi.com>
Acked-by: Jan Kara <jack@suse.cz>

---
 fs/xfs/xfs_alloc.c  |    1 +
 fs/xfs/xfs_bmap.c   |    3 +++
 fs/xfs/xfs_ialloc.c |    1 +
 3 files changed, 5 insertions(+)

Index: linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_alloc.c
===================================================================
--- linux-3.0-SLE11-SP3-xfs_stack_alloc.orig/fs/xfs/xfs_alloc.c
+++ linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_alloc.c
@@ -1872,6 +1872,7 @@ xfs_alloc_fix_freelist(
 	/*
 	 * Initialize the args structure.
 	 */
+	memset(&targs, 0, sizeof(targs));
 	targs.tp = tp;
 	targs.mp = mp;
 	targs.agbp = agbp;
Index: linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_bmap.c
===================================================================
--- linux-3.0-SLE11-SP3-xfs_stack_alloc.orig/fs/xfs/xfs_bmap.c
+++ linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_bmap.c
@@ -2563,6 +2563,7 @@ xfs_bmap_btalloc(
 	 * Normal allocation, done through xfs_alloc_vextent.
 	 */
 	tryagain = isaligned = 0;
+	memset(&args, 0, sizeof(args));
 	args.tp = ap->tp;
 	args.mp = mp;
 	args.fsbno = ap->rval;
@@ -3196,6 +3197,7 @@ xfs_bmap_extents_to_btree(
 	 * Convert to a btree with two levels, one record in root.
 	 */
 	XFS_IFORK_FMT_SET(ip, whichfork, XFS_DINODE_FMT_BTREE);
+	memset(&args, 0, sizeof(args));
 	args.tp = tp;
 	args.mp = mp;
 	args.firstblock = *firstblock;
@@ -3357,6 +3359,7 @@ xfs_bmap_local_to_extents(
 		xfs_buf_t	*bp;	/* buffer for extent block */
 		xfs_bmbt_rec_host_t *ep;/* extent record pointer */
 
+		memset(&args, 0, sizeof(args));
 		args.tp = tp;
 		args.mp = ip->i_mount;
 		args.firstblock = *firstblock;
Index: linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_ialloc.c
===================================================================
--- linux-3.0-SLE11-SP3-xfs_stack_alloc.orig/fs/xfs/xfs_ialloc.c
+++ linux-3.0-SLE11-SP3-xfs_stack_alloc/fs/xfs/xfs_ialloc.c
@@ -251,6 +251,7 @@ xfs_ialloc_ag_alloc(
 					/* boundary */
 	struct xfs_perag *pag;
 
+	memset(&args, 0, sizeof(args));
 	args.tp = tp;
 	args.mp = tp->t_mountp;
 
