From: Sunil Mushran <sunil.mushran@oracle.com>
Date: Wed, 4 May 2011 10:28:02 -0700
Subject: [PATCH] ocfs2: Skip mount recovery for hard-ro mounts
Patch-mainline: yes
Git-commit: 10b3dd76117a327557b8cb898b41c18afd08dc86

Patch skips mount recovery for hard-ro mounts which otherwise leads to an oops.

Signed-off-by: Sunil Mushran <sunil.mushran@oracle.com>
Acked-by: Mark Fasheh <mfasheh@suse.com>
Signed-off-by: Joel Becker <jlbec@evilplan.org>
Acked-by: David Sterba <dsterba@suse.cz>
---
 fs/ocfs2/journal.c |    3 +++
 1 file changed, 3 insertions(+)

--- a/fs/ocfs2/journal.c
+++ b/fs/ocfs2/journal.c
@@ -1303,6 +1303,9 @@ void ocfs2_complete_mount_recovery(struc
 {
 	struct ocfs2_journal *journal = osb->journal;
 
+	if (ocfs2_is_hard_readonly(osb))
+		return;
+
 	/* No need to queue up our truncate_log as regular cleanup will catch
 	 * that */
 	ocfs2_queue_recovery_completion(journal, osb->slot_num,
