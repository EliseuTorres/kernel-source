From d518b54113c1b5a5f4d6466d16500f4cc1918e0b Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Tue, 14 Sep 2010 17:04:02 +0100
Patch-mainline: 2.6.37
References: fate#310916
Git-commit: 2b6efaa47615b29e572d7fc444565db62ca9bcf7
Subject: [PATCH 1412/2588] drm/i915: Remove unused
 intel_ringbuffer->ring_flag

This can always be re-added should somebody find a use...

Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit 2b6efaa47615b29e572d7fc444565db62ca9bcf7)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/i915_gem.c         |    5 ++---
 drivers/gpu/drm/i915/intel_ringbuffer.c |    2 --
 drivers/gpu/drm/i915/intel_ringbuffer.h |    1 -
 3 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_gem.c b/drivers/gpu/drm/i915/i915_gem.c
index fd94bb9..f5b3aca 100644
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -1582,9 +1582,8 @@ i915_gem_process_flushing_list(struct drm_device *dev,
 				 gpu_write_list) {
 		struct drm_gem_object *obj = &obj_priv->base;
 
-		if ((obj->write_domain & flush_domains) ==
-		    obj->write_domain &&
-		    obj_priv->ring->ring_flag == ring->ring_flag) {
+		if (obj->write_domain & flush_domains &&
+		    obj_priv->ring == ring) {
 			uint32_t old_write_domain = obj->write_domain;
 
 			obj->write_domain = 0;
diff --git a/drivers/gpu/drm/i915/intel_ringbuffer.c b/drivers/gpu/drm/i915/intel_ringbuffer.c
index 1ae2b25..11bcfc8 100644
--- a/drivers/gpu/drm/i915/intel_ringbuffer.c
+++ b/drivers/gpu/drm/i915/intel_ringbuffer.c
@@ -805,7 +805,6 @@ struct intel_ring_buffer render_ring = {
 		.tail = PRB0_TAIL,
 		.start = PRB0_START
 	},
-	.ring_flag		= I915_EXEC_RENDER,
 	.size			= 32 * PAGE_SIZE,
 	.alignment		= PAGE_SIZE,
 	.virtual_start		= NULL,
@@ -843,7 +842,6 @@ struct intel_ring_buffer bsd_ring = {
 		.tail = BSD_RING_TAIL,
 		.start = BSD_RING_START
 	},
-	.ring_flag		= I915_EXEC_BSD,
 	.size			= 32 * PAGE_SIZE,
 	.alignment		= PAGE_SIZE,
 	.virtual_start		= NULL,
diff --git a/drivers/gpu/drm/i915/intel_ringbuffer.h b/drivers/gpu/drm/i915/intel_ringbuffer.h
index d3e5f40..fa5d84f 100644
--- a/drivers/gpu/drm/i915/intel_ringbuffer.h
+++ b/drivers/gpu/drm/i915/intel_ringbuffer.h
@@ -16,7 +16,6 @@ struct  intel_ring_buffer {
 			u32 tail;
 			u32 start;
 	} regs;
-	unsigned int	ring_flag;
 	unsigned long	size;
 	unsigned int	alignment;
 	void		*virtual_start;
-- 
1.7.6

