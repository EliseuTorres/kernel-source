From 8b9c632fa15d5eee32525dc963073c5f3a5ed20d Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Sun, 5 Dec 2010 14:54:05 +0000
Patch-mainline: 2.6.38
References: fate#310916
Git-commit: 160b1543cdae83e9f8914ac7afc3d2bd686140af
Subject: [PATCH 1920/2588] drm/i915/dp: Trivial code tidy

Locally scope the crtc to where it is used.

Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit 160b1543cdae83e9f8914ac7afc3d2bd686140af)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/intel_dp.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_dp.c b/drivers/gpu/drm/i915/intel_dp.c
index 864417c..9d8f1ad 100644
--- a/drivers/gpu/drm/i915/intel_dp.c
+++ b/drivers/gpu/drm/i915/intel_dp.c
@@ -1425,9 +1425,9 @@ intel_dp_link_down(struct intel_dp *intel_dp)
 	if (is_edp(intel_dp))
 		DP |= DP_LINK_TRAIN_OFF;
 
-	if (!HAS_PCH_CPT(dev) &&
-	    I915_READ(intel_dp->output_reg) & DP_PIPEB_SELECT) {
+	if (!HAS_PCH_CPT(dev) && (DP & DP_PIPEB_SELECT)) {
 		struct intel_crtc *intel_crtc = to_intel_crtc(intel_dp->base.base.crtc);
+
 		/* Hardware workaround: leaving our transcoder select
 		 * set to transcoder B while it's off will prevent the
 		 * corresponding HDMI output on transcoder A.
@@ -1442,8 +1442,7 @@ intel_dp_link_down(struct intel_dp *intel_dp)
 		/* Changes to enable or select take place the vblank
 		 * after being written.
 		 */
-		intel_wait_for_vblank(intel_dp->base.base.dev,
-				      intel_crtc->pipe);
+		intel_wait_for_vblank(dev, intel_crtc->pipe);
 	}
 
 	I915_WRITE(intel_dp->output_reg, DP & ~DP_PORT_EN);
-- 
1.7.6

