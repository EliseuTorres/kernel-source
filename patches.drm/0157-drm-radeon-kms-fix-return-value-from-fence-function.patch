From c007ffa10d11128cd0a51fca0433080187ffbac7 Mon Sep 17 00:00:00 2001
From: Dave Airlie <airlied@redhat.com>
Date: Wed, 9 Dec 2009 15:32:23 +1000
Patch-mainline: 2.6.33
References: fate#310916
Git-commit: 2e7b6f7fa62d92d941c626f8ae45f5cd75a52d55
Subject: [PATCH 0157/2588] drm/radeon/kms: fix return value from fence
 function.

We only want to return here for errors, the wait functions return
a positive timeout otherwise, which gets back to userspace and
causes X to crash here.

Signed-off-by: Dave Airlie <airlied@redhat.com>
(cherry picked from commit 2e7b6f7fa62d92d941c626f8ae45f5cd75a52d55)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/radeon/radeon_fence.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/drivers/gpu/drm/radeon/radeon_fence.c b/drivers/gpu/drm/radeon/radeon_fence.c
index 78743cd..cb4cd97 100644
--- a/drivers/gpu/drm/radeon/radeon_fence.c
+++ b/drivers/gpu/drm/radeon/radeon_fence.c
@@ -197,7 +197,7 @@ retry:
 		r = wait_event_interruptible_timeout(rdev->fence_drv.queue,
 				radeon_fence_signaled(fence), timeout);
 		radeon_irq_kms_sw_irq_put(rdev);
-		if (unlikely(r != 0))
+		if (unlikely(r < 0))
 			return r;
 	} else {
 		radeon_irq_kms_sw_irq_get(rdev);
-- 
1.7.6

