From 1e05415733b0d4668fbce92856fafabfa1a33333 Mon Sep 17 00:00:00 2001
From: Ben Skeggs <bskeggs@redhat.com>
Date: Sat, 17 Sep 2011 06:38:56 +1000
Subject: drm/nouveau/pm: remove defunct fanspeed_set/get from pm table
Git-commit: 1e05415733b0d4668fbce92856fafabfa1a33333
Patch-mainline: v3.3-rc1

Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/nouveau/nouveau_drv.h |    2 --
 drivers/gpu/drm/nouveau/nouveau_pm.c  |   12 +++---------
 2 files changed, 3 insertions(+), 11 deletions(-)

diff --git a/drivers/gpu/drm/nouveau/nouveau_drv.h b/drivers/gpu/drm/nouveau/nouveau_drv.h
index ea4009e..4848350 100644
--- a/drivers/gpu/drm/nouveau/nouveau_drv.h
+++ b/drivers/gpu/drm/nouveau/nouveau_drv.h
@@ -556,8 +556,6 @@ struct nouveau_pm_engine {
 	int (*voltage_set)(struct drm_device *, int voltage);
 	int (*pwm_get)(struct drm_device *, struct dcb_gpio_entry*, u32*, u32*);
 	int (*pwm_set)(struct drm_device *, struct dcb_gpio_entry*, u32, u32);
-	int (*fanspeed_get)(struct drm_device *);
-	int (*fanspeed_set)(struct drm_device *, int fanspeed);
 	int (*temp_get)(struct drm_device *);
 };
 
diff --git a/drivers/gpu/drm/nouveau/nouveau_pm.c b/drivers/gpu/drm/nouveau/nouveau_pm.c
index b94364d..3ebc3f5 100644
--- a/drivers/gpu/drm/nouveau/nouveau_pm.c
+++ b/drivers/gpu/drm/nouveau/nouveau_pm.c
@@ -40,15 +40,12 @@ nouveau_pwmfan_get(struct drm_device *dev)
 	struct drm_nouveau_private *dev_priv = dev->dev_private;
 	struct nouveau_gpio_engine *pgpio = &dev_priv->engine.gpio;
 	struct nouveau_pm_engine *pm = &dev_priv->engine.pm;
-	struct dcb_gpio_entry *gpio;
+	struct dcb_gpio_entry *gpio = NULL;
 	u32 divs, duty;
 	int ret;
 
-	if (!pm->pwm_get) {
-		if (pm->fanspeed_get)
-			return pm->fanspeed_get(dev);
+	if (!pm->pwm_get)
 		return -ENODEV;
-	}
 
 	gpio = nouveau_bios_gpio_entry(dev, DCB_GPIO_PWM_FAN);
 	if (gpio) {
@@ -75,11 +72,8 @@ nouveau_pwmfan_set(struct drm_device *dev, int percent)
 	struct dcb_gpio_entry *gpio;
 	u32 divs, duty;
 
-	if (!pm->pwm_set) {
-		if (pm->fanspeed_set)
-			return pm->fanspeed_set(dev, percent);
+	if (!pm->pwm_set)
 		return -ENODEV;
-	}
 
 	gpio = nouveau_bios_gpio_entry(dev, DCB_GPIO_PWM_FAN);
 	if (gpio) {

