From 43b1e9c9899ece92c1f68d45ae0d7b98d009f5d0 Mon Sep 17 00:00:00 2001
From: Ben Skeggs <bskeggs@redhat.com>
Date: Mon, 6 Aug 2012 16:31:26 +1000
Subject: drm/nouveau/device: return proper error codes if ioremap fails
Git-commit: 43b1e9c9899ece92c1f68d45ae0d7b98d009f5d0
Patch-mainline: v3.7-rc3

Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/nouveau/core/subdev/device/base.c |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/gpu/drm/nouveau/core/subdev/device/base.c b/drivers/gpu/drm/nouveau/core/subdev/device/base.c
index 42faa65..cac67dc 100644
--- a/drivers/gpu/drm/nouveau/core/subdev/device/base.c
+++ b/drivers/gpu/drm/nouveau/core/subdev/device/base.c
@@ -139,8 +139,8 @@ nouveau_devobj_ctor(struct nouveau_object *parent,
 	if (!(args->disable & NV_DEVICE_DISABLE_IDENTIFY) &&
 	    !device->card_type) {
 		map = ioremap(mmio_base, 0x102000);
-		if (map == NULL) {
-		}
+		if (map == NULL)
+			return -ENOMEM;
 
 		/* switch mmio to cpu's native endianness */
 #ifndef __BIG_ENDIAN
@@ -230,7 +230,7 @@ nouveau_devobj_ctor(struct nouveau_object *parent,
 		nv_subdev(device)->mmio  = ioremap(mmio_base, mmio_size);
 		if (!nv_subdev(device)->mmio) {
 			nv_error(device, "unable to map device registers\n");
-			return ret;
+			return -ENOMEM;
 		}
 	}
 

