From d27d19dd2cd6dda15727770f6f16ec1ecf97aefb Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Sun, 12 Sep 2010 16:33:47 +0100
Patch-mainline: 2.6.37
References: fate#310916
Git-commit: 8aadf70bd72c8f15994e68503af8f6722cd5c813
Subject: [PATCH 1399/2588] drm/i915/lvds: Remove incorrect mode locking

One doesn't need to hold the mode lock in order to duplicate a mode.

Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit 8aadf70bd72c8f15994e68503af8f6722cd5c813)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/intel_lvds.c |    7 -------
 1 files changed, 0 insertions(+), 7 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_lvds.c b/drivers/gpu/drm/i915/intel_lvds.c
index 368f987..5784b60 100644
--- a/drivers/gpu/drm/i915/intel_lvds.c
+++ b/drivers/gpu/drm/i915/intel_lvds.c
@@ -751,7 +751,6 @@ static void intel_find_lvds_downclock(struct drm_device *dev,
 	panel_fixed_mode = dev_priv->panel_fixed_mode;
 	temp_downclock = panel_fixed_mode->clock;
 
-	mutex_lock(&dev->mode_config.mutex);
 	list_for_each_entry(scan, &connector->probed_modes, head) {
 		/*
 		 * If one mode has the same resolution with the fixed_panel
@@ -777,7 +776,6 @@ static void intel_find_lvds_downclock(struct drm_device *dev,
 			}
 		}
 	}
-	mutex_unlock(&dev->mode_config.mutex);
 	if (temp_downclock < panel_fixed_mode->clock &&
 	    i915_lvds_downclock) {
 		/* We found the downclock for LVDS. */
@@ -948,23 +946,18 @@ void intel_lvds_init(struct drm_device *dev)
 		dev_priv->lvds_edid_good = false;
 
 	list_for_each_entry(scan, &connector->probed_modes, head) {
-		mutex_lock(&dev->mode_config.mutex);
 		if (scan->type & DRM_MODE_TYPE_PREFERRED) {
 			dev_priv->panel_fixed_mode =
 				drm_mode_duplicate(dev, scan);
-			mutex_unlock(&dev->mode_config.mutex);
 			intel_find_lvds_downclock(dev, connector);
 			goto out;
 		}
-		mutex_unlock(&dev->mode_config.mutex);
 	}
 
 	/* Failed to get EDID, what about VBT? */
 	if (dev_priv->lfp_lvds_vbt_mode) {
-		mutex_lock(&dev->mode_config.mutex);
 		dev_priv->panel_fixed_mode =
 			drm_mode_duplicate(dev, dev_priv->lfp_lvds_vbt_mode);
-		mutex_unlock(&dev->mode_config.mutex);
 		if (dev_priv->panel_fixed_mode) {
 			dev_priv->panel_fixed_mode->type |=
 				DRM_MODE_TYPE_PREFERRED;
-- 
1.7.6

