From: Takashi Iwai <tiwai@suse.de>
Subject: drm: Fix fb after S4
Patch-mainline: Submitted
References: 

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/gpu/drm/drm_fb_helper.c |   10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

--- a/drivers/gpu/drm/drm_fb_helper.c
+++ b/drivers/gpu/drm/drm_fb_helper.c
@@ -1400,7 +1400,7 @@
 	struct drm_device *dev = fb_helper->dev;
 	int count = 0;
 	u32 max_width, max_height, bpp_sel;
-	bool bound = false, crtcs_bound = false;
+	bool bound = false, others_bound = false;
 	struct drm_crtc *crtc;
 
 	if (!fb_helper->fb)
@@ -1408,13 +1408,15 @@
 
 	mutex_lock(&dev->mode_config.mutex);
 	list_for_each_entry(crtc, &dev->mode_config.crtc_list, head) {
-		if (crtc->fb)
-			crtcs_bound = true;
+		if (!crtc->fb)
+			continue;
 		if (crtc->fb == fb_helper->fb)
 			bound = true;
+		else
+			others_bound = true;
 	}
 
-	if (!bound && crtcs_bound) {
+	if (!bound || others_bound) {
 		fb_helper->delayed_hotplug = true;
 		mutex_unlock(&dev->mode_config.mutex);
 		return 0;
