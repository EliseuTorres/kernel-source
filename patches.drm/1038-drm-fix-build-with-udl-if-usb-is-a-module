From 2de6d4a9e46c9bb038e9970628ed4b8e199ffda3 Mon Sep 17 00:00:00 2001
From: Dave Airlie <airlied@redhat.com>
Date: Fri, 16 Mar 2012 09:28:03 +0000
Subject: drm: fix build with UDL if USB is a module
Git-commit: 2de6d4a9e46c9bb038e9970628ed4b8e199ffda3
Patch-mainline: v3.4-rc1

reported by sfr on -next merge.

Signed-off-by: Dave Airlie <airlied@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/Makefile  |    3 ++-
 drivers/gpu/drm/drm_usb.c |    2 --
 2 files changed, 2 insertions(+), 3 deletions(-)

Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/Makefile
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/Makefile
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/Makefile
@@ -12,8 +12,9 @@ drm-y       :=	drm_auth.o drm_buffer.o d
 		drm_platform.o drm_sysfs.o drm_hashtab.o drm_mm.o \
 		drm_crtc.o drm_modes.o drm_edid.o \
 		drm_info.o drm_debugfs.o drm_encoder_slave.o \
-		drm_trace_points.o drm_global.o drm_usb.o
+		drm_trace_points.o drm_global.o
 
+drm-$(CONFIG_USB) += drm_usb.o
 drm-$(CONFIG_COMPAT) += drm_ioc32.o
 
 drm_kms_helper-y := drm_fb_helper.o drm_crtc_helper.o drm_dp_i2c_helper.o
Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/drm_usb.c
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/drm_usb.c
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/drm_usb.c
@@ -1,7 +1,6 @@
 #include "drmP.h"
 #include <linux/usb.h>
 
-#ifdef CONFIG_USB
 int drm_get_usb_dev(struct usb_interface *interface,
 		    const struct usb_device_id *id,
 		    struct drm_driver *driver)
@@ -114,4 +113,3 @@ void drm_usb_exit(struct drm_driver *dri
 	usb_deregister(udriver);
 }
 EXPORT_SYMBOL(drm_usb_exit);
-#endif
