From 5be2d1c7054ec9461cf4ef791c82b50bcf71c2c3 Mon Sep 17 00:00:00 2001
From: Jesse Barnes <jbarnes@virtuousgeek.org>
Date: Fri, 10 Sep 2010 11:27:03 -0700
Patch-mainline: 2.6.37
References: fate#310916
Git-commit: c64e311e650921fb014af2b3c500180fc65802b9
Subject: [PATCH 1383/2588] drm/i915: set FDI RX TU size to match transmit
 size

This allows FDI error checking to work.

Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit c64e311e650921fb014af2b3c500180fc65802b9)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/intel_display.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index fc9bb68..8b5b935 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -1871,12 +1871,18 @@ static void ironlake_fdi_enable(struct drm_crtc *crtc)
 	int pipeconf_reg = (pipe == 0) ? PIPEACONF : PIPEBCONF;
 	int fdi_tx_reg = (pipe == 0) ? FDI_TXA_CTL : FDI_TXB_CTL;
 	int fdi_rx_reg = (pipe == 0) ? FDI_RXA_CTL : FDI_RXB_CTL;
+	int data_m1_reg = (pipe == 0) ? PIPEA_DATA_M1 : PIPEB_DATA_M1;
 	u32 temp;
 	u32 pipe_bpc;
+	u32 tx_size;
 
 	temp = I915_READ(pipeconf_reg);
 	pipe_bpc = temp & PIPE_BPC_MASK;
 
+	/* Write the TU size bits so error detection works */
+	tx_size = I915_READ(data_m1_reg) & TU_SIZE_MASK;
+	I915_WRITE(FDI_RXA_TUSIZE1, tx_size);
+
 	/* enable PCH FDI RX PLL, wait warmup plus DMI latency */
 	temp = I915_READ(fdi_rx_reg);
 	/*
-- 
1.7.6

