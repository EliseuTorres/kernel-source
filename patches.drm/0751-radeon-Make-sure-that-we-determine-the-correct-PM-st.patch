From de1e12a61ab5725b7d8ec429ae56a6b089040b15 Mon Sep 17 00:00:00 2001
From: Matthew Garrett <mjg@redhat.com>
Date: Tue, 27 Apr 2010 13:58:46 -0400
Patch-mainline: 2.6.35
References: fate#310916
Git-commit: c37d230af450472183e70947f8e2aa8101a96603
Subject: [PATCH 0751/2588] radeon: Make sure that we determine the correct PM
 state before transition

We need to choose the correct PM state to transition into before starting
the actual change. Call radeon_get_power_state() at the top of the clock
setting to do so.

Signed-off-by: Matthew Garrett <mjg@redhat.com>
Signed-off-by: Dave Airlie <airlied@redhat.com>
(cherry picked from commit c37d230af450472183e70947f8e2aa8101a96603)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/radeon/radeon_pm.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/radeon/radeon_pm.c b/drivers/gpu/drm/radeon/radeon_pm.c
index 79d3336..7cc54c8 100644
--- a/drivers/gpu/drm/radeon/radeon_pm.c
+++ b/drivers/gpu/drm/radeon/radeon_pm.c
@@ -58,6 +58,9 @@ static void radeon_pm_set_clocks(struct radeon_device *rdev, int static_switch)
 {
 	int i;
 
+	if (!static_switch)
+		radeon_get_power_state(rdev, rdev->pm.planned_action);
+
 	mutex_lock(&rdev->cp.mutex);
 
 	/* wait for GPU idle */
-- 
1.7.6

