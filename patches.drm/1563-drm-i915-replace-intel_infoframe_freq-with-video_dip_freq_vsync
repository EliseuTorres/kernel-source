From 4b24c9331a761d237b8e071941759b80cc580802 Mon Sep 17 00:00:00 2001
From: Daniel Vetter <daniel.vetter@ffwll.ch>
Date: Tue, 8 May 2012 14:41:00 +0200
Subject: drm/i915: replace intel_infoframe_freq with VIDEO_DIP_FREQ_VSYNC
Git-commit: 4b24c9331a761d237b8e071941759b80cc580802
Patch-mainline: v3.5-rc1

Simplifies things because for all the infoframes we care about,
we always send them on each vblank. Also, this gets rid of one
of the hw specific functions mislabelled with the intel_ prefix -
hsw will completely change how this works!

Acked-by: Paulo Zanoni <przanoni@gmail.com>
Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/i915/intel_hdmi.c |   25 ++++---------------------
 1 files changed, 4 insertions(+), 21 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_hdmi.c b/drivers/gpu/drm/i915/intel_hdmi.c
index 9902904..4c822e1 100644
--- a/drivers/gpu/drm/i915/intel_hdmi.c
+++ b/drivers/gpu/drm/i915/intel_hdmi.c
@@ -113,23 +113,6 @@ static u32 intel_infoframe_enable(struct dip_infoframe *frame)
 	return flags;
 }
 
-static u32 intel_infoframe_frequency(struct dip_infoframe *frame)
-{
-	u32 flags = 0;
-
-	switch (frame->type) {
-	case DIP_TYPE_AVI:
-	case DIP_TYPE_SPD:
-		flags |= VIDEO_DIP_FREQ_VSYNC;
-		break;
-	default:
-		DRM_DEBUG_DRIVER("unknown info frame type %d\n", frame->type);
-		break;
-	}
-
-	return flags;
-}
-
 static void i9xx_write_infoframe(struct drm_encoder *encoder,
 				 struct dip_infoframe *frame)
 {
@@ -165,7 +148,7 @@ static void i9xx_write_infoframe(struct drm_encoder *encoder,
 
 	val |= intel_infoframe_enable(frame);
 	val &= ~VIDEO_DIP_FREQ_MASK;
-	val |= intel_infoframe_frequency(frame);
+	val |= VIDEO_DIP_FREQ_VSYNC;
 
 	I915_WRITE(VIDEO_DIP_CTL, val);
 }
@@ -215,7 +198,7 @@ static void ibx_write_infoframe(struct drm_encoder *encoder,
 
 	val |= intel_infoframe_enable(frame);
 	val &= ~VIDEO_DIP_FREQ_MASK;
-	val |= intel_infoframe_frequency(frame);
+	val |= VIDEO_DIP_FREQ_VSYNC;
 
 	I915_WRITE(reg, val);
 }
@@ -255,7 +238,7 @@ static void cpt_write_infoframe(struct drm_encoder *encoder,
 
 	val |= intel_infoframe_enable(frame);
 	val &= ~VIDEO_DIP_FREQ_MASK;
-	val |= intel_infoframe_frequency(frame);
+	val |= VIDEO_DIP_FREQ_VSYNC;
 
 	I915_WRITE(reg, val);
 }
@@ -289,7 +272,7 @@ static void vlv_write_infoframe(struct drm_encoder *encoder,
 
 	val |= intel_infoframe_enable(frame);
 	val &= ~VIDEO_DIP_FREQ_MASK;
-	val |= intel_infoframe_frequency(frame);
+	val |= VIDEO_DIP_FREQ_VSYNC;
 
 	I915_WRITE(reg, val);
 }

