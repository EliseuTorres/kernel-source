From 5574e72ccbfd62d37af6cc1931547cb6362a4de1 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michel=20D=C3=A4nzer?= <daenzer@vmware.com>
Date: Tue, 11 Jan 2011 10:44:54 +0100
Patch-mainline: 2.6.38
References: fate#310916
Git-commit: 29d9ebc4820ee4e03776ddd9a34f3d0097595405
Subject: [PATCH 2049/2588] drm/radeon/kms: Initialize pageflip spinlocks.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

I'm amazed but not really surprised this worked on x86...

Signed-off-by: Michel DÃ¤nzer <daenzer@vmware.com>
Signed-off-by: Dave Airlie <airlied@gmail.com>
(cherry picked from commit 29d9ebc4820ee4e03776ddd9a34f3d0097595405)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/radeon/radeon_irq_kms.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/radeon/radeon_irq_kms.c b/drivers/gpu/drm/radeon/radeon_irq_kms.c
index a289646..9ec830c 100644
--- a/drivers/gpu/drm/radeon/radeon_irq_kms.c
+++ b/drivers/gpu/drm/radeon/radeon_irq_kms.c
@@ -110,11 +110,14 @@ void radeon_driver_irq_uninstall_kms(struct drm_device *dev)
 
 int radeon_irq_kms_init(struct radeon_device *rdev)
 {
+	int i;
 	int r = 0;
 
 	INIT_WORK(&rdev->hotplug_work, radeon_hotplug_work_func);
 
 	spin_lock_init(&rdev->irq.sw_lock);
+	for (i = 0; i < rdev->num_crtc; i++)
+		spin_lock_init(&rdev->irq.pflip_lock[i]);
 	r = drm_vblank_init(rdev->ddev, rdev->num_crtc);
 	if (r) {
 		return r;
-- 
1.7.6

