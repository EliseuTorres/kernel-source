From 669442f02a3119336afbd4a191ed896bf398b020 Mon Sep 17 00:00:00 2001
From: Jesse Barnes <jbarnes@virtuousgeek.org>
Date: Thu, 3 Dec 2009 09:52:43 -0800
Patch-mainline: 2.6.33
References: fate#310916
Git-commit: 85364905f9ae12d19cb34099257d493e5d9a0c4e
Subject: [PATCH 0082/2588] drm/i915: warn if Pineview CxSR can't be enabled

If we don't detect a supported memory configuration, we can't enable
CxSR.  Warn the user in this case so they can file a bug.
(cherry picked from commit 85364905f9ae12d19cb34099257d493e5d9a0c4e)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/intel_display.c |    7 +++++++
 1 files changed, 7 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_display.c b/drivers/gpu/drm/i915/intel_display.c
index e8d4744..49e1a1e 100644
--- a/drivers/gpu/drm/i915/intel_display.c
+++ b/drivers/gpu/drm/i915/intel_display.c
@@ -4817,6 +4817,13 @@ void intel_modeset_init(struct drm_device *dev)
 		    (unsigned long)dev);
 
 	intel_setup_overlay(dev);
+
+	if (IS_IGD(dev) && !intel_get_cxsr_latency(IS_IGDG(dev),
+						   dev_priv->fsb_freq,
+						   dev_priv->mem_freq))
+		DRM_INFO("failed to find known CxSR latency "
+			 "(found fsb freq %d, mem freq %d), disabling CxSR\n",
+			 dev_priv->fsb_freq, dev_priv->mem_freq);
 }
 
 void intel_modeset_cleanup(struct drm_device *dev)
-- 
1.7.6

