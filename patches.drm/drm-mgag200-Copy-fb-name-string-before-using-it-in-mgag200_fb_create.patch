From: Egbert Eich <Egbert Eich eich@suse.de>
Date: Thu May 2 11:03:31 2013 +0200
Subject: drm/mgag200: Copy fb name string before using it in mgag200_fb_create().
Patch-Mainline: to be upstreamed
Git-commit: db6940c2e177f024db916ac5135b8858331f3b51
Git-repo: git://people.freedesktop.org/~airlied/linux/
References: bnc #806990
Signed-off-by: Egbert Eich <eich@suse.com>

The fb id string was used in an error message right before it was set.
Reversing the order of the code fixes this.

Signed-off-by: Egbert Eich <eich@suse.de>
---
 drivers/gpu/drm/mgag200/mgag200_fb.c |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/mgag200/mgag200_fb.c
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/mgag200/mgag200_fb.c
@@ -175,6 +175,8 @@ static int mgag200fb_create(struct mga_f
 	mfbdev->helper.fb = fb;
 	mfbdev->helper.fbdev = info;
 
+	strcpy(info->fix.id, "mgadrmfb");
+
 	ret = fb_alloc_cmap(&info->cmap, 256, 0);
 	if (ret) {
 		DRM_ERROR("%s: can't allocate color map\n", info->fix.id);
@@ -182,8 +184,6 @@ static int mgag200fb_create(struct mga_f
 		goto out;
 	}
 
-	strcpy(info->fix.id, "mgadrmfb");
-
 	info->flags = FBINFO_DEFAULT | FBINFO_CAN_FORCE_OUTPUT;
 	info->fbops = &mgag200fb_ops;
 
