From c5c42360bc1cb14c7da3186683e9525b33b72656 Mon Sep 17 00:00:00 2001
From: Jakob Bornecrantz <jakob@vmware.com>
Date: Sat, 22 Oct 2011 10:29:34 +0200
Subject: vmwgfx: Don't pass unused arguments to do_dirty functions
Git-commit: c5c42360bc1cb14c7da3186683e9525b33b72656
Patch-mainline: v3.2-rc1

Signed-off-by: Jakob Bornecrantz <jakob@vmware.com>
Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com>
Signed-off-by: Dave Airlie <airlied@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/vmwgfx/vmwgfx_kms.c |   12 +++---------
 1 files changed, 3 insertions(+), 9 deletions(-)

diff --git a/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c b/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
index 00ec619..8b14dfd 100644
--- a/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
+++ b/drivers/gpu/drm/vmwgfx/vmwgfx_kms.c
@@ -353,7 +353,6 @@ void vmw_framebuffer_surface_destroy(struct drm_framebuffer *framebuffer)
 static int do_surface_dirty_sou(struct vmw_private *dev_priv,
 				struct drm_file *file_priv,
 				struct vmw_framebuffer *framebuffer,
-				struct vmw_surface *surf,
 				unsigned flags, unsigned color,
 				struct drm_clip_rect *clips,
 				unsigned num_clips, int inc)
@@ -381,7 +380,6 @@ static int do_surface_dirty_sou(struct vmw_private *dev_priv,
 		units[num_units++] = vmw_crtc_to_du(crtc);
 	}
 
-	BUG_ON(surf == NULL);
 	BUG_ON(!clips || !num_clips);
 
 	fifo_size = sizeof(*cmd) + sizeof(SVGASignedRect) * num_clips;
@@ -476,7 +474,6 @@ int vmw_framebuffer_surface_dirty(struct drm_framebuffer *framebuffer,
 	struct vmw_master *vmaster = vmw_master(file_priv->master);
 	struct vmw_framebuffer_surface *vfbs =
 		vmw_framebuffer_to_vfbs(framebuffer);
-	struct vmw_surface *surf = vfbs->surface;
 	struct drm_clip_rect norect;
 	int ret, inc = 1;
 
@@ -502,7 +499,7 @@ int vmw_framebuffer_surface_dirty(struct drm_framebuffer *framebuffer,
 		inc = 2; /* skip source rects */
 	}
 
-	ret = do_surface_dirty_sou(dev_priv, file_priv, &vfbs->base, surf,
+	ret = do_surface_dirty_sou(dev_priv, file_priv, &vfbs->base,
 				   flags, color,
 				   clips, num_clips, inc);
 
@@ -642,7 +639,6 @@ void vmw_framebuffer_dmabuf_destroy(struct drm_framebuffer *framebuffer)
 
 static int do_dmabuf_dirty_ldu(struct vmw_private *dev_priv,
 			       struct vmw_framebuffer *framebuffer,
-			       struct vmw_dma_buffer *buffer,
 			       unsigned flags, unsigned color,
 			       struct drm_clip_rect *clips,
 			       unsigned num_clips, int increment)
@@ -722,7 +718,6 @@ static int do_dmabuf_define_gmrfb(struct drm_file *file_priv,
 static int do_dmabuf_dirty_sou(struct drm_file *file_priv,
 			       struct vmw_private *dev_priv,
 			       struct vmw_framebuffer *framebuffer,
-			       struct vmw_dma_buffer *buffer,
 			       unsigned flags, unsigned color,
 			       struct drm_clip_rect *clips,
 			       unsigned num_clips, int increment)
@@ -811,7 +806,6 @@ int vmw_framebuffer_dmabuf_dirty(struct drm_framebuffer *framebuffer,
 	struct vmw_master *vmaster = vmw_master(file_priv->master);
 	struct vmw_framebuffer_dmabuf *vfbd =
 		vmw_framebuffer_to_vfbd(framebuffer);
-	struct vmw_dma_buffer *dmabuf = vfbd->buffer;
 	struct drm_clip_rect norect;
 	int ret, increment = 1;
 
@@ -831,12 +825,12 @@ int vmw_framebuffer_dmabuf_dirty(struct drm_framebuffer *framebuffer,
 	}
 
 	if (dev_priv->ldu_priv) {
-		ret = do_dmabuf_dirty_ldu(dev_priv, &vfbd->base, dmabuf,
+		ret = do_dmabuf_dirty_ldu(dev_priv, &vfbd->base,
 					  flags, color,
 					  clips, num_clips, increment);
 	} else {
 		ret = do_dmabuf_dirty_sou(file_priv, dev_priv, &vfbd->base,
-					  dmabuf, flags, color,
+					  flags, color,
 					  clips, num_clips, increment);
 	}
 

