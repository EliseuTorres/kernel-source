From fce875d647171f9f740587a252fc026aaa421afe Mon Sep 17 00:00:00 2001
From: Ben Skeggs <bskeggs@redhat.com>
Date: Thu, 26 Jul 2012 08:54:33 +1000
Subject: drm/nouveau: move compat ioctl out of nouveau_drv.h
Git-commit: fce875d647171f9f740587a252fc026aaa421afe
Patch-mainline: v3.7-rc3

Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/nouveau/Makefile        |    2 +-
 drivers/gpu/drm/nouveau/nouveau_drv.c   |    1 +
 drivers/gpu/drm/nouveau/nouveau_drv.h   |    3 ---
 drivers/gpu/drm/nouveau/nouveau_ioc32.c |    2 +-
 drivers/gpu/drm/nouveau/nouveau_ioctl.h |    6 ++++++
 5 files changed, 9 insertions(+), 5 deletions(-)

Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/Makefile
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/nouveau/Makefile
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/Makefile
@@ -168,6 +168,7 @@ nouveau-y += nv50_fbcon.o nvc0_fbcon.o
 # drm/kms/nvd9-
 
 # other random bits
+nouveau-$(CONFIG_COMPAT) += nouveau_ioc32.o
 nouveau-$(CONFIG_ACPI) += nouveau_acpi.o
 
 ##
@@ -201,7 +202,6 @@ nouveau-y += nv04_pm.o nv40_pm.o nv50_pm
 nouveau-y += nouveau_mem.o
 
 # optional stuff
-nouveau-$(CONFIG_COMPAT) += nouveau_ioc32.o
 nouveau-$(CONFIG_DRM_NOUVEAU_BACKLIGHT) += nouveau_backlight.o
 
 
Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_drv.c
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/nouveau/nouveau_drv.c
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_drv.c
@@ -36,6 +36,7 @@
 #include "nouveau_pm.h"
 #include "nv50_display.h"
 #include "nouveau_acpi.h"
+#include "nouveau_ioctl.h"
 
 #include <drm/drm_pciids.h>
 
Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_drv.h
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/nouveau/nouveau_drv.h
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_drv.h
@@ -405,9 +405,6 @@ int nouveau_ttm_mmap(struct file *, stru
 /* nouveau_hdmi.c */
 void nouveau_hdmi_mode_set(struct drm_encoder *, struct drm_display_mode *);
 
-extern long nouveau_compat_ioctl(struct file *file, unsigned int cmd,
-			         unsigned long arg);
-
 /* nvd0_display.c */
 extern int nvd0_display_create(struct drm_device *);
 extern void nvd0_display_destroy(struct drm_device *);
Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_ioc32.c
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/gpu/drm/nouveau/nouveau_ioc32.c
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_ioc32.c
@@ -35,7 +35,7 @@
 
 #include <drm/drmP.h>
 
-#include "nouveau_drv.h"
+#include "nouveau_ioctl.h"
 
 /**
  * Called whenever a 32-bit process running under a 64-bit kernel
Index: linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_ioctl.h
===================================================================
--- /dev/null
+++ linux-3.0-SLE11-SP3/drivers/gpu/drm/nouveau/nouveau_ioctl.h
@@ -0,0 +1,6 @@
+#ifndef __NOUVEAU_IOCTL_H__
+#define __NOUVEAU_IOCTL_H__
+
+long nouveau_compat_ioctl(struct file *, unsigned int cmd, unsigned long arg);
+
+#endif
