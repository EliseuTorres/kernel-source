From: Takashi Iwai <tiwai@suse.de>
Subject: Replace CONFIG_INTEL_IOMMU with CONFIG_DMAR
Patch-mainline: Never
References: bnc#808010

The upstream renamed CONFIG_DMAR with CONFIG_INTEL_IOMMU but we didn't
follow it for SP3, so need to rename back to the old name in each place.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 drivers/char/agp/intel-gtt.c        |    4 ++--
 drivers/gpu/drm/i915/i915_drv.c     |    2 +-
 drivers/gpu/drm/i915/i915_gem.c     |    2 +-
 drivers/gpu/drm/i915/i915_gem_gtt.c |    2 +-
 include/drm/intel-gtt.h             |    2 +-
 5 files changed, 6 insertions(+), 6 deletions(-)

--- a/drivers/char/agp/intel-gtt.c
+++ b/drivers/char/agp/intel-gtt.c
@@ -585,7 +585,7 @@ static void intel_gtt_cleanup(void)
  */
 static inline int needs_ilk_vtd_wa(void)
 {
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 	const unsigned short gpu_devid = intel_private.pcidev->device;
 
 	/* Query intel_iommu to see if we need the workaround. Presumably that
@@ -1127,7 +1127,7 @@ static void i965_write_entry(dma_addr_t
  */
 static inline int needs_idle_maps(void)
 {
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 	const unsigned short gpu_devid = intel_private.pcidev->device;
 
 	/* Query intel_iommu to see if we need the workaround. Presumably that
--- a/drivers/gpu/drm/i915/i915_drv.c
+++ b/drivers/gpu/drm/i915/i915_drv.c
@@ -456,7 +456,7 @@ bool i915_semaphore_is_enabled(struct dr
 	if (i915_semaphores >= 0)
 		return i915_semaphores;
 
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 	/* Enable semaphores on SNB when IO remapping is off */
 	if (INTEL_INFO(dev)->gen == 6 && intel_iommu_gfx_mapped)
 		return false;
--- a/drivers/gpu/drm/i915/i915_gem.c
+++ b/drivers/gpu/drm/i915/i915_gem.c
@@ -3982,7 +3982,7 @@ intel_enable_ppgtt(struct drm_device *de
 	if (i915_enable_ppgtt >= 0)
 		return i915_enable_ppgtt;
 
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 	/* Disable ppgtt on SNB if VT-d is on. */
 	if (INTEL_INFO(dev)->gen == 6 && intel_iommu_gfx_mapped)
 		return false;
--- a/drivers/gpu/drm/i915/i915_gem_gtt.c
+++ b/drivers/gpu/drm/i915/i915_gem_gtt.c
@@ -585,7 +585,7 @@ static int setup_scratch_page(struct drm
 	get_page(page);
 	set_pages_uc(page, 1);
 
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 	dma_addr = pci_map_page(dev->pdev, page, 0, PAGE_SIZE,
 				PCI_DMA_BIDIRECTIONAL);
 	if (pci_dma_mapping_error(dev->pdev, dma_addr))
--- a/include/drm/intel-gtt.h
+++ b/include/drm/intel-gtt.h
@@ -43,7 +43,7 @@ void intel_gtt_clear_range(unsigned int
 /* flag for GFDT type */
 #define AGP_USER_CACHED_MEMORY_GFDT (1 << 3)
 
-#ifdef CONFIG_INTEL_IOMMU
+#ifdef CONFIG_DMAR
 extern int intel_iommu_gfx_mapped;
 #endif
 
