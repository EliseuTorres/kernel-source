From f030122c9bbd08edfc209ccb0b66a64bd52963bc Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Sun, 12 Sep 2010 17:16:17 +0100
Patch-mainline: 2.6.37
References: fate#310916
Git-commit: 6edc3242e35f03990e362e7c115e722717f0f7a7
Subject: [PATCH 1397/2588] drm/i915/bios: Prevent NULL dereference after
 allocation failure

Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit 6edc3242e35f03990e362e7c115e722717f0f7a7)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/intel_bios.c |    2 ++
 1 files changed, 2 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/intel_bios.c b/drivers/gpu/drm/i915/intel_bios.c
index 8d7deca..8986a4b 100644
--- a/drivers/gpu/drm/i915/intel_bios.c
+++ b/drivers/gpu/drm/i915/intel_bios.c
@@ -169,6 +169,8 @@ parse_lfp_panel_data(struct drm_i915_private *dev_priv,
 			((unsigned char *)entry + dvo_timing_offset);
 
 	panel_fixed_mode = kzalloc(sizeof(*panel_fixed_mode), GFP_KERNEL);
+	if (!panel_fixed_mode)
+		return;
 
 	fill_detail_timing_data(panel_fixed_mode, dvo_timing);
 
-- 
1.7.6

