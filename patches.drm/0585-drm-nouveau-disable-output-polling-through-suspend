From 4bfb94a1b40e694284df3ea7dfb66ce6252b6008 Mon Sep 17 00:00:00 2001
From: Maxim Levitsky <maximlevitsky@gmail.com>
Date: Sun, 9 Oct 2011 22:58:33 +0200
Subject: drm/nouveau: disable output polling through suspend.
Git-commit: 4bfb94a1b40e694284df3ea7dfb66ce6252b6008
Patch-mainline: v3.3-rc1

Because doing polling while hardware is disabled is a bad idea...

Signed-off-by: Maxim Levitsky <maximlevitsky@gmail.com>
Signed-off-by: Ben Skeggs <bskeggs@redhat.com>
Acked-by: Michal Srb <msrb@suse.com>
---
 drivers/gpu/drm/nouveau/nouveau_drv.c |    3 +++
 1 files changed, 3 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/nouveau/nouveau_drv.c b/drivers/gpu/drm/nouveau/nouveau_drv.c
index f0a60af..982505b 100644
--- a/drivers/gpu/drm/nouveau/nouveau_drv.c
+++ b/drivers/gpu/drm/nouveau/nouveau_drv.c
@@ -178,6 +178,8 @@ nouveau_pci_suspend(struct pci_dev *pdev, pm_message_t pm_state)
 	if (dev->switch_power_state == DRM_SWITCH_POWER_OFF)
 		return 0;
 
+	drm_kms_helper_poll_disable(dev);
+
 	NV_INFO(dev, "Disabling fbcon acceleration...\n");
 	nouveau_fbcon_save_disable_accel(dev);
 
@@ -385,6 +387,7 @@ nouveau_pci_resume(struct pci_dev *pdev)
 	drm_helper_resume_force_mode(dev);
 
 	nouveau_fbcon_restore_accel(dev);
+	drm_kms_helper_poll_enable(dev);
 	return 0;
 }
 

