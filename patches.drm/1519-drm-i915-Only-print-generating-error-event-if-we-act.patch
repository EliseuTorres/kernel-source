From ab5ddf17f05dcaddd53ce5d062c307a1b7e4486c Mon Sep 17 00:00:00 2001
From: Chris Wilson <chris@chris-wilson.co.uk>
Date: Fri, 1 Oct 2010 13:23:27 +0100
Patch-mainline: 2.6.37
References: fate#310916
Git-commit: 2fa772f34042cd4ddfb4ffaf5c24f0ce8c1025e9
Subject: [PATCH 1519/2588] drm/i915: Only print 'generating error event' if
 we actually are

Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
(cherry picked from commit 2fa772f34042cd4ddfb4ffaf5c24f0ce8c1025e9)

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---
 drivers/gpu/drm/i915/i915_irq.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_irq.c b/drivers/gpu/drm/i915/i915_irq.c
index aaa0f1b..64c07c2 100644
--- a/drivers/gpu/drm/i915/i915_irq.c
+++ b/drivers/gpu/drm/i915/i915_irq.c
@@ -396,7 +396,6 @@ static void i915_error_work_func(struct work_struct *work)
 	char *reset_event[] = { "RESET=1", NULL };
 	char *reset_done_event[] = { "ERROR=0", NULL };
 
-	DRM_DEBUG_DRIVER("generating error event\n");
 	kobject_uevent_env(&dev->primary->kdev.kobj, KOBJ_CHANGE, error_event);
 
 	if (atomic_read(&dev_priv->mm.wedged)) {
@@ -574,8 +573,10 @@ static void i915_capture_error_state(struct drm_device *dev)
 		return;
 	}
 
+	DRM_DEBUG_DRIVER("generating error event\n");
+
 	error->seqno =
-	       	dev_priv->render_ring.get_seqno(dev, &dev_priv->render_ring);
+		dev_priv->render_ring.get_seqno(dev, &dev_priv->render_ring);
 	error->eir = I915_READ(EIR);
 	error->pgtbl_er = I915_READ(PGTBL_ER);
 	error->pipeastat = I915_READ(PIPEASTAT);
-- 
1.7.6

