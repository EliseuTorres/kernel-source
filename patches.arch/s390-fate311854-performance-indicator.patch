From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: kernel: display capacity adjustment indicator in /proc/sysinfo
References: bnc#700080,LTC#69454,FATE#311854
Patch-mainline: Yes

Description: Display machine capacity adjustment indicator and capacity
             change reason if available in /proc/sysinfo.

Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/include/asm/sysinfo.h |    5 ++++-
 arch/s390/kernel/sysinfo.c      |    7 +++++++
 2 files changed, 11 insertions(+), 1 deletion(-)

--- a/arch/s390/include/asm/sysinfo.h
+++ b/arch/s390/include/asm/sysinfo.h
@@ -15,7 +15,10 @@
 #define __ASM_S390_SYSINFO_H
 
 struct sysinfo_1_1_1 {
-	char reserved_0[32];
+	unsigned short :16;
+	unsigned char ccr;
+	unsigned char cai;
+	char reserved_0[28];
 	char manufacturer[16];
 	char type[4];
 	char reserved_1[12];
--- a/arch/s390/kernel/sysinfo.c
+++ b/arch/s390/kernel/sysinfo.c
@@ -73,6 +73,13 @@ static int stsi_1_1_1(struct sysinfo_1_1
 			       "Model Temp. Capacity: %-16.16s %08u\n",
 			       info->model_temp_cap,
 			       *(u32 *) info->model_temp_cap_rating);
+	if (info->cai) {
+		len += sprintf(page + len,
+			       "Capacity Adj. Ind.:   %d\n",
+			       info->cai);
+		len += sprintf(page + len, "Capacity Ch. Reason:  %d\n",
+			       info->ccr);
+	}
 	return len;
 }
 
