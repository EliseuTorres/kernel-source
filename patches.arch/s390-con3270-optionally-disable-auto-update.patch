From: Hannes Reinecke <hare@suse.de>
Date: Fri, 14 Mar 2014 12:21:08 +0100
Subject: [PATCH] con3270: optionally disable auto update
References: bnc#868409
Patch-Mainline: not yet

This patch adds a parameter 'auto_update' to the con3270
driver, causing the 'auto_update' feature to be disabled
if unset.
The 'auto_update' feature will cause the con3270 driver
to switch to the console view whenever new system messages
are display, which makes working on the 3270 terminal
awkward.

Signed-off-by: Hannes Reinecke <hare@suse.de>

diff --git a/drivers/s390/char/con3270.c b/drivers/s390/char/con3270.c
index 699fd3e..f54ee3f 100644
--- a/drivers/s390/char/con3270.c
+++ b/drivers/s390/char/con3270.c
@@ -7,6 +7,7 @@
  *     Copyright IBM Corp. 2003, 2009
  */
 
+#include <linux/module.h>
 #include <linux/console.h>
 #include <linux/init.h>
 #include <linux/interrupt.h>
@@ -30,6 +31,9 @@
 
 static struct raw3270_fn con3270_fn;
 
+static bool auto_update = 1;
+module_param(auto_update, bool, 0);
+
 /*
  * Main 3270 console view data structure.
  */
@@ -379,6 +383,9 @@ con3270_activate(struct raw3270_view *view)
 {
 	struct con3270 *cp;
 
+	if (!auto_update)
+		return 0;
+
 	cp = (struct con3270 *) view;
 	cp->update_flags = CON_UPDATE_ALL;
 	con3270_set_timer(cp, 1);
