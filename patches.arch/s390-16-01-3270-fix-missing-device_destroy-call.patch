From: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
Subject: fs3270: unloading module does not remove device
Patch-mainline: v3.13-rc1
Git-commit: d1e61fe49fd450be15d402ac353784f5ba8a624e
References: bnc#851879, LTC#100284

Description:  fs3270: unloading module does not remove device
Symptom:      Reloading the fs3270 kernel module results in the following
              kernel warning: "sysfs: cannot create duplicate filename
              '/devices/virtual/3270/3270!tub'".
Problem:      At module unload, the fs3270 device is not removed.  When
              loading the module again, creating the same device fails
              with the aforementioned kernel warning.
Solution:     Remove the device at module unload.
Reproduction: 1. Load the fs3270 module with: modprobe fs3270
              2. Remove the module with: modprobe -r fs3270
              3. Load the fs3270 module again with: modprobe fs3270
              4. Check the dmesg output for the aforementioned kernel
                 warning message

Signed-off-by: Hendrik Brueckner <brueckner@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/char/fs3270.c |    1 +
 1 file changed, 1 insertion(+)

--- a/drivers/s390/char/fs3270.c
+++ b/drivers/s390/char/fs3270.c
@@ -563,6 +563,7 @@ static void __exit
 fs3270_exit(void)
 {
 	raw3270_unregister_notifier(&fs3270_notifier);
+	device_destroy(class3270, MKDEV(IBM_FS3270_MAJOR, 0));
 	__unregister_chrdev(IBM_FS3270_MAJOR, 0, 1, "fs3270");
 }
 
