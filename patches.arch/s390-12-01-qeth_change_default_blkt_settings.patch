From: Stefan Raspl <raspl@linux.vnet.ibm.com>
Subject: qeth: change default standard blkt settings for OSA Express
Patch-mainline: v3.11-rc1
Git-commit: a0c98523d7d71e0276f3cb127bc0c6d4fc85907a
References: bnc#835175, LTC#96808

Description:  qeth: change default standard blkt settings for OSA Express
Symptom:      Later generation OSA Express cards experience too high CPU cost
              due to sub-optimal blkt settings.
Problem:      Per default, later generation OSA Express cards will use the
              blkt settings of the earliest generation of cards, which is
              likely to be inappropriate.
Solution:     Apply the most recent blkt settings to future-generation OSA
              Express cards.
Reproduction: Measure CPU utilization of inbound traffic and compare with
              earlier generation cards.

Signed-off-by: Stefan Raspl <raspl@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/net/qeth_core_main.c |   10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

--- a/drivers/s390/net/qeth_core_main.c
+++ b/drivers/s390/net/qeth_core_main.c
@@ -1726,14 +1726,14 @@ static void qeth_configure_blkt_default(
 	QETH_DBF_TEXT(SETUP, 2, "cfgblkt");
 
 	if (prcd[74] == 0xF0 && prcd[75] == 0xF0 &&
-	    (prcd[76] == 0xF5 || prcd[76] == 0xF6)) {
-		card->info.blkt.time_total = 250;
-		card->info.blkt.inter_packet = 5;
-		card->info.blkt.inter_packet_jumbo = 15;
-	} else {
+	    prcd[76] >= 0xF1 && prcd[76] <= 0xF4) {
 		card->info.blkt.time_total = 0;
 		card->info.blkt.inter_packet = 0;
 		card->info.blkt.inter_packet_jumbo = 0;
+	} else {
+		card->info.blkt.time_total = 250;
+		card->info.blkt.inter_packet = 5;
+		card->info.blkt.inter_packet_jumbo = 15;
 	}
 }
 
