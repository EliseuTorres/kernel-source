From: Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
Subject: cpuidle/powerpc: Fix target residency initialisation in pseries cpuidle
Git-commit: 817deb05df45577d4037230f2facee486c11d9df
Patch-mainline: yes
References: fate#314019,bnc#795230

    Remove the redundant target residency initialisation in pseries_cpuidle_driver_init().
    This is currently over-writing the residency time updated as part of the static
    table, resulting in  all the idle states having the same target
    residency of 100us which is incorrect. This may result in the menu governor making
    wrong state decisions.

Signed-off-by: Deepthi Dharwar <deepthi@linux.vnet.ibm.com>
Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Acked-by: Torsten Duwe <duwe@suse.de>
---

 arch/powerpc/platforms/pseries/processor_idle.c |    4 ----
 1 file changed, 4 deletions(-)


diff --git a/arch/powerpc/platforms/pseries/processor_idle.c b/arch/powerpc/platforms/pseries/processor_idle.c
index 7c755f9..b581daf 100644
--- a/arch/powerpc/platforms/pseries/processor_idle.c
+++ b/arch/powerpc/platforms/pseries/processor_idle.c
@@ -229,10 +229,6 @@ static int pseries_cpuidle_driver_init(void)
 		drv->states[drv->state_count] =	/* structure copy */
 			cpuidle_state_table[idle_state];
 
-		if (cpuidle_state_table == dedicated_states)
-			drv->states[drv->state_count].target_residency =
-				__get_cpu_var(smt_snooze_delay);
-
 		drv->state_count += 1;
 	}
 
