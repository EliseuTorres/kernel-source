From: Harald Freudenberger <freude@linux.vnet.ibm.com>
Subject: s390/crypto: fix stckf loop
Patch-mainline: v4.1-rc5
Git-commit: c431761dddff87039edb3300b9b29d1f9e0af2c9
References: bsc#934549,FATE#318042,LTC#SEC1223

Summary:     kernel: Introduce new SHA-512 based Pseudo Random Generator.
Description: Rework of the prandom device with introduction
             of a new SHA-512 based NIST SP 800-90 conform
             deterministic random bit generator.

Upstream-Description:

             s390/crypto: fix stckf loop

             The store-clock-fast loop in generate_entropy() mixes (exors)
             only the first 64 bytes of the initial page before doing the
             first SHA256. Fix the loop to mix the store-clock-fast values
             all over the page.

             Signed-off-by: Harald Freudenberger <freude@linux.vnet.ibm.com>
             Reported-by: David Binderman <dcb314@hotmail.com>
             Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>


Signed-off-by: Harald Freudenberger <freude@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/crypto/prng.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/s390/crypto/prng.c
+++ b/arch/s390/crypto/prng.c
@@ -125,7 +125,7 @@ static int generate_entropy(u8 *ebuf, si
 		/* fill page with urandom bytes */
 		get_random_bytes(pg, PAGE_SIZE);
 		/* exor page with stckf values */
-		for (n = 0; n < sizeof(PAGE_SIZE/sizeof(u64)); n++) {
+		for (n = 0; n < PAGE_SIZE / sizeof(u64); n++) {
 			u64 *p = ((u64 *)pg) + n;
 			*p ^= get_tod_clock_fast();
 		}
