From: Laurent Dufour <ldufour@linux.vnet.ibm.com>
Subject: powerpc/xmon: Fix another endiannes issue in RTAS call from xmon
Git-commit: e6eb2eba494d6f99e69ca3c3748cd37a2544ab38
Patch-mainline: v3.19-rc7 
References: bsc#915188

The commit 3b8a3c010969 ("powerpc/pseries: Fix endiannes issue in RTAS
call from xmon") was fixing an endianness issue in the call made from
xmon to RTAS.

However, as Michael Ellerman noticed, this fix was not complete, the
token value was not byte swapped. This lead to call an unexpected and
most of the time unexisting RTAS function, which is silently ignored by
RTAS.

This fix addresses this hole.

Reported-by: Michael Ellerman <mpe@ellerman.id.au>
Cc: stable@vger.kernel.org
Signed-off-by: Laurent Dufour <ldufour@linux.vnet.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Acked-by: Dinar Valeev <dvaleev@suse.com>

Index: linux-3.12-SLE12/arch/powerpc/xmon/xmon.c
===================================================================
--- linux-3.12-SLE12.orig/arch/powerpc/xmon/xmon.c
+++ linux-3.12-SLE12/arch/powerpc/xmon/xmon.c
@@ -292,6 +292,7 @@ static inline void disable_surveillance(
 	args.token = rtas_token("set-indicator");
 	if (args.token == RTAS_UNKNOWN_SERVICE)
 		return;
+	args.token = cpu_to_be32(args.token);
 	args.nargs = cpu_to_be32(3);
 	args.nret = cpu_to_be32(1);
 	args.rets = &args.args[3];
