From: trenn@suse.de
Subject: acpi processor: Avoid WARN message on processor driver removal
References: fate#311831,bnc#703100
Patch-Mainline: no

Only unregister acpi_idle driver if acpi_idle driver got
registered. On latest Nehalem/Sandybridge this is not the case,
but the intel_idle driver is used instead.

Signed-off-by: Thomas Renninger <trenn@suse.de>

---
 drivers/acpi/processor_core.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: linux-2.6.32-SLE11-SP2/drivers/acpi/processor_core.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/drivers/acpi/processor_core.c
+++ linux-2.6.32-SLE11-SP2/drivers/acpi/processor_core.c
@@ -1187,7 +1187,8 @@ static int __init acpi_processor_init(vo
 	return 0;
 
 out_cpuidle:
-	cpuidle_unregister_driver(&acpi_idle_driver);
+	if (cpuidle_get_driver() == &acpi_idle_driver)
+		cpuidle_unregister_driver(&acpi_idle_driver);
 
 #ifdef CONFIG_ACPI_PROCFS
 	remove_proc_entry(ACPI_PROCESSOR_CLASS, acpi_root_dir);
@@ -1209,7 +1210,8 @@ static void __exit acpi_processor_exit(v
 
 	acpi_bus_unregister_driver(&acpi_processor_driver);
 
-	cpuidle_unregister_driver(&acpi_idle_driver);
+	if (cpuidle_get_driver() == &acpi_idle_driver)
+		cpuidle_unregister_driver(&acpi_idle_driver);
 
 #ifdef CONFIG_ACPI_PROCFS
 	remove_proc_entry(ACPI_PROCESSOR_CLASS, acpi_root_dir);
