From: trenn@suse.de
Subject: acpi processor: Avoid WARN message on processor driver removal
References: fate#311831,bnc#703100
Patch-Mainline: no

Only unregister acpi_idle driver if acpi_idle driver got
registered. On latest Nehalem/Sandybridge this is not the case,
but the intel_idle driver is used instead.

Signed-off-by: Thomas Renninger <trenn@suse.de>

---
 drivers/acpi/processor_driver.c |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/drivers/acpi/processor_driver.c
+++ b/drivers/acpi/processor_driver.c
@@ -823,7 +823,8 @@ static int __init acpi_processor_init(vo
 	return 0;
 
 out_cpuidle:
-	cpuidle_unregister_driver(&acpi_idle_driver);
+	if (cpuidle_get_driver() == &acpi_idle_driver)
+		cpuidle_unregister_driver(&acpi_idle_driver);
 
 	return result;
 }
@@ -841,7 +842,8 @@ static void __exit acpi_processor_exit(v
 
 	acpi_bus_unregister_driver(&acpi_processor_driver);
 
-	cpuidle_unregister_driver(&acpi_idle_driver);
+	if (cpuidle_get_driver() == &acpi_idle_driver)
+		cpuidle_unregister_driver(&acpi_idle_driver);
 
 	return;
 }
