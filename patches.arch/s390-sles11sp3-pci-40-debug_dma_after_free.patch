From: Sebastian Ott <sebott@linux.vnet.ibm.com>
Subject: s390/dma: do not call debug_dma after free
Patch-mainline: v3.10-rc5
Git-commit: abd9a0c36028771a8f397f38bf79bfcf404f957f
References: bnc#848335,FATE#83037,LTC#94737

In dma_free_coherent call debug_dma_free_coherent before deallocating
the memory to avoid a possible use after free.

Reviewed-by: Gerald Schaefer <gerald.schaefer@de.ibm.com>
Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/include/asm/dma-mapping.h |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/s390/include/asm/dma-mapping.h
+++ b/arch/s390/include/asm/dma-mapping.h
@@ -69,8 +69,8 @@ static inline void dma_free_coherent(str
 {
 	struct dma_map_ops *dma_ops = get_dma_ops(dev);
 
-	dma_ops->free_coherent(dev, size, cpu_addr, dma_handle);
 	debug_dma_free_coherent(dev, size, cpu_addr, dma_handle);
+	dma_ops->free_coherent(dev, size, cpu_addr, dma_handle);
 }
 
 #endif /* _ASM_S390_DMA_MAPPING_H */
