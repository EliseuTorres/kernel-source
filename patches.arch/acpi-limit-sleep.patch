commit a842be9f49eb462bb1ea8aa2339d24ab9dd3042b
From: Alexey Starikovskiy <astarikovskiy@suse.de>
Author: Alexey Starikovskiy <astarikovskiy@suse.de>
Date:   Thu Jun 24 20:34:50 2010 +0400

Subject: [ACPI] Add constraints on usage of ACPI Sleep function
    
    Panasonic Toughbook CF-52 may use uninitialized variable as argument
    to Sleep(), thus stopping init sequence for about 45 days (0xf0000def ms).
    Add constraints to not sleep that long, and also to not sleep during init.
    
    References: http://bugzilla.novell.com/show_bug.cgi?id=557710
    	    http://bugzilla.kernel.org/show_bug.cgi?id=13195
    Signed-off-by: Alexey Starikovskiy <astarikovskiy@suse.de>

diff --git a/drivers/acpi/osl.c b/drivers/acpi/osl.c
index 78418ce..304d668 100644
--- a/drivers/acpi/osl.c
+++ b/drivers/acpi/osl.c
@@ -438,7 +438,15 @@ acpi_status acpi_os_remove_interrupt_handler(u32 irq, acpi_osd_handler handler)
 
 void acpi_os_sleep(u64 ms)
 {
-	schedule_timeout_interruptible(msecs_to_jiffies(ms));
+	if (ms > 1000) {
+		printk(KERN_WARNING FW_BUG
+			"ACPI: Limit %lld sleep to 1 second\n", ms);
+		ms = 1000;
+	}
+	if (system_state == SYSTEM_RUNNING)
+		schedule_timeout_interruptible(msecs_to_jiffies(ms));
+	else
+		acpi_os_stall(ms * 1000);
 }
 
 void acpi_os_stall(u32 us)
