From: Michael Holzheu <holzheu@linux.vnet.ibm.com>
Subject: [S390] kdump: Replace is_kdump_kernel() with OLDMEM_BASE check
Date:   Thu Dec 1 13:32:14 2011 +0100
Patch-mainline: v3.2-rc5
Git-commit: 5f894cbb6890d317699aa622b4dc9d73d009cd22
References: bnc#786472,ltc#82694,fate#314077
    
In order to have the same behavior for kdump based stand-alone dump
as for the kexec method, the is_kdump_kernel() check (only true for
the kexec method) has to be replaced by the OLDMEM_BASE check (true
for both methods).

Signed-off-by: Michael Holzheu <holzheu@linux.vnet.ibm.com>
Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: John L. Jolly <jjolly@suse.de>

---
 arch/s390/kernel/setup.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/s390/kernel/setup.c
+++ b/arch/s390/kernel/setup.c
@@ -587,7 +587,7 @@ static unsigned long __init find_crash_b
 		*msg = "first memory chunk must be at least crashkernel size";
 		return 0;
 	}
-	if (is_kdump_kernel() && (crash_size == OLDMEM_SIZE))
+	if (OLDMEM_BASE && crash_size == OLDMEM_SIZE)
 		return OLDMEM_BASE;
 
 	for (i = MEMORY_CHUNKS - 1; i >= 0; i--) {
