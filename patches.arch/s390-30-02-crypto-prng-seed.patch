From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: crypto: prng error in initial seed calculation.
References: bnc#696586,LTC#72362
Patch-mainline: Yes

Symptom:     Since the seed contains at least 8 bytes from the kernel random
             pool the initial state of the random number generator is
             unpredictable without knowing the seed so there is no visible
             symptom.
Problem:     If the prng is seeded with more than 8 bytes the offset
             calculation is wrong resulting in an access beyond the
             end of the kernel stack. Although the accessed data is
             presumably random this weakens the quality of the inital
             seed for the random number generator.
Solution:    Fix the offset calculation for a seed longer than 8 bytes.

Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/crypto/prng.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/arch/s390/crypto/prng.c
+++ b/arch/s390/crypto/prng.c
@@ -77,7 +77,7 @@ static void prng_seed(int nbytes)
 
 	/* Add the entropy */
 	while (nbytes >= 8) {
-		*((__u64 *)parm_block) ^= *((__u64 *)buf+i*8);
+		*((__u64 *)parm_block) ^= *((__u64 *)(buf+i));
 		prng_add_entropy();
 		i += 8;
 		nbytes -= 8;
