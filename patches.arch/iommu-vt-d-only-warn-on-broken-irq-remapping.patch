From: Jean Delvare <jdelvare@suse.de>
Subject: iommu/vt-d: Only warn about broken interrupt remapping
References: bnc#844513
Patch-mainline: Never

Upstream decided to plain disable interrupt remapping when the
hardware is known to be broken in this respect. We can't really do
that in a SLE11 maintenance kernel update, as it could break running
systems. So we'll only print a warning and make disabling the feature
an opt-in decision by the customer.

For SLE12 this patch should be dropped to return to upstream's
behavior.

For SLE11 SP4 this can be discussed. If we drop this patch there, the
change will have to be documented in the release notes.
---
 drivers/pci/intr_remapping.c |    5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

--- a/drivers/pci/intr_remapping.c
+++ b/drivers/pci/intr_remapping.c
@@ -537,11 +537,10 @@ int __init intr_remapping_supported(void
 			"This system BIOS has enabled interrupt remapping\n"
 			"on a chipset that contains an erratum making that\n"
 			"feature unstable.  To maintain system stability\n"
-			"interrupt remapping is being disabled.  Please\n"
+			"interrupt remapping should be disabled.  You can\n"
+			"do so by booting with parameter intremap=off.  Please\n"
 			"contact your BIOS vendor for an update\n");
 		add_taint(TAINT_FIRMWARE_WORKAROUND);
-		disable_intremap = 1;
-		return 0;
 	}
 
 	if (!dmar_ir_support())
