From: Niklas Söderlund <niklas.soderlund@ericsson.com>
Subject: ACPI, APEI, EINJ Allow empty Trigger Error Action Table
References: bnc#788160
Patch-Mainline: v3.3-rc2
Git-commit: 4c40aed869a200a621b53bcb491c5ee8a34ef5f1


Signed-off-by: Thomas Renninger <trenn@suse.de>

According to the ACPI spec [1] section 18.6.4 the TRIGGER_ERROR action
table can consists of zero elements.

[1] Advanced Configuration and Power Interface Specification
    Revision 5.0, December 6, 2011
	http://www.acpi.info/DOWNLOADS/ACPIspec50.pdf

Signed-off-by: Niklas Söderlund <niklas.soderlund@ericsson.com>
Acked-by: Huang Ying <ying.huang@intel.com>
Signed-off-by: Len Brown <len.brown@intel.com>

---
 drivers/acpi/apei/einj.c |    7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

Index: linux-3.0-SLE11-SP3/drivers/acpi/apei/einj.c
===================================================================
--- linux-3.0-SLE11-SP3.orig/drivers/acpi/apei/einj.c
+++ linux-3.0-SLE11-SP3/drivers/acpi/apei/einj.c
@@ -184,7 +184,7 @@ static int einj_check_trigger_header(str
 	if (trigger_tab->header_size != sizeof(struct acpi_einj_trigger))
 		return -EINVAL;
 	if (trigger_tab->table_size > PAGE_SIZE ||
-	    trigger_tab->table_size <= trigger_tab->header_size)
+	    trigger_tab->table_size < trigger_tab->header_size)
 		return -EINVAL;
 	if (trigger_tab->entry_count !=
 	    (trigger_tab->table_size - trigger_tab->header_size) /
@@ -247,6 +247,11 @@ static int __einj_error_trigger(u64 trig
 			   "The trigger error action table is invalid\n");
 		goto out_rel_header;
 	}
+
+	/* No action structures in the TRIGGER_ERROR table, nothing to do */
+	if (!trigger_tab->entry_count)
+		goto out_rel_header;
+
 	rc = -EIO;
 	table_size = trigger_tab->table_size;
 	r = request_mem_region(trigger_paddr + sizeof(*trigger_tab),
