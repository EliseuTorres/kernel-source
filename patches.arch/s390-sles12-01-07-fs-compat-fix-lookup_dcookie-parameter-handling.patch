From: Heiko Carstens <heiko.carstens@de.ibm.com>
Subject: kernel: fix compat lookup_dcookie system call
Patch-mainline: v3.14-rc1
Git-commit: d8d14bd09cddbaf0168d61af638455a26bd027ff
References: bnc#860346,LTC#103626

Description:  kernel: fix compat lookup_dcookie system call
Symptom:      The lookup_dcookie system call may not work for 32 bit
              applications.
Problem:      Zero extension for the "len" parameter of the lookup_dcookie
              system call is missing. Therefore random values for the "len"
              parameter may be used when calling the native lookup_dcookie
              system call. Therefore the system call may incorrectly return
              -EFAULT.
Solution:     Change the type of the "len" parameter to compat_ulong_t.
Reproduction: -

Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 fs/dcookies.c          |    2 +-
 include/linux/compat.h |    2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

--- a/fs/dcookies.c
+++ b/fs/dcookies.c
@@ -204,7 +204,7 @@ out:
 }
 
 #ifdef CONFIG_COMPAT
-COMPAT_SYSCALL_DEFINE4(lookup_dcookie, u32, w0, u32, w1, char __user *, buf, size_t, len)
+COMPAT_SYSCALL_DEFINE4(lookup_dcookie, u32, w0, u32, w1, char __user *, buf, compat_size_t, len)
 {
 #ifdef __BIG_ENDIAN
 	return sys_lookup_dcookie(((u64)w0 << 32) | w1, buf, len);
--- a/include/linux/compat.h
+++ b/include/linux/compat.h
@@ -422,7 +422,7 @@ extern long compat_arch_ptrace(struct ta
 asmlinkage long compat_sys_ptrace(compat_long_t request, compat_long_t pid,
 				  compat_long_t addr, compat_long_t data);
 
-asmlinkage long compat_sys_lookup_dcookie(u32, u32, char __user *, size_t);
+asmlinkage long compat_sys_lookup_dcookie(u32, u32, char __user *, compat_size_t);
 /*
  * epoll (fs/eventpoll.c) compat bits follow ...
  */
