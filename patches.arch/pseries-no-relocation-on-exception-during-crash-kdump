From: Mahesh Salgaonkar <mahesh@linux.vnet.ibm.com>
Subject: powerpc/pseries: Disable relocation on exception while going down during crash
Git-commit: 3ec8b78fcc5aa7745026d8d85a4e9ab52c922765
Patch-mainline: 3.14-rc3
References: bnc#863534 

    Disable relocation on exception while going down even in kdump case. This
    is because we are about clear htab mappings while kexec-ing into kdump
    kernel and we may run into issues if we still have AIL ON.
    
Signed-off-by: Mahesh Salgaonkar <mahesh@linux.vnet.ibm.com>
Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Acked-by: Torsten Duwe <duwe@suse.de>

 arch/powerpc/platforms/pseries/setup.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)
Index: linux-3.12-SLE12/arch/powerpc/platforms/pseries/setup.c
===================================================================
--- linux-3.12-SLE12.orig/arch/powerpc/platforms/pseries/setup.c
+++ linux-3.12-SLE12/arch/powerpc/platforms/pseries/setup.c
@@ -430,8 +430,7 @@ static void pSeries_machine_kexec(struct
 {
 	long rc;
 
-	if (firmware_has_feature(FW_FEATURE_SET_MODE) &&
-	    (image->type != KEXEC_TYPE_CRASH)) {
+	if (firmware_has_feature(FW_FEATURE_SET_MODE)) {
 		rc = pSeries_disable_reloc_on_exc();
 		if (rc != H_SUCCESS)
 			pr_warning("Warning: Failed to disable relocation on "
