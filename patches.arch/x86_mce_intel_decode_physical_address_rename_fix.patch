From: H. Peter Anvin <hpa@zytor.com>
Subject: x86, mce: Rename cpu_specific_poll to mce_cpu_specific_poll
Patch-Mainline: submitted to x86-tip, added but reverted due to a minor compile issue
		which gets fixed by and incremental patch
References: bnc#573380, fate#307738

http://lkml.org/lkml/2010/1/22/99

cpu_specific_poll is a global variable, and it should have a global
namespace name.  Since it is MCE-specific (it takes a struct mce *),
rename it mce_cpu_specific_poll.

Signed-off-by: Thomas Renninger <trenn@suse.de>

---
 arch/x86/kernel/cpu/mcheck/mce-internal.h |    2 +-
 arch/x86/kernel/cpu/mcheck/mce-xeon75xx.c |    4 ++--
 arch/x86/kernel/cpu/mcheck/mce.c          |    8 ++++----
 3 files changed, 7 insertions(+), 7 deletions(-)

Index: linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce-internal.h
===================================================================
--- linux-2.6.32-master.orig/arch/x86/kernel/cpu/mcheck/mce-internal.h
+++ linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce-internal.h
@@ -28,4 +28,4 @@ extern int mce_ser;
 
 extern struct mce_bank *mce_banks;
 
-extern void (*cpu_specific_poll)(struct mce *);
+extern void (*mce_cpu_specific_poll)(struct mce *);
Index: linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce-xeon75xx.c
===================================================================
--- linux-2.6.32-master.orig/arch/x86/kernel/cpu/mcheck/mce-xeon75xx.c
+++ linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce-xeon75xx.c
@@ -396,7 +396,7 @@ static int __init xeon75xx_mce_init(void
 	pr_info("Found Xeon75xx PFA memory error translation table at %x\n",
 		addr);
 	mb();
-	cpu_specific_poll = xeon75xx_mce_poll;
+	mce_cpu_specific_poll = xeon75xx_mce_poll;
 	return 0;
 
 error_unmap:
@@ -412,7 +412,7 @@ MODULE_DESCRIPTION("Intel Xeon 75xx spec
 #ifdef CONFIG_MODULE
 static void __exit xeon75xx_mce_exit(void)
 {
-	cpu_specific_poll = NULL;
+	mce_cpu_specific_poll = NULL;
 	wmb();
 	/* Wait for all machine checks to finish before really unloading */
 	synchronize_rcu();
Index: linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce.c
===================================================================
--- linux-2.6.32-master.orig/arch/x86/kernel/cpu/mcheck/mce.c
+++ linux-2.6.32-master/arch/x86/kernel/cpu/mcheck/mce.c
@@ -84,8 +84,8 @@ static char			*mce_helper_argv[2] = { mc
 static DECLARE_WAIT_QUEUE_HEAD(mce_wait);
 static DEFINE_PER_CPU(struct mce, mces_seen);
 static int			cpu_missing;
-void				(*cpu_specific_poll)(struct mce *);
-EXPORT_SYMBOL_GPL(cpu_specific_poll);
+void				(*mce_cpu_specific_poll)(struct mce *);
+EXPORT_SYMBOL_GPL(mce_cpu_specific_poll);
 
 static void default_decode_mce(struct mce *m)
 {
@@ -561,8 +561,8 @@ void machine_check_poll(enum mcp_flags f
 		if (!(flags & MCP_TIMESTAMP))
 			m.tsc = 0;
 
-		if (cpu_specific_poll && !under_injection() && !mce_dont_log_ce)
-			cpu_specific_poll(&m);
+		if (mce_cpu_specific_poll && !under_injection() && !mce_dont_log_ce)
+			mce_cpu_specific_poll(&m);
 
 		/*
 		 * Don't get the IP here because it's unlikely to
