From: Thomas Renninger <trenn@suse.de>
Subject: X86 Intel microcode: Do not request firmware by default
References: bnc#777887,bnc#719291
Patch-Mainline: never

Pass microcode.firmware_request=1 to activate microcode loading via
firmware_request again. In SLE11 the microcode.ctl service updates
the microcode via /sbin/microcode_ctl (/dev/cpu/microcode).
The request firmware is unused, but may cause false positive warnings like:
Cannot find  firmware file 'intel-ucode/06-2d-07' from udev's firmware.sh
script.
Therefore it is switched off by default, but can get activated via:
microcode.firmware_request=1 boot parameter

---
 arch/x86/kernel/microcode_intel.c |   16 ++++++++++++++++
 1 file changed, 16 insertions(+)

Index: linux-3.0-SLE11-SP2/arch/x86/kernel/microcode_intel.c
===================================================================
--- linux-3.0-SLE11-SP2.orig/arch/x86/kernel/microcode_intel.c
+++ linux-3.0-SLE11-SP2/arch/x86/kernel/microcode_intel.c
@@ -415,6 +415,19 @@ static int get_ucode_fw(void *to, const
 	return 0;
 }
 
+/*
+ * Pass microcode.firmware_request=1 to activate microcode loading via
+ * firmware_request. In SLE11 the microcode.ctl service updates the microcode
+ * via /sbin/microcode_ctl (/dev/cpu/microcode).
+ * The request firmware is unused, but may cause false positive warnings like:
+ * Cannot find  firmware file 'intel-ucode/06-2d-07' from udev's firmware.sh
+ * script.
+ * Therefore it is switched off by default, but can get activated via:
+ * microcode.firmware_request=1 boot parameter
+ */
+static unsigned int firmware_request;
+module_param(firmware_request, uint, 0444);
+
 static enum ucode_state request_microcode_fw(int cpu, struct device *device)
 {
 	char name[30];
@@ -422,6 +435,9 @@ static enum ucode_state request_microcod
 	const struct firmware *firmware;
 	enum ucode_state ret;
 
+	if (firmware_request == 0)
+		return UCODE_NFOUND;
+
 	sprintf(name, "intel-ucode/%02x-%02x-%02x",
 		c->x86, c->x86_model, c->x86_mask);
 
