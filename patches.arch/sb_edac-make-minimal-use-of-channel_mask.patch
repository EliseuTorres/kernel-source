From: Aristeu Rozanski <aris@redhat.com>
Date: Mon, 2 Jun 2014 15:15:28 -0300
Subject: sb_edac: make minimal use of channel_mask
Git-commit: d7c660b7dcb2f3c3835432cf733fba03507f4387
Patch-mainline: v3.17-rc1
References: fate#318187

channel_mask will be used in the future to determine which group of memory
modules is causing the errors since when mirroring, lockstep and close page
are enabled you can't. While that doesn't happen, use the channel_mask to
determine the channel instead of relying on the MC event/exception.

Cc: Tony Luck <tony.luck@intel.com>
Signed-off-by: Aristeu Rozanski <aris@redhat.com>
Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>
Acked-by: Borislav Petkov <bp@suse.de>
---
 drivers/edac/sb_edac.c | 3 +++
 1 file changed, 3 insertions(+)

Index: kernel/drivers/edac/sb_edac.c
===================================================================
--- kernel.orig/drivers/edac/sb_edac.c	2015-04-20 16:42:06.136151217 +0200
+++ kernel/drivers/edac/sb_edac.c	2015-04-20 16:47:27.796150648 +0200
@@ -1678,6 +1678,9 @@ static void sbridge_mce_output_error(str
 	 * EDAC core should be handling the channel mask, in order to point
 	 * to the group of dimm's where the error may be happening.
 	 */
+	if (!pvt->is_lockstep && !pvt->is_mirrored && !pvt->is_close_pg)
+		channel = first_channel;
+
 	snprintf(msg, sizeof(msg),
 		 "%s%s area:%s err_code:%04x:%04x socket:%d channel_mask:%ld rank:%d",
 		 overflow ? " OVERFLOW" : "",
