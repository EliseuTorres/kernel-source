From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: zfcp: Fix retry after failed "open port" erp action
References: bnc#617464,LTC#65806
Patch-mainline: Yes

Symptom:     A failed "port open" action is not retried.
Problem:     After a failed "port open", the strategy routine tries to
             enqueue a new erp action for the same port, but this will
             always fail.
Solution:    Instead of the enqueue, return ZFCP_ERP_FAILED to trigger
             an appropriate retry.

Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/scsi/zfcp_erp.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/drivers/s390/scsi/zfcp_erp.c	2010-07-06 12:42:04.000000000 +0200
+++ b/drivers/s390/scsi/zfcp_erp.c	2010-07-06 13:21:41.000000000 +0200
@@ -874,8 +874,7 @@ static int zfcp_erp_port_strategy_open_c
 		}
 		if (port->d_id && !(p_status & ZFCP_STATUS_COMMON_NOESC)) {
 			port->d_id = 0;
-			_zfcp_erp_port_reopen(port, 0, "erpsoc1", NULL);
-			return ZFCP_ERP_EXIT;
+			return ZFCP_ERP_FAILED;
 		}
 		/* fall through otherwise */
 	}
