Subject: kernel: fix dump indicator
References: BNC#563999
From: Gerald Schaefer <geraldsc@de.ibm.com>
Patch-mainline: 2.6.33-rc1
Git-commit: cb9d71604a6e3d6aa93bb663747a62fc520da483

Symptom: Kernel dump is not readable by the lcrash or crash utility.
Problem: An incorrect dump might be written in certain cases.
Solution: Set dump indicator on read-scp-info command to get meaningful
             dumps.
Acked-by: John Jolly <jjolly@suse.de>

---

 drivers/s390/char/sclp_cmd.c |    1 +
 1 file changed, 1 insertion(+)

Index: linux-sles11sp1/drivers/s390/char/sclp_cmd.c
===================================================================
--- linux-sles11sp1.orig/drivers/s390/char/sclp_cmd.c
+++ linux-sles11sp1/drivers/s390/char/sclp_cmd.c
@@ -84,6 +84,7 @@ static void __init sclp_read_info_early(
 		do {
 			memset(sccb, 0, sizeof(*sccb));
 			sccb->header.length = sizeof(*sccb);
+			sccb->header.function_code = 0x80;
 			sccb->header.control_mask[2] = 0x80;
 			rc = sclp_cmd_sync_early(commands[i], sccb);
 		} while (rc == -EBUSY);
