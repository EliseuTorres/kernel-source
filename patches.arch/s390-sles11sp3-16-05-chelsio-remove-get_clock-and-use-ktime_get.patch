From: Martin Schwidefsky <schwidefsky@de.ibm.com>
Subject: chelsio: remove get_clock and use ktime_get
Patch-mainline: v3.8-rc1
Git-commit: fd3065b25b69ce345073bbd294a73343a608fd8b
References: bnc#802343, FATE#83037, ltc#83040

The get_clock() of the chelsio driver clashes with the s390 one.
The chelsio helper reads a timespec via ktime just to convert it
back to ktime. I can see no different outcome from calling
ktime_get directly.

Remove the get_clock and use ktime_get directly.

Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/net/ethernet/chelsio/cxgb/sge.c |   13 +------------
 1 file changed, 1 insertion(+), 12 deletions(-)

--- a/drivers/net/ethernet/chelsio/cxgb/sge.c
+++ b/drivers/net/ethernet/chelsio/cxgb/sge.c
@@ -369,17 +369,6 @@ void t1_sched_set_drain_bits_per_us(stru
 
 
 /*
- * get_clock() implements a ns clock (see ktime_get)
- */
-static inline ktime_t get_clock(void)
-{
-	struct timespec ts;
-
-	ktime_get_ts(&ts);
-	return timespec_to_ktime(ts);
-}
-
-/*
  * tx_sched_init() allocates resources and does basic initialization.
  */
 static int tx_sched_init(struct sge *sge)
@@ -411,7 +400,7 @@ static int tx_sched_init(struct sge *sge
 static inline int sched_update_avail(struct sge *sge)
 {
 	struct sched *s = sge->tx_sched;
-	ktime_t now = get_clock();
+	ktime_t now = ktime_get();
 	unsigned int i;
 	long long delta_time_ns;
 
