From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: nss: add missing .previous statement to asm function
References: bnc#598553,LTC#62329
Patch-mainline: v2.6.34-rc4
Git-commit: 187644636ea79aa4bdc04757ebca919c4fd546e0

Symptom:     The kernel may panic or fail to IPL.
Problem:     The savesys_ipl_nss() asm function is put into the
             .init.text section.  However, it is missing a ".previous"
             statement which would restore the previous section.
             Depending on the compiler version used to built the kernel,
             code may or may not be placed into the correct section.
Solution:    Add the ".previous" statement to return to the previous
             section.

Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/kernel/early.c |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- a/arch/s390/kernel/early.c
+++ b/arch/s390/kernel/early.c
@@ -82,7 +82,8 @@ asm(
 	"	lm	6,15,24(15)\n"
 #endif
 	"	br	14\n"
-	"	.size	savesys_ipl_nss, .-savesys_ipl_nss\n");
+	"	.size	savesys_ipl_nss, .-savesys_ipl_nss\n"
+	"	.previous\n");
 
 static __initdata char upper_command_line[COMMAND_LINE_SIZE];
 


