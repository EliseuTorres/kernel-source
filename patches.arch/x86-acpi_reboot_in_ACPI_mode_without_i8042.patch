From: Thomas Renninger <trenn@suse.de>
Subject: Fix reboot issue with machines that do not have an i8042
References: bnc#703937
Patch-Mainline: yes and no (see below)

Mainline switched from BOOT_KBD to BOOT_ACPI unconditionally.
It's expected that this will cause regressions, therefore
BOOT_ACPI is only chosen by default if the ACPI FADT table
tells us that the system does not have an i8042 controller.

---
 arch/x86/kernel/reboot.c |   23 ++++++++++++++++-------
 1 file changed, 16 insertions(+), 7 deletions(-)

Index: linux-2.6.32-SLE11-SP2/arch/x86/kernel/reboot.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/arch/x86/kernel/reboot.c
+++ linux-2.6.32-SLE11-SP2/arch/x86/kernel/reboot.c
@@ -26,6 +26,8 @@
 # include <asm/iommu.h>
 #endif
 
+#include <acpi/acpi.h>
+
 /*
  * Power off function, if any
  */
@@ -35,6 +37,7 @@ EXPORT_SYMBOL(pm_power_off);
 static const struct desc_ptr no_idt = {};
 static int reboot_mode;
 enum reboot_type reboot_type = BOOT_KBD;
+static int __initdata reboot_param_set;
 int reboot_force;
 
 #if defined(CONFIG_X86_32) && defined(CONFIG_SMP)
@@ -109,6 +112,7 @@ static int __init reboot_setup(char *str
 		else
 			break;
 	}
+	reboot_param_set = 1;
 	return 1;
 }
 
@@ -279,13 +283,6 @@ static struct dmi_system_id __initdata r
 	{ }
 };
 
-static int __init reboot_init(void)
-{
-	dmi_check_system(reboot_dmi_table);
-	return 0;
-}
-core_initcall(reboot_init);
-
 /* The following code and data reboots the machine by switching to real
    mode and jumping to the BIOS reset entry point, as if the CPU has
    really been reset.  The previous version asked the keyboard
@@ -423,6 +420,18 @@ EXPORT_SYMBOL(machine_real_restart);
 
 #endif /* CONFIG_X86_32 */
 
+static int __init reboot_init(void)
+{
+	if (!(acpi_gbl_FADT.boot_flags & ACPI_FADT_8042) &&
+	    !reboot_param_set)
+		reboot_type = BOOT_ACPI;
+#ifdef CONFIG_X86_32
+	dmi_check_system(reboot_dmi_table);
+#endif
+	return 0;
+}
+core_initcall(reboot_init);
+
 /*
  * Some Apple MacBook and MacBookPro's needs reboot=p to be able to reboot
  */
