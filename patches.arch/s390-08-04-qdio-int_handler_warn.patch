From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: qdio: prevent kernel bug message in interrupt handler.
References: bnc#579111
Patch-mainline: v2.6.33-rc8
Git-commit: 959153d34544b7237bad263e73a5abdf94fc7722

Symptom:     A kernel bug message may be printed by qdio.
Problem:     Setting a qdio chpid offline during a qdio device shutdown
             can lead to a failing ccw_device_halt which leaves the qdio
             device in the stopped state. If an interrupt occurs before
             the final cleanup is done the unhandled stopped state triggers
             a kernel bug message.
Solution:    Add the stopped state to the known states in the interrupt
             handler and prevent the kernel bug message for the stopped state.
Problem-ID:  -
Distros:     RHEL4 : no
             RHEL5 : no
             SLES9 : no
             SLES10: no
             SLES11: yes
Preventive:  yes
Reported:    -
Introduced:  -
PMR:         -
ITPM:        -

Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/cio/qdio_main.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/drivers/s390/cio/qdio_main.c
+++ b/drivers/s390/cio/qdio_main.c
@@ -962,6 +962,8 @@ void qdio_int_handler(struct ccw_device 
 			qdio_handle_activate_check(cdev, intparm, cstat,
 						   dstat);
 		break;
+	case QDIO_IRQ_STATE_STOPPED:
+		break;
 	default:
 		WARN_ON(1);
 	}


