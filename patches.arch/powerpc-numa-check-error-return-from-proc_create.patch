Git-commit: 2d15b9b479512f05680541acffd9acbbc831a47c
From: Nishanth Aravamudan <nacc@linux.vnet.ibm.com>
Date: Thu, 9 Oct 2014 16:41:28 -0700
Subject: [PATCH] powerpc/numa: check error return from proc_create
Reference: bsc#924809
Patch-mainline: v3.18-rc2

proc_create can fail, we should check the return value and pass up the
failure.

Suggested-by: Michael Ellerman <mpe@ellerman.id.au>
Signed-off-by: Nishanth Aravamudan <nacc@linux.vnet.ibm.com>
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Acked-by: Dinar Valeev <dvaleev@suse.com>
---
 arch/powerpc/mm/numa.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

--- dev1/arch/powerpc/mm/numa.c	2015-03-30 18:47:54.930146609 -0500
+++ dev1/arch/powerpc/mm/numa.c	2015-03-30 18:48:37.080092320 -0500
@@ -1791,7 +1791,8 @@ static const struct file_operations topo
 static int topology_update_init(void)
 {
 	start_topology_update();
-	proc_create("powerpc/topology_updates", 644, NULL, &topology_ops);
+	if (!proc_create("powerpc/topology_updates", 0644, NULL, &topology_ops))
+		return -ENOMEM;
 
 	return 0;
 }

