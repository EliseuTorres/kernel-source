From: Sebastian Ott <sebott@linux.vnet.ibm.com>
Subject: s390/pci: fix removal of nonexistent pci bus
Patch-mainline: not yet
Git-commit: -
References: bnc#856307, LTC#101276

If we remove a pci bus after receiving a hotplug notification we need
to check if the bus is actually present (creation of the pci bus
during an earlier notification may have been failed).

Reviewed-by: Gerald Schaefer <gerald.schaefer@de.ibm.com>
Signed-off-by: Sebastian Ott <sebott@linux.vnet.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/pci/pci_event.c |    2 ++
 1 file changed, 2 insertions(+)

--- a/arch/s390/pci/pci_event.c
+++ b/arch/s390/pci/pci_event.c
@@ -116,6 +116,8 @@ static void __devinit __zpci_event_avail
 		 * Remove the pci root bus. Note that pcibios_remove_bus
 		 * isn't called by common code here, so we call it ourselves.
 		 */
+		if (!zdev)
+			break;
 		device_unregister(zdev->bus->bridge);
 		__pcibios_remove_bus(zdev->bus);
 		pci_remove_bus(zdev->bus);
