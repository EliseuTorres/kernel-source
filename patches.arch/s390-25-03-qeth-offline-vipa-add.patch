From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: qeth: enable VIPA add/remove for offline devices
References: bnc#657415,LTC#68589
Patch-mainline: Yes

Symptom:     setting up VIPA via QETH_OPTIONS in hw-cfg file fails
Problem:     missing check for card state in qeth_set_ip_addr_list
Solution:    check card start in qeth_set_ip_addr_list

Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/net/qeth_l3_main.c |    5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

--- a/drivers/s390/net/qeth_l3_main.c
+++ b/drivers/s390/net/qeth_l3_main.c
@@ -459,8 +459,11 @@ static void qeth_l3_set_ip_addr_list(str
 	QETH_DBF_TEXT(TRACE, 2, "sdiplist");
 	QETH_DBF_HEX(TRACE, 2, &card, sizeof(void *));
 
-	if (card->options.sniffer)
+	if ((card->state != CARD_STATE_UP &&
+	     card->state != CARD_STATE_SOFTSETUP) || card->options.sniffer) {
 		return;
+	}
+
 	spin_lock_irqsave(&card->ip_lock, flags);
 	tbd_list = card->ip_tbd_list;
 	card->ip_tbd_list = kmalloc(sizeof(struct list_head), GFP_ATOMIC);
