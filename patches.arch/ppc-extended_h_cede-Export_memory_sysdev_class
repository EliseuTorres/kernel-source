From: Nathan Fontenot <nfont at austin.ibm.com>
Subject: Export the memory_sysdev_class structure
Patch-mainline: 2.6.33
References: bnc#550447 / FATE#307059

From: Nathan Fontenot <nfont@austin.ibm.com>

Export the memory_sysdev_class structure.  This is needed so we can create
a 'release' file in sysfs in addition to the existing 'probe' file in
order to support DLPAR removal of memory on the powerpc/pseries platform.
The new 'release' file will be powerpc/pseries only.

Signed-off-by: Nathan Fontenot <nfont at austin.ibm.com>
Acked-by: <duwe@suse.de>

---
 drivers/base/memory.c          |    3 ++-
 include/linux/memory_hotplug.h |    2 ++
 2 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/drivers/base/memory.c b/drivers/base/memory.c
index 989429c..facefe4 100644
--- a/drivers/base/memory.c
+++ b/drivers/base/memory.c
@@ -28,9 +28,10 @@
 
 #define MEMORY_CLASS_NAME	"memory"
 
-static struct sysdev_class memory_sysdev_class = {
+struct sysdev_class memory_sysdev_class = {
 	.name = MEMORY_CLASS_NAME,
 };
+EXPORT_SYMBOL_GPL(memory_sysdev_class);
 
 static const char *memory_uevent_name(struct kset *kset, struct kobject *kobj)
 {
diff --git a/include/linux/memory_hotplug.h b/include/linux/memory_hotplug.h
index fed9692..80c6700 100644
--- a/include/linux/memory_hotplug.h
+++ b/include/linux/memory_hotplug.h
@@ -12,6 +12,8 @@ struct mem_section;
 
 #ifdef CONFIG_MEMORY_HOTPLUG
 
+extern struct sysdev_class memory_sysdev_class;
+
 /*
  * Types for free bootmem.
  * The normal smallest mapcount is -1. Here is smaller value than it.
