From fab04b2208dd1d4121319f0096c5a5f4b70abc54 Mon Sep 17 00:00:00 2001
From: Len Brown <len.brown@intel.com>
Date: Sat, 9 Nov 2013 00:30:17 -0500
Subject: [PATCH] intel_idle: Support Intel Atom Processor C2000 Product Family

Git-commit: fab04b2208dd1d4121319f0096c5a5f4b70abc54
Patch-mainline: v3.13
References: fate#317428
Target: SLE11 SP4

Support the "Intel(R) Atom(TM) Processor C2000 Product Family",
formerly code-named Avoton.  It is based on the next generation
Intel Atom processor architecture, formerly code-named Silvermont.

Joey Lee:
Modified original patch fulfeel intel_idle_probe() in v3.0 intel_idel driver.

Signed-off-by: Len Brown <len.brown@intel.com>
Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Acked-by: Lee, Chun-Yi <jlee@suse.com>
---
 drivers/idle/intel_idle.c | 24 +++++++++++++++++++++++-
 1 file changed, 23 insertions(+), 1 deletion(-)

Index: linux-3.0-SLE11-SP4/drivers/idle/intel_idle.c
===================================================================
--- linux-3.0-SLE11-SP4.orig/drivers/idle/intel_idle.c	2015-05-21 18:06:36.073463955 +0200
+++ linux-3.0-SLE11-SP4/drivers/idle/intel_idle.c	2015-05-21 18:06:38.065575802 +0200
@@ -345,6 +345,23 @@
 		.enter = &intel_idle },
 };
 
+static struct cpuidle_state avn_cstates[CPUIDLE_STATE_MAX] = {
+	{
+		.name = "C1-AVN",
+		.desc = "MWAIT 0x00",
+		.flags = CPUIDLE_FLAG_TIME_VALID,
+		.exit_latency = 2,
+		.target_residency = 2,
+		.enter = &intel_idle },
+	{
+		.name = "C6-AVN",
+		.desc = "MWAIT 0x51",
+		.flags = CPUIDLE_FLAG_TIME_VALID | CPUIDLE_FLAG_TLB_FLUSHED,
+		.exit_latency = 15,
+		.target_residency = 45,
+		.enter = &intel_idle },
+};
+
 /**
  * intel_idle
  * @dev: cpuidle_device
@@ -510,6 +527,10 @@
 		cpuidle_state_table = hsw_cstates;
 		break;
 
+	case 0x4d:	/* AVN */
+		cpuidle_state_table = avn_cstates;
+		break;
+
 	case 0x3d:	/* BDW */
 	case 0x47:	/* BDW */
 	case 0x4f:	/* BDW */
