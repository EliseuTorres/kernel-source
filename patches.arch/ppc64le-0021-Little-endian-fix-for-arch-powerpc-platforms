From: Philippe Bergheaud <felix@linux.vnet.ibm.com>
Subject: powerpc: Little endian fix for
Git-commit: 044cb69c53f286673b6809641f9c0ce929f9f221
Patch-mainline: v3.13-rc1
References: bnc#856774 fate#315275, LTC#92305
 arch/powerpc/platforms/powernv/pci.c

Summary:     powerpc: add little-endian support
Description: Add little-endian support for POWER8.

Upstream-Description:

    powerpc: Little endian fix for
     arch/powerpc/platforms/powernv/pci.c

Signed-off-by: Alistair Popple <alistair@popple.id.au>
Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>

Signed-off-by: Philippe Bergheaud <felix@linux.vnet.ibm.com>
Acked-by: Torsten Duwe <duwe@suse.de>
---
 arch/powerpc/platforms/powernv/pci.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

Index: linux-3.12-SLE12/arch/powerpc/platforms/powernv/pci.c
===================================================================
--- linux-3.12-SLE12.orig/arch/powerpc/platforms/powernv/pci.c
+++ linux-3.12-SLE12/arch/powerpc/platforms/powernv/pci.c
@@ -605,8 +605,8 @@ void pnv_pci_setup_iommu_table(struct io
 static struct iommu_table *pnv_pci_setup_bml_iommu(struct pci_controller *hose)
 {
 	struct iommu_table *tbl;
-	const __be64 *basep, *swinvp;
-	const __be32 *sizep;
+	const __be64 *basep;
+	const __be32 *sizep, *swinvp;
 
 	basep = of_get_property(hose->dn, "linux,tce-base", NULL);
 	sizep = of_get_property(hose->dn, "linux,tce-size", NULL);
@@ -627,8 +627,9 @@ static struct iommu_table *pnv_pci_setup
 	swinvp = of_get_property(hose->dn, "linux,tce-sw-invalidate-info",
 				 NULL);
 	if (swinvp) {
-		tbl->it_busno = be64_to_cpu(swinvp[1]);
-		tbl->it_index = (unsigned long)ioremap(be64_to_cpup(swinvp), 8);
+		tbl->it_busno = of_read_ulong(&swinvp[1], 2);
+		tbl->it_index =
+			(unsigned long)ioremap(of_read_number(swinvp, 2), 8);
 		tbl->it_type = TCE_PCI_SWINV_CREATE | TCE_PCI_SWINV_FREE;
 	}
 	return tbl;
