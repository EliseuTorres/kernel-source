From: Takashi Iwai <tiwai@suse.de>
Subject: x86: Fix S4 regression
Patch-mainline: Submitted
References: bnc#714605

The commit 4b239f458: [x86-64, mm: Put early page table high] causes
a S4 regression, namely the machine reboots occasionally at S4 resume.

This patch reverts the memory assignment in the older way to prevent
the reboot problem.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
 arch/x86/mm/init.c |    3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

--- a/arch/x86/mm/init.c
+++ b/arch/x86/mm/init.c
@@ -63,9 +63,8 @@
 #ifdef CONFIG_X86_32
 	/* for fixmap */
 	tables += roundup(__end_of_fixed_addresses * sizeof(pte_t), PAGE_SIZE);
-
-	good_end = max_pfn_mapped << PAGE_SHIFT;
 #endif
+	good_end = max_pfn_mapped << PAGE_SHIFT;
 
 	base = memblock_find_in_range(start, good_end, tables, PAGE_SIZE);
 	if (base == MEMBLOCK_ERROR)
