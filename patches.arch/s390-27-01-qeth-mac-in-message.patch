From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: qeth: wrong MAC-address displayed in error message
References: bnc#671296,LTC#69730
Patch-mainline: Yes

Symptom:     actual MAC-address displayed in error message
Problem:     Setting of a MAC-address may fail because an already
             used MAC-address is to bet set or because of
             authorization problems. In those cases qeth issues a
             message, but the mentioned MAC-address is not the new
             MAC-address to be set, but the actual MAC-address.
Solution:    Choose the new MAC-address to be set for the error
             messages.

Acked-by: John Jolly <jjolly@suse.de>

---
 drivers/s390/net/qeth_l2_main.c |   25 +++++++------------------
 1 file changed, 7 insertions(+), 18 deletions(-)

--- a/drivers/s390/net/qeth_l2_main.c
+++ b/drivers/s390/net/qeth_l2_main.c
@@ -496,22 +496,14 @@ static int qeth_l2_send_setmac_cb(struct
 		case IPA_RC_L2_DUP_MAC:
 		case IPA_RC_L2_DUP_LAYER3_MAC:
 			dev_warn(&card->gdev->dev,
-				"MAC address "
-				"%2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x "
-				"already exists\n",
-				card->dev->dev_addr[0], card->dev->dev_addr[1],
-				card->dev->dev_addr[2], card->dev->dev_addr[3],
-				card->dev->dev_addr[4], card->dev->dev_addr[5]);
+				"MAC address %pM already exists\n",
+				cmd->data.setdelmac.mac);
 			break;
 		case IPA_RC_L2_MAC_NOT_AUTH_BY_HYP:
 		case IPA_RC_L2_MAC_NOT_AUTH_BY_ADP:
 			dev_warn(&card->gdev->dev,
-				"MAC address "
-				"%2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x "
-				"is not authorized\n",
-				card->dev->dev_addr[0], card->dev->dev_addr[1],
-				card->dev->dev_addr[2], card->dev->dev_addr[3],
-				card->dev->dev_addr[4], card->dev->dev_addr[5]);
+				"MAC address %pM is not authorized\n",
+				cmd->data.setdelmac.mac);
 			break;
 		default:
 			break;
@@ -522,12 +514,9 @@ static int qeth_l2_send_setmac_cb(struct
 		memcpy(card->dev->dev_addr, cmd->data.setdelmac.mac,
 		       OSA_ADDR_LEN);
 		dev_info(&card->gdev->dev,
-			"MAC address %2.2x:%2.2x:%2.2x:%2.2x:%2.2x:%2.2x "
-			"successfully registered on device %s\n",
-			card->dev->dev_addr[0], card->dev->dev_addr[1],
-			card->dev->dev_addr[2], card->dev->dev_addr[3],
-			card->dev->dev_addr[4], card->dev->dev_addr[5],
-			card->dev->name);
+			"MAC address %pM successfully registered on "
+			"device %s\n",
+			card->dev->dev_addr, card->dev->name);
 	}
 	return 0;
 }
