From: Aristeu Rozanski <arozansk@redhat.com>
Date: Wed, 30 Oct 2013 13:27:05 -0300
Subject: sb_edac: avoid decoding the same error multiple times
Git-commit: be3036d220c9f9350c9da92e9b4e66855cf90889
Patch-mainline: v3.13-rc1
References: fate#318187

Whenever the extended error reporting is active, multiple MCEs will be
generated for the same event, which will lead to multiple repeated
errors to be reported. So check ADDRV and only decode the error if the
MCE address is valid.

Signed-off-by: Aristeu Rozanski <arozansk@redhat.com>
Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>
Acked-by: Borislav Petkov <bp@suse.de>
---
 drivers/edac/sb_edac.c | 4 ++++
 1 file changed, 4 insertions(+)

Index: current/drivers/edac/sb_edac.c
===================================================================
--- current.orig/drivers/edac/sb_edac.c	2015-04-20 21:12:12.344122532 +0200
+++ current/drivers/edac/sb_edac.c	2015-04-20 21:12:19.160122520 +0200
@@ -1427,6 +1427,10 @@ static void sbridge_mce_output_error(str
 		}
 	}
 
+	/* Only decode errors with an valid address (ADDRV) */
+	if (!GET_BITFIELD(m->status, 58, 58))
+		return;
+
 	rc = get_memory_error_data(mci, m->addr, &socket,
 				   &channel_mask, &rank, &area_type, msg);
 	if (rc < 0)
