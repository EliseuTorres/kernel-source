From: Gerald Schaefer <geraldsc@de.ibm.com>
Subject: qeth: l3 add vlan hdr in passthru frames
References: bnc#657415,LTC#68532
Patch-mainline: Yes

Symptom:     Using arping to create a gratuitous ARP on a vlan
             device, creates the ARP frame without a vlan tag.
Problem:     OSA l3 mode is hw accelerated VLAN only for IPv4.
Solution:    Take care we add the vlan hdr to a passthru frame in the
             device driver.

Acked-by: John Jolly <jjolly@suse.de>
---
 drivers/s390/net/qeth_l3_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/s390/net/qeth_l3_main.c
+++ b/drivers/s390/net/qeth_l3_main.c
@@ -2926,7 +2926,7 @@ static int qeth_l3_hard_start_xmit(struc
 				skb_pull(new_skb, ETH_HLEN);
 		}
 
-		if (ipv == 6 && card->vlangrp &&
+		if (ipv != 4 && card->vlangrp &&
 				vlan_tx_tag_present(new_skb)) {
 			skb_push(new_skb, VLAN_HLEN);
 			skb_copy_to_linear_data(new_skb, new_skb->data + 4, 4);
