From: Thomas Renninger <trenn@suse.de>
Subject: cpufreq powernow-k8: Remove firmware warning in zero transition latency case
Patch-Mainline: not yet, submitted
References: bnc#698604

AMD's BKDG documents that a zero transition latency should get passed for
several recent CPU models.
-> This isn't a firmware bug.

I did not dare to really pass the zero latency to the cpufreq core,
this would need careful checking whether this does not show side effects.
-> Still modify latency to 1 (us) in case BIOS passes zero.

Signed-off-by: Thomas Renninger <trenn@suse.de>

---
 arch/x86/kernel/cpu/cpufreq/powernow-k8.c |   14 ++------------
 1 file changed, 2 insertions(+), 12 deletions(-)

Index: linux-2.6.32-SLE11-SP2/arch/x86/kernel/cpu/cpufreq/powernow-k8.c
===================================================================
--- linux-2.6.32-SLE11-SP2.orig/arch/x86/kernel/cpu/cpufreq/powernow-k8.c
+++ linux-2.6.32-SLE11-SP2/arch/x86/kernel/cpu/cpufreq/powernow-k8.c
@@ -1014,19 +1014,9 @@ static int get_transition_latency(struct
 		if (cur_latency > max_latency)
 			max_latency = cur_latency;
 	}
-	if (max_latency == 0) {
-		/*
-		 * Fam 11h always returns 0 as transition latency.
-		 * This is intended and means "very fast". While cpufreq core
-		 * and governors currently can handle that gracefully, better
-		 * set it to 1 to avoid problems in the future.
-		 * For all others it's a BIOS bug.
-		 */
-		if (boot_cpu_data.x86 != 0x11)
-			printk(KERN_ERR FW_WARN PFX "Invalid zero transition "
-				"latency\n");
+	if (max_latency == 0)
 		max_latency = 1;
-	}
+
 	/* value in usecs, needs to be in nanoseconds */
 	return 1000 * max_latency;
 }
