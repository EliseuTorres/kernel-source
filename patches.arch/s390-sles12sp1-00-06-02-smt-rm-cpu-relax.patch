From: Martin Schwidefsky <schwidefsky@de.ibm.com>
Subject: s390: remove diag 44 calls from cpu_relax()
Patch-mainline: v3.19-rc1
Git-commit: 57f2ffe14fd125c240babd88b99d8a57d3ed060e
References: bsc#934387,FATE#318041,LTC#KRN1216

Summary:     s390: add multi-threading support
Description: With this feature, the Linux kernel can make use of the
             multi-threading facility. With the multi-threading facility
             enabled a single core will surface multiple CPUs. In Linux
             terms this is called SMT or Hyperthreading support.

Upstream-Description:

             s390: remove diag 44 calls from cpu_relax()

             Simplify cpu_relax() to a simple barrier(). Performance wise this doesn't
             seem to make any big difference anymore, since nearly all lock variants
             have directed yield semantics in the meantime.
             Also this makes s390 behave like all other architectures.

             Signed-off-by: Heiko Carstens <heiko.carstens@de.ibm.com>
             Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>


Signed-off-by: Martin Schwidefsky <schwidefsky@de.ibm.com>
Acked-by: John Jolly <jjolly@suse.de>
---
 arch/s390/include/asm/processor.h |    2 --
 1 file changed, 2 deletions(-)

--- a/arch/s390/include/asm/processor.h
+++ b/arch/s390/include/asm/processor.h
@@ -192,8 +192,6 @@ static inline unsigned short stap(void)
  */
 static inline void cpu_relax(void)
 {
-	if (MACHINE_HAS_DIAG44)
-		asm volatile("diag 0,0,68");
 	barrier();
 }
 
